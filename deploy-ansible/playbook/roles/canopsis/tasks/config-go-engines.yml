---
- name: Create canopsis-engine-go .service directory
  file: path=/etc/systemd/system/canopsis-engine-go@.service.d state=directory

- name: Deploy common environment variables for Go engines
  template:
    src: go-engines/all-go-engines.j2
    dest: "/etc/systemd/system/canopsis-engine-go@.service.d/all-go-engines.conf"

- name: Reload systemd
  systemd:
    daemon-reload: yes

- name: Override initialisation.toml with initialisation.toml.example
  copy:
    src: "{{ canopsis_home }}/etc/initialisation.toml.example"
    dest: "{{ canopsis_home }}/etc/initialisation.toml"

- name: Override amqp2engines.conf with amqp2engines-go.conf.example
  copy:
    src: "{{ canopsis_home }}/etc/amqp2engines-go.conf.example"
    dest: "{{ canopsis_home }}/etc/amqp2engines.conf"
