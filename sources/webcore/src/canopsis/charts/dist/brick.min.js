Ember.Application.initializer({name:"component-c3categorychart",after:["HashUtils","ValuesUtils"],initialize:function(e,t){var i=e.lookupFactory("utility:hash"),o=e.lookupFactory("utility:values"),r=Ember.get,n=Ember.set,s=Ember.isNone,a=Ember.String.loc,c=Ember.Component.extend({init:function(){this._super(),Ember.setProperties(this,{uuid:i.generateId("categoryChart"),"parentController.chartComponent":this})},willDestroyElement:function(){var e=r(this,"chart");s(e)||e.destroy()},maxValue:function(){var e=r(this,"parentController.options.max_value"),t=r(this,"parentController.options.use_max_value"),i=r(this,"seriesSum");return t&&!s(e)&&e>i?e:i}.property("parentController.options.max_value"),seriesSum:function(){for(var e=0,t=r(this,"seriesWithComputedNames"),i=0;i<t.length;i++)e+=t[i][1];return e}.property("series"),seriesNames:function(){for(var e=[],t=r(this,"c3series"),i=t.length,o=0;i>o;o++)e.push(t[o][0]);return e}.property("series"),seriesWithComputedNames:function(){var e,t,i=["type","connector","connector_name","component","resource","metric"],o=$.extend(!0,[],r(this,"series")),n=[];console.log("seriesWithMeta",o);var s=o.length;for(e=0;s>e;e++){var a=o[e].serie,c=o[e].id;console.log("meta serie",c,a);var l=c.split("/"),h={},m=l.length;for(t=0;m>t;t++)h[i[t]]=l[t+1];console.log("Template context",h,"for metric",c);var u=r(this,"parentController.options.metric_template");try{a[0]=Handlebars.compile(u)(h)}catch(d){console.log("could not proceed template feed",d)}n.push(a)}return n}.property(),c3series:function(){console.log("chart series is now",r(this,"series"));var e=r(this,"maxValue")-r(this,"seriesSum"),t=r(this,"seriesWithComputedNames");if(e>0){var i=r(this,"parentController.options.text_left_space");t.push([i,e])}return t.sort(function(e,t){return t[1]-e[1]}),t}.property("series"),colors:function(){for(var e=r(this,"seriesNames"),t={leftValueLabel:"#EEEEEE"},i=0;i<e.length;i++)t[e[i]]=["#FF0000","#F97600"][i];return t}.property("seriesNames"),didInsertElement:function(){n(this,"domready",!0)},generateChart:function(){if(s(r(this,"domready")))return void console.log("Dom is not ready for category chart, cannot draw");if(s(r(this,"parentController.options")))return void console.log("Chart options are not ready cannot draw");var e="#"+r(this,"uuid"),t=r(this,"seriesSum"),i=r(this,"seriesNames"),c=r(this,"c3series"),l=(r(this,"colors"),r(this,"maxValue")),h=r(this,"parentController.options.text_left_space"),m=r(this,"parentController.options.display"),u=r(this,"parentController.options.show_legend"),d=r(this,"parentController.options.show_tooltip"),p=r(this,"parentController.options.show_labels"),f=r(this,"parentController.options.stacked"),g=r(this,"parentController.options.human_readable"),v=!1,x=!0,b=!0;t=g?o.humanize(t,""):t.toFixed(2);var y={show:p,format:function(e,i){return p?t:""}},w={label:y},_={},S={title:p&&t?t:""};console.log("seriesNames",i),console.log("c3series",c),"progressbar"==m&&(b=!1,m="bar",v=!0,x=!1,p=!1),l>0&&(w.max=l,l>t&&-1===$.inArray(h,i)&&i.push(h));var E={bindto:e,groups:i,tooltip:{show:d},legend:{show:u},data:{columns:c,type:m,groups:[i],labels:{format:function(e,t,i,r){return e=g?o.humanize(e,""):parseFloat(e).toFixed(2),p?t+" : "+e:""}},empty:{label:{text:a("No Data")}}},gauge:w,donut:S,pie:_,axis:{rotated:v,x:{show:x},y:{tick:{format:function(e){return g?o.humanize(e,""):parseFloat(e).toFixed(2)}},show:x}}};"bar"!==m||f||(delete E.groups,delete E.data.groups);var C=c3.generate(E);n(this,"chart",C)},update:function(){var e=r(this,"chart");if(s(e))this.generateChart();else{console.log("refreshing c3 chart with series",r(this,"c3series"));var t=r(this,"seriesNames");t.length&&e.unload({ids:t}),e.load({columns:r(this,"c3series"),groups:[r(this,"seriesNames")]})}}.observes("series","ready","parentController.options"),actions:{transform:function(e){r(this,"chart").destroy(),n(this,"parentController.options.display",e),this.generateChart()}}});t.register("component:component-c3categorychart",c)}}),Ember.Application.initializer({name:"c3jsComponent",initialize:function(e,t){var i=Ember.get,o=Ember.set,r=Ember.isNone,n=Ember.Component.extend({didInsertElement:function(){this.renderChart()},renderChart:function(){var e=i(this,"series"),t=i(this,"chart");r(t)||t.destroy(),o(e,"bindto","#"+this.elementId),t=c3.generate(e),o(this,"chart",t)}.observes("series"),willDestroyElement:function(){var e=i(this,"chart");r(e)||e.destroy()}});t.register("component:component-c3js",n)}}),Ember.Application.initializer({name:"component-flotchart",after:"ValuesUtils",initialize:function(e,t){var i=e.lookupFactory("utility:values"),o=Ember.get,r=Ember.set,n=Ember.isNone,s=Ember.Component.extend({tagName:"div",classNames:"flotchart",init:function(){r(this,"chart",null),n(o(this,"options"))&&r(this,"options",null),n(o(this,"series"))&&r(this,"series",[]),n(o(this,"human"))&&r(this,"human",!1),this._super.apply(this,arguments),this.addObserver("series.@each",this.onDataUpdate),this.addObserver("options",this.onOptionsUpdate)},onDataUpdate:function(){this.send("renderChart")},onOptionsUpdate:function(){this.send("renderChart")},didInsertElement:function(){this.send("renderChart")},actions:{renderChart:function(){var e=o(this,"chart");null!==e&&(console.log("Destroy chart"),e.destroy()),this.createChart()},toggleSerie:function(e){var t=e[0],i=e[1],r=o(this,"series"),n=r[i];console.log("Toggling serie:",t,i,n),n.config.lines&&n.lines&&(n.lines.show=!n.lines.show),n.config.bars&&n.bars&&(n.bars.show=!n.bars.show),n.config.points&&n.points&&(n.points.show=!n.points.show),n.config.values&&n.values&&(n.values.show=!n.values.show),n.hidden=!n.hidden,n.hidden?n.color="#CCCCCC":n.color=n.config.color,this.send("renderChart"),this.$().trigger("toggleserie",[e])}},classifiedSeries:function(){for(var e=o(this,"series"),t={x:{},y:{}},i=0,r=e.length;r>i;i++){var n=e[i];n.index=i,void 0===t.x[n.xaxis]&&(t.x[n.xaxis]=[]),t.x[n.xaxis].push(n),void 0===t.y[n.yaxis]&&(t.y[n.yaxis]=[]),t.y[n.yaxis].push(n)}return t}.property("series.@each"),createAxes:function(){var e,t,r=o(this,"options"),n=o(this,"classifiedSeries"),s=Object.keys(n.x),a=Object.keys(n.y);for(e=0,t=s.length;t>e;e++){var c=s[e],l=c-1;void 0===r.xaxes[l]&&(r.xaxes[l]={show:!0,reserveSpace:!0,position:l%2===0?"bottom":"top",color:n.x[c][0].color,font:{color:n.x[c][0].color}})}var h=this;for(e=0,t=a.length;t>e;e++){var c=a[e],l=c-1;void 0===r.yaxes[l]&&(r.yaxes[l]={show:!0,reserveSpace:!0,position:l%2==0?"left":"right",color:n.y[c][0].color,font:{color:n.y[c][0].color}}),r.yaxes[l].tickFormatter=function(e,t){if(o(h,"human")===!0){var r=n.y[t.n][0].unit||"";e=i.humanize(e,r)}return e}}},createLegend:function(){var e=o(this,"options"),t=this;e&&e.legend&&e.legend.show&&void 0===e.legend.labelFormatter&&(e.legend.labelFormatter=function(e,i){console.log("Format label for serie:",e,i);var o="cursor: pointer; margin-left: 5px;";i.hidden&&(o+=" font-style: italic;");var r=$("<span/>",{style:o,onclick:['Ember.View.views["',t.elementId,'"].send("toggleSerie", [','"',e,'",',i.index,"]);"].join(""),text:e}),n=$("<div/>");return n.append(r),n.html()})},createChart:function(){console.group("createChart:");var e=this.$(),t=o(this,"series"),i=o(this,"options");console.log("options (before):",i),null!==o(this,"options")&&(this.createAxes(),this.createLegend(),this.autoscale(),console.log("series:",t),console.log("options:",i),r(this,"chart",$.plot(e,t,i))),console.groupEnd()},autoscale:function(){for(var e=o(this,"classifiedSeries"),t=o(this,"options"),i=Object.keys(e.y),r=0,n=i.length;n>r;r++){for(var s=i[r],a=s-1,c=e.y[s].length,l=null,h=null,m=!1,u=0;c>u;u++){var d=e.y[s][u];if(!d.hidden){var p=this.getSerieBoundaries(d);(null===l||p[0]<l)&&(l=p[0]),(null===h||p[1]>h)&&(h=p[1])}d.values.show&&(m=!0)}var f,g=m?115:105,v=h+30,x=100*v/h;if(x>g&&(v=h*g/100),0>l||l>30){l=-l,f=l+30;var b=100*l/l;b>g&&(f=l*g/100),f=-f}else f=0;t.yaxes[a].min=f,t.yaxes[a].max=v}},refreshChart:function(){var e=o(this,"chart"),t=o(this,"series");console.log("flotchart refresh series:",t),this.autoscale(),e.setData(t),e.setupGrid(),e.draw()},getSerieBoundaries:function(e){for(var t=null,i=null,r=o(this,"options"),n=0,s=e.data.length;s>n;n++){var a=e.data[n];if(a[0]>r.xaxis.max)break;a[0]>=r.xaxis.min&&((null===t||a[1]<t)&&(t=a[1]),(null===i||a[1]>i)&&(i=a[1]))}return[t,i]}});t.register("component:component-flotchart",s)}}),Ember.Application.initializer({name:"component-metricitemeditor",initialize:function(e,t){var i=window.schemasRegistry,o=Ember.get,r=Ember.set,n=Ember.Component.extend({init:function(){this._super(arguments),r(this,"componentDataStore",DS.Store.create({container:o(this,"container"),"parentController.chartComponent":this}));var e="stylizedmetric",t=i.getByName(e).EmberModel.proto();console.log("Fetch model:",e,t);var n={},s=this;console.group("Create virtual attributes for serieitem:"),t.eachAttribute(function(e,t){var i="content.value."+e,a="item."+e+".value",c=o(s,i),l=o(t,"options.default"),h=c||l;n[e]=Ember.Object.create({value:h,model:t}),s.addObserver(a,function(){var e=o(s,a);r(s,i,e)}),void 0!==h&&r(s,i,h),console.log(e,c,l,n[e])}),console.groupEnd(),r(this,"item",Ember.Object.create(n))}});t.register("component:component-metricitemeditor",n)}}),Ember.Application.initializer({name:"component-metricselector",after:"HashUtils",initialize:function(e,t){var i=e.lookupFactory("utility:hash"),o=Ember.get,r=Ember.set,n=Ember.isNone,s=Ember.String.loc,a=Ember.Component.extend({valueChanged:function(){for(var e=o(this,"selectedMetrics")||[],t=[],i=0,n=e.length;n>i;i++){var s=o(e[i],"id");t.push(s)}o(this,"multiselect")===!0?r(this,"content",t):r(this,"content",t[0])}.observes("selectedMetrics.@each"),helpModal:{title:s("Syntax"),content:["<ul>","<li><code>co:regex</code> : ",s("look for a component"),"</li>","<li><code>re:regex</code> : ",s("look for a resource"),"</li>","<li><code>me:regex</code> : ",s("look for a metric"),"(<code>me:</code>",s(" isn't needed for this one"),")</li>","<li>",s("combine all of them to improve your search")," : <code>co:regex re:regex me:regex</code></li>","<li><code>co:</code>, <code>re:</code>, <code>me:</code> : ",s("look for non-existant field"),"</li>","</ul>"].join(""),id:i.generateId("cmetric-help-modal"),label:i.generateId("cmetric-help-modal-label")},select_cols:function(){return[{name:"component",title:s("Component")},{name:"resource",title:s("Resource")},{name:"name",title:s("Metric")},{action:"select",actionAll:o(this,"multiselect")===!0?"selectAll":void 0,title:new Ember.Handlebars.SafeString('<span class="glyphicon glyphicon-plus-sign"></span>'),style:"text-align: center;"}]}.property(),unselect_cols:function(){return[{name:"component",title:s("Component")},{name:"resource",title:s("Resource")},{name:"name",title:s("Metric")},{action:"unselect",actionAll:"unselectAll",title:new Ember.Handlebars.SafeString('<span class="glyphicon glyphicon-trash"></span>'),style:"text-align: center;"}]}.property(),init:function(){n(o(this,"selectedMetrics"))&&r(this,"selectedMetrics",[]),n(o(this,"metricSearch"))&&r(this,"metricSearch",null),n(o(this,"multiselect"))&&r(this,"multiselect",!0),r(this,"metrics",[]),this._super.apply(this,arguments);var e=DS.Store.create({container:this.get("container")});r(this,"componentDataStore",e);var t={filter:{_id:void 0}},i=this;if(!n(o(this,"content"))){if(o(this,"multiselect")===!0){var s=o(this,"content")||[];t.filter._id={$in:s}}else t.filter._id=o(this,"content");e.findQuery("ctxmetric",t).then(function(e){var t=o(i,"selectedMetrics")||[],n=o(e,"content"),s=o(e,"meta.total");console.log("Received data:",s,n,t);for(var a=0;s>a;a++)t.pushObject(n[a]);r(i,"selectedMetrics",t)})}},build_filter:function(e){var t,i=e.split(" "),o={component:[],resource:[],name:[]};for(t=0;t<i.length;t++){var r=i[t];if(""!==r){var n=r.slice(3)||null;0===r.indexOf("co:")?o.component.push(n):0===r.indexOf("re:")?o.resource.push(n):0===r.indexOf("me:")?o.name.push(n):o.name.push(r)}}var s={$and:[]},a={component:{$or:[]},resource:{$or:[]},name:{$or:[]}};for(var c in a){for(t=0;t<o[c].length;t++){var l={},h=o[c][t];null!==h?l[c]={$regex:h}:l[c]=null,a[c].$or.push(l)}var m=a[c].$or.length;1===m&&(a[c]=a[c].$or[0]),m>0&&s.$and.push(a[c])}return 1===s.$and.length&&(s=s.$and[0]),s},actions:{select:function(e){var t=o(this,"selectedMetrics");t.indexOf(e)<0&&(console.log("Select metric:",e),o(this,"multiselect")===!0?t.pushObject(e):t=[e]),r(this,"selectedMetrics",t)},unselect:function(e){var t=o(this,"selectedMetrics"),i=t.indexOf(e);i>=0&&(console.log("Unselect metric:",e),t.removeAt(i)),r(this,"selectedMetrics",t)},selectAll:function(){if(o(this,"multiselect")===!0){var e=o(this,"metrics");r(this,"selectedMetrics",e)}},unselectAll:function(){r(this,"selectedMetrics",[])},search:function(e){if(e){var t=this.build_filter(e);r(this,"metricSearch",t)}else r(this,"metricSearch",null)}}});t.register("component:component-metricselector",a)}}),Ember.Application.initializer({name:"component-metricselector2",after:"HashUtils",initialize:function(e,t){var i=e.lookupFactory("utility:hash"),o=Ember.get,r=Ember.set,n=Ember.isNone,s=Ember.String.loc,a=Ember.Component.extend({additionnalSelectionButtons:["removeitembutton"],helpModal:{title:s("Syntax"),content:["<ul>","<li><code>co:regex</code> : ",s("look for a component"),"</li>","<li><code>re:regex</code> : ",s("look for a resource"),"</li>","<li><code>me:regex</code> : ",s("look for a metric"),"(<code>me:</code>",s(" isn't needed for this one"),")</li>","<li>",s("combine all of them to improve your search")," : <code>co:regex re:regex me:regex</code></li>","<li><code>co:</code>, <code>re:</code>, <code>me:</code> : ",s("look for non-existant field"),"</li>","</ul>"].join(""),id:i.generateId("cmetric-help-modal"),label:i.generateId("cmetric-help-modal-label")},select_cols:function(){return[{name:"component",title:s("Component")},{name:"resource",title:s("Resource")},{name:"cid",title:s("Metric")},{action:"select",actionAll:o(this,"multiselect")===!0?"selectAll":void 0,title:new Ember.Handlebars.SafeString('<span class="glyphicon glyphicon-plus-sign"></span>'),style:"text-align: center;"}]}.property(),init:function(){n(o(this,"selectedMetrics"))&&r(this,"selectedMetrics",[]),n(o(this,"metricSearch"))&&r(this,"metricSearch",null),n(o(this,"multiselect"))&&r(this,"multiselect",!0),r(this,"metrics",[]),this._super.apply(this,arguments);var e=DS.Store.create({container:this.get("container")});r(this,"componentDataStore",e);var t={filter:{_id:void 0}},i=this;if(!n(o(this,"content"))){if(o(this,"multiselect")===!0){var s=o(this,"content")||[];t.filter._id={$in:s}}else t.filter._id=o(this,"content");e.findQuery("ctxmetric",t).then(function(e){var t=[],n=o(e,"content");console.log("Received data:",c,s,t);for(var a=0,c=n.length;c>a;a++)t.pushObject(n[a]);r(i,"metrics",t)})}},actions:{select:function(e){var t=o(this,"content.value")||[];t.indexOf(e)<0&&(console.log("Select metric:",e),e={metric:e.get("id"),color:"#B7CA79",curve:"curve.simplepoints",unit:null,xaxis:1,xtype:"stylizedmetric",yaxis:1},o(this,"multiselect")===!0?t.pushObject(e):t=[e]),r(this,"content.value",t)},unselect:function(e){console.error("unselect",e);var t=o(this,"content.value"),i=t.indexOf(e);i>=0&&(console.log("Unselect metric:",e),t.removeAt(i)),r(this,"content.value",t)},selectAll:function(){if(o(this,"multiselect")===!0){var e=o(this,"metrics");if(e.length)for(var t=0,i=e.length;i>t;t++)this.send("select",e[t])}},unselectAll:function(){r(this,"selectedMetrics",[])},search:function(e){if(e){var t=this.buildFilterFromSearch(e);r(this,"metricSearch",t)}else r(this,"metricSearch",null)}},buildFilterFromSearch:function(e){var t,i=e.split(" "),o={component:[],resource:[],cid:[]};for(t=0;t<i.length;t++){var r=i[t];if(""!==r){var n=r.slice(3)||null;0===r.indexOf("co:")?o.component.push(n):0===r.indexOf("re:")?o.resource.push(n):0===r.indexOf("me:")?o.cid.push(n):o.cid.push(r)}}var s={$and:[]},a={component:{$or:[]},resource:{$or:[]},cid:{$or:[]}};for(var c in a){for(t=0;t<o[c].length;t++){var l={},h=o[c][t];null!==h?l[c]={$regex:h}:l[c]=null,a[c].$or.push(l)}var m=a[c].$or.length;1===m&&(a[c]=a[c].$or[0]),m>0&&s.$and.push(a[c])}return 1===s.$and.length&&(s=s.$and[0]),s}});t.register("component:component-metricselector2",a)}}),Ember.Application.initializer({name:"component-selectedmetricheader",initialize:function(e,t){var i=Ember.get,o=(Ember.set,Ember.isNone,Ember.String.loc,Ember.Component.extend({rk:void 0,splittedRk:function(){return i(this,"rk").split("/")}.property("rk"),connectorType:function(){return i(this,"splittedRk")[2]}.property("splittedRk"),component:function(){return i(this,"splittedRk")[4]}.property("splittedRk"),resource:function(){var e=i(this,"splittedRk");return 7===e.length?e[5]:""}.property("splittedRk"),metricName:function(){var e=i(this,"splittedRk");return e[e.length-1]}.property("splittedRk")}));t.register("component:component-selectedmetricheader",o)}}),Ember.Application.initializer({name:"component-serieitemeditor",initialize:function(e,t){var i=window.schemasRegistry,o=Ember.get,r=Ember.set,n=Ember.Component.extend({init:function(){this._super(arguments),r(this,"componentDataStore",DS.Store.create({container:o(this,"container")}));var e="stylizedserie",t=i.getByName(e).EmberModel.proto();console.log("Fetch model:",e,t);var n={},s=this;console.group("Create virtual attributes for serieitem:"),t.eachAttribute(function(e,t){var i="content.value."+e,a="item."+e+".value",c=o(s,i),l=o(t,"options.default"),h=c||l;n[e]=Ember.Object.create({value:c||l,model:t}),s.addObserver(a,function(){var e=o(s,a);r(s,i,e)}),void 0!==h&&r(s,i,h),console.log(e,c,l,n[e])}),console.groupEnd(),r(this,"item",Ember.Object.create(n))}});t.register("component:component-serieitemeditor",n)}}),Ember.Application.initializer({name:"CategorychartWidget",after:["WidgetFactory","MetricConsumer","TimeWindowUtils"],initialize:function(e,t){var i=e.lookupFactory("factory:widget"),o=e.lookupFactory("mixin:metricconsumer"),r=e.lookupFactory("utility:timewindow"),n=Ember.get,s=Ember.set,a=Ember.isNone,c={mixins:[o]},l=i("categorychart",{init:function(){this._super.apply(this,arguments)},findItems:function(){var e=["display","allow_user_display","use_max_value","max_value","show_legend","show_tooltip","show_labels","metric_template","stacked","text_left_space","human_readable"],t={},i=this;e.forEach(function(e){s(t,e,n(i,e))}),s(this,"options",t),s(this,"chartSeries",{});var o=r.getFromTo(n(this,"time_window"),n(this,"time_window_offset")),c=o[0],l=o[1],h=n(this,"from"),m=n(this,"to");a(h)||(c=h),a(m)||(l=m);var u=n(this,"metrics");!a(u)&&u.length&&this.aggregateMetrics(u,c,l,"last",l-c),u=n(this,"series"),!a(u)&&u.length&&this.fetchSeries(u,c,l)},updateChart:function(){var e=[];$.each(n(this,"chartSeries"),function(t,i){e.push(i)}),s(this,"chartComponent.series",e)},onMetrics:function(e){var t=n(this,"chartSeries");$.each(e,function(e,i){var o=n(i,"meta.data_id"),r=n(i,"points"),c=r.length,l=0;c&&(l=r[c-1][1]);var h=void 0,m=void 0,u=void 0,d=o.split("/");6===d.length?(h=d[4],u=d[5]):(h=d[4],m=d[5],u=d[6]);var p=h;a(m)||(p+="."+m),p+="."+u,s(t,p.replace(/\./g,"_"),{id:o,serie:[p,l]})}),s(this,"chartSeries",t),this.updateChart()},onSeries:function(e){var t=n(this,"chartSeries");$.each(e,function(e,i){var o=n(i,"points"),r=n(i,"label"),a=0;o.length&&(a=o[o.length-1][1]),s(t,r,{id:r,serie:[r,a]})}),s(this,"chartSeries",t),this.updateChart()}},c);t.register("widget:categorychart",l)}}),Ember.Application.initializer({name:"TimegraphWidget",after:["WidgetFactory","ValuesUtils","DatesUtils"],initialize:function(e,t){var i=e.lookupFactory("factory:widget"),o=e.lookupFactory("utility:values"),r=e.lookupFactory("utility:dates"),n=Ember.get,s=Ember.set,a=Ember.isNone,c={},l=Ember.Mixin.create({didInsertElement:function(){var e=n(this,"controller");console.group("timegraph init");var t=function(t,i){var o=n(e,"chartOptions"),r={};$.extend(r,o),i.xaxis&&(s(r,"xaxis.min",i.xaxis.from),s(r,"xaxis.max",i.xaxis.to)),s(e,"chartOptions",r),s(e,"zooming",!0)};this.setDefaultChartOptions();var i=this.$(".flotchart-plot-container .flotchart");if(i.bind("plotselected",t),n(e,"config.timenav")){this.setDefaultTimenavOptions();var o=this.$(".flotchart-preview-container .flotchart");o.bind("plotselected",t);var r=Ember.View.views[o.attr("id")];i.bind("toggleserie",function(e,t){r.send("renderChart")})}e.on("onRenderer",this,this.onRenderer),console.groupEnd(),this._super.apply(this,arguments)},willDestroyElement:function(){var e=n(this,"controller"),t=this.$(".flotchart-plot-container .flotchart");if(t.unbind("plotselected"),n(this,"controller.config.timenav")){var i=this.$(".flotchart-preview-container .flotchart");i.unbind("plotselected"),t.unbind("toggleserie")}e.off("onRenderer",this,this.onRenderer)},setDefaultChartOptions:function(){var e=+new Date,t=n(this,"controller"),i=n(t,"config"),a=(n(t,"model.metric_template"),{});$.extend(a,n(t,"chartOptions")),n(t,"zooming")||$.extend(a,{xaxis:{min:e-n(t,"time_window_offset")-n(t,"time_window"),max:e-n(t,"time_window_offset")}}),$.extend(a,{zoom:{interactive:!1},selection:{mode:"x"},crosshair:{mode:"x"},grid:{hoverable:!0,clickable:!0,borderWidth:2},yaxis:{},xaxes:[{show:!0,reserveSpace:!0,position:"bottom",mode:"time",timezone:"browser"}],yaxes:[{show:!0,reserveSpace:!0}],legend:{show:n(i,"legend"),container:this.$(".flotchart-legend-container")},tooltip:n(i,"tooltip"),tooltipOpts:{id:this.$().closest(".ember-view").attr("id")+"-tooltip",content:function(e,i,s,a){var c=r.timestamp2String(i/1e3,"f",!0),l=a.series.unit||"",h=["<p>",c,"</p><p><b>",e," :</b> "].join("");return h+=n(t,"human_readable")===!0?o.humanize(s,l||""):s+" "+l},shifts:{x:-60,y:25}}}),console.log("Configure chart:",a),s(t,"chartOptions",a)},setDefaultTimenavOptions:function(){var e=+new Date,t=n(this,"controller"),i=(n(t,"config"),{});$.extend(i,n(t,"timenavOptions")),$.extend(i,{zoom:{interactive:!1},selection:{mode:"x"},crosshair:{mode:"x"},grid:{hoverable:!0,clickable:!0,borderWidth:2},xaxis:{reserveSpace:!0,min:e-n(t,"time_window_offset")-n(t,"timenav_window"),max:e-n(t,"time_window_offset")},yaxis:{},xaxes:[{show:!0,reserveSpace:!0,position:"bottom",mode:"time",timezone:"browser"}],yaxes:[{show:!0,reserveSpace:!0}],legend:{show:!1},tooltip:!1}),console.log("Configure time navigation:",i),s(t,"timenavOptions",i)},resetZoom:function(){var e=n(this,"controller");s(e,"zooming",!1),this.setDefaultChartOptions(),this.setDefaultTimenavOptions()},onRenderer:function(){this.rerender()},actions:{stepBack:function(){var e=n(this,"controller"),t=n(e,"timestep"),i={};$.extend(i,n(e,"chartOptions")),i.xaxis.min-=t,i.xaxis.max-=t,s(e,"chartOptions",i)},stepForward:function(){var e=n(this,"controller"),t=n(e,"timestep"),i={};$.extend(i,n(e,"chartOptions")),i.xaxis.min+=t,i.xaxis.max+=t,s(e,"chartOptions",i)}},registerHooks:function(){return console.log("registerHooks",n(this,"controller"),n(this,"controller").on),n(this,"controller").on("resetZoom",this,this.resetZoom),this._super()},unregisterHooks:function(){return n(this,"controller").off("resetZoom",this,this.resetZoom),this._super()}}),h=i("timegraph",{needs:["serie","perfdata"],viewMixins:[l],partials:{titlebarbuttons:["titlebarbutton-resetzoom"],widgetActionButtons:["timegraphbutton-resetzoom"]},actions:{resetZoom:function(){this.trigger("resetZoom")}},init:function(){s(this,"zooming",!1),s(this,"chartOptions",void 0),s(this,"timenavOptions",void 0),s(this,"chartSeries",Ember.Object.create({})),s(this,"dataSeries",Ember.A()),this._super.apply(this,arguments)},human_readable:function(){return n(this,"config.human_readable")}.property("config.human_readable"),time_window:function(){return 1e3*n(this,"config.time_window")}.property("config.time_window"),time_window_offset:function(){return 1e3*n(this,"config.time_window_offset")}.property("config.time_window_offset"),timenav_window:function(){return n(this,"config.timenav")?1e3*n(this,"config.timenav_window"):n(this,"time_window")}.property("config.timenav_window"),timestep:function(){return 1e3*n(this,"config.timestep")}.property("config.timestep"),findItems:function(){var e=this,t=!0,i=(new Date).getTime(),o=i-n(this,"time_window_offset"),r=o-n(this,"timenav_window")-n(this,"time_window_offset");console.log("refresh:",r,o,t),this.updateAxisLimits(r,o),console.group("Load stylized series:"),this.fetchStylizedSeries(r,o,t),console.groupEnd(),console.group("Load stylized metrics:"),this.fetchStylizedMetrics(r,o,t),console.groupEnd(),e.trigger("onRenderer")},updateAxisLimits:function(e,t){if(!n(this,"zooming")){var i={};$.extend(i,n(this,"chartOptions")),$.extend(i,{xaxis:{min:t-n(this,"time_window")-n(this,"time_window_offset"),max:t}}),s(this,"chartOptions",i),n(this,"timenav")&&(i={},$.extend(i,n(this,"timenavOptions")),$.extend(i,{xaxis:{min:t-n(this,"timenav_window")-n(this,"time_window_offset"),max:t}}),s(this,"timenavOptions",i))}},fetchStylizedSeries:function(e,t,i){for(var o=n(this,"widgetDataStore"),r=n(this,"config.series"),s={},a=[],c=0,l=r.length;l>c;c++){var h=n(r[c],"serie");s[h]={style:r[c],serie:void 0,curve:void 0},a.push(n(r[c],"curve"))}var m=JSON.stringify(Object.keys(s));a=JSON.stringify(a),console.log("series:",m),console.log("curves:",a);var u=this;Ember.RSVP.all([o.findQuery("serie",{ids:m}),o.findQuery("curve",{ids:a})]).then(function(o){u.genChartConfig(o,s,e,t,i)})},fetchStylizedMetrics:function(e,t,i){var o,r,s=n(this,"widgetDataStore"),c=n(this,"config.metrics"),l=[],h={},m=[],u=this,d=["type","connector","connector_name","component","resource","metric"],p=[];r=function(e){console.log("metric tmpl",e);var t=e.id,i=t.split("/"),r={},s=i.length;for(o=0;s>o;o++)r[d[o]]=i[o+1];var c=n(u,"config.metric_template");(""===c||a(c))&&(c="{{component}} - {{resource}} - {{metric}}");try{t=Handlebars.compile(c)(r)}catch(l){console.log("could not proceed template feed",l)}var h=p.pushObject(t);return h};var f=function(o){o=JSON.stringify(o),console.log("series:",h),console.log("curves:",o),s.findQuery("curve",{ids:o}).then(function(o){var r={meta:{total:l.length},content:l};u.genChartConfig([r,o],h,e,t,i)})};if(c.length>0){for(var g=[],v=0,x=c.length;x>v;v++){var b=n(c[v],"metric");g.push(b)}s.findQuery("ctxmetric",{filter:JSON.stringify({_id:{$in:g}})}).then(function(e){var t,i,o={};for(t=0,i=n(e,"content.length");i>t;t++){var s=n(e,"content")[t];o[n(s,"id")]=s}for(t=0,i=c.length;i>t;t++){var a=n(c[t],"metric"),u=o[a];console.log("mectric info",u);var d=Ember.Object.create({id:a,virtual:!0,crecord_name:r(u),metrics:[a],aggregate_method:"none",unit:n(c[t],"unit")});h[a]={style:c[t],serie:d,curve:void 0},l.push(d),m.push(n(c[t],"curve"))}f(m)})}else f(m)},genChartConfig:function(e,t,i,o,r){console.group("Generate Chart series");var a,c,l=e[0],h=e[1];console.group("Fetch curves:");var m={};for(a=0,c=h.meta.total;c>a;a++){var u=h.content[a];m[u.id]=u}for(console.log(m),console.groupEnd(),console.group("Fetch series:"),a=0,c=l.meta.total;c>a;a++){var d=l.content[a],p=d.id;if(console.log(d,p),void 0!==t[p]){var f=t[p],g=n(f,"style.curve"),v=m[g];void 0!==v&&s(f,"curve",v),console.log(g,v),s(f,"serie",d),this.genChartSerie(f,i,o,r)}}console.log("stylizedseries:",t),console.groupEnd(),console.groupEnd()},genChartSerie:function(e,t,i,o){console.group("Generating Chart serie:",e);var r=this,a=null,c=!1;if(n(e,"curve.areas")){var l=$.color.parse(n(e,"style.color"));c=n(e,"curve.area_opacity"),l.a=c,a=l.toString()}var h,m,u,d,p={label:n(e,"serie.crecord_name"),color:n(e,"style.color"),lines:{show:n(e,"curve.lines")||n(e,"curve.areas"),used:n(e,"curve.lines"),lineWidth:n(e,"curve.line_width"),fill:c,fillColor:a},bars:{show:n(e,"curve.bars"),used:n(e,"curve.bars"),lineWidth:n(e,"curve.line_width"),barWidth:1e3*n(e,"curve.bar_width"),fill:c,fillColor:a},points:{show:n(e,"curve.points"),used:n(e,"curve.points"),symbol:n(e,"curve.point_shape")},values:{show:n(e,"curve.valueLabels"),labelFormatter:function(e,t){var i=parseFloat(t);return i.toFixed(2)}},xaxis:parseInt(n(e,"style.xaxis"))||1,yaxis:parseInt(n(e,"style.yaxis"))||1,clickable:!0,hoverable:!0,hidden:!1,config:{color:n(e,"style.color"),lines:n(e,"curve.lines")||n(e,"curve.areas"),bars:n(e,"curve.bars"),points:n(e,"curve.points"),values:n(e,"curve.valueLabels")},unit:n(e,"serie.unit")};n(e,"serie.virtual")===!0?(u=n(this,"controllers.perfdata"),h=n(e,"style.metric"),m=n(this,"chartSeries")[h],d=n(e,"serie.id")):(u=n(this,"controllers.serie"),h=n(e,"style.serie"),m=n(this,"chartSeries."+h),d=n(e,"serie")),void 0===m||o?p.data=[]:p.data=m.data,p.serie=h,console.log("chartserie:",p),console.log("Fetch perfdata and compute serie");var f,g,v="none"!==n(e,"serie.aggregate_method")||n(e,"serie.metrics.length")>1;n(this,"timenav")?(f=n(this,"timenavOptions.xaxis.min"),g=n(this,"timenavOptions.xaxis.max")):(f=n(this,"chartOptions.xaxis.min"),g=n(this,"chartOptions.xaxis.max")),v&&(t=f,i=g,p.data=[]),console.log("call controller fetch",d),u.fetch(d,t,i).then(function(t){if(console.log("fetch:",t),n(e,"serie.virtual")===!0){for(var i=n(r,"chartSeries"),o=t.data[0].points,a=0,c=o.length;c>a;a++)o[a][0]=1e3*o[a][0];p.data=p.data.concat(o),i[n(e,"style.metric")]=p,s(r,"chartSeries",i)}else p.data=p.data.concat(t),s(r,"chartSeries."+n(e,"style.serie"),p);r.recomputeDataSeries()}),console.groupEnd()},recomputeDataSeries:function(){var e,t,i,o=n(this,"chartSeries"),r=n(this,"dataSeries");for(e=0,t=r.length;t>e;e++){var a=r[e];i=n(a,"serie");var c=n(o,i);if(void 0!==c){var l=n(a,"hidden");s(c,"hidden",l),l&&(s(c,"color","#CCCCCC"),s(c,"lines.show",!1),s(c,"bars.show",!1),s(c,"points.show",!1),s(c,"values.show",!1))}}delete r;var h=Ember.A(),m=Object.keys(o);for(e=0,t=m.length;t>e;e++)i=m[e],h.pushObject(o[i]);console.log("dataSeries:",h),s(this,"dataSeries",h)}},c);t.register("widget:timegraph",h)}});
//# sourceMappingURL=dist/brick.map.js