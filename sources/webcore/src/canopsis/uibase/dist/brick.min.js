Ember.Application.initializer({name:"component-actionbutton",after:"ActionsUtils",initialize:function(e,t){var i=e.lookupFactory("utility:actions"),n=Ember.Component.extend({action:void 0,actions:{doAction:function(e,t){i.doAction(e,t)}}});t.register("component:component-actionbutton",n)}}),Ember.Application.initializer({name:"component-actionfilter",initialize:function(e,t){var i=Ember.get,n=Ember.set,o=Ember.Component.extend({init:function(){this._super(),this.set("selectedAction","pass"),console.log(" ! --- > content",this.get("content")),void 0===i(this,"content")?n(this,"contentUnprepared",Ember.A()):n(this,"contentUnprepared",i(this,"content"))},selectedAction:"pass",availableactions:["pass","drop","override","remove","snooze","execjob"],isOverride:function(){return console.log("isOverride",i(this,"selectedAction"),"override"===i(this,"selectedAction")),"override"===i(this,"selectedAction")}.property("selectedAction"),isRoute:function(){return!1}.property("selectedAction"),isRemove:function(){return console.log("isRemove",i(this,"selectedAction"),"remove"===i(this,"selectedAction")),"remove"===i(this,"selectedAction")}.property("selectedAction"),isSnooze:function(){return console.log("isSnooze",i(this,"selectedAction"),"snooze"===i(this,"selectedAction")),"snooze"===i(this,"selectedAction")}.property("selectedAction"),isExecJob:function(){return console.log("isExecJob",i(this,"selectedAction"),"execjob"===i(this,"selectedAction")),"execjob"===i(this,"selectedAction")}.property("selectedAction"),actions:{addAction:function(){var e={type:i(this,"selectedAction")};"override"===i(this,"selectedAction")&&(e.field=i(this,"field"),value=i(this,"value"),null!==value&&"object"==typeof value?(e.value=value.value,e.operation=value.operation):e.value=value),"remove"===i(this,"selectedAction")&&(e.key=i(this,"key")),"execjob"===i(this,"selectedAction")&&(e.job=i(this,"jobid")),"snooze"===i(this,"selectedAction")&&(e.duration=parseInt(i(this,"duration"),10),NaN===e.duration&&(e.duration=0)),console.log("Adding action",e),i(this,"contentUnprepared").pushObject(e),n(this,"content",i(this,"contentUnprepared"))},deleteAction:function(e){console.log("Removing action",e),i(this,"contentUnprepared").removeObject(e),n(this,"content",i(this,"contentUnprepared"))}}});t.register("component:component-actionfilter",o)}}),Ember.Application.initializer({name:"component-arrayclassifiedcrecordselector",after:"component-classifiedcrecordselector",initialize:function(e,t){var i=e.lookupFactory("component:component-classifiedcrecordselector"),n=Ember.get,o=Ember.set,r=Ember.isNone,s=i.extend({multiselect:!0,setInitialContent:function(e){var t=n(this,"valueKey");if(console.log("setInitialContent",t,typeof e,e),e)if(t)o(this,"loadingInitialContent","true");else for(var i=n(this,"selectionUnprepared"),r=0,s=e.length;r<s;r++)i.pushObject({name:e[r]})},selectionChanged:function(){this._super();var e=n(this,"selection"),t=n(this,"valueKey");r(t)&&(t="name");for(var i={},s=[],a=[],l=0;l<e.length;l++){var c=n(e[l],t);i[c]||(i[c]=1,a.push(c),s.push(e[l]))}o(this,"selection",s),o(this,"content",a)}.observes("selectionUnprepared","selectionUnprepared.@each"),extractItems:function(e){var t=n(this,"valueKey"),i=n(this,"content");if(t){var o=[];console.log("extractItems",arguments);for(var r=0,s=i.length;r<s;r++){var a=e.findBy("id",i);void 0!==a&&o.pushObject({name:a.get(t)})}this.setProperties({selectionUnprepared:o,loadingInitialContent:!1})}}});t.register("component:component-arrayclassifiedcrecordselector",s)}}),Ember.Application.initializer({name:"component-arrayeditor",after:"ValidationFieldMixin",initialize:function(e,t){var i=e.lookupFactory("mixin:validation-field"),n=Ember.get,o=Ember.set,r=Ember.Component.extend(i,{valueRefPath:"content.value",valuePath:"value",init:function(){this._super.apply(this,arguments),o(this,"componentDataStore",DS.Store.create({container:n(this,"container")}));var e=n(this,"content.value")||[];o(this,"value",e),o(this,"content.value",e);var t=n(this,"value"),i=this;Ember.run(function(){if(o(i,"arrayAttributes",Ember.A()),void 0!==t)for(var e=0,r=t.length;e<r;e++)n(i,"arrayAttributes").pushObject(i.generateVirtualAttribute(e))})},itemEditorType:function(){var e=n(this,"content.model.options.items.type"),t=n(this,"content.model.options.items.role");console.log("editorType",n(this,"content"),e,t);var i;return i=t?"editor-"+t:"editor-"+e,void 0===Ember.TEMPLATES[i]&&(i="editor-defaultpropertyeditor"),i}.property("content.model.options.items.type","content.model.options.items.role"),generateVirtualAttribute:function(e){var t=n(this,"value"),i=n(this,"content.model.options.items"),r=this;console.log("generateVirtualAttribute",e,t[e]);var s=Ember.Object.create({parent:r,index:e,value:t[e]});o(s,"model",Ember.Object.create()),o(s,"model.options",Ember.Object.create());for(var a in i)"value"!==a&&Ember.set(s,"model.options."+a,i[a]);return console.log("generateVirtualAttribute virtual attribute",s),Ember.addObserver(s,"value",function(e){console.log("value changed",e.value,e.index),n(r,"value").removeAt(e.index),n(r,"value").insertAt(e.index,e.value),console.log("content changed",r.get("value"))}),console.log("generateVirtualAttribute"),s},contentChanged:function(){console.log("recompute contentAttributeArray")},actions:{move:function(e,t){var i=n(this,"arrayAttributes"),o=i.indexOf(t);"up"===e&&o>0&&(console.log("processing",e),this.moveItem(o,o-1)),"down"===e&&o<n(i,"length")-1&&(console.log("processing",e),this.moveItem(o,o+1))},addItem:function(){console.log("addItem",n(this,"value"));var e=n(this,"value"),t=n(this,"content.model.options.items.type"),i=n(this,"content.model.options.items.model"),o=n(this,"content.model.options.items.objectDict");if(void 0!==i){var r=n(this,"componentDataStore"),s=r.createRecord(i,{xtype:i});e.pushObject(s)}else"object"===t?e.pushObject(Ember.Object.create(o)):e.pushObject(void 0);var a=e.length-1,l=this.generateVirtualAttribute(a);n(this,"arrayAttributes").pushObject(l),this.validate()},removeItem:function(e){console.log("removeItem",n(this,"value"));var t=n(this,"arrayAttributes");n(this,"value").removeAt(e.index),t.removeAt(e.index);for(var i=e.index,o=t.length;i<o;i++)t.objectAt(i).set("index",t.objectAt(i).get("index")-1);this.validate()}},moveItem:function(e,t){console.log("moveItem",arguments);var i=n(this,"arrayAttributes");i.arrayContentWillChange(e,1,0);var o=i[e];i.splice(e,1),i.splice(t,0,o);for(var r=0,s=i.length;r<s;r++)i[r].index=r;i.arrayContentDidChange(t,0,1),i=n(this,"value"),i.arrayContentWillChange(e,1,0),o=i[e],i.splice(e,1),i.splice(t,0,o),i.arrayContentDidChange(t,0,1)}});t.register("component:component-arrayeditor",r)}}),Ember.Application.initializer({name:"component-classifiedcrecordselector",initialize:function(e,t){var i=Ember.get,n=Ember.set,o=Ember.Component.extend({model:void 0,modelfilter:void 0,data:void 0,nameKeyDefault:"crecord_name",nameKey:"crecord_name",idKeyDefault:"id",idKey:"id",items:[],selectedValue:void 0,init:function(){this._super(arguments),n(this,"selectionUnprepared",Ember.A()),this.set("store_"+i(this,"elementId"),DS.Store.create({container:this.get("container")}));var e=i(this,"content");console.log("init",e),this.setInitialContent(e),this.refreshContent()},actions:{do:function(e,t){this.targetObject.send(e,t)}},setInitialContent:function(e){var t=i(this,"valueKey")||i(this,"valueKeyDefault");if(console.log("setInitialContent",t),e&&(t&&n(this,"loadingInitialContent","true"),!t))if("string"==typeof e)n(this,"selectionUnprepared",[{name:e}]);else if("object"==typeof e&&null!==e){var o=[];for(var r in e)if(e.hasOwnProperty(r)){var s=this.deserializeAdditionnalData(i(e,r));s.name=r,o.pushObject(s)}n(this,"selectionUnprepared",o)}else n(this,"selectionUnprepared",[])},classifiedItems:function(){var e=i(this,"items"),t=i(this,"valueKey")||i(this,"valueKeyDefault"),n=i(this,"nameKey")||i(this,"nameKeyDefault");console.log("recompute classifiedItems",i(this,"items"),t);for(var o=Ember.Object.create({all:Ember.A()}),r=0,s=e.length;r<s;r++){var a=e[r],l={name:a.get(n)};t&&(console.log("add valueKey",a.get(t)),l.value=a.get(t),console.log("objDict value",a,a.get(t))),this.serializeAdditionnalData(a,l),o.all.pushObject(Ember.Object.create(l))}return o}.property("items","items.@each"),selectionChanged:function(){console.log("selectionChanged");var e,t=i(this,"selectionUnprepared"),o=i(this,"valueKey");if(i(this,"multiselect"))if(e=Ember.A(),console.log("Push",t[0]),o)for(var r=0,s=t.length;r<s;r++)e.pushObject(t[r]);else for(var a=0,l=t.length;a<l;a++)e.pushObject(t[a]);else Ember.isArray(t)&&(e=t[0]);n(this,"selection",e)}.observes("selectionUnprepared","selectionUnprepared.@each"),onDataChange:function(){console.error("refreshContent"),this.refreshContent()}.observes("data.@each"),onModelFilterChange:function(){this.set("currentPage",1),this.refreshContent()}.observes("modelfilter"),refreshContent:function(){this._super(arguments),this.findItems(),console.log(this.get("widgetDataMetas"))},findItems:function(){var e=this,t=i(this,"crecordtype"),n=this.get("store_"+i(this,"elementId")),o={start:0,limit:1e4,filter:i(this,"modelfilter")};console.log("findItems",this.get("crecordtype"),o),"view"===t&&(t="userview"),n.findQuery(t,o).then(function(t){e.set("widgetDataMetas",t.meta);var i=t.get("content");e.set("items",i),Ember.run.scheduleOnce("afterRender",{},function(){e.rerender()}),e.extractItems(i)})},extractItems:function(e){var t=i(this,"valueKey"),o=i(this,"idKey")||i(this,"idKeyDefault"),r=i(this,"nameKey")||i(this,"nameKeyDefault"),s=i(this,"content");if(console.log("extractItems",e,s),t){var a;if("string"==typeof s){if(console.log("extractItems with valueKey",arguments,Ember.inspect(s)),a=e.findBy(o,s),console.log("correspondingExtractedItem",a),void 0!==a){var l=[{name:i(a,r),value:i(a,o)}];n(this,"selectionUnprepared",l)}}else if("object"==typeof s&&null!==s){for(var c=[],d=Ember.keys(s),u=0,h=d.length;u<h;u++){var p=d[u];if(s.hasOwnProperty(p)){var m=i(s,p);console.log("findBy",o,p,m),a=e.findBy(o,m);var f={name:i(a,r),value:i(a,o)};c.pushObject(f)}}n(this,"selectionUnprepared",c)}n(this,"loadingInitialContent",!1)}},deserializeAdditionnalData:function(e){console.log("deserializeAdditionnalData",arguments)},serializeAdditionnalData:function(e){console.log("serializeAdditionnalData",arguments)}});t.register("component:component-classifiedcrecordselector",o)}}),Ember.Application.initializer({name:"component-classifieditemselector",initialize:function(e,t){var i=Ember.set,n=Ember.get,o=Ember.isNone,r=Ember.Component.extend({multiselect:!0,showselection:!0,init:function(){this._super.apply(this,arguments),i(this,"allCollapsed",!0),Ember.isArray(n(this,"selection"))||(console.warn("override selection property"),i(this,"selection",Ember.A()))},actions:{setListMode:function(){i(this,"mode","list")},setIconMode:function(){i(this,"mode","icon")},unselectItem:function(e){n(this,"selection").removeObject(e),n(this,"target")&&n(this,"target").send("unselectItem",e.name)},selectItem:function(e){if(console.log("selectItem",arguments),!1===n(this,"multiselect"))i(this,"selection",[e]);else{0===n(this,"selection").filter(function(t,i,n){return t===e}).length&&n(this,"selection").pushObject(e)}n(this,"target")?n(this,"target").send("selectItem",e.name):console.warn("no target attribute for Classifieditemselector",this)},collapse:function(e){if("all"===e)!0===n(this,"allCollapsed")?i(this,"allCollapsed",!1):i(this,"allCollapsed",!0);else if("selection"===e)!0===n(this,"selectionCollapsed")?i(this,"selectionCollapsed",!1):i(this,"selectionCollapsed",!0);else{var t=n(this,"classes").findBy("key",e.key);console.log("collapse",e,e.key,t),!0===t.isCollapsed||void 0===t.isCollapsed?(i(t,"isCollapsed",!1),i(e,"isCollapsed",!1)):(i(t,"isCollapsed",!0),i(e,"isCollapsed",!0))}}},searchFilter:"",allCollapsed:!1,selectionCollapsed:!1,classesCollapsed:!0,mode:"list",defaultIcon:"unchecked",iconModeButtonCssClass:function(){return"icon"===n(this,"mode")?"btn btn-default active":"btn btn-default"}.property("mode"),listModeButtonCssClass:function(){return"list"===n(this,"mode")?"btn btn-default active":"btn btn-default"}.property("mode"),listGroupClass:function(){return"list-group "+n(this,"mode")}.property("mode"),classAllPanelId:function(){return n(this,"elementId")+"_all"}.property(),classAllPanelHref:function(){return"#"+n(this,"classAllPanelId")}.property(),allClasses:function(){var e=n(this,"searchFilter"),t=n(this,"content.all");if(!o(t)){var i=this;t=n(this,"content.all").filter(function(e,t,n){console.log("filter",e);var r=i.get("content.byClass.system");return!(!o(r)&&r.filterBy("name",e.get("name")).length>0)||(console.log("filtered!",e),!1)}),""!==e&&(t=t.filter(function(t,i,n){return t.name.slice(0,e.length)==e}))}return console.log("recompute allClasses",t),t}.property("searchFilter"),collapsedPanelCssClass:"list-group collapse",expandedPanelCssClass:"list-group",classList:function(){var e=n(this,"content.byClass");if(console.log("contentByClass",e),null!==e&&void 0!==e)return $.map(e,function(t,i){if(e.hasOwnProperty(i))return i})}.property("content"),classesFiltered:function(){for(var e=n(this,"classes"),t=n(this,"searchFilter"),i=Ember.A(),o=function(e,i,n){return-1!==e.name.indexOf(t)},r=0,s=e.length;r<s;r++){var a=Ember.Object.create({key:e[r].key,items:e[r].items,id:e[r].id,titleHref:e[r].titleHref,isCollapsed:e[r].isCollapsed||n(this,"classesCollapsed")}),l=a.items;console.log("classItems",l),""!==t&&(console.log("filter",l),l=l.filter(o),a.items=l,console.log("filterEnd",l)),i.push(a)}return console.log("classesFiltered CP end"),i}.property("classes","searchFilter"),classes:function(){var e=this,t=n(this,"content.byClass");return console.log("classes CP",arguments,this,t),void 0!==t?$.map(t,function(o,r){if(t.hasOwnProperty(r)){var s=Ember.Object.create({key:r,items:o,id:n(e,"elementId")+"_"+r,titleHref:"#"+n(e,"elementId")+"_"+r}),a=[s];return i(a,"isCollapsed",t[r].isCollapsed),a}}):(i(e,"allCollapsed",!0),[])}.property("content")});t.register("component:component-classifieditemselector",r)}}),Ember.Application.initializer({name:"component-colorchooser",initialize:function(e,t){var i=Ember.Component.extend({});t.register("component:component-colorchooser",i)}}),Ember.Application.initializer({name:"component-colpick",initialize:function(e,t){var i=Ember.get,n=Ember.set,o=Ember.Component.extend({classNames:["colorSelector dropdown-toggle"],init:function(){this._super(),n(this,"store",DS.Store.create({container:this.get("container")}))},didInsertElement:function(){var e=this,t={flat:!0,layout:"hex",submit:0,onChange:function(t,i){n(e,"value","#"+i)}};this.get("store").findAll("rangecolor",{}).then(function(t){for(var o=i(t,"content"),r=o.length-1;r>=0;r--)for(var s=i(o[r],"colors"),a=s.length-1;a>=0;a--){var l=s[a],c="background-color:"+l,d=l;s[a]={style:c,selected:!1,code:d}}n(e,"ranges",o)});var o=i(this,"value");o&&(t.color=o),e.$(".colorGrid").hide(),e.$("#colorPicker").addClass("activeColor"),e.$("#colorPicker").click(function(){e.$(".customcolor").show(),e.$("#colorPicker").addClass("activeColor"),e.$(".colorGrid").hide(),e.$("#colorGrid").removeClass("activeColor")}),e.$("#colorGrid").click(function(){e.$(".customcolor").hide(),e.$("#colorPicker").removeClass("activeColor"),e.$(".colorGrid").show(),e.$("#colorGrid").addClass("activeColor")}),e.$(".customcolor").colpick(t),this._super()},actions:{changeColor:function(e,t){for(var o=this,r=e,s=r.code,a=t.length-1;a>=0;a--)for(var l=i(t[a],"colors"),c=l.length-1;c>=0;c--)e=l[c],n(e,"selected",!1);n(r,"selected",!0),n(o,"value",s),o.$(".customcolor").colpickSetColor(s,!0)}},willDestroyElement:function(){this._super(),this.$().off("click")}});t.register("component:component-colpick",o)}}),Ember.Application.initializer({name:"component-contextselector",after:["ContextRegistry","HashUtils"],initialize:function(e,t){var i=e.lookupFactory("registry:context"),n=e.lookupFactory("utility:hash"),o=Ember.get,r=Ember.set,s=Ember.String.loc,a=Ember.Component.extend({contexts:i.all,init:function(){this._super(),this.set("store",DS.Store.create({container:this.get("container")}))},destroy:function(){this._super(),this.get("store").destroy()},helpModal:{title:s("Syntax"),content:["<ul>","<li><code>co:regex</code> : ",s("look for a component"),"</li>","<li><code>re:regex</code> : ",s("look for a resource"),"</li>","<li><code>me:regex</code> : ",s("look for a metric"),"(<code>me:</code>",s(" isn't needed for this one"),")</li>","<li>",s("combine all of them to improve your search")," : <code>co:regex re:regex me:regex</code></li>","<li><code>co:</code>, <code>re:</code>, <code>me:</code> : ",s("look for non-existant field"),"</li>","</ul>"].join(""),name:n.generateId("cmetric-help-modal"),label:n.generateId("cmetric-help-modal-label")},actions:{select:function(e){r(this,"content",o(e,"_id"))},search:function(e){if(e){var t=this.build_filter(e);r(this,"contextSearch",t)}else r(this,"contextSearch",null)},clearselection:function(){r(this,"content",void 0)}},build_filter:function(e){var t,i=e.split(" "),n={component:[],resource:[],name:[]};for(t=0;t<i.length;t++){var o=i[t];if(""!==o){var r=o.slice(3)||null;0===o.indexOf("co:")?n.component.push(r):0===o.indexOf("re:")?n.resource.push(r):0===o.indexOf("me:")?n.name.push(r):n.name.push(o)}}var s={$and:[]},a={component:{$or:[]},resource:{$or:[]},name:{$or:[]}};for(var l in a){for(t=0;t<n[l].length;t++){var c={},d=n[l][t];c[l]=null!==d?{$regex:d}:null,a[l].$or.push(c)}var u=a[l].$or.length;1===u&&(a[l]=a[l].$or[0]),u>0&&s.$and.push(a[l])}return 1===s.$and.length&&(s=s.$and[0]),s},columns:function(){var e=o(this,"contextType"),t=[{name:"name",title:s("Component")},{action:"select",actionAll:!0===o(this,"multiselect")?"selectAll":void 0,title:new Ember.Handlebars.SafeString('<span class="glyphicon glyphicon-plus-sign"></span>'),style:"text-align: center;"}];switch(e){case"ctxtopology":case"ctxselector":return t;case"ctxcomponent":return[{name:"connector_name",title:s("Connector name")},{name:"name",title:s("Component")},{action:"select",actionAll:!0===o(this,"multiselect")?"selectAll":void 0,title:new Ember.Handlebars.SafeString('<span class="glyphicon glyphicon-plus-sign"></span>'),style:"text-align: center;"}];case"ctxresource":return[{name:"connector_name",title:s("Connector name")},{name:"component",title:s("Component")},{name:"name",title:s("Resource")},{action:"select",actionAll:!0===o(this,"multiselect")?"selectAll":void 0,title:new Ember.Handlebars.SafeString('<span class="glyphicon glyphicon-plus-sign"></span>'),style:"text-align: center;"}];default:return[{name:"component",title:s("Component")},{name:"resource",title:s("Resource")},{name:"id",title:s("Metric")},{action:"select",actionAll:!0===o(this,"multiselect")?"selectAll":void 0,title:new Ember.Handlebars.SafeString('<span class="glyphicon glyphicon-plus-sign"></span>'),style:"text-align: center;"}]}}.property("contextType")});t.register("component:component-contextselector",a)}}),Ember.Application.initializer({name:"component-crudentitydetails",after:["DataUtils","HashUtils"],initialize:function(e,t){var i=e.lookupFactory("utility:data"),n=e.lookupFactory("utility:forms"),o=Ember.get,r=Ember.set;window.moment;__=Ember.String.loc;var s=Ember.Component.extend({init:function(){this._super(),r(this,"componentDataStore",DS.Store.create({container:o(this,"container")}))},didInsertElement:function(){r(this,"entity",this.this),this.findPbehaviors()},findPbehaviors:function(){var e=this,t=i.getEmberApplicationSingleton().__container__.lookup("adapter:ccpbehavior"),n=o(e,"entity");t.findQuery("ccpbehavior",encodeURI(n._id)).then(function(t){r(e,"pbehaviors",t)})},removepbehavior:function(e){n.showNew("confirmform",{},{title:__("Do you want to remove this pbehavior?")}).submit.then(function(t){return $.ajax({type:"DELETE",url:"/api/v2/pbehavior/"+e,contentType:"application/json",dataType:"json",success:function(){console.log("pbehavior removed")},error:function(){console.error("Failure to send remove pbehavior")}})})},actions:{removepbehavior:function(e){this.removepbehavior(e)}}});t.register("component:component-crudentitydetails",s)}}),Ember.Application.initializer({name:"component-dateinterval",after:["HashUtils","DatesUtils"],initialize:function(e,t){var i=e.lookupFactory("utility:hash"),n=e.lookupFactory("utility:dates"),o=Ember.get,r=Ember.set,s=window.moment,a=Ember.Component.extend({init:function(){this._super.apply(this,arguments),r(this,"id",i.generate_GUID())},id:void 0,label:void 0,didInsertElement:function(){var e=this;this.$("#"+o(this,"id")).daterangepicker({timePickerIncrement:5,timePicker:!0,ranges:{Today:[s(),s()],Yesterday:[s().subtract("days",1),s().subtract("days",1)],"Last 7 Days":[s().subtract("days",6),s()],"Last 30 Days":[s().subtract("days",29),s()],"This Month":[s().startOf("month"),s().endOf("month")],"Last Month":[s().subtract("month",1).startOf("month"),s().subtract("month",1).endOf("month")]},startDate:s().subtract("days",29),endDate:s()},function(t,i,s){r(e,"label",s),console.log(s);var a=parseInt(new Date(t).getTime()/1e3),l=parseInt(new Date(i).getTime()/1e3);console.log("startTimestamp",a,"stopTimestamp",l),a===l&&(console.log("We are on the same day, let compute the start of the day"),a=n.startOfTheDay(),"Yesterday"===s&&(l=a,a-=86400),console.log("NEW -> startTimestamp",a,"stopTimestamp",l));var c={},d={},u=!1;a&&(d.$gte=a,u=!0),l&&(d.$lte=l,u=!0),c=u?{timestamp:d}:{},r(e,"content",c),console.log(o(e,"content"))})}});t.register("component:component-dateinterval",a)}}),Ember.Application.initializer({name:"component-dictclassifiedcrecordselector",after:"component-classifiedcrecordselector",initialize:function(e,t){var i=e.lookupFactory("component:component-classifiedcrecordselector"),n=i.extend({multiselect:!0});t.register("component:component-dictclassifiedcrecordselector",n)}}),Ember.Application.initializer({name:"component-dropdownbutton",initialize:function(e,t){var i=Ember.set,n=Ember.Component.extend({classNames:["dropdown"],opened:!1,actions:{hideContent:function(){i(this,"opened",!1)}},didInsertElement:function(){var e=this;this.$().parents("td").css("overflow-x","visible").css("overflow-y","visible"),this.$().mouseleave(function(){i(e,"opened",!1)})}});t.register("component:component-dropdownbutton",n)}}),Ember.Application.initializer({name:"component-dropdownbuttoncontent",initialize:function(e,t){var i=Ember.get,n=Ember.Component.extend({classNames:["dropdownbuttoncontent"],classNameBindings:["dropdownContentMenu"],align:"left",init:function(){var e=i(this,"align");this._super(),"right"===e&&i(this,"classNames").pushObject("dropdown-menu-right")},dropdownContentMenu:function(){return i(this,"parentView.opened")}.property("parentView.opened"),attributeBindings:["aria-labelledby"],"aria-labelledby":"dropdownMenu1"});t.register("component:component-dropdownbuttoncontent",n)}}),Ember.Application.initializer({name:"component-dropdownbuttonheader",initialize:function(e,t){var i=Ember.get,n=Ember.Component.extend({tagName:"a",classNameBindings:["classAttribute"],classAttribute:function(){var e=i(this,"parentView.opened"),t="btn btn-secondary dropdown-toggle opening";return e&&(t+=" active"),t}.property("parentView.opened"),attributeBindings:["aria-expanded"],"aria-expanded":"true",click:function(){this.toggle()},toggle:function(){this.toggleProperty("parentView.opened")}});t.register("component:component-dropdownbuttonheader",n)}}),Ember.Application.initializer({name:"component-dropdownbuttonoverview",initialize:function(e,t){var i=Ember.get,n=Ember.Component.extend({classNames:["dropdownbuttonoverview","dropdownbuttonoverview-default","overview"],attributeBindings:["style"],style:function(){return"background-color:"+i(this,"color")}.property("color")});t.register("component:component-dropdownbuttonoverview",n)}}),Ember.Application.initializer({name:"component-dropdownbuttontitle",initialize:function(e,t){var i=Ember.Component.extend({name:void 0,classNames:["dropdownbuttontitle","dropdownbuttontitle-default"]});t.register("component:component-dropdownbuttontitle",i)}}),Ember.Application.initializer({name:"component-elementidselectorwithoptions",after:["SearchmethodsRegistry","HashUtils"],initialize:function(e,t){var i=e.lookupFactory("registry:searchmethods"),n=Ember.get,o=Ember.set,r=Ember.isNone,s=Ember.String.loc,a=Ember.Component.extend({additionnalSelectionButtons:["removeitembutton"],searchMethod:function(){var e=n(this,"content.model.options.source.searchMethod");return i.getByName(e)}.property("content.model.options.source.searchMethod"),helpModal:function(){return n(this,"searchMethod.help")}.property("searchMethod"),availableDataColumns:function(){for(var e=n(this,"content.model.options.source.columns"),t=Ember.A(),i=0;i<e.length;i++){var o=e[i],r=n(o,"title"),a=n(o,"name");t.pushObject({title:s(r),name:a})}return t.pushObject({action:"select",actionAll:!0===n(this,"multiselect")?"selectAll":void 0,title:new Ember.Handlebars.SafeString('<span class="glyphicon glyphicon-plus-sign"></span>'),style:"text-align: center;"}),t}.property("content.model.options.source.columns"),init:function(){r(n(this,"selectedData"))&&o(this,"selectedData",[]),r(n(this,"searchPhrase"))&&o(this,"searchPhrase",null),r(n(this,"multiselect"))&&o(this,"multiselect",!0),o(this,"listedAvailableItems",[]),this._super.apply(this,arguments);var e=DS.Store.create({container:this.get("container")});o(this,"componentDataStore",e);var t={filter:{_id:void 0}},i=this;if(!r(n(this,"content"))){if(!0===n(this,"multiselect")){var s=n(this,"content")||[];t.filter._id={$in:s}}else t.filter._id=n(this,"content");var a=n(this,"content.model.options.source.schema");e.findQuery(a,t).then(function(e){var t=n(e,"content")||[];console.log("Received data:",a,s,t);for(var r=0,a=t.length;r<a;r++)t.pushObject(t[r]);o(i,"listedAvailableItems",t)})}},rendererFor:function(e){var t=n(e,"type"),i=n(e,"options.role");n(e,"model.options.role")&&(i=n(e,"model.options.role"));var o=n(e,"options.items.role");"array"!==i||r(o)||(i=o);var s;return s=i?"renderer-"+i:"renderer-"+t,void 0===Ember.TEMPLATES[s]&&(s=void 0),s},selectedItemHeaderRendererType:function(){return this.rendererFor(n(this,"selectedItemHeaderRendererAttr"))}.property("selectedItemHeaderRendererAttr"),selectedItemHeaderRendererAttr:function(){return{type:n(this,"content.model.options.items.type"),options:n(this,"content.model.options.items")}}.property(),actions:{select:function(e){var t=n(this,"content.value")||[];if(t.indexOf(e)<0){console.log("Select element:",e);var i,r=n(this,"content.model.options.items.polymorphicTypeKey"),s={},a=n(this,"content.model.options.items.typeKeyName");if(r)i=n(e,r);else{n(this,"content.model.options.items.model")&&(i=n(this,"content.model.options.items.model"))}i&&a&&(s[a]=i);for(var l=n(this,"content.model.options.sourceMappingKeys"),c=0;c<l.length;c++){var d=l[c];s[d.objectKey]=n(e,d.sourceItemKey)}!0===n(this,"multiselect")?t.pushObject(s):t=[s]}o(this,"content.value",t)},unselect:function(e){console.error("unselect",e);var t=n(this,"content.value"),i=t.indexOf(e);i>=0&&(console.log("Unselect element:",e),t.removeAt(i)),o(this,"content.value",t)},selectAll:function(){if(!0===n(this,"multiselect")){var e=n(this,"listedAvailableItems");if(e.length)for(var t=0,i=e.length;t<i;t++)this.send("select",e[t])}},unselectAll:function(){o(this,"selectedData",[])},search:function(e){if(e){var t=n(this,"searchMethod");if(t){var i=t.buildFilter(e);o(this,"searchPhrase",i)}}else o(this,"searchPhrase",null)}}});t.register("component:component-elementidselectorwithoptions",a)}}),Ember.Application.initializer({name:"component-eventkey",after:"EventUtils",initialize:function(e,t){var i=e.lookupFactory("utility:event"),n=Ember.get,o=Ember.set,r=Ember.String.loc,s=Ember.Component.extend({init:function(){this._super(),o(this,"selectedMode",r("List")),o(this,"modes",[r("List"),r("Custom")]);var e=i.getFields();console.log("eventFields",e);for(var t=[],n=e.length,s=0;s<n;s++)t.push({field:e[s]});o(this,"selectableProperties",t)},useTextField:function(){return n(this,"selectedMode")===r("Custom")}.property("selectedMode"),useList:function(){return n(this,"selectedMode")===r("List")}.property("selectedMode"),testActive:function(){for(var e=n(this,"selectableProperties"),t=e.length,i=0;i<t;i++){var r=e[i].field===n(this,"content");o(e[i],"isActive",r),console.log("compare",e[i].field,"and",n(this,"content"))}}.observes("content"),actions:{setProperty:function(e){o(this,"content",e),console.log("content is now",n(this,"content"))}}});t.register("component:component-eventkey",s)}}),Ember.Application.initializer({name:"component-filefield",initialize:function(e,t){var i=Ember.isEmpty,n=Ember.TextField.extend(Ember.Evented,{type:"file",attributeBindings:["multiple"],multiple:!1,change:function(e){var t=e.target;i(t.files)||this.send("onFileUpload",t.files)}});t.register("component:component-filefield",n)}}),Ember.Application.initializer({name:"component-filterclause",initialize:function(e,t){var i=Ember.get,n=Ember.set,o=Ember.Component.extend({tagName:"span",classNames:"filterclause",editionMode:!1,init:function(){this._super(arguments),console.log("ComponentFilterclauseComponent init"),console.log(this.get("content")),console.log(this.get("content.operator")),this.get("content.key")?this.finalized=!0:this.finalized=!1},finalized:!1,actions:{editAndClause:function(){this.set("editionMode",!0)},startEditClause:function(){this.get("content").set("filling",!0)},removeAndClause:function(e,t){this.get("parent").send("removeAndClause",e,t)},onAddKey:function(e){console.log("onAddKey",e);var t=this.get("clauses"),i=this.get("currentClauseIndex");if(i>=0){var n=t.objectAt(i),o=n.and[n.and.length-1];if(console.log("focusOutInput",n,o.options.available_indexes),!0===this.get("onlyAllowRegisteredIndexes")){console.group("onlyAllowRegisteredIndexes check");for(var r=0;r<o.options.available_indexes.length;r++){var s=o.options.available_indexes[r];console.log("currentIndex",s),s.value===e&&(console.log("currentIndex validated",s,e),o.set("key",e))}console.groupEnd()}else o.set("key",e)}return!0},focusOutKeyInput:function(){console.log("focusOutInput",arguments)},validateClause:function(e){var t=i(this,"content.value"),o=i(this,"content.key"),r=e.clause.and;if(console.log("focusOutInput",arguments),void 0!==t&&null!==t&&""!==t){var s=i(this,"clauses"),a=i(this,"currentClauseIndex");if(a>=0&&this.keyIsValid(o,r)){var l=s.objectAt(a);console.log("focusOutInput",l),n(this,"content.value",t),n(this,"content.finalized",!0),n(this,"content.filling",!1);var c=i(this,"finalized");n(this,"finalized",!0),i(this,"parent").send("addAndClause",c),n(this,"editionMode",!1)}}}},keyIsValid:function(e,t){var n=i(this,"currentClauseIndex"),o=i(this,"clauses"),r=o.objectAt(n);if(console.log("keyIsValid",e,n,r,t),!0!==this.get("onlyAllowRegisteredIndexes")||void 0===t.options.available_indexes)return!0;console.group("onlyAllowRegisteredIndexes check");for(var s=0,a=t.options.available_indexes.length;s<a;s++){var l=t.options.available_indexes[s];if(console.log("currentIndex",l),l.value===e)return console.log("currentIndex validated",l,e),t.set("key",e),!0}return console.groupEnd(),!1}});t.register("component:component-filterclause",o)}}),Ember.Application.initializer({name:"component-formulaeditor",initialize:function(e,t){var i=Ember.get,n=Ember.set,o=Ember.isNone,r=Ember.String.loc,s=Ember.Component.extend({form:Ember.computed.alias("parentView.parentView.controller"),metrics_cols:[{name:"component",title:r("Component")},{name:"resource",title:r("Resource")},{name:"id",title:r("Metric")},{action:"insert",actionAll:void 0,title:new Ember.Handlebars.SafeString('<span class="glyphicon glyphicon-plus-sign"></span>'),style:"text-align: center;"}],init:function(){n(this,"selectedMetrics",Ember.A()),this._super.apply(this,arguments)
;for(var e=i(this,"form.categories"),t=!1,o=0,r=e.length;o<r;o++){for(var s=e[o],a=0,l=s.keys.length;a<l;a++){var c=s.keys[a];if("metrics"===c.field){Ember.addObserver(c,"value",this,this.metricDidChange),t=!0;break}}if(t)break}},metricDidChange:function(e,t){for(var o=i(e,t),r=[],s=0,a=o.length;s<a;s++){var l=o[s].split("/"),c=l.length;l=7===c?{component:l[c-3],resource:l[c-2],id:l[c-1]}:{component:l[c-2],resource:null,id:l[c-1]},r.push(l)}n(this,"selectedMetrics",r)},actions:{insert:function(e){var t=" "+["",i(e,"component"),i(e,"resource")||"",i(e,"id")].join("/"),r=i(this,"content.value");o(r)?n(this,"content.value",t):n(this,"content.value",r+t)}}});t.register("component:component-formulaeditor",s)}}),Ember.Application.initializer({name:"component-ical",initialize:function(e,t){var i=Ember.get,n=Ember.set,o=Ember.isNone,r=Ember.String.loc,s=window.RRule,a=Ember.Component.extend({helpFrequency:"How often the rule is applied",helpRepetitionInterval:"Time space between two repetitions",helpRepetitionCount:"How many times action is repeated",helpStartDate:"Since when to apply rule",helpStopDate:"Until when to apply rule",frequencyForm:[{value:s.YEARLY,label:r("Yearly")},{value:s.MONTHLY,label:r("Monthly")},{value:s.WEEKLY,label:r("Weekly")},{value:s.DAILY,label:r("Daily")},{value:s.HOURLY,label:r("Hourly")},{value:s.MINUTELY,label:r("Minutely")},{value:s.SECONDLY,label:r("Secondly")}],init:function(){this._super(),DS.Model.extend({label:DS.attr()}).FIXTURES=i(this,"months"),n(this,"rules",[]),n(this,"frequencySelection",s.YEARLY),console.log("rrule information",i(this,"frequencyForm"));var e=i(this,"content");if(!o(e)&&Ember.isArray(e))for(var t=e.length,r=0;r<t;r++)try{var a=s.fromString(e[r]),l={value:a.toText(),instance:a};i(this,"rules").pushObject(l)}catch(t){console.warn("Unable to parse rrule from given information",e[r],t)}else console.log("no content available for initialization");this.updateContent()},actions:{removeRule:function(e){i(this,"rules").removeObject(e),this.updateContent()},addRule:function(){var e={},t=i(this,"startDate");o(t)||isNaN(t)||(e.dtstart=new Date(1e3*t));var n=i(this,"stopDate");o(n)||isNaN(n)||(e.until=new Date(1e3*n));var r=i(this,"repetitionCount");o(r)||isNaN(r)||(e.count=parseInt(r));var a=i(this,"repetitionInterval");o(a)||isNaN(a)?(console.log("rrule inteval default value set to 30 as no value set"),e.interval=30):e.interval=parseInt(a);var l=i(this,"frequencySelection");console.log("generated rrule options",e,"frequencySelection ",l);var c=new s(l,e),d={value:c.toText(),instance:c};i(this,"rules").pushObject(d),this.updateContent()}},updateContent:function(){for(var e=[],t=i(this,"rules"),o=t.length,r=0;r<o;r++)e.push(t[r].instance.toString());console.log("generated rules",e),n(this,"content",e)},didInsertElement:function(){console.log("recurrence input loaded",this.$())}});t.register("component:component-rrulebak",a)}}),Ember.Application.initializer({name:"if_equal_component",initialize:function(e,t){var i=(Ember.get,Ember.set,Ember.Component.extend({init:function(){this._super()},isEqual:function(){return this.get("param1")==this.get("param2")}.property("param1","param2")}));t.register("component:component-if_equal_component",i)}}),Ember.Application.initializer({name:"component-labelledlink",initialize:function(e,t){var i=Ember.String.loc,n=Ember.Component.extend({label_placeholder:i("label"),url_placeholder:i("url"),content:void 0});t.register("component:component-labelledlink",n)}}),Ember.Application.initializer({name:"component-mixinselector",after:"MixinsRegistry",initialize:function(e,t){var i=e.lookupFactory("registry:mixins"),n=Ember.get,o=Ember.set,r=Ember.isNone,s=Ember.Component.extend({init:function(){this._super.apply(this,arguments),r(n(this,"content"))&&o(this,"content",Ember.A()),o(this,"selectionPrepared",Ember.A());var e=n(this,"content");if(e)for(var t=0,i=e.length;t<i;t++){var s=window.schemasRegistry.getByName(e[t].name);s&&s.modelDict&&s.modelDict.metadata&&s.modelDict.metadata.description&&(e[t].description=s.modelDict.metadata.description),"string"==typeof e[t]&&(e[t]={name:e[t]})}o(this,"selectionPrepared",e)},classifiedItems:i,selectionPrepared:void 0,content:void 0,selectionUnprepared:Ember.computed.alias("content"),recomputeSelection:function(){var e=n(this,"selectionPrepared");console.log("recomputeSelection",e,n(this,"selectionPrepared"));var t=n(this,"content"),i=Ember.A();if(e)for(var r=0,s=e.length;r<s;r++){var a,l=e[r],c=n(l,"name"),d=t.findBy("name",c);a=d||{name:c},i.pushObject(a)}o(this,"content",i)},actions:{selectItem:function(){this.recomputeSelection()},unselectItem:function(){this.recomputeSelection()}}});t.register("component:component-mixinselector",s)}}),Ember.Application.initializer({name:"component-modelselect",initialize:function(e,t){var i=Ember.get,n=Ember.set,o=Ember.Component.extend({model:function(){var e=i(this,"content.model.options.model"),t=e.split(".");return t[t.length-1].capitalize()}.property("content.model.options.model"),newModelSelected:function(){var e=i(this,"selectedModel");console.log("Select record:",e),n(this,"content.value",i(e,"id"))}.observes("selectedModel"),availableModels:function(){var e=i(this,"componentDataStore"),t=i(this,"model");return e.findAll(t.dasherize())}.property("model"),init:function(){this._super.apply(this,arguments);var e=DS.Store.create({container:i(this,"container")});n(this,"componentDataStore",e);var t,o=i(this,"content.value"),r=this;if(o){console.log("Select model instance:",o);var s=i(this,"model");t=e.find(s,o),t.then(function(e){n(r,"selectedModel",e)})}else console.log("Select first available model"),t=i(this,"availableModels"),t.then(function(e){var t=e.content[0];n(r,"selectedModel",t)})}});t.register("component:component-modelselect",o)}}),Ember.Application.initializer({name:"component-nestedarrayeditor",after:"ValidationFieldMixin",initialize:function(e,t){var i=e.lookupFactory("mixin:validation-field"),n=Ember.get,o=Ember.set,r=Ember.Component.extend(i,{valueRefPath:"content.value",valuePath:"value",init:function(){this._super.apply(this,arguments),o(this,"componentDataStore",DS.Store.create({container:n(this,"container")}));var e=n(this,"content.value")||[];o(this,"value",e),o(this,"content.value",e);var t=n(this,"value"),i=this;Ember.run(function(){if(o(i,"arrayAttributes",Ember.A()),void 0!==t)for(var e=0,r=t.length;e<r;e++)n(i,"arrayAttributes").pushObject(i.generateVirtualAttribute(e))})},itemEditorType:function(){var e=n(this,"content.model.options.items.type"),t=n(this,"content.model.options.items.role");console.log("editorType",n(this,"content"),e,t);var i;return i=t?"editor-"+t:"editor-"+e,void 0===Ember.TEMPLATES[i]&&(i="editor-defaultpropertyeditor"),i}.property("content.model.options.items.type","content.model.options.items.role"),generateVirtualAttribute:function(e){var t=n(this,"value"),i=n(this,"content.model.options.items"),r=this;console.log("generateVirtualAttribute",e,t[e]);var s=Ember.Object.create({parent:r,index:e,value:t[e]});o(s,"model",Ember.Object.create()),o(s,"model.options",Ember.Object.create());for(var a in i)"value"!==a&&Ember.set(s,"model.options."+a,i[a]);return console.log("generateVirtualAttribute virtual attribute",s),Ember.addObserver(s,"value",function(e){console.log("value changed",e.value,e.index),n(r,"value").removeAt(e.index),n(r,"value").insertAt(e.index,e.value),console.log("content changed",r.get("value"))}),console.log("generateVirtualAttribute"),s},contentChanged:function(){console.log("recompute contentAttributeArray")},actions:{move:function(e,t){var i=n(this,"arrayAttributes"),o=i.indexOf(t);"up"===e&&o>0&&(console.log("processing",e),this.moveItem(o,o-1)),"down"===e&&o<n(i,"length")-1&&(console.log("processing",e),this.moveItem(o,o+1))},addItem:function(){console.log("addItem",n(this,"value"));var e=n(this,"value"),t=n(this,"content.model.options.items.type"),i=n(this,"content.model.options.items.model"),o=n(this,"content.model.options.items.objectDict");if(void 0!==i){var r=n(this,"componentDataStore"),s=r.createRecord(i,{xtype:i});e.pushObject(s)}else"object"===t?e.pushObject(Ember.Object.create(o)):e.pushObject(void 0);var a=e.length-1,l=this.generateVirtualAttribute(a);n(this,"arrayAttributes").pushObject(l),this.validate()},addNestedItem:function(e){var t={value:{displayable:!0,isActive:!1,label:""}};console.log("addNestedItem",n(this,"value")),e.get("value.nestedViews")||e.set("value.nestedViews",Ember.A()),e.get("value.nestedViews").pushObject(t)},removeItem:function(e){console.log("removeItem",n(this,"value"));var t=n(this,"arrayAttributes");n(this,"value").removeAt(e.index),t.removeAt(e.index);for(var i=e.index,o=t.length;i<o;i++)t.objectAt(i).set("index",t.objectAt(i).get("index")-1);this.validate()},removeNestedItem:function(e,t){console.log("removeNestedItem",n(this,"value")),e.get("value.nestedViews").removeObject(t)}},moveItem:function(e,t){console.log("moveItem",arguments);var i=n(this,"arrayAttributes");i.arrayContentWillChange(e,1,0);var o=i[e];i.splice(e,1),i.splice(t,0,o);for(var r=0,s=i.length;r<s;r++)i[r].index=r;i.arrayContentDidChange(t,0,1),i=n(this,"value"),i.arrayContentWillChange(e,1,0),o=i[e],i.splice(e,1),i.splice(t,0,o),i.arrayContentDidChange(t,0,1)}});t.register("component:component-nestedarrayeditor",r)}}),Ember.Application.initializer({name:"component-password",after:"HashUtils",initialize:function(e,t){var i=e.lookupFactory("utility:hash"),n=Ember.get,o=Ember.set,r=Ember.isNone,s=Ember.Component.extend({method:void 0,content:void 0,init:function(){this._super.apply(this,arguments);var e=["sha1","md5"],t=n(this,"method");r(t)||-1!==e.indexOf(t)||(console.warning("Invalid method, using sha1:",t),o(this,"method","sha1"))},onUpdate:function(){var e=n(this,"password"),t=n(this,"method");if(!r(t)){e=n(i,t)(e)}o(this,"content",e)}.observes("password")});t.register("component:component-password",s)}}),Ember.Application.initializer({name:"component-propertiestopopup",initialize:function(e,t){var i=Ember.get,n=Ember.set,o=Ember.isNone,r=window.json2html,s=Ember.Component.extend({init:function(){this._super();var e;try{if(e=JSON.parse(i(this,"properties")),!Ember.isArray(e))throw"Not an array"}catch(t){console.warn("Unable to parse properties list"),e=[]}n(this,"propertieslist",e)},propertiesAsHtml:function(){var e=i(this,"propertieslist"),t=e.length,n=i(this,"source");if(o(n))return"";var s,a;for(s=i(this,"propertiesOnly")?[]:{},a=0;a<t;a++){var l=i(n,e[a]);o(l)||(i(this,"propertiesOnly")?s.push(l):s[e[a]]=l)}var c=r(s);return i(this,"htmlOnly")?c:c.toString()}.property(),icon:function(){var e=i(this,"customIcon");return o(e)?"glyphicon-eye-open":e}.property()});t.register("component:component-propertiestopopup",s)}}),Ember.Application.initializer({name:"component-restobjectcombo",initialize:function(e,t){var i=Ember.get,n=Ember.set,o=Ember.Component.extend({schemaType:void 0,selectedValue:void 0,valueField:void 0,labelField:void 0,valuePath:void 0,isLoading:!0,init:function(){this._super(),n(this,"store",DS.Store.create({container:this.get("container")}))},destroy:function(){i(this,"store").destroy()},categorizeElements:function(e){function t(e,t){void 0===n[e]&&(n[e]=Ember.A()),t.get(i(o,"valueField"))===i(o,"selectedValue")?n[e].pushObject({label:i(t,i(o,"labelField")),value:i(t,i(o,"valueField")),selected:!0}):n[e].pushObject({label:i(t,i(o,"labelField")),value:i(t,i(o,"valueField"))})}for(var n={},o=this,r=0,s=e.length;r<s;r++){var a=i(e[r],"tags");if(a&&a.length)for(var l=0,c=a.length;l<c;l++)t(a[l],e[r]);else t("untagged",e[r])}var d=Ember.keys(n),u=Ember.A();for(r=0;r<d.length;r++)u.pushObject({name:d[r],content:n[d[r]]});return console.log("res",u),u},filteredElements:function(){var e=this;if(i(this,"searchCriterion")){var t=i(this,"searchCriterion"),n=i(this,"content").filter(function(n){console.log("item",n);var o=n.get(i(e,"labelField")).slice(0,t.length)==t,r=n.get("tags");if(r)for(var s=0,a=r.length;s<a;s++){var l=r[s].slice(0,t.length)==t;if(l)return!0}return o});return this.categorizeElements(n)}return this.categorizeElements(i(this,"content"))}.property("content","searchCriterion"),didInsertElement:function(){var e=this,t=i(this,"valuePath")||"attr.value";i(this,"store").findQuery(i(this,"schemaType"),{limit:1e4}).then(function(i){n(e,"isLoading",!1),n(e,"content",i.get("content")),Ember.run.schedule("afterRender",function(){e.$("select").on("change",function(){console.log("select value",this.value),n(e,t,this.value)})})})},willDestroyElement:function(){this.$("select").off("change")}});t.register("component:component-restobjectcombo",o)}}),Ember.Application.initializer({name:"component-searchbar",initialize:function(e,t){var i=Ember.get,n=Ember.Component.extend({showSearchOptions:!1,tagName:"span",actions:{searchInputAction:function(){var e=i(this,"value");console.log("searchItems",this,this.controller,e),i(this,"controller").target.set("searchCriterion",e)},clearSearch:function(){console.log("clear search field"),this.set("value",""),i(this,"controller").target.set("searchFieldValue",""),this.send("searchInputAction","")}},tabAllId:function(){return console.log("tabAllId"),i(this,"elementId")+"TabAll"}.property("elementId"),tabIndexedId:function(){return i(this,"elementId")+"TabIndexed"}.property("elementId"),tabFilterId:function(){return i(this,"elementId")+"TabFilter"}.property("elementId"),tabAllHref:function(){return"#"+i(this,"elementId")+"TabAll"}.property("elementId"),tabIndexedHref:function(){return"#"+i(this,"elementId")+"TabIndexed"}.property("elementId"),tabFilterHref:function(){return"#"+i(this,"elementId")+"TabFilter"}.property("elementId")});t.register("component:component-searchbar",n)}}),Ember.Application.initializer({name:"component-simpledicteditor",initialize:function(e,t){var i=Ember.get,n=Ember.set,o=Ember.isNone,r=Ember.Component.extend({content:void 0,actions:{addKey:function(){var e=i(this,"newValue"),t=i(this,"newKey");o(i(this,"content"))&&n(this,"content",{}),o(e)||o(t)||(n(this,"content."+t,e),this.contentChanged(),n(this,"newKey"),n(this,"newValue"))},select:function(){console.warn("select",arguments)},removeKey:function(e){delete this.content[e],this.contentChanged()}},didInsertElement:function(){this._super.apply(this),this.contentChanged()},contentChanged:function(){var e=Ember.A(),t=i(this,"content");if(t){var o=Ember.keys(t);console.warn(t,o);for(var r=0,s=o.length;r<s;r++){var a=o[r];e.pushObject(Ember.Object.create({key:a,value:t[a]}))}console.warn("dictAsArray",e),n(this,"dictAsArray",e)}}});t.register("component:component-simpledicteditor",r)}}),Ember.Application.initializer({name:"component-slider",initialize:function(e,t){var i=Ember.get,n=Ember.set,o=Ember.isNone,r=Ember.Component.extend({content:void 0,options:void 0,didInsertElement:function(){var e=this,t=i(this,"options"),r=i(t,"min")||0,s=i(t,"max")||100,a=i(t,"step")||1,l=parseInt(i(e,"content"));(o(l)||isNaN(l))&&(l=i(t,"default")||r),console.log("slider options",{min:r,max:s,step:a,value:l}),e.$("#range_slider").ionRangeSlider({min:r,max:s,from:l,type:"single",step:a,prefix:"",onChange:function(t){n(e,"content",i(t,"from"))}});var c=function(){var t=e.$(".irs-line");if(void 0!==t)if(t.is(":visible")){var i=t.width(),n=i/s*l,o=i-20;n>o&&(n=o),e.$(".irs-single").css("left",n),e.$(".irs-slider").css("left",n)}else setTimeout(c,500)};c()}});t.register("component:component-slider",r)}}),Ember.Application.initializer({name:"component-stringclassifiedcrecordselector",after:"component-classifiedcrecordselector",initialize:function(e,t){var i=e.lookupFactory("component:component-classifiedcrecordselector"),n=Ember.get,o=Ember.set,r=i.extend({multiselect:!1,selectionChanged:function(){var e,t=n(this,"selectionUnprepared")[0],i=n(this,"valueKey");Ember.isNone(t)||(e=i?n(t,"value"):n(t,"name"),console.log("selection changed",e)),o(this,"selection",e)}.observes("selectionUnprepared","selectionUnprepared.@each")});t.register("component:component-stringclassifiedcrecordselector",r)}}),Ember.Application.initializer({name:"component-tabcontent",initialize:function(e,t){var i=Ember.get,n=Ember.set,o=Ember.Component.extend({tabContainer:Ember.computed.alias("parentView.parentView"),classNames:["tab-pane"],attributeBindings:["role","data-ref"],role:"tab","data-ref":Ember.computed.alias("ref"),active:!1,init:function(){n(this,"elementId",i(this,"tabContainer.elementId")+"-"+i(this,"ref")),i(this,"active")&&!0===i(this,"active")?i(this,"classNames").pushObject("active"):i(this,"classNames").removeObject("active"),this._super()}});t.register("component:component-tabcontent",o)}}),Ember.Application.initializer({name:"component-tabheader",initialize:function(e,t){var i=Ember.get,n=Ember.Component.extend({tagName:"li",attributeBindings:["data-toggle","role","data-ref"],"data-toggle":"tab",role:"tab","data-ref":Ember.computed.alias("ref"),href:function(){return"#"+i(this,"tabContainer.elementId")+"-"+i(this,"ref")}.property("tabContainer","ref"),tabContainer:Ember.computed.alias("parentView.parentView"),active:!1,init:function(){i(this,"active")&&!0===i(this,"active")?i(this,"classNames").pushObject("active"):i(this,"classNames").removeObject("active"),this._super()}});t.register("component:component-tabheader",n)}}),Ember.Application.initializer({name:"component-table",after:"PaginationMixin",initialize:function(e,t){var i=e.lookupFactory("mixin:pagination"),n=Ember.get,o=Ember.set,r=Ember.isNone,s=Ember.Component.extend(i,{model:void 0,modelfilter:void 0,data:void 0,columns:[],items:[],mixinOptions:{pagination:{itemsPerPage:5}},onDataChange:function(){this.refreshContent()}.observes("data.@each"),onModelFilterChange:function(){o(this,"currentPage",1),this.refreshContent()}.observes("modelfilter"),init:function(){this._super(arguments),r(n(this,"model"))||o(this,"store",DS.Store.create({container:n(this,"container")})),o(this,"widgetDataMetas",{total:0}),r(n(this,"items"))&&o(this,"items",[])},didInsertElement:function(){this.refreshContent()},refreshContent:function(){this._super(arguments),this.findItems(),console.log(n(this,"widgetDataMetas"))},findItems:function(){try{var e=this,t=n(this,"store"),i=n(this,"model"),r=n(this,"modelfilter"),s={limit:n(this,"paginationMixinFindOptions.limit")};if(s[n(this,"queryStartOffsetKeyword")||"skip"]=n(this,"paginationMixinFindOptions.start"),void 0!==i)null!==r&&(s.filter=r),t.findQuery(i,s).then(function(t){console.log("Received data for table:",t),o(e,"widgetDataMetas",n(t,"meta")),o(e,"items",n(t,"content"))});else{var a=n(this,"data").slice(s.skip,s.skip+s.limit);o(this,"widgetDataMetas",{total:n(this,"data.length")}),o(this,"items",a)}}catch(e){console.warn("extractItems not updated:",e)}},actions:{do:function(e,t){this.targetObject.send(e,t)}}});t.register("component:component-table",s)}}),Ember.Application.initializer({name:"component-tabs",initialize:function(e,t){var i=Ember.Component.extend({});t.register("component:component-tabs",i)}}),Ember.Application.initializer({name:"component-tabscontentgroup",initialize:function(e,t){var i=Ember.Component.extend({classNames:["tab-content"]});t.register("component:component-tabscontentgroup",i)}}),Ember.Application.initializer({name:"component-tabsheadergroup",initialize:function(e,t){var i=Ember.Component.extend({tagName:"ul",classNames:["nav","nav-tabs"]});t.register("component:component-tabsheadergroup",i)}}),Ember.Application.initializer({name:"component-textwithsortoption",initialize:function(e,t){var i=Ember.get,n=Ember.set,o=Ember.isNone,r=Ember.Component.extend({directionTypes:["ASC","DESC"],property:void 0,direction:void 0,content:void 0,init:function(){this._super.apply(this,arguments),o(this.get("content"))||(n(this,"property",i(this,"content.property")),n(this,"direction",i(this,"content.direction")))},onUpdate:function(){this.set("content",{property:i(this,"property"),direction:i(this,"direction")}),console.debug("update sortable content",i(this,"content"))}.observes("property","direction")});t.register("component:component-textwithsortoption",r)}}),Ember.Application.initializer({name:"component-timestamptooltiped",after:"DatesUtils",initialize:function(e,t){var i=e.lookupFactory("utility:dates"),n=Ember.get,o=Ember.String.loc,r=Ember.Component.extend({showMainTimestamp:function(){var e=n(this,"maintitle"),t=n(this,"maintimestamp");return o(e)+"<br/><i>"+i.timestamp2String(t)+"</i>"}.property(),showOptionalElapsed:function(){var e=n(this,"optionaltimestamp");return i.durationFromNow(e)}.property()});t.register("component:component-timestamptooltiped",r)}}),Ember.Application.initializer({name:"component-typedvalue",after:"ValuesUtils",initialize:function(e,t){var i=e.lookupFactory("utility:values"),n=Ember.get,o=Ember.set,r=Ember.String.loc,s=Ember.Component.extend({init:function(){this._super(),o(this,"selectedValueType","String"),o(this,"valuesTypes",["String","Number","Boolean","Array"]);var e,t;if(console.log("Init content for typed value is",n(this,"content")),Ember.isNone(n(this,"content")))e="",t="";else{t=e=n(this,"content");var i=(typeof e).capitalize();o(this,"selectedValueType",i)}o(this,"content",t),o(this,"value",e)},updateContent:function(){console.log("get content from typed value:",n(this,"value"));var e=i.castValue(n(this,"value"),n(this,"selectedValueType"));o(this,"content",e),o(this,"contentType",typeof e)}.observes("value"),placeholder:function(){var e="Type a value";switch(n(this,"selectedValueType")){case"Number":e="Use an integer value or a decimal";break;case"String":e="Type a value"}return r(e)}.property("selectedValueType"),updateContentType:function(){var e=n(this,"selectedValueType");"String"===e&&o(this,"value",""),"Number"===e&&o(this,"value",0),"Boolean"===e&&o(this,"value",!0),"Array"===e&&o(this,"value",{value:[""],operation:"append"}),console.log("updated content type with value",n(this,"value"))}.observes("selectedValueType"),useTextField:function(){return"String"===n(this,"selectedValueType")||"Number"===n(this,"selectedValueType")}.property("selectedValueType"),useBoolean:function(){return"Boolean"===n(this,"selectedValueType")}.property("selectedValueType"),useArray:function(){return"Array"===n(this,"selectedValueType")}.property("selectedValueType"),actions:{switchContentValue:function(){o(this,"value",!n(this,"value")),console.log("switched boolean value",n(this,"value"))},addListElement:function(){n(this,"value").pushObject("")},removeItem:function(e){n(this,"value").removeObject(e)}}});t.register("component:component-typedvalue",s)}}),Ember.Application.initializer({name:"DoneForm",after:["FormFactory","InspectableItemMixin","ValidationMixin","SlugUtils"],initialize:function(e,t){var i=e.lookupFactory("factory:form"),n=window.schemasRegistry,o=e.lookupFactory("mixin:inspectable-item"),r=e.lookupFactory("mixin:validation"),s=e.lookupFactory("utility:slug"),a=Ember.set,l=Ember.get,c=Ember.isNone,d={mixins:[o,r]},u=i("doneform",{needs:["application"],partials:{debugButtons:["formbutton-inspectform"]},validationFields:Ember.computed(function(){return Ember.A()}),ArrayFields:Ember.A(),init:function(){this._super(),this.set("partials.buttons",["formbutton-submit"])},filterUserPreferenceCategory:function(e,t){var i=l(e,"keys");a(e,"keys",[]);for(var n=0,o=i.length;n<o;n++)console.log("key",i[n]),this.get("userPreferencesOnly")?i[n].model&&i[n].model.options&&i[n].model.options.isUserPreference&&l(e,"keys").push(i[n]):t[i[n].field]&&(console.log("magic keys",i[n]),t[i[n].field].readOnly&&(i[n].model.options.readOnly=!0),l(e,"keys").push(i[n]));return e},categories:function(){var e=l(this,"categorized_attributes"),t=[];if(e instanceof Array){for(var i=0,n=e.length;i<n;i++){var o=e[i];o.slug=s.slug(o.title),console.log("current category",o),l(this,"filterFieldByKey")||l(this,"userPreferencesOnly")?(this.filterUserPreferenceCategory(o,l(this,"filterFieldByKey")),o.keys.length&&t.push(e[i]),console.log("category"),console.log(o)):t.push(e[i])}return t.length&&a(t[0],"isDefault",!0),t}return[]}.property("categorized_attributes"),onePageDisplay:function(){return!1}.property(),inspectedDataItem:function(){return l(this,"formContext")}.property("formContext"),inspectedItemType:function(){return console.log("recompute inspectedItemType",l(this,"formContext")),l(this,"formContext.xtype")?l(this,"formContext.xtype"):"user"===l(this,"formContext.crecord_type")?"account":l(this,"formContext.crecord_type")||l(this,"formContext.connector_type")}.property("formContext"),categorized_attributes:function(){var e=l(this,"inspectedDataItem");if(console.log("recompute categorized_attributes",e),void 0===e);else{console.log("inspectedDataItem attributes",this.getAttributes());var t=this.getInspectedItemType(),i=window.schemasRegistry.getByName(t).EmberModel;if(void 0!==t){var n=l(this,"options"),o=[];n&&n.filters&&(o=n.filters),console.log(" + filters ",o);var r={};n&&n.override_labels&&(r=n.override_labels),a(this,"categories",[]);for(var s=this.getAttributes(),c=i.proto().categories,d=0,u=c.length;c&&d<u;d++){for(var h=c[d],p={title:h.title,keys:[]},m=0,f=h.keys.length;m<f;m++){var g=h.keys[m],v=s.get(g);if("separator"===g)p.keys[m]=this.generateRoleAttribute("separator");else{if("name"===g&&(v={isAttribute:!0,name:"name",options:{default:"",description:"Name",required:!0,role:"string",type:"string"},type:"stting"}),void 0!==g&&void 0===v){console.error("An attribute that does not exists seems to be referenced in schema categories"+g),console.error(i,v,s),p.keys[m]=this.generateRoleAttribute("error"),p.keys[m].field=g,p.keys[m].error="Attribute referenced in schema categories not found";continue}void 0===v.options&&(v.options={}),0===o.length||-1!==$.inArray(g,o)?a(v,"options.hiddenInForm",!1):a(v,"options.hiddenInForm",!0);var b=g;r[g]&&(b=r[g]),p.keys[m]={field:b,model:v,editor:this.generateEditorNameForAttribute(v)},p=this.insertValueIntoAttribute(p,e,g,v,m)}}this.categories.push(p)}return console.log("categories",this.categories),this.categories}}}.property("inspectedDataItem","inspectedItemType"),actions:{submit:function(){if(void 0===this.validation||this.validation()){console.log("submit action",arguments);var e={};if(this.isOnCreate&&this.modelname){var t=this.modelname.charAt(0).toUpperCase()+this.modelname.slice(1),i=n.getByName(t);if(i)for(var o in i)if(i.hasOwnProperty(o)){var r=i[o];if(r&&r._meta&&r._meta.options){var s=r._meta.options;if("setOnCreate"in s){var d=s.setOnCreate;a(this,"formContext."+o,d)}}}}var u=l(this,"options");if(u&&u.override_labels)for(var h in u.override_labels)u.override_labels.hasOwnProperty(h)&&(e[u.override_labels[h]]=h);var p=l(this,"categorized_attributes");console.log("setting fields");for(var m=0,f=p.length;m<f;m++)for(var g=p[m],v=0,b=g.keys.length;v<b;v++){var y=g.keys[v],E=y.field;if(e[y.field]&&(E=e[y.field]),"mixins"===y.field){var x=[];if(!c(y.value))for(var w=0;w<y.value.length;w++){for(var _=Ember.keys(y.value[w]),k={},A=0;A<_.length;A++)k[_[A]]=y.value[w][_[A]];window.$M=k,x.push(k)}Ember.set(y,"value",x)}a(this,"formContext."+E,y.value)}console.log("this is a widget",l(this,"formContext"));var C=[l(this,"formContext")];C.addObjects(arguments),this._super.apply(this,C)}}}},d);t.register("form:doneform",u)}}),Ember.Application.initializer({name:"PbehaviorForm",after:["FormFactory","InspectableItemMixin","ValidationMixin","SlugUtils"],initialize:function(e,t){var i=e.lookupFactory("factory:form"),n=window.schemasRegistry,o=e.lookupFactory("mixin:inspectable-item"),r=e.lookupFactory("mixin:validation"),s=e.lookupFactory("utility:slug"),a=Ember.set,l=Ember.get,c=Ember.isNone,d={mixins:[o,r]},u=i("pbehaviorform",{needs:["application"],partials:{debugButtons:["formbutton-inspectform"]},validationFields:Ember.computed(function(){return Ember.A()}),ArrayFields:Ember.A(),init:function(){this._super(),this.set("partials.buttons",["formbutton-submit"])},filterUserPreferenceCategory:function(e,t){var i=l(e,"keys");a(e,"keys",[]);for(var n=0,o=i.length;n<o;n++)console.log("key",i[n]),this.get("userPreferencesOnly")?i[n].model&&i[n].model.options&&i[n].model.options.isUserPreference&&l(e,"keys").push(i[n]):t[i[n].field]&&(console.log("magic keys",i[n]),t[i[n].field].readOnly&&(i[n].model.options.readOnly=!0),l(e,"keys").push(i[n]));return e},categories:function(){var e=l(this,"categorized_attributes"),t=[];if(e instanceof Array){for(var i=0,n=e.length;i<n;i++){var o=e[i];o.slug=s.slug(o.title),console.log("current category",o),l(this,"filterFieldByKey")||l(this,"userPreferencesOnly")?(this.filterUserPreferenceCategory(o,l(this,"filterFieldByKey")),o.keys.length&&t.push(e[i]),console.log("category"),console.log(o)):t.push(e[i])}return t.length&&a(t[0],"isDefault",!0),t}return[]}.property("categorized_attributes"),onePageDisplay:function(){return!1}.property(),inspectedDataItem:function(){return l(this,"formContext")}.property("formContext"),inspectedItemType:function(){return console.log("recompute inspectedItemType",l(this,"formContext")),l(this,"formContext.xtype")?l(this,"formContext.xtype"):"user"===l(this,"formContext.crecord_type")?"account":l(this,"formContext.crecord_type")||l(this,"formContext.connector_type")}.property("formContext"),categorized_attributes:function(){var e=l(this,"inspectedDataItem");if(console.log("recompute categorized_attributes",e),void 0===e);else{console.log("inspectedDataItem attributes",this.getAttributes());var t=this.getInspectedItemType(),i=window.schemasRegistry.getByName(t).EmberModel;if(void 0!==t){var n=l(this,"options"),o=[];n&&n.filters&&(o=n.filters),console.log(" + filters ",o);var r={};n&&n.override_labels&&(r=n.override_labels),a(this,"categories",[]);for(var s=this.getAttributes(),c=[{keys:["start","end","rrule","name"],title:"General"}],d=0,u=c.length;c&&d<u;d++){for(var h=c[d],p={title:h.title,keys:[]},m=0,f=h.keys.length;m<f;m++){var g=h.keys[m],v=s.get(g);if("separator"===g)p.keys[m]=this.generateRoleAttribute("separator");else{if("name"===g&&(v={isAttribute:!0,name:"name",options:{default:"",description:"Name",required:!0,role:"string",type:"string"},type:"stting"}),void 0!==g&&void 0===v){console.error("An attribute that does not exists seems to be referenced in schema categories"+g),console.error(i,v,s),p.keys[m]=this.generateRoleAttribute("error"),p.keys[m].field=g,p.keys[m].error="Attribute referenced in schema categories not found";continue}void 0===v.options&&(v.options={}),0===o.length||-1!==$.inArray(g,o)?a(v,"options.hiddenInForm",!1):a(v,"options.hiddenInForm",!0);var b=g;r[g]&&(b=r[g]),p.keys[m]={field:b,model:v,editor:this.generateEditorNameForAttribute(v)},p=this.insertValueIntoAttribute(p,e,g,v,m)}}this.categories.push(p)}return console.log("categories",this.categories),this.categories}}}.property("inspectedDataItem","inspectedItemType"),actions:{submit:function(){if(void 0===this.validation||this.validation()){console.log("submit action",arguments);var e={};if(this.isOnCreate&&this.modelname){var t=this.modelname.charAt(0).toUpperCase()+this.modelname.slice(1),i=n.getByName(t);if(i)for(var o in i)if(i.hasOwnProperty(o)){var r=i[o];if(r&&r._meta&&r._meta.options){var s=r._meta.options;if("setOnCreate"in s){var d=s.setOnCreate;a(this,"formContext."+o,d)}}}}var u=l(this,"options");if(u&&u.override_labels)for(var h in u.override_labels)u.override_labels.hasOwnProperty(h)&&(e[u.override_labels[h]]=h);var p=l(this,"categorized_attributes");console.log("setting fields");for(var m=0,f=p.length;m<f;m++)for(var g=p[m],v=0,b=g.keys.length;v<b;v++){var y=g.keys[v],E=y.field;if(e[y.field]&&(E=e[y.field]),"mixins"===y.field){var x=[];if(!c(y.value))for(var w=0;w<y.value.length;w++){for(var _=Ember.keys(y.value[w]),k={},A=0;A<_.length;A++)k[_[A]]=y.value[w][_[A]];window.$M=k,x.push(k)}Ember.set(y,"value",x)}a(this,"formContext."+E,y.value)}console.log("this is a widget",l(this,"formContext"));var C=[l(this,"formContext")];C.addObjects(arguments),this._super.apply(this,C)}}}},d);t.register("form:pbehaviorform",u)}}),function(){
Ember.Handlebars.helper("color",function(e){var t="";if(e&&"#null"!==e.toLowerCase()){"#"===e[0]&&(e=e.slice(1));var i=parseInt("FFFFFF",16),n=parseInt("888888",16),o=parseInt("444444",16),r=parseInt(e,16),s=i-r,a=s-n;a<0?(a=-a)<=o&&(s-=o-a):a<=o&&(s+=o-a),s=s.toString(16);s=(parseInt(s.substring(0,2),16)+parseInt(s.substring(2,4),16)+parseInt(s.substring(4,6),16))/3,s=parseInt(s.toFixed()),s=s.toString(16),s=s+s+s;var l="background-color: #"+e+";";l+="color: #"+s+";",t='style="'+l+'"'}else e="no color";return new Ember.Handlebars.SafeString('<div class="color" '+t+">"+e+"</div>")})}(),Ember.Application.initializer({name:"Compare",initialize:function(e,t){var i=window.Handlebars,n=function(e,t,i){if(arguments.length<3)throw new Error("Handlebars Helper 'compare' needs 2 parameters");var n=i.hash.operator||"==",o={"==":function(e,t){return e==t},"===":function(e,t){return e===t},"!=":function(e,t){return e!=t},lt:function(e,t){return e<t},gt:function(e,t){return e>t},lte:function(e,t){return e<=t},gte:function(e,t){return e>=t},typeof:function(e,t){return typeof e==t}};if(!o[n])throw new Error('Handlebars Helper "compare" doesn\'t know the operator '+n);return o[n](e,t)?i.fn(this):i.inverse(this)};i.registerHelper("compare",n),Ember.Handlebars.helper("compare",n)}}),function(){var e=(Ember.set,Ember.isNone,Ember.isArray,function(e,t){var i="";"number"!=typeof t&&(t=0),t>0&&e.length>t&&(i+='style="',i+="text-overflow:ellipsis;",i+="width: "+t+"ch;",i+="white-space:nowrap;",i+='overflow:hidden;"');var n="<p "+i+' onclick="selfEllipsis('+t+',this)">'+e+"</p>";return new Ember.String.htmlSafe(n)});Handlebars.registerHelper("ellipsis",e),Ember.Handlebars.helper("ellipsis",e),window.ellipsis=e,window.selfEllipsis=function(e,t){"number"!=typeof e||e<=0||(t.style.textOverflow?t.removeAttribute("style"):$(t).text().length>e&&(t.style.textOverflow="ellipsis",t.style.width=e+"ch",t.style.whiteSpace="nowrap",t.style.overflow="hidden"))}}(),function(){var e=Ember.isNone,t=Ember.String.loc,i={check:{color:"green",icon:"certificate"},consolidation:{color:"green",icon:"cogs"},log:{color:"black",icon:"clock-o"},perf:{color:"grey",icon:"pie-chart"},selector:{color:"green",icon:"eye"},sla:{color:"green",icon:"warning"},topology:{color:"green",icon:"code-fork"},eue:{color:"green",icon:"cog"},calendar:{color:"blue",icon:"calendar"},comment:{color:"blue",icon:"comment"},trap:{color:"blue",icon:"wrench"},user:{color:"blue",icon:"male"},ack:{color:"purple",icon:"check"},downtime:{color:"yellow",icon:""},cancel:{color:"yellow",icon:"trash"},uncancel:{color:"yellow",icon:"reply"},ackremove:{color:"purple",icon:"close"},assocticket:{color:"yellow",icon:"thumb-tack"}};Ember.Handlebars.helper("eventtype",function(n){if(e(i[n]))return n;var o=i[n],r='<span class="badge bg-%@"><i class="fa fa-%@"></i> %@</span>'.fmt(o.color,o.icon,t(n));return new Ember.Handlebars.SafeString(r)})}(),function(){Ember.Handlebars.helper("glyphicon",function(e){return new Ember.Handlebars.SafeString('<span class="glyphicon glyphicon-'+e+'"></span>')})}(),Ember.Application.initializer({name:"HumanReadableHelper",after:["ValuesUtils"],initialize:function(e,t){var i=e.lookupFactory("utility:values"),n=Ember.get,o=Ember.isNone,r=Ember.String.loc,s=window.Handlebars,a=function(e,t){var s,a=e;o(t)&&(t=e,a=n(t,"hash.value"));var l=n(t,"hash.unit")||"";return s=isNaN(a)?r("Not a valid number"):i.humanize(a,l),new Ember.Handlebars.SafeString(s)};s.registerHelper("hr",a),Ember.Handlebars.helper("hr",a)}}),Ember.Application.initializer({name:"InfosDetailsHelper",after:"DatesUtils",initialize:function(e,t){e.lookupFactory("utility:dates"),Ember.get,Ember.isNone;Ember.Handlebars.helper("infosdetails",function(e,t){var i="";for(var n in e)e.hasOwnProperty(n)&&(void 0===e[n].description||""===e[n].description?i=""!==e[n].value?i+"<ul><li>"+n+" : "+e[n].value+"</li></ul>":i+"<ul><li>"+n+"</li></ul>":(i=i+"<ul><li>"+n+"</li>",i=""!==e[n].value?i+"<ul><li>"+e[n].description+" : "+e[n].value+"</li></ul>":i+"<ul><li>"+e[n].description+"</li></ul>",i+="</ul>"));return new Ember.Handlebars.SafeString(i)})}}),Ember.Application.initializer({name:"Interval2htmlHelper",after:"DatesUtils",initialize:function(e,t){var i=e.lookupFactory("utility:dates"),n=Ember.isNone,o=Ember.String.loc;Ember.Handlebars.helper("interval2html",function(e,t){var r="";return n(e)||(r+=o("From")+" "+i.timestamp2String(e)),n(e)||n(t)||(r+=" "),n(t)||(r+=o("to")+" "+i.timestamp2String(t)),console.debug("generated html form interval2html is",r),r})}}),function(){var e=Ember.set,t=Ember.isNone,i=Ember.isArray,n=function(n,o){function r(e){var t="";if(i(e)){t+='<ul class="jsonUl">';for(var n=e.length,o=0;o<n;o++)t+='<li class="jsonLi">'+r(e[o])+"</li>";t+="</ul>"}else if("object"==typeof e)for(var s in e)t+='<ul class="jsonUl"><li class="jsonLi">',t+='<span class="label label-primary">'+s+"</span>","object"==typeof e[s]||i(e[s])?t+=r(e[s]):t+='&nbsp;<span class="glyphicon glyphicon-arrow-right" style="display:inline"></span><span class="label label-warning">'+e[s]+"</span>",t+="</li></ul>";else t+='&nbsp;<span class="glyphicon glyphicon-arrow-right" style="display:inline"></span><span class="label label-warning">'+e+"</span>";return t}if("string"==typeof n)try{n=JSON.parse(n)}catch(e){console.error("unable to deserialize json"),n={invalid:"json string"}}var s=r(n);return console.info("json2html",{data:n,"settable object:":o,html:s,arguments:arguments}),!t(o)&&arguments.length>2&&(console.log("processing set html to the settable item"),e(o,"json2html",s),s=""),new Ember.Handlebars.SafeString(s)};Ember.Handlebars.helper("json2html",n),window.json2html=n}(),Ember.Application.initializer({name:"LinksDetailsHelper",initialize:function(e,t){Ember.get,Ember.isNone;Ember.Handlebars.helper("linksdetails",function(e,t){var n=["jpg","JPG","jpeg","JPEG","png","PNG"],o="<ul>";for(var r in e){console.error("prop :",r),console.error("info[prop] :",e[r]);var s=new RegExp("^.*.("+n.join("|")+")$");for(i=0;i<e[r].length;i++)console.error("toto",e[r][i]),o=e[r][i].match(s)?o+"<li><a href="+e[r][i]+' target="_blank"><img src='+e[r][i]+" alt="+r+' class="image-center" style="max-width: 100px;max-height: 100px;"></a></li>':o+"<li><a href="+e[r][i]+' target="_blank">'+r+"</a></li>"}return o+="</ul>",new Ember.Handlebars.SafeString(o)})}}),function(){var e="/static/canopsis/media/images/",t={nagios:e+"nagioslogo.png",shinken:e+"shinkenlogo.png",schneider:e+"schneiderlogo.png",collectd:e+"collectd.jpg",sikuli:e+"sikulilogo.png",cucumber:e+"cucumberlogo.png",watir:e+"watirlogo.png",jmeter:e+"jmeterlogo.jpg",centreon:e+"centreonlogo.png",Engine:e+"engine.png"};Ember.Handlebars.helper("logo",function(e){var i=t[e];return void 0!==i?'<img alt="Source" src="'+i+'"/>':e}),Ember.Handlebars.helper("logofromstring",function(e){return t[e]}),Ember.Handlebars.helper("logofromstring2",function(e){return'<img alt="Source" src="'+t[e]+'"/>'})}(),function(){Ember.Handlebars.helper("percent",function(e){return e+="%",new Ember.Handlebars.SafeString(e)})}(),Ember.Handlebars.helper("rights",function(e){var t=["r","w"],i=["eye","pencil"],n="";return t.forEach(function(t,o){var r;r=e&&void 0!==e.contains&&e.contains(t)?"success":"default",n+=' <span class="label label-%@"><span class="fa fa-%@" style="color:white"></span></span>'.fmt(r,i[o])}),n}),Ember.Handlebars.helper("sorticon",function(e){var t;if("sorting_desc"===e)t='<i class="fa fa-caret-down"></i>';else{if("sorting_asc"!==e)return;t='<i class="fa fa-caret-up"></i>'}return t}),Ember.Application.initializer({name:"TimesinceHelper",after:"DatesUtils",initialize:function(e,t){var i=e.lookupFactory("utility:dates"),n=Ember.String.loc;Ember.Handlebars.helper("timeSince",function(e,t){if(e||t.timeStampState){if(e=t.timeStampState||e,i.isToday(e))return n("Today");return i.durationFromNow(e)}return""})}}),Ember.Application.initializer({name:"TimestampHelper",after:"DatesUtils",initialize:function(e,t){var i=e.lookupFactory("utility:dates"),n=Ember.get,o=Ember.isNone;Ember.Handlebars.helper("timestamp",function(e,t,r){o(r)||(e=n(r,"timeStampState")||e),e&&!o(t)&&(s=n(t,"options.format"));var s;if(i.isToday(e)&&(s="timeOnly"),o(e))return"";if(0===e.length)return"";"object"==typeof e&&(e=e.sort(),e=e[0]);var a=i.timestamp2String(e,s,!0);return new Ember.Handlebars.SafeString(a)})}}),Ember.Application.initializer({name:"TimestampfulldateHelper",after:"DatesUtils",initialize:function(e,t){var i=e.lookupFactory("utility:dates"),n=Ember.get,o=Ember.isNone;Ember.Handlebars.helper("timestampfulldate",function(e,t,r){if(o(r)||(e=n(r,"timeStampState")||e),format="r",o(e))return"";if(0===e.length)return"";"object"==typeof e&&(e=e.sort(),e=e[0]);var s=i.timestamp2String(e,format,!0);return new Ember.Handlebars.SafeString(s)})}}),Ember.Application.initializer({name:"ArraysearchMixin",after:"MixinFactory",initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),n=Ember.get,o=Ember.set,r=i("arraysearch",{partials:{header:["search"]},init:function(){if(n(this,"content.mixins")){var e=n(this,"content.mixins").findBy("name","arraysearch");this.mixinOptions.arraysearch=e}this._super.apply(this,arguments)},computeFilterFragmentsList:function(){var e=this._super(),t=n(this,"findParams_searchFilterPart");return e.pushObject(t),e},actions:{searchItems:function(e){console.log("searchItems",e),o(this,"findOptions",e),void 0!==n(this,"currentPage")&&o(this,"currentPage",1),this.refreshContent()}},searchCriterionChanged:function(){console.log("searchFieldValueChanged: criterion",n(this,"searchCriterion"),"field value",n(this,"searchFieldValue"));var e=n(this,"searchFieldValue"),t={};if(null!==e&&void 0!==e){var i=this.computeFilterPartForCriterion(e);console.log("searchFilterPart",i),t=i}o(this,"findParams_searchFilterPart",t),this.refreshContent()}.observes("searchCriterion"),computeFilterPartForCriterion:function(e){console.log("search",n(this,"searchableAttributes"));var t=n(this,"searchableAttributes");if(void 0===t&&(console.warn("searchableAttributes not defined in controller, but searchItems still called. Trying to recompute searchableAttributes.",this),this.searchableAttributesUpdate(),t=n(this,"searchableAttributes"),console.log("new searchableAttributes",t),void 0===t))return void console.warn("searchableAttributes not defined in controller, but searchItems still called. Doing nothing.",this);if("object"!=typeof t)return void console.warn("searchableAttributes should be an array.",this);if(0===t.length)return void console.warn("Asking for a search on records with no searchableAttributes. Doing nothing.",this);for(var i=[],o=0,r=t.length;o<r;o++){var s={};s[t[o]]={$regex:e,$options:"i"},i.pushObject(s)}return JSON.stringify({$or:i})},searchableAttributesUpdate:function(){console.log("shown_columnsChanged");var e,t=n(this,"mixinOptions.arraysearch.searchable_columns");if(Ember.isNone(t)){var i=n(this,"shown_columns");e=Ember.A();for(var r=0,s=i.length;r<s;r++)e.push(i[r].field);o(this,"searchableAttributes",e),console.log("new searchableAttributes",e)}else{e=Ember.A();for(var a=0,l=t.length;a<l;a++)e.push(t[a]);o(this,"searchableAttributes",e),console.log("new searchableAttributes computed from widget parameters",e)}}.observes("shown_columns")});t.register("mixin:arraysearch",r)}}),Ember.Application.initializer({name:"BackgroundMixin",after:["MixinFactory","FormsUtils","HashUtils"],initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),n=Ember.get,o=Ember.Mixin.create({didInsertElement:function(){var e=n(this,"controller.mixinOptions.background.imageUrl"),t=n(this,"controller.mixinOptions.background.position"),i=n(this,"controller.mixinOptions.background.repeat"),o=n(this,"controller.mixinOptions.background.size"),r=n(this,"controller.mixinOptions.background.backgroundcolor"),s=this.$();e&&s.css("background-image","url("+e+")"),t&&s.css("background-position",t),o&&s.css("background-size",o),i&&s.css("background-repeat",i),r&&s.css("background-color",r),this._super()}}),r=i("background",{init:function(){this._super(),this.addMixinView(o)}});t.register("mixin:background",r)}}),Ember.Application.initializer({name:"ContextarraysearchMixin",after:"MixinFactory",initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),n=Ember.get,o=Ember.set,r=i("contextarraysearch",{partials:{header:["search"]},init:function(){if(n(this,"content.mixins")){var e=n(this,"content.mixins").findBy("name","arraysearch");this.mixinOptions.arraysearch=e}this._super.apply(this,arguments)},computeFilterFragmentsList:function(){var e=this._super(),t=n(this,"findParams_searchFilterPart");return e.pushObject(t),e},actions:{searchItems:function(e){console.log("searchItems",e),o(this,"findOptions",e),void 0!==n(this,"currentPage")&&o(this,"currentPage",1),this.refreshContent()}},searchCriterionChanged:function(){console.log("searchFieldValueChanged: criterion",n(this,"searchCriterion"),"field value",n(this,"searchFieldValue"));var e=n(this,"searchFieldValue"),t={};if(null!==e&&void 0!==e){var i=this.computeFilterPartForCriterion(e);console.log("searchFilterPart",i),t=i}o(this,"findParams_searchFilterPart",t),this.refreshContent()}.observes("searchCriterion"),computeFilterPartForCriterion:function(e){console.log("search",n(this,"searchableAttributes"));var t=n(this,"searchableAttributes");if(e.search(/.+={1}".+"/)>-1){var i=e.split(" "),o=i.map(function(e){var t=e.split("="),i={};return i[t[0]]={$regex:t[1].substring(1,t[1].length-1),$options:"i"},i});return JSON.stringify({$and:o})}if(void 0===t&&(console.warn("searchableAttributes not defined in controller, but searchItems still called. Trying to recompute searchableAttributes.",this),this.searchableAttributesUpdate(),t=n(this,"searchableAttributes"),console.log("new searchableAttributes",t),void 0===t))return void console.warn("searchableAttributes not defined in controller, but searchItems still called. Doing nothing.",this);if("object"!=typeof t)return void console.warn("searchableAttributes should be an array.",this);if(0===t.length)return void console.warn("Asking for a search on records with no searchableAttributes. Doing nothing.",this);for(var r=[],s=0,a=t.length;s<a;s++){var l={};l[t[s]]={$regex:e,$options:"i"},r.pushObject(l)}return JSON.stringify({$or:r})},searchableAttributesUpdate:function(){console.log("shown_columnsChanged");var e,t=n(this,"mixinOptions.arraysearch.searchable_columns");if(Ember.isNone(t)){var i=n(this,"shown_columns");e=Ember.A();for(var r=0,s=i.length;r<s;r++)e.push(i[r].field);o(this,"searchableAttributes",e),console.log("new searchableAttributes",e)}else{e=Ember.A();for(var a=0,l=t.length;a<l;a++)e.push(t[a]);o(this,"searchableAttributes",e),console.log("new searchableAttributes computed from widget parameters",e)}}.observes("shown_columns")});t.register("mixin:contextarraysearch",r)}}),Ember.Application.initializer({name:"CrudMixin",after:["MixinFactory","FormsUtils","HashUtils","DataUtils"],initialize:function(e,t){function n(e,t,i){e.onRecordReady(t),console.log("temp record",t,r);var n=l(e,"mixinOptions.crud.formoptions"),o=l(e,"mixinOptions.crud.form");d(n)||$.extend(i,n),d(o)&&(o="modelform"),console.log("open form:",o,i);var a=e;r.showNew(o,t,i).submit.then(function(e){console.log("record going to be saved",t,e),"group"===l(t,"crecord_type")&&c(t,"id",s.generateId("group")),"profile"===l(t,"crecord_type")&&(console.error("set id for profile",t),c(t,"id",s.generateId("profile"))),t=l(e,"formContext"),t.save().then(function(){a.refreshContent()})})}var o=e.lookupFactory("factory:mixin"),r=e.lookupFactory("utility:forms"),s=e.lookupFactory("utility:hash"),a=e.lookupFactory("utility:data"),l=Ember.get,c=Ember.set,d=Ember.isNone,u=Ember.String.loc,h=o("crud",{partials:{selectionToolbarButtons:[],actionToolbarButtons:[],itemactionbuttons:[],header:[],subHeader:[],footer:[]},mixinsOptionsReady:function(){this._super(),l(this,"mixinOptions.crud.hideRemove")||(l(this,"partials.selectionToolbarButtons").pushObject("actionbutton-removeselection"),l(this,"partials.itemactionbuttons").pushObject("actionbutton-duplicate"),l(this,"partials.itemactionbuttons").pushObject("actionbutton-remove")),l(this,"mixinOptions.crud.hideEdit")||l(this,"partials.itemactionbuttons").pushObject("actionbutton-edit"),l(this,"mixinOptions.crud.hideCreate")||l(this,"partials.actionToolbarButtons").pushObject("actionbutton-create"),c(this,"itemsPerPagePropositionSelected",l(this,"itemsPerPage"))},userCanReadRecord:!0,userCanCreateRecord:!0,userCanUpdateRecord:!0,userCanDeleteRecord:!0,onRecordReady:function(e){this._super.apply(this,arguments)},actions:{add:function(e){this._super.apply(this,arguments),console.log("add",e),n(this,l(this,"widgetDataStore").createRecord(e,{crecord_type:e}),{title:"Add "+e})},duplicate:function(e){var t=a.getStore(),i=a.cleanJSONIds(e.serialize()),o=e.constructor.typeKey,r={};r[o]=i,t.pushPayload(o,r),n(this,t.getById(o,i.id),{title:"Duplicate "+o,inspectedItemType:o})},edit:function(e){console.log("edit",e);var t=l(this,"mixinOptions.crud.formoptions"),i=l(this,"mixinOptions.crud.form"),n={title:"Edit "+l(e,"crecord_type"),inspectedItemType:l(this,"listed_crecord_type")};d(t)||$.extend(n,t),d(i)&&(i="modelform"),console.log("open form:",i,n);var o=this;r.showNew(i,e,n).submit.then(function(t){console.log("record going to be saved",e,t),e=l(t,"formContext"),e.save(),o.trigger("refresh")})},remove:function(e,t){if(console.info("removing record",e),t)e.deleteRecord(),e.save();else{r.showNew("confirmform",{},{title:u("Delete this record ?")}).submit.then(function(t){if("filter"===e._data.crecord_type)for(i=0;i<e._data.actions.length;i++)if("baseline"==e._data.actions[i].type){var n=a.getEmberApplicationSingleton().__container__.lookup("adapter:baseline");n.deleteRecord("baseline",{baseline_name:e._data.actions[i].baseline_name}).then(function(e){console.error("Raw data",e)},function(e){console.error("ERROR in the adapter: ",e)})}e.deleteRecord(),e.save()})}},removeSelection:function(){var e=r.showNew("confirmform",{},{title:u("Delete these records ?")}),t=this;e.submit.then(function(e){var i=t.get("widgetData").filterBy("isSelected",!0);console.log("remove action",i);for(var n=0,o=i.length;n<o;n++){var r=i[n];t.send("remove",r,!0)}})}}});t.register("mixin:crud",h)}}),Ember.Application.initializer({name:"CustomfilterlistMixin",after:["FormsUtils","MixinFactory","DataUtils","NotificationUtils"],initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),n=e.lookupFactory("utility:forms"),o=e.lookupFactory("utility:data"),r=e.lookupFactory("utility:notification"),s=Ember.get,a=Ember.set,l=Ember.isNone,c=Ember.String.loc,d=i("customfilterlist",{partials:{subHeader:["customfilters"]},init:function(){this._super(),s(this,"model.user_filters")||a(this,"model.user_filters",Ember.A()),a(this,"multiFiltersTitle",[]),a(this,"customFilterOperators",[{value:"$and",display:"&",active:!0},{value:"$or",display:"||",active:!1}])},canAddCustomFiltersInUserPreferences:!0,isSelectedFilter:function(e){if(!e||!e.length)return!1;if(!s(this,"mixinOptions.customfilterlist.can_mix_filters"))for(var t=e.length,i=s(this,"model.selected_filter.title"),n=0;n<t;n++){var o=s(e[n],"title");console.log("compare filters",i,o),i===o?a(e[n],"isActive",!0):a(e[n],"isActive",!1)}return e},filters_list:function(){return this.isSelectedFilter(s(this,"mixinOptions.customfilterlist.filters"))}.property("mixinOptions.customfilterlist.filters","model.selected_filter"),user_filters:function(){return this.isSelectedFilter(s(this,"model.user_filters"))}.property("model.user_filters","model.selected_filter"),computeFilterFragmentsList:function(){var e,t=this._super(),i=s(this,"model.mixins").findBy("name","customfilterlist"),n=s(this,"model.selected_filter.filter");return l(n)?s(this,"model.selected_filter")&&!n?e={}:i&&i.default_filter?(e=i.default_filter,e=JSON.parse(e)):e={}:e=n,t.pushObject(e),t},generateMultiFilter:function(){var e=s(this,"mixinOptions.customfilterlist.filters"),t=s(this,"model.user_filters"),i=[];i.addObjects(e),i.addObjects(t);var n,o,r=i.length,l=s(this,"multiFiltersTitle"),c={},d=s(this,"customFilterOperators"),u=d.length;for(n=0;n<u;n++)s(d[n],"active")&&(o=s(d[n],"value"));for(c[o]=[],n=0;n<r;n++){var h=s(i[n],"title");if(-1!==$.inArray(h,l)){var p=JSON.parse(s(i[n],"filter"));c[o].pushObject(p)}}0===c[o].length&&(c={});var m=JSON.stringify(c);a(this,"model.selected_filter",{filter:m})},actions:{setActiveOperator:function(e){for(var t=s(this,"customFilterOperators"),i=t.length,n=0;n<i;n++)a(t[n],"active",!1);a(e,"active",!0),this.generateMultiFilter(),this.refreshContent()},setFilter:function(e){if(s(this,"mixinOptions.customfilterlist.can_mix_filters")){console.log("multi filter mode");var t=s(this,"multiFiltersTitle"),i=s(e,"title"),n=!s(e,"isActive");a(e,"isActive",n),n?t.pushObject(i):t.removeObject(i),this.generateMultiFilter()}else{console.log("single filter mode");var o=s(e,"filter");a(this,"model.selected_filter",e),a(this,"model.userFilter",o),s(this,"userPreferencesModel.attributes.list").push({isAttribute:!0,name:"selected_filter",options:{isUserPreference:!0,type:"boolean"},type:"boolean"}),this.saveUserConfiguration(),l(s(this,"currentPage"))||a(this,"currentPage",1)}this.refreshContent()},addUserFilter:function(){var e=this,t=o.getStore().createRecord("customfilter",{crecord_type:"customfilter"});n.showNew("modelform",t,{title:c("Create a custom filter for current list")}).submit.then(function(i){t=i.get("formContext"),s(e,"model.user_filters").pushObject(t),e.notifyPropertyChange("model.user_filters"),console.log("Custom filter created",t,i),r.info(c("Custom filter created")),e.saveUserConfiguration()})},editFilter:function(e){var t=this,i=o.getStore().createRecord("customfilter",{crecord_type:"customfilter",filter:s(e,"filter"),title:s(e,"title")});n.showNew("modelform",i,{title:c("Edit filter for current list")}).submit.then(function(n){t.get("model.user_filters").removeObject(e),i=n.get("formContext"),t.get("model.user_filters").pushObject(i),console.log("Custom filter created",i,n),r.info(c("Custom filter created")),t.saveUserConfiguration()})},removeFilter:function(e){var t=s(e,"title"),i=n.showNew("confirmform",{},{title:c("Are you sure to delete filter")+" "+t+"?"}),o=this;i.submit.then(function(t){o.get("model.user_filters").removeObject(e),r.info(c("Custom filter removed")),o.saveUserConfiguration()})}}});t.register("mixin:customfilterlist",d)}}),Ember.Application.initializer({name:"CustomSendeventMixin",after:["MixinFactory","FormsUtils","DatesUtils","NotificationUtils"],initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),n=e.lookupFactory("utility:forms"),o=e.lookupFactory("utility:dates"),r=e.lookupFactory("utility:notification"),s=Ember.get,a=Ember.set,l=Ember.isNone,c=Ember.String.loc,d=i("customsendevent",{needs:["application"],init:function(){this._super(),a(this,"login",s(this,"controllers.login.record"))},partials:{itemactionbuttons:["actionbutton-ack","actionbutton-cancel","actionbutton-incident","actionbutton-changestate","actionbutton-ticketnumber"],selectionToolbarButtons:["actionbutton-cancelselection","actionbutton-ackselection"]},setPendingOperation:function(e){if(s(this,"controllers.application.frontendConfig.safe_mode"))for(var t=0,i=e.length;t<i;t++)console.log("Pending operations on crecord",e[t]),e[t].pendingOperation=!0},getDataFromRecord:function(e,t,i){console.group("getDataFromRecord"),console.log("get data from record:",e,i);for(var n={author:s(this,"login._id"),id:s(t,"id"),connector:s(t,"connector"),connector_name:s(t,"connector_name"),event_type:e,source_type:s(t,"source_type"),component:s(t,"component"),state:s(t,"state.val"),state_type:s(t,"state_type"),crecord_type:e,timestamp:o.getNow()},r=["domain","perimeter","resource","output"],c=0,d=r.length;c<d;c++){var u=r[c];l(s(t,u))||a(n,u,s(t,u))}return"resource"===n.source_type&&(n.resource=s(t,"resource")),this.processEvent(e,"extract",[n,t,i]),console.groupEnd(),n},submitEvents:function(e,t,i){var n=this,o=s(this,"widgetDataStore")||Ember.widgetDataStore,r=this.get("controllers.application.frontendConfig.safe_mode");return console.log("safe_mode",r),new Ember.RSVP.Promise(function(a,l){for(var c=[],d=0;d<e.length;d++){console.log("Event:",s(t,"author"),s(t,"output"));var u=n.getDataFromRecord(i,e[d],t);u.author=s(t,"author"),u.output=s(t,"output"),s(t,"ticket")&&(u.ticket=s(t,"ticket")),c.push(u),r||n.processEvent(i,"transform",[e[d],u]),o.destroy(t),n.refreshContent()}$.post("/event",{event:JSON.stringify(c)}).then(function(e){if(e.success){for(var t=0;t<e.data.length;t++)o.destroy(e.data[t]);n.refreshContent()}else console.error("error while send event",e.data.msg)})})},getEventForm:function(e,t,i,o){o=o||"modelform";var l=n.showNew(o,t,{title:c("Add event type: ")+e,override_labels:{output:"comment"},onePageDisplay:!0}),d=this,u=function(){d.startRefresh(),t.rollback(),t.unloadRecord()};l.submit.then(function(n){console.log("saveRecord:",t,n),t=s(n,"formContext"),r.info(c("event sent: ")+e),d.submitEvents(i,t,e),-1!==$.inArray("reportIncident",arguments[1])?d.submitEvents(i,t,"declareticket"):-1!==$.inArray("doneTicket",arguments[1])&&(a(t,"output",""),d.submitEvents(i,t,"done")),u()},u)},getRoutingKey:function(e){var t=[e.connector,e.connector_name,e.event_type,e.source_type,e.component].join(".");return"resource"===e.source_type&&(t=[e.id,e.resource].join(".")),t},getDisplayRecord:function(e,t){var i=s(this,"widgetDataStore")||Ember.widgetDataStore,n=this.getDataFromRecord(e,t);return i.createRecord(e,n)},filterUsableCrecords:function(e,t){for(var i=[],n=0,o=t.length;n<o;n++){var r=t[n];this.processEvent(e,"filter",[r])&&i.pushObject(r)}return i},event_processors:{ack:{extract:function(e,t,i){e.ref_rk=s(t,"entity_id"),e.state=0,e.state_type=1,void 0!==i&&(e.ticket=s(i,"ticket"),e.output=s(i,"output"))},filter:function(e){return s(e,"state")&&!s(e,"ack.isAck")&&!s(e,"ack.isCancel")||0===s(e,"state")&&3===s(e,"status")},handle:function(e){var t=this.getDisplayRecord("ack",e[0]);this.getEventForm("ack",t,e,"ackform")},transform:function(e,t){console.log("transform method for ack -> crecords",e,"record",t),e.set("ack",{comment:t.output,timestamp:o.getNow(),author:t.author,isAck:!0}),l(t.ticket)||(e.set("ticket",t.ticket),e.set("ticket_date",o.getNow())),e.set("ack_remove",void 0)}},fastack:{extract:function(e,t,i){e.ref_rk=s(t,"entity_id"),e.state=0,e.state_type=1,e.ticket="ticket",e.output="auto ack by "+s(e,"author")},filter:function(e){return s(e,"state")&&!s(e,"ack.isAck")&&!s(e,"ack.isCancel")||0===s(e,"state")&&3===s(e,"status")},handle:function(e){var t=this.getDisplayRecord("ack",e[0]);s(this,"mixinOptions.sendevent.fastackmsg");t.set("output","auto ack by "+s(t,"author")),this.submitEvents(e,t,"ack")},transform:function(e,t){console.log("transform method for ack -> crecords",e,"record",t),e.set("ack",{comment:t.output,timestamp:o.getNow(),author:t.author,isAck:!0}),l(t.ticket)||(e.set("ticket",t.ticket),e.set("ticket_date",o.getNow())),e.set("ack_remove",void 0)}},ackremove:{extract:function(e,t,i){l(i)||(e.output=s(i,"output")),e.ref_rk=s(t,"entity_id"),e.state=0,e.state_type=1},filter:function(e){var t=void 0!=s(e,"canceled"),i=void 0!=s(e,"extra_details.ack");return!t&&i},handle:function(e){var t=this.getDisplayRecord("ackremove",e[0]);this.getEventForm("ackremove",t,e)},transform:function(e,t){console.log("transform method for ack remove",e,t),e.set("ack",void 0),e.set("declare_ticket_author",void 0),e.set("declare_ticket_date",void 0),e.set("ticket",void 0),e.set("ticket_date",void 0),e.set("ack_remove",Ember.Object.create({comment:t.output,timestamp:o.getNow(),author:t.author}))}},done:{extract:function(e,t,i){e.output=void 0===i?"":s(i,"output")},filter:function(e){return s(e,"ack.isAck")},handle:function(e){var t=this.getDisplayRecord("done",e[0]);this.getEventForm("done",t,e)},transform:function(e,t){console.log("transform method for done",e,t),e.set("output",t.get("output"))}},pbehavior:{extract:function(e,t,i){l(i)||(e.output=s(i,"output"),e.start=s(i,"start"),e.end=s(i,"end"),e.rrule=s(i,"rrule"),e.pbehavior_name="downtime",e.action="create",e.name=s(i,"name"))},filter:function(e){return s(e,"ack.author")&&s(e,"ack.isAck")},handle:function(e){var t=this.getDisplayRecord("pbehavior",e[0]);this.getEventForm("pbehavior",t,e,"pbehaviorform")},transform:function(e,t){console.log("transform method for ack remove",e,t,"pbehavior")}},declareticket:{extract:function(e,t,i){e.ref_rk=s(t,"entity_id"),e.state=0,e.state_type=1,e.output="declare ticket"},filter:function(e){return s(e,"ack.isAck")},handle:function(e){var t=this.getDisplayRecord("declareticket",e[0]);this.getEventForm("declareticket",t,e,"ticketform")},transform:function(e,t){console.log("transform method for declare ticket",e,t),e.set("ticket_declared_author",t.author),e.set("ticket_declared_date",o.getNow()),l(t.done)||(e.set("done",t.done),e.set("done_date",o.getNow()))}},assocticket:{extract:function(e,t,i){e.ref_rk=s(t,"entity_id"),e.state=0,e.state_type=1,void 0===i?e.output=c("Associated ticket number"):(e.output=s(i,"output"),e.ticket=s(i,"ticket"))},filter:function(e){return s(e,"ack.isAck")},handle:function(e){var t=this.getDisplayRecord("assocticket",e[0]);this.getEventForm("assocticket",t,e)},transform:function(e,t){console.log("transform method for assoticket",e,t),e.set("ticket",t.ticket),e.set("ticket_date",o.getNow())}},cancel:{extract:function(e,t,i){e.ref_rk=s(t,"entity_id"),e.state=0,e.state_type=1,void 0!==i&&(e.output=s(i,"output")),e.cancel=1},filter:function(e){return s(e,"ack.isAck")},handle:function(e){var t=this.getDisplayRecord("cancel",e[0]);this.getEventForm("cancel",t,e)},transform:function(e,t){console.log("transform method for cancel -> crecords",e,"record",t),e.set("ack.isCancel",!0),e.set("ack.isAck",!1),e.set("status",4),e.set("cancel",{comment:t.output,timestamp:o.getNow(),author:t.author,previous_status:t.state})}},cancelack:{extract:function(e,t,i){e.ref_rk=s(t,"entity_id"),e.state=0,e.state_type=1,void 0!==i&&(e.output=s(i,"output")),e.cancel=1},filter:function(e){return s(e,"ack.isAck")},handle:function(e){var t=this.getDisplayRecord("cancel",e[0]);this.getEventForm("cancel",t,e)},transform:function(e,t){console.log("transform method for cancel -> crecords",e,"record",t),e.set("ack.isCancel",!0),e.set("ack.isAck",!1),e.set("status",4),e.set("cancel",{comment:t.output,timestamp:o.getNow(),author:t.author,previous_status:t.state})}},recovery:{extract:function(e,t,i){a(t,"state",0)},filter:function(e){return void 0!=s(e,"canceled")},handle:function(e){var t=e[0];this.submitEvents([t],t,"recovery")},transform:function(e,t){}},uncancel:{extract:function(e,t,i){if(e.ref_rk=s(t,"entity_id"),e.state_type=1,e.state=0,e.cancel=0,void 0!==i){var n=s(i,"output");n||(n=" "),e.output=n}},filter:function(e){return s(e,"ack.isCancel")},handle:function(e){var t=this.getDisplayRecord("uncancel",e[0]);this.getEventForm("uncancel",t,e)},transform:function(e,t){console.log("transform method for uncancel -> crecords",e,"record",t),e.set("ack.isCancel",!1),e.set("ack.isAck",!0),e.set("status",e.get("cancel.previous_status")),l(e.get("ack"))?e.set("ack",{comment:t.output,timestamp:o.getNow(),author:t.author,isAck:!0}):e.set("ack",e.get("ack"))}},changestate:{extract:function(e,t,i){l(i)||(e.state=s(i,"state"),e.output=s(i,"output")),e.event_type="changestate",e.keep_state=!0,e.state_type=1},filter:function(e){return s(e,"state")},handle:function(e){var t=this.getDisplayRecord("changestate",e[0]);this.getEventForm("changestate",t,e)},transform:function(e,t){console.log("transform method for ack changestate",e,t),e.set("state",t.state),0===t.state?e.set("ack",void 0):e.set("cancel",void 0),a(e,"change_state_output",s(t,"output")),a(e,"keep_state",!0)}},snooze:{extract:function(e,t,i){l(i)||(e.state=s(i,"state"),e.output=s(i,"output"),e.duration=s(i,"duration"))},filter:function(e){return s(e,"state")},handle:function(e){
var t=this.getDisplayRecord("snooze",e[0]);this.getEventForm("snooze",t,e,"snoozeform")},transform:function(e,t){console.log("transform method for ack snooze",e,t)}},comment:{extract:function(e,t,i){e.referer=s(t,"referer"),e.output=s(t,"output"),e.display_name=s(this,"login.firstname")+" "+s(this,"login.lastname")},filter:function(e){return!1},handle:function(e){var t=this.getDisplayRecord("comment",e[0]);r.info(c('event "comment" sent')),this.submitEvents(e,t,"comment")},transform:function(e,t){console.log("transform method for comment",e,t)}}},hasEventProcessorForType:function(e){return void 0!==this.event_processors[e]},processEvent:function(e,t,i){if(this.hasEventProcessorForType(e)){return this.event_processors[e][t].apply(this,i)}},actions:{sendEvent:function(e,t){console.group("sendEvent:",arguments),this.stopRefresh();var i=[];if(l(t)){var n=s(this,"widgetData.content"),o=n.filterBy("isSelected",!0);if(i=this.filterUsableCrecords(e,o),console.log("events:",e,i),!i.length)return void r.warning("No matching event found for event:",e)}else console.log("event:",e,t),i.pushObject(t);this.processEvent(e,"handle",[i]),this.setPendingOperation(i),console.groupEnd()}}});t.register("mixin:customsendevent",d)}}),Ember.Application.initializer({name:"DraggablecolumnsMixin",after:"MixinFactory",initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),n=i("draggablecolumns",{partials:{tableheader:["draggableheaders"]}});t.register("mixin:draggablecolumns",n)}}),Ember.Application.initializer({name:"GridlayoutMixin",after:"MixinFactory",initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),n=Ember.get,o=Ember.set,r=Ember.isNone,s=Ember.Mixin.create({didInsertElement:function(){var e,t=n(this,"controller.items.content"),i=!1,s=!1,a=n(this,"controller.mixins");r(a)||(e=a.findBy("name","gridlayout"),r(e)||(s=n(e,"forcelegacy")));var l=n(this,"controller.mixins").findBy("name","gridlayout"),c="12";r(n(l,"columnXS"))||(c=n(l,"columnXS"));var d="6";r(n(l,"columnMD"))||(d=n(l,"columnMD"));var u="3";r(n(l,"columnLG"))||(u=n(l,"columnLG"));var h=n(l,"offset")||"0",p=["col-md-",d," col-xs-",c," col-lg-",u," col-md-offset-",h].join("");if(n(l,"hiddenLG")&&(p+=" hidden-lg"),n(l,"hiddenMD")&&(p+=" hidden-md"),n(l,"hiddenXS")&&(p+=" hidden-xs hidden-sm"),o(this,"controller.defaultItemCssClass",p),t)for(var m=t.length-1;m>=0;m--){var f=n(t[m],"mixins");if(r(f)&&(o(t[m],"mixins",[]),f=n(t[m],"mixins")),r(f.findBy("name","gridlayout"))&&(r(e)&&(e={name:"gridlayout"}),f.pushObject(e),i=!0),s){var g=f.findBy("name","gridlayout");r(g)||f.removeObject(g),delete e.forcelegacy,f.pushObject(e),i=!0}p=n(this,"controller").getSection(f),Ember.setProperties(t[m],{classValue:p})}i&&n(this,"controller.viewController.content").save(),this._super()}}),a=i("gridlayout",{partials:{layout:["gridlayout"]},init:function(){this._super(),this.addMixinView(s)},isGridLayout:function(){return!0}.property(),getSection:function(e){var t=e.findBy("name","gridlayout"),i="12";r(t.columnXS)||(i=t.columnXS);var n="6";r(t.columnMD)||(n=t.columnMD);var s="3";r(t.columnLG)||(s=t.columnLG);var a=t.offset||"0",l=["col-md-",n," col-xs-",i," col-lg-",s," col-md-offset-",a].join("");return t.hiddenLG&&(l+=" hidden-lg"),t.hiddenMD&&(l+=" hidden-md"),t.hiddenXS&&(l+=" hidden-xs hidden-sm"),o(this,"defaultItemCssClass",l),l}});t.register("mixin:gridlayout",a)}}),Ember.Application.initializer({name:"HorizontallayoutMixin",after:"MixinFactory",initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),n=Ember.get,o=i("horizontallayout",{partials:{layout:["horizontallayout"]},section:function(){return n(this,"mixinOptions.horizontallayout.cellCssClass")||"col-lg-3 col-md-6 col-xs-12"}});t.register("mixin:horizontallayout",o)}}),Ember.Application.initializer({name:"LightlayoutMixin",after:"MixinFactory",initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),n=i("lightlayout",{partials:{layout:["lightlayout"]}});t.register("mixin:lightlayout",n)}}),Ember.Application.initializer({name:"ListlinedetailMixin",after:["MixinFactory","FormsRegistry","HashUtils"],initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),n=e.lookupFactory("utility:hash"),o=Ember.get,r=Ember.set,s=Ember.isNone,a=i("listlinedetail",{partials:{columnsLine:["actionbutton-foldable"],columnsHead:["column-unfold"]},actions:{unfold:function(e){var t=o(e,"unfolded");s(t)?r(e,"unfolded",!0):r(e,"unfolded",!t)}},init:function(){this._super.apply(this,arguments);var e=n.generateId("dynamic-listline-detail");r(this,"detailTemplate",e)},mixinsOptionsReady:function(){this._super.apply(this,arguments);var e=o(this,"detailTemplate"),t=o(this,"mixinOptions.listlinedetail.template");s(t)&&(t="No template defined"),r(Ember.TEMPLATES,e,Ember.Handlebars.compile(t))},colspan:function(){var e=o(this,"controller.shown_columns.length"),t=o(this,"controller._partials.columnsLine.length"),i=o(this,"controller._partials.itemactionbuttons");return s(e)&&(e=0),s(t)&&(t=0),s(i)&&(i=!1),i=!!i,e++,e+=t,i&&e++,e}.property("controller.shown_columns")});t.register("mixin:listlinedetail",a)}}),Ember.Application.initializer({name:"PaginationMixin",after:"MixinFactory",initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),n=Ember.get,o=Ember.set,r=Ember.isNone,s=i("pagination",{partials:{subHeader:["itemsperpage"],actionToolbarButtons:["pagination"],footer:["pagination-infos"],rightFooter:["pagination"]},init:function(){this._super()},mixinsOptionsReady:function(){this._super(),o(this,"itemsPerPagePropositionSelected",n(this,"itemsPerPage"))},isFirstPage:function(){return 1===n(this,"currentPage")&&1===n(this,"paginationFirstItemIndex")}.property("currentPage","paginationFirstItemIndex"),isLastPage:function(){return n(this,"currentPage")===n(this,"totalPages")}.property("currentPage","totalPages"),hasOnePage:function(){var e=1===n(this,"totalPages");return console.log("Is it a one page ?",e),e}.property("totalPages"),itemsPerPage:function(){return n(this,"model.itemsPerPage")||n(this,"mixinOptions.pagination.defaultItemsPerPage")||5}.property("model.itemsPerPage","mixinOptions.pagination.defaultItemsPerPage"),paginationMixinContent:function(){console.warn("paginationMixinContent should be defined on the concrete class")},paginationMixinFindOptions:function(){console.warn("paginationMixinFindOptions should be defined on the concrete class")},actions:{prevPage:function(){var e=n(this,"currentPage");"string"==typeof e&&(e=parseInt(e,10)),e>1&&o(this,"currentPage",e-1)},nextPage:function(){var e=n(this,"currentPage");"string"==typeof e&&(e=parseInt(e,10)),e<n(this,"totalPages")&&o(this,"currentPage",e+1)},firstPage:function(){this.set("currentPage",1)},lastPage:function(){n(this,"currentPage")<n(this,"totalPages")&&o(this,"currentPage",n(this,"totalPages"))}},currentPage:1,itemsDivided:function(){return n(this,"itemsTotal")/n(this,"itemsPerPage")}.property("itemsTotal","itemsPerPage"),itemsPerPagePropositions:function(){var e=[5,10,20,50],t=n(this,"mixinOptions.pagination.customItemsPerPage");if(!r(t)&&Ember.isArray(t))for(var i=t.length,o=0;o<i;o++)isNaN(t[o])||e.push(parseInt(t[o]));var s=n(this,"itemsPerPage");return e.contains(s)||e.pushObject(s),e.sort(function(e,t){return e-t}),e}.property("itemsPerPagePropositionSelected"),onCurrentPageChanges:function(){this.refreshContent()}.observes("currentPage"),itemsPerPagePropositionSelectedChanged:function(){var e=n(this,"itemsPerPagePropositionSelected");n(this,"loaded")&&(Ember.setProperties(this,{"model.itemsPerPage":e,currentPage:1}),this.saveUserConfiguration()),this.refreshContent()}.observes("itemsPerPagePropositionSelected"),refreshContent:function(){console.group("paginationMixin refreshContent",n(this,"itemsPerPage")),void 0===n(this,"paginationMixinFindOptions")&&o(this,"paginationMixinFindOptions",{});var e=n(this,"itemsPerPage"),t=e*(this.currentPage-1);Ember.setProperties(this,{"paginationMixinFindOptions.start":t,paginationFirstItemIndex:t+1,"paginationMixinFindOptions.limit":e}),this._super.apply(this,arguments),console.groupEnd()},paginationLastItemIndex:function(){var e=n(this,"itemsPerPage"),t=e*(this.currentPage-1);return Math.min(t+e,n(this,"itemsTotal"))}.property("widgetData","itemsTotal"),paginationFirstItemIndex:function(){return n(this,"itemsPerPage")*(this.currentPage-1)+1}.property("widgetData"),itemsTotal:function(){return n(this,"widgetDataMetas").total}.property("widgetDataMetas","widgetData"),totalPages:function(){if(0===n(this,"itemsTotal"))return 0;var e=n(this,"itemsPerPage");return Math.ceil(n(this,"itemsTotal")/e)}.property("itemsTotal")});t.register("mixin:pagination",s)}}),Ember.Application.initializer({name:"PeriodicrefreshMixin",after:"MixinFactory",initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),n=Ember.get,o=Ember.set,r=Ember.isNone,s=Ember.Mixin.create({willInsertElement:function(){console.log("init periodicrefresh viewMixin"),this._super();var e=n(this,"controller"),t=n(this,"mixinOptions.periodicrefresh.refreshInterval");t&&clearInterval(t);var i=n(this,"widgetRefreshInterval"),r=this;Ember.run(function(){refreshIntvalConfigValue=1e3*e.get("mixinOptions.periodicrefresh.refreshInterval"),isNaN(refreshIntvalConfigValue)||(i=setInterval(function(){console.log("refreshing widget "+n(e,"title"),e.get("mixinOptions.periodicrefresh.refreshInterval"),e),"test"!==window.environment&&e.refreshContent()},refreshIntvalConfigValue),o(r,"widgetRefreshInterval",i))})},willDestroyElement:function(){clearInterval(n(this,"widgetRefreshInterval")),this._super()}}),a=i("periodicrefresh",{init:function(){if(console.log("init periodicrefresh"),this.addMixinView(s),n(this,"content.mixins")){var e=n(this,"content.mixins").findBy("name","periodicrefresh");this.mixinOptions.periodicrefresh=e}this._super.apply(this,arguments),this.startRefresh(),(n(this,"mixinOptions.periodicrefresh.refreshInterval")<10||r(n(this,"mixinOptions.periodicrefresh.refreshInterval")))&&o(this,"mixinOptions.periodicrefresh.refreshInterval",10)}});t.register("mixin:periodicrefresh",a)}}),Ember.Application.initializer({name:"ResponsivelistMixin",after:["MixinFactory","FormsUtils","HashUtils"],initialize:function(e,t){function i(e){var t=a(e,"controller.mixinOptions.responsivelist.stackableColumnsPriority"),i=a(e,"controller"),n=a(i,"shown_columns"),o=Ember.A();if(console.log("stackableColumnsPriority",t,n),t)for(var r=0,s=t.length;r<s;r++){var l=n.findBy("field",t[r]);if(console.log("currentColumn",l),void 0!==l){console.log("currentColumn",l);var c=Ember.get(l,"index");console.log("columnIndex",c),o.pushObject(c)}}return console.log("stackableColumnsPriority@end",o),o}function n(e,t){console.log("hideColumn",t),c(t)||(this.$("th."+t.field).css("display","none"),this.$("td."+t.field).css("display","none"),a(e,"groupedColumns").pushObject(t),e.notifyPropertyChange("groupedColumns"))}function o(e,t,o,r){var s=o<r,l=a(e,"controller"),c=a(l,"shown_columns"),d=i(e);if(console.log("columnStackingPriority",d),s){console.group("table overflowing, starting shrink loop");for(var u=-1,h=r;s;)if(u++,console.log("while shownColumns[i]",u,c,c[u],d),void 0!==c[u]){if(void 0===d[u])return void console.log("no stacking priority, return",u,d);n(e,c[d[u]]),h-=c[u].width,s=o<h}console.groupEnd()}}function r(e){for(var t=a(e,"controller"),i=a(t,"shown_columns"),n=0,o=i.length;n<o;n++)l(i[n],"width",this.$("th."+i[n].field).width()),l(i[n],"index",n)}var s=e.lookupFactory("factory:mixin"),a=Ember.get,l=Ember.set,c=Ember.isNone,d=Ember.Mixin.create({classNames:["list"],groupedColumns:Ember.A(),invisibleCellsCount:function(){return a(this,"controller.shown_columns").length-1}.property("controller.shown_columns"),didInsertElement:function(){this._super.apply(this,arguments);var e=this;a(e,"groupedColumns").clear();var t=r(e);console.log("resize call"),o(e,t,e.$(".table-responsive table").parent().width(),e.$(".table-responsive table").width())}}),u=s("responsivelist",{partials:{alternativeListDisplay:["groupedrowslistlayout"],subRowInformation:["stackedcolumns"]},stackedColumns:Ember.A(),groupedColumnsBindingActivator:0,init:function(){if(console.log("init responsivelist"),this.addMixinView(d),a(this,"content.mixins")){var e=a(this,"content.mixins").findBy("name","responsivelist");this.mixinOptions.responsivelist=e}this._super.apply(this,arguments)}});t.register("mixin:responsivelist",u)}}),Ember.Application.initializer({name:"ShowviewbuttonMixin",after:["MixinFactory","RoutesUtils","FormsUtils"],initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),n=e.lookupFactory("utility:routes"),o=e.lookupFactory("utility:forms"),r=Ember.isNone,s=Ember.String.loc,a=i("showviewbutton",{partials:{itemactionbuttons:["actionbutton-show"]},actions:{show:function(e){Ember.assert("There should be an id passed as first argument",!r(e)),console.log("Show action",arguments),n.getCurrentRouteController().send("showView",e)},viewrights:function(e){o.showNew("viewrightsform",e,{title:s("Edit view rights")})}}});t.register("mixin:showviewbutton",a)}}),Ember.Application.initializer({name:"SortablearrayMixin",after:"MixinFactory",initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),n=Ember.get,o=Ember.set,r=Ember.isNone,s=i("sortablearray",{init:function(){this._super(),o(this,"sort_direction","ASC");var e=n(this,"model.user_sortedAttribute");if(e){o(this,"sortedAttribute",e);var t="sorting_asc"===n(this,"sortedAttribute.headerClassName")?"ASC":"DESC";o(this,"sort_direction",t)}},actions:{sort:function(e){var t=n(this,"sort_direction"),i="ASC"===t?"DESC":"ASC";o(this,"sort_direction",i),void 0!==n(this,"model.user_sortedAttribute")&&o(this,"model.user_sortedAttribute.headerClassName","sorting"),console.log("attribute",e),o(e,"headerClassName","sorting_"+i.toLowerCase()),o(this,"sortedAttribute",e),o(this,"model.user_sortedAttribute",e),console.log("sortBy",arguments),void 0===this.findOptions&&(this.findOptions={}),this.findOptions.sort=JSON.stringify([{property:e.field,direction:i}]),this.saveUserConfiguration(),this.refreshContent()}},computeShownColumns:function(e){for(var t=this._super(e),i=n(this,"sortedAttribute"),o=n(this,"default_column_sort"),s=0,a=t.length;s<a;s++)if(!r(o)&&o.property===t[s].field&&!r(o.direction)&&(r(i)||i==={})){var l="ASC"===o.direction?"sorting_asc":"sorting_desc";t[s].headerClassName=l}return t},attributesKeys:function(){console.log("attributesKeys from sortableArray");var e=this._super.apply(this),t=n(this,"sortedAttribute");if(console.log("sortedAttribute",t),void 0!==t)for(var i=0,r=e.length;i<r;i++){var s=e[i],a=n(t,"field"),l=n(t,"headerClassName");n(s,"field")===a?o(s,"headerClassName",l):o(s,"headerClassName","sorting")}else{if(!e)return[];for(var c=0,d=e.length;c<d;c++)o(e[c],"headerClassName","sorting")}return e}.property("inspectedProperty","inspectedDataArray")});t.register("mixin:sortablearray",s)}}),Ember.Application.initializer({name:"TablayoutMixin",after:"MixinFactory",initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),n=Ember.get,o=Ember.set,r=i("tablayout",{init:function(){n(this,"items.content").length>=0&&!Ember.isEmpty(n(this,"items.content")[0])&&(console.log("init tabs",n(this,"items.content")[0].get("widget")),this.send("selectTab",n(this,"items.content")[0].get("widget")),o(n(this,"items.content")[0],"tabSelected",!0)),this._super.apply(this,arguments)},actions:{selectTab:function(e){console.info("select tab",e),n(this,"selectedItem")&&o(this,"selectedItem.tabSelected",!1),o(e,"tabSelected",!0),o(this,"selectedItem",e)}},partials:{layout:["tablayout"]}});t.register("mixin:tablayout",r)}}),Ember.Application.initializer({name:"VerticallayoutMixin",after:"MixinFactory",initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),n=i("verticallayout",{partials:{layout:["verticallayout"]}});t.register("mixin:verticallayout",n)}}),Ember.Application.initializer({name:"WidgetfullscreenMixin",after:["MixinFactory"],initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),n=i("widgetfullscreen",{partials:{titlebarsbuttons:["titlebarbutton-widgetfullscreen"]}});t.register("mixin:widgetfullscreen",n)}}),Ember.Application.initializer({name:"WidgetrefreshMixin",after:["MixinFactory"],initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),n=Ember.Mixin.create({}),o=i("widgetrefresh",{partials:{titlebarsbuttons:["titlebarbutton-widgetrefresh"]},init:function(){this.addMixinView(n),this.on("refreshCurrentActiveViewByPass",function(){this.trigger("refresh")}),window.refreshCurrentActiveViewByPass=this,this._super()},actions:{refreshWidget:function(){this.trigger("refresh")}}});t.register("mixin:widgetrefresh",o)}}),Ember.Application.initializer({name:"CrudContextWidget",after:["WidgetFactory","PaginationMixin","InspectableArrayMixin","UserconfigurationMixin","DraggablecolumnsMixin","RoutesUtils","FormsUtils","ListlineView","DataUtils"],initialize:function(e,t){var i=e.lookupFactory("factory:widget"),n=e.lookupFactory("mixin:pagination"),o=e.lookupFactory("mixin:inspectable-array"),r=e.lookupFactory("mixin:userconfiguration"),s=e.lookupFactory("view:listline"),a=e.lookupFactory("utility:data"),l=e.lookupFactory("utility:forms"),c=Ember.get,d=Ember.set,u=Ember.isNone,h={mixins:[o,n,r]},p=i("crudcontext",{css:"table table-striped table-bordered table-hover dataTable sortable",needs:["login","application","recordinfopopup"],standardListDisplay:!0,dynamicTemplateName:"loading",listlineControllerClass:s,user:Ember.computed.alias("controllers.login.record._id"),rights:Ember.computed.alias("controllers.login.record.rights"),safeMode:Ember.computed.alias("controllers.application.frontendConfig.safe_mode"),init:function(){var e=this;Ember.setProperties(this,{custom_filters:[],widgetData:[],findOptions:{},loaded:!1}),crudContextAdapter=a.getEmberApplicationSingleton().__container__.lookup("adapter:crudcontext"),d(e,"crudContextAdapter",crudContextAdapter),d(e,"listed_crecord_type","ccontext"),c(this,"partials.selectionToolbarButtons").pushObject("actionbutton-createpbehavior"),this._super.apply(this,arguments)},rollbackableChanged:function(){var e=this;!1===c(this,"model.rollbackable")&&Ember.run.scheduleOnce("afterRender",this,function(){e.refreshContent()})}.observes("model.rollbackable"),generateListlineTemplate:function(e){c(this,"partials.actionToolbarButtons").removeObject("actionbutton-create");var t='<td>{{#if pendingOperation}}<i class="fa fa-cog fa-spin"></i>{{/if}}{{component-checkbox checked=isSelected class="toggle"}}</td>';if(c(this,"_partials.columnsLine")&&(t+="{{#each columns in controller._partials.columnsLine}}<td>{{partial columns}}</td>{{/each}}"),void 0!==e&&0!==e.length){for(var i=0,n=e.length;i<n;i++){var o=e[i];console.log("currentColumn",o),c(o,"options.show")&&(o.renderer&&c(this,"model.useRenderers")?t+=['<td class="',o.field,'">{{component-renderer rendererType="',o.renderer,'" value=this.',o.field,' record=this field="',o.field,'" shown_columns=controller.shown_columns}}</td>'].join(""):t+=['<td class="',o.field,'">{{this.',o.field,"}}</td>"].join(""))}var r=c(this,"_partials.itemactionbuttons");if(r){console.log("itemactionbuttons",r),t+='<td style="padding-left:0; padding-right:0"><div class="btn-group" style="display:flex">';for(var s=0,a=r.length;s<a;s++)t+=['{{partial "',r[s],'"}}'].join("");t+="</div></td>"}return console.log("generatedListlineTemplate",t),t}},updateInterval:function(e){console.warn("Set widget list time interval",e),d(this,"timeIntervalFilter",e),this.refreshContent()},getTimeInterval:function(){var e=c(this,"timeIntervalFilter");return u(e)?{}:e},itemType:function(){var e=c(this,"listed_crecord_type");return console.info("listed_crecord_type",e),void 0!==e&&null!==e?c(this,"listed_crecord_type"):"event"}.property("listed_crecord_type"),isAllSelectedChanged:function(){c(this,"widgetData").content.setEach("isSelected",c(this,"isAllSelected"))}.observes("isAllSelected"),historyMixinFindOptions:Ember.computed.alias("findOptions.useLogCollection"),inspectedDataArray:Ember.computed.alias("widgetData"),paginationMixinFindOptions:Ember.computed.alias("findOptions"),widgetDataMetas:{},findItems:function(){var t=this,i=this,n=(c(this,"crudContextAdapter"),c(this,"controllers.application"));n.addConcurrentLoading("list-data");c(i,"widgetDataStore");u(c(i,"widgetDataStore"))&&d(i,"widgetDataStore",DS.Store.create({container:c(i,"container")}));var o=c(this,"itemType"),r=this.computeFindParams();u(e.lookupFactory("model:"+o))?(void 0===c(this,"content.displayedErrors")&&d(this,"content.displayedErrors",Ember.A()),c(this,"content.displayedErrors").pushObject("No model was found for "+o),d(this,"loaded",!0),n.removeConcurrentLoading("list-data")):c(this,"widgetDataStore").findQuery(o,r).then(function(e){var i=c(t,"listed_crecord_type"),o=c(t,"widgetDataStore").metadataFor(i);console.log("crecordTypeMetadata",o),Ember.setProperties(t,{widgetDataMetas:o,loaded:!0}),t.extractItems.apply(t,[e]);for(var r=0,s=e.content.length;r<s;r++)e.content[r].set("pendingOperation",!1);n.removeConcurrentLoading("list-data")})},widgetDataChanged:function(){this.trigger("refresh")}.observes("widgetData"),attributesKeysDict:function(){for(var e={},t=c(this,"attributesKeys"),i=c(this,"sortedAttribute"),n=0,o=t.length;n<o;n++)void 0!==i&&i.field===t[n].field?(i.renderer=this.rendererFor(i),e[t[n].field]=i):(t[n].renderer=this.rendererFor(t[n]),e[t[n].field]=t[n]);return e}.property("attributesKeys"),rendererFor:function(e){var t=c(e,"type"),i=c(e,"options.role");c(e,"model.options.role")&&(i=c(e,"model.options.role"));var n=c(e,"options.items.role");"array"!==i||u(n)||(i=n);var o;return o=i?"renderer-"+i:"renderer-"+t,void 0===Ember.TEMPLATES[o]&&(o=void 0),o},shown_columns:function(){if(console.log("compute shown_columns",c(this,"sorted_columns"),c(this,"sortedAttribute")),void 0!==this.get("user_show_columns"))return console.log("user columns selected",c(this,"user_show_columns")),c(this,"user_show_columns");var e=[],t=c(this,"displayed_columns")||c(this,"model.columns");if(void 0!==t&&t.length>0)for(var i=this.get("attributesKeysDict"),n=0,o=t.length;n<o;n++)void 0!==i[t[n]]&&(d(i[t[n]].options,"show",!0),e.push(i[t[n]]));else console.log("no shown columns set, displaying everything"),e=this.get("attributesKeys");for(var r=[],s=c(this,"sortedAttribute"),a=c(this,"default_column_sort"),l=0,h=e.length;l<h;l++){if(e[l].options.canUseDisplayRecord&&delete e[l].options.canUseDisplayRecord,e[l].field===c(this,"display_record_field")&&(e[l].options.canUseDisplayRecord=!0),-1===$.inArray(e[l].field,c(this,"hidden_columns"))&&r.pushObject(e[l]),!u(a)&&a.property===e[l].field&&!u(a.direction)&&(u(s)||s==={})){var p="ASC"===a.direction?"sorting_asc":"sorting_desc";e[l].headerClassName=p}var m="no label",f=c(e[l],"options.label"),g=c(e[l],"options.title"),v=c(e[l],"field");g?m=g:f?m=f:v&&(m=v),d(e[l],"display_title",m)}console.debug("selected cols",r);var b=this.generateListlineTemplate(r);if(void 0!==b){var y=Ember.Handlebars.compile(b);d(this,"hbsListline",b);var E=c(this,"dynamicTemplateName");E&&delete Ember.TEMPLATES[E];var x="dynamic-list"+Math.floor(1e4*Math.random());Ember.TEMPLATES[x]=y,d(this,"dynamicTemplateName",x)}return r}.property("attributesKeysDict","sorted_columns"),computeFilterFragmentsList:function(){var e=Ember.A(),t=c(this,"model.volatile.forced_filter")||c(this,"additional_filter");return console.log("additionalFilterPart",c(this,"model.volatile.forced_filter"),c(this,"additional_filter")),e.pushObject(this.getTimeInterval()),e.pushObject(t),e},computeFindParams:function(){console.group("computeFindParams",c(this,"model.selected_filter.filter"));for(var e=this.computeFilterFragmentsList(),t=[],i=0,n=e.length;i<n;i++){if("string"==typeof e[i])try{e[i]=JSON.parse(e[i])}catch(t){void 0===c(this,"content.displayedErrors")&&d(this,"content.displayedErrors",Ember.A()),c(this,"content.displayedErrors").pushObject("There seems to be an error with the currently selected filter."),e[i]={}}e[i]==={}||u(e[i])||t.pushObject(e[i])}var o={};o.limit=c(this,"itemsPerPagePropositionSelected"),0===o.limit&&(o.limit=5),o.start=c(this,"paginationFirstItemIndex")-1,t.length&&(o._filter=JSON.stringify({$and:t}));var r=c(this,"model.user_sortedAttribute");if(u(r))u(c(this,"model.default_column_sort"))||(o.sort=JSON.stringify([c(this,"model.default_column_sort")]),console.log("defaultSortedAttribute",c(this,"model.default_column_sort")));else if(!u(r)){var s;s="sorting_asc"===c(r,"headerClassName")?"ASC":"DESC",o.sort=JSON.stringify([{property:r.field,direction:s}]),console.log("userSortedAttribute",r)}return console.groupEnd(),o},actions:{createMultiplePBehaviors:function(){var e=this,t=e.get("widgetData").filterBy("isSelected",!0);if(0!==t.length){var i=Ember.Object.create({crecord_type:"pbehaviorform"});l.showNew("modelform",i,{title:__("Put a pbehavior on these elements ?")}).submit.then(function(e){Array.isArray(t)||(t=[t]);for(var i=[],n=0,o=t.length;n<o;n++)i.push(t[n]._data._id);var r={tstart:e.get("formContext.start"),tstop:"Pause"===e.get("formContext.type_")?2147483647:e.get("formContext.end"),rrule:e.get("formContext.rrule"),name:e.get("formContext.name"),type_:e.get("formContext.type_"),reason:e.get("formContext.reason"),author:window.username,filter:{}};return r.rrule||delete r.rrule,r.filter={_id:{$in:i}},$.ajax({type:"POST",url:"/api/v2/pbehavior",data:JSON.stringify(r),contentType:"application/json",dataType:"json",success:function(){console.log("Ticket sent")},error:function(){console.error("Failure to send downtime")}})})}}}},h);t.register("widget:crudcontext",p)}}),Ember.Application.initializer({name:"ListWidget",after:["WidgetFactory","PaginationMixin","InspectableArrayMixin","UserconfigurationMixin","DraggablecolumnsMixin","RoutesUtils","FormsUtils","ListlineView"],initialize:function(e,t){var i=e.lookupFactory("factory:widget"),n=e.lookupFactory("mixin:pagination"),o=e.lookupFactory("mixin:inspectable-array"),r=e.lookupFactory("mixin:userconfiguration"),s=e.lookupFactory("view:listline"),a=Ember.get,l=Ember.set,c=Ember.isNone,d={mixins:[o,n,r]},u=i("list",{css:"table table-striped table-bordered table-hover dataTable sortable",needs:["login","application","recordinfopopup"],standardListDisplay:!0,dynamicTemplateName:"loading",listlineControllerClass:s,user:Ember.computed.alias("controllers.login.record._id"),rights:Ember.computed.alias("controllers.login.record.rights"),safeMode:Ember.computed.alias("controllers.application.frontendConfig.safe_mode"),init:function(){Ember.setProperties(this,{custom_filters:[],widgetData:[],findOptions:{},loaded:!1}),this._super.apply(this,arguments)},rollbackableChanged:function(){var e=this;!1===a(this,"model.rollbackable")&&Ember.run.scheduleOnce("afterRender",this,function(){e.refreshContent()})}.observes("model.rollbackable"),generateListlineTemplate:function(e){var t='<td>{{#if pendingOperation}}<i class="fa fa-cog fa-spin"></i>{{/if}}{{component-checkbox checked=isSelected class="toggle"}}</td>';if(a(this,"_partials.columnsLine")&&(t+="{{#each columns in controller._partials.columnsLine}}<td>{{partial columns}}</td>{{/each}}"),void 0!==e&&0!==e.length){for(var i=0,n=e.length;i<n;i++){var o=e[i];console.log("currentColumn",o),a(o,"options.show")&&(o.renderer&&a(this,"model.useRenderers")?t+=['<td class="',o.field,'">{{component-renderer rendererType="',o.renderer,'" value=this.',o.field,' record=this field="',o.field,'" shown_columns=controller.shown_columns}}</td>'].join(""):t+=['<td class="',o.field,'">{{this.',o.field,"}}</td>"].join(""))}var r=a(this,"_partials.itemactionbuttons");if(r){console.log("itemactionbuttons",r),t+='<td style="padding-left:0; padding-right:0"><div class="btn-group" style="display:flex">';for(var s=0,l=r.length;s<l;s++)t+=['{{partial "',r[s],'"}}'].join("");t+="</div></td>"}return console.log("generatedListlineTemplate",t),t}},updateInterval:function(e){console.warn("Set widget list time interval",e),l(this,"timeIntervalFilter",e),this.refreshContent()},getTimeInterval:function(){var e=a(this,"timeIntervalFilter");return c(e)?{}:e},itemType:function(){var e=a(this,"listed_crecord_type");return console.info("listed_crecord_type",e),void 0!==e&&null!==e?a(this,"listed_crecord_type"):"event"}.property("listed_crecord_type"),isAllSelectedChanged:function(){a(this,"widgetData").content.setEach("isSelected",a(this,"isAllSelected"))}.observes("isAllSelected"),historyMixinFindOptions:Ember.computed.alias("findOptions.useLogCollection"),inspectedDataArray:Ember.computed.alias("widgetData"),paginationMixinFindOptions:Ember.computed.alias("findOptions"),widgetDataMetas:{},findItems:function(){var t=this,i=a(this,"controllers.application");i.addConcurrentLoading("list-data"),c(a(this,"widgetDataStore"))&&l(this,"widgetDataStore",DS.Store.create({container:a(this,"container")}));var n=a(this,"itemType"),o=this.computeFindParams();c(e.lookupFactory("model:"+n))?(void 0===a(this,"content.displayedErrors")&&l(this,"content.displayedErrors",Ember.A()),a(this,"content.displayedErrors").pushObject("No model was found for "+n),l(this,"loaded",!0),i.removeConcurrentLoading("list-data")):a(this,"widgetDataStore").findQuery(n,o).then(function(e){var n=a(t,"listed_crecord_type"),o=a(t,"widgetDataStore").metadataFor(n);console.log("crecordTypeMetadata",o),Ember.setProperties(t,{widgetDataMetas:o,loaded:!0}),t.extractItems.apply(t,[e]);for(var r=0,s=e.content.length;r<s;r++)e.content[r].set("pendingOperation",!1);i.removeConcurrentLoading("list-data")})},widgetDataChanged:function(){this.trigger("refresh")}.observes("widgetData"),attributesKeysDict:function(){for(var e={},t=a(this,"attributesKeys"),i=a(this,"sortedAttribute"),n=0,o=t.length;n<o;n++)void 0!==i&&i.field===t[n].field?(i.renderer=this.rendererFor(i),e[t[n].field]=i):(t[n].renderer=this.rendererFor(t[n]),e[t[n].field]=t[n]);return e}.property("attributesKeys"),rendererFor:function(e){var t=a(e,"type"),i=a(e,"options.role");a(e,"model.options.role")&&(i=a(e,"model.options.role"));var n=a(e,"options.items.role");"array"!==i||c(n)||(i=n);var o;return o=i?"renderer-"+i:"renderer-"+t,void 0===Ember.TEMPLATES[o]&&(o=void 0),o},shown_columns:function(){if(console.log("compute shown_columns",a(this,"sorted_columns"),a(this,"sortedAttribute")),void 0!==this.get("user_show_columns"))return console.log("user columns selected",a(this,"user_show_columns")),a(this,"user_show_columns");var e=[],t=a(this,"displayed_columns")||a(this,"model.displayed_columns");if(void 0!==t&&t.length>0)for(var i=this.get("attributesKeysDict"),n=0,o=t.length;n<o;n++)void 0!==i[t[n]]&&(l(i[t[n]].options,"show",!0),e.push(i[t[n]]));else console.log("no shown columns set, displaying everything"),e=this.get("attributesKeys");for(var r=[],s=a(this,"sortedAttribute"),d=a(this,"default_column_sort"),u=0,h=e.length;u<h;u++){if(e[u].options.canUseDisplayRecord&&delete e[u].options.canUseDisplayRecord,e[u].field===a(this,"display_record_field")&&(e[u].options.canUseDisplayRecord=!0),-1===$.inArray(e[u].field,a(this,"hidden_columns"))&&r.pushObject(e[u]),!c(d)&&d.property===e[u].field&&!c(d.direction)&&(c(s)||s==={})){var p="ASC"===d.direction?"sorting_asc":"sorting_desc";e[u].headerClassName=p}var m="no label",f=a(e[u],"options.label"),g=a(e[u],"options.title"),v=a(e[u],"field");g?m=g:f?m=f:v&&(m=v),l(e[u],"display_title",m)}console.debug("selected cols",r);var b=this.generateListlineTemplate(r);if(void 0!==b){var y=Ember.Handlebars.compile(b);l(this,"hbsListline",b);var E=a(this,"dynamicTemplateName");E&&delete Ember.TEMPLATES[E];var x="dynamic-list"+Math.floor(1e4*Math.random());Ember.TEMPLATES[x]=y,l(this,"dynamicTemplateName",x)}return r}.property("attributesKeysDict","sorted_columns"),computeFilterFragmentsList:function(){var e=Ember.A(),t=a(this,"model.volatile.forced_filter")||a(this,"additional_filter");return console.log("additionalFilterPart",a(this,"model.volatile.forced_filter"),a(this,"additional_filter")),e.pushObject(this.getTimeInterval()),e.pushObject(t),e},
computeFindParams:function(){console.group("computeFindParams",a(this,"model.selected_filter.filter"));for(var e=this.computeFilterFragmentsList(),t=[],i=0,n=e.length;i<n;i++){if("string"==typeof e[i])try{e[i]=JSON.parse(e[i])}catch(t){void 0===a(this,"content.displayedErrors")&&l(this,"content.displayedErrors",Ember.A()),a(this,"content.displayedErrors").pushObject("There seems to be an error with the currently selected filter."),e[i]={}}e[i]==={}||c(e[i])||t.pushObject(e[i])}var o={};o.limit=a(this,"itemsPerPagePropositionSelected"),0===o.limit&&(o.limit=5),o.start=a(this,"paginationFirstItemIndex")-1,t.length&&(o.filter=JSON.stringify({$and:t}));var r=a(this,"model.user_sortedAttribute");if(c(r))c(a(this,"model.default_column_sort"))||(o.sort=JSON.stringify([a(this,"model.default_column_sort")]),console.log("defaultSortedAttribute",a(this,"model.default_column_sort")));else if(!c(r)){var s;s="sorting_asc"===a(r,"headerClassName")?"ASC":"DESC",o.sort=JSON.stringify([{property:r.field,direction:s}]),console.log("userSortedAttribute",r)}return console.groupEnd(),o}},d);t.register("widget:list",u)}}),Ember.Application.initializer({name:"TextWidget",after:["WidgetFactory","TimeWindowUtils","EventConsumer","MetricConsumer"],initialize:function(e,t){var i=e.lookupFactory("factory:widget"),n=e.lookupFactory("mixin:eventconsumer"),o=e.lookupFactory("mixin:metricconsumer"),r=e.lookupFactory("utility:timewindow"),s=window.Handlebars,a=Ember.String.loc,l=Ember.get,c=Ember.set,d=Ember.isNone,u={mixins:[n,o]},h=i("text",{findItems:function(){var e=r.getFromTo(l(this,"time_window"),l(this,"time_window_offset")),t=e[0],i=e[1],n=l(this,"from"),o=l(this,"to");d(n)||(t=n),d(o)||(i=o),c(this,"context",{event:{},serie:{},metric:{}}),c(this,"context.from",t),c(this,"context.to",i);var a=!1,u=l(this,"events");if(!d(u)&&u.length&&(this.fetchEvents(u),a=!0),u=l(this,"metrics"),l(this,"appliedDynamicProperties")&&l(this,"appliedDynamicProperties")!=={}){u=JSON.stringify(u);var h=l(this,"appliedDynamicProperties");u=s.compile(u)(h),u=JSON.parse(u)}!d(u)&&u.length&&(this.aggregateMetrics(u,t,i,"last",i-t),a=!0),u=l(this,"series"),!d(u)&&u.length&&(this.fetchSeries(u,t,i),a=!0),!1===a&&this.renderTemplate()},onEvents:function(e,t){var i=l(this,"context");$.each(e,function(e,n){var o=l(n,"id"),r=t[o];d(r)?console.warn("No label found for event, will not be rendered:",o):c(i,"event."+r,n._data)}),c(this,"context",i),this.renderTemplate()},onMetrics:function(e){var t=l(this,"context");$.each(e,function(e,i){var n=l(i,"meta.data_id").split("/"),o=l(i,"points"),r=o.length,s=a("No data available");r&&(s=o[r-1][1]);var u=void 0,h=void 0,p=void 0;6===n.length?(u=n[4],p=n[5]):(u=n[4],h=n[5],p=n[6]),u=u.replace(/\./g,"_"),p=p.replace(/\./g,"_"),void 0!==h&&(h=h.replace(/\./g,"_"));var m="metric."+u;d(l(t,m))&&c(t,m,{}),d(h)||(m+="."+h,d(l(t,m))&&c(t,m,{})),c(t,m+"."+p,s)}),c(this,"context",t),this.renderTemplate()},onSeries:function(e){var t=l(this,"context");$.each(e,function(e,i){var n=l(i,"points"),o=l(i,"label"),r=a("No data available");n.length&&(r=n[n.length-1][1]),c(t,"serie."+o,r)}),c(this,"context",t),this.renderTemplate()},makeTemplate:function(){var e=void 0;try{e=s.compile(l(this,"html"))}catch(t){e=function(){return"<i>Impossible to render template:</i> "+t}}return e},renderTemplate:function(){var e=this.makeTemplate(),t=l(this,"context"),i=l(this,"appliedDynamicProperties")||{};$.extend(t,i),c(this,"renderedTemplate",new Ember.Handlebars.SafeString(e(t)))}},u);t.register("widget:text",h)}}),Ember.Application.initializer({name:"TopologyAdapters",after:"ApplicationAdapter",initialize:function(e,t){var i=e.lookupFactory("adapter:application"),n=Ember.get,o=Ember.isNone,r=i.extend({graphType:"topology",buildURL:function(e,t,i){return"/"+this.graphType+"/"+e+"s"},createRecord:function(e,t,i){var n={};(o(t)||o(t.typeKey))&&console.error("Error while retrieving typeKey from type is it is none."),n=e.serializerFor(t.typeKey).serializeIntoHash(n,t,i,"PUT",{includeId:!0});var r=this.buildURL("graphelt");return this.ajax(r,"PUT",{data:{elts:n}})},updateRecord:function(e,t,i){return this.createRecord(e,t,i)},deleteRecord:function(e,t,i){var o=this.buildURL("graphelt",null),r=n(i,"id"),s={data:{ids:r}};return this.ajax(o,"DELETE",s)},findQuery:function(e,t,i){var n=this.buildURL(t.typeKey,null);return this.ajax(n,"POST",{data:i})}});t.register("adapter:graphelt",r),t.register("adapter:graph",r),t.register("adapter:vertice",r),t.register("adapter:edge",r),t.register("adapter:toponode",r),t.register("adapter:topoedge",r),t.register("adapter:topo",r)}}),Ember.Application.initializer({name:"TopologyWidget",after:["WidgetFactory","FormsUtils","DataUtils","TopologyViewMixin"],initialize:function(e,t){var i=e.lookupFactory("factory:widget"),n=e.lookupFactory("utility:forms"),o=(e.lookupFactory("utility:data"),e.lookupFactory("mixin:topology-view")),r=Ember.get,s=(Ember.set,i("topology",{viewMixins:[o],graphModel:{graph:null,recordsById:{},selected:{}},graph_cls:"canopsis.topology.elements.Topology",defaultVerticeCls:"canopsis.topology.elements.TopoNode",defaultEdgeCls:"canopsis.topology.elements.TopoEdge",graphEltType:"topo",verticeEltType:"toponode",edgeEltType:"topoedge",init:function(){this._super.apply(this,arguments)},getEntitiesFromServer:function(e,t,i){if(e.length>0){var n=function(t,i){$.ajax({url:"/context/ids",type:"POST",data:{ids:JSON.stringify(e)}}).then(t,i)};new Ember.RSVP.Promise(n).then(t,i)}else t({total:0})},_addGraph:function(e){var t=this,i=this.graphModel.recordsById;this.graphModel.graph=e,i[e.get("id")]=e;var n=e.get("_delts"),o=function(e){var o=n[e];o.id=e;var r=t.widgetDataStore.createRecord(o.type,o);return i[e]=r,r.save()};records_to_save=Object.keys(n).map(o);var r=function(){t.trigger("refresh")};Ember.RSVP.all(records_to_save).then(r,console.error)},findItems:function(){var e=this,t=r(this,"model.graph_id");if(void 0!==t){null!==this.graphModel.graph&&this.graphModel.graph.get("id")!==t&&(this.graphModel.graph=null,this.graphModel.recordsById={},this.graphModel.selected={});var i={ids:t,add_elts:!0},n=function(i){var n=null;if(1===i.content.length){if(n=i.content[0],null!==e.graphModel.graph){var o=n.get("_delts"),r=e.graphModel.recordsById,s=e.graphModel.selected;Object.keys(r).forEach(function(e){e!==t&&void 0===o[e]&&(delete r[e],delete s[e])})}e._addGraph(n)}else console.error("Several graph obtained from a simple request: "+i.content)},o=function(i){var n=e.widgetDataStore.createRecord(e.graphEltType,{id:t}),o=function(){e._addGraph(n)};n.save().then(o)};this.widgetDataStore.find("graph",i).then(n,o)}},deleteRecords:function(e,t,i,n){Array.isArray(e)||(e=[e]);var o=this,r=this.graphModel.graph.get("id"),s=this.graphModel.recordsById,a=this.graphModel.selected,l=function(e){var t=null,i=e.get("id");return i===r?console.error("Impossible to delete the graph"):(delete s[i],delete a[i],t=e.destroyRecord()),t},c=e.map(l),d=function(){void 0!==t&&t.call(n,arguments),o.findItems()},u=function(e){console.error(e),void 0!==i&&i.call(n,arguments),o.trigger("refresh")};Ember.RSVP.all(c).then(d,u)},select:function(e){Array.isArray(e)||(e=[e]);var t=function(e){this.graphModel.selected[e.get("id")]=e};e.forEach(t,this),this.trigger("refresh")},unselect:function(e){Array.isArray(e)||(e=[e]);e.forEach(deleteRecords,this),this.trigger("refresh")},saveRecords:function(e,t,i,n){Array.isArray(e)||(e=[e]);var o=e.map(function(e){var t=e.get("info");return void 0===t.view&&(t.view={}),t.view[r(this,"model.graph_id")]=e.view,e.save()});Ember.RSVP.all(o).then(t,n).catch(i,n)},newRecord:function(e,t,i,n,o,r){void 0===e&&(e=this.verticeEltType);var s=this.widgetDataStore.createRecord(e,t),a=function(e){console.error(e),void 0!==o&&o.call(r,e)},l=function(e){var t=e.get("id"),i=this.graphModel.recordsById,o=this.graphModel.graph,s=i[t];if(void 0!==s)this.deleteRecords(s);else{var l=o.get("elts");l.push(t),o.set("elts",l);var c=function(){i[t]=e,void 0!==n&&n.call(r,e)},d=function(t){e.destroyRecord().then(a)};o.save().then(c,d)}};return i?this.editRecord(s,l,a,this):l.call(this,s),s},editRecord:function(e,t,i,o){var r=this;"string"==typeof e&&(e=this.graphModel.recordsById[e]);var s=e.get("_type");switch(s){case"edge":break;case"vertice":case"graph":var a=["ok","minor","major","critical"],l=function(e){var t=e.id||e,i=t.lastIndexOf(".");return t.substring(i+1)},c=function(e,t,i,n){var o=e[i];if(void 0!==o){var r=l(o),s=r;if("change_state"===r){var c=o.params;void 0!==c&&(s=c.state,s=a[s])}t.set(n,s)}},d=function(e,t,i,n){var o=t.get(i);switch(e.params[n]={id:"canopsis.topology.rule.action.",params:{}},o){case"worst_state":case"best_state":e.params[n].id+=o;break;default:o=a.indexOf(o),e.params[n].id+="change_state",e.params[n].params.state=o}},u=e.get("info");if(void 0!==u){var h=u.entity;void 0!==h&&e.set("entity",h);var p=u.label;void 0!==p&&e.set("label",p);var m=u.task;if(void 0!==m){if(void 0!==(m.id||m)){var f=l(m);if("condition"===f){var g=m.params;if(void 0!==g){var v=g.condition;if(void 0!==v){var b=l(v.id||v);e.set("operator",b);var y=v.params;if(void 0!==y){if("nok"===b)e.set("operator","nok");else{var E=y.state;"canopsis.topology.rule.condition.is_nok"===y.f?E="nok":void 0!==E&&(E=a[E],e.set("in_state",E))}var x=y.min_weight;void 0!==x&&e.set("min_weight",x),c(g,e,"statement","then_state"),c(g,e,"_else","else_state")}}}}else e.set("operator",f)}}}}var w=n.showNew("modelform",e,{inspectedItemType:e.get("type")}),_=function(){switch(s){case"edge":break;case"vertice":case"graph":var n=e.get("info"),l=null;void 0!==n?(l=n.task,"string"==typeof l?(n.task={id:l},l=n.task):void 0===l&&(n.task={},l=n.task)):(n={task:{}},l=n.task);var c=e.get("entity");void 0!==c&&(n.entity=c);var u=e.get("label");void 0!==u&&(n.label=u);var h=e.get("operator");switch(h){case"change_state":case"worst_state":case"best_state":l.id="canopsis.topology.rule.action."+h,l.params={};break;case"_all":case"at_least":case"nok":if(l.id="canopsis.task.condition.condition",l.params={},l.params.condition={id:"canopsis.topology.rule.condition."+h,params:{}},"_all"!==h){var p=e.get("min_weight");l.params.condition.params.min_weight=p}var m=e.get("in_state");"nok"===m?"nok"!==h&&(l.params.condition.params.f="canopsis.topology.rule.condition.is_nok",l.params.condition.params.state=null):l.params.condition.params.state=a.indexOf(m),d(l,e,"then_state","statement"),d(l,e,"else_state","_else")}e.set("info",n)}var f=function(e){var i=e[0];void 0!==t&&t.call(o,i),r.trigger("refresh")},g=function(e){console.error(e),void 0!==i&&i.call(o,e)};r.saveRecords(e,f,g,r)},k=function(){void 0!==i&&i.call(o,e)};w.submit.done(_).fail(k)}}));t.register("widget:topology",s)}}),Ember.Application.initializer({name:"TopologyViewMixin",initialize:function(e,t){var i=window.d3,n=Ember.get,o=Ember.set,r=Ember.Mixin.create({shapesById:{},nodes:[],links:[],nodeClass:"node",linkClass:"link",edgeClass:"edge",toolbox:null,_layout:{type:"force",force:null,tree:null,cluster:null,partition:null,pack:null,activated:!0,engine:null},panel:null,source:null,toolboxGap:50,duration:500,_unit:32,translate:[1,1],scale:1.5,_defaultLayout:{partition:{sort:function(e,t){return i.ascending(e.name,t.name)},children:function(e){return e.sources}},pack:{sort:function(e,t){return i.ascending(e.name,t.name)},children:function(e){return e.sources}},cluster:{separation:function(e,t){return(e.parent==t.parent?1:2)/e.depth},nodeSize:null,sort:function(e,t){return i.ascending(e.name,t.name)},children:function(e){return e.sources}},tree:{separation:function(e,t){return(e.parent==t.parent?1:2)/e.depth},nodeSize:null,sort:function(e,t){return i.ascending(e.name,t.name)},children:function(e){return e.sources}},force:{charge:-30,linkDistance:20,linkStrength:1,friction:.9,theta:.8,gravity:.1}},optionsCharge:function(){return{min:-256,max:256}}.property("optionsCharge"),linkStrengthCharge:function(){return{min:0,max:1,step:.05}}.property("linkStrengthCharge"),linkDistanceCharge:function(){return{min:0,max:150,step:10}}.property("linkDistanceCharge"),frictionCharge:function(){return{min:0,max:1,step:.05}}.property("frictionCharge"),thetaCharge:function(){return{min:0,max:1,step:.05}}.property("thetaCharge"),gravityCharge:function(){return{min:0,max:1,step:.05}}.property("gravityCharge"),filter:function(){return this._filter}.property("filter"),filterChanged:function(){this._filter=n(this,"filter")}.observes("filter"),autoLayout:function(){return this._layout.activated}.property("autoLayout"),autoLayoutChanged:function(){this._layout.activated=n(this,"autoLayout"),this._layout.activated?this._layout.engine.start():this._layout.engine.stop()}.observes("autoLayout"),charge:function(){return this._layout[this._layout.type].charge}.property("charge"),chargeChanged:function(){var e=n(this,"charge");this._layout[this._layout.type].charge=e,this._layout.engine.charge(e),this.redraw()}.observes("charge"),linkDistance:function(){return this._layout[this._layout.type].linkDistance}.property("linkDistance"),linkDistanceChanged:function(){var e=this.get("linkDistance");this._layout[this._layout.type].linkDistance=e,this._layout.engine.linkDistance(e),this.redraw()}.observes("linkDistance"),linkStrength:function(){return this._layout[this._layout.type].linkStrength}.property("linkStrength"),linkStrengthChanged:function(){var e=this.get("linkStrength");this._layout[this._layout.type].linkStrength=e,this._layout.engine.linkStrength(e),this.redraw()}.observes("linkStrength"),friction:function(){return this._layout[this._layout.type].friction}.property("friction"),frictionChanged:function(){var e=this.get("friction");this._layout[this._layout.type].friction=e,this._layout.engine.friction(e),this.redraw()}.observes("friction"),theta:function(){return this._layout[this._layout.type].theta}.property("theta"),thetaChanged:function(){var e=this.get("theta");this._layout[this._layout.type].theta=e,this._layout.engine.theta(e),this.redraw()}.observes("theta"),gravity:function(){return this._layout[this._layout.type].gravity}.property("gravity"),gravityChanged:function(){var e=this.get("gravity");this._layout[this._layout.type].gravity=e,this._layout.engine.gravity(e),this.redraw()}.observes("gravity"),showProperties:function(){return this._showProperties}.property("showProperties"),rerender:function(){this._super.apply(this,arguments),this.didInsertElement()},registerHooks:function(){return result=this._super.apply(this,arguments),n(this,"controller").on("redraw",this,this.redraw),result},unregisterHooks:function(){return result=this._super.apply(this,arguments),n(this,"controller").off("redraw",this,this.redraw),result},didInsertElement:function(){this._super.apply(this,arguments),null!==n(this,"controller").graphModel.graph&&this.updateModel()},updateModel:function(){var e=this,t=n(this,"controller").graphModel.recordsById,i={},o=function(e){var n=e.id,o=t[n].get("info");if(o){var r=o.entity;void 0!==r&&(void 0===i[r]?i[r]=[e]:i[r].push(e))}},r=this.shapesById,s={nodes:[],links:[]};Object.keys(r).forEach(function(e){if(void 0===t[e]){var i=r[e];"link"===i.type?s.links.push(i.index):s.nodes.push(i.index),delete r[e]}}),["nodes","links"].forEach(function(e){indexToDelete=s[e];var t=0;indexToDelete.forEach(function(i){this[e].splice(i-t++,1)},this)},this),Object.keys(t).forEach(function(e){var i=t[e],n=this.getNode(i);this.shapesById[e]=n,"edge"===i.get("_type")?this.weaveLinks(n):n._weight=1,o(n)},this),this.nodes.forEach(function(e,i){var n=e.id,o=t[n];if("edge"===o.get("_type")){var r=o.get("sources")[0],s=this.shapesById[r];void 0!==s&&(s._weight+=o.get("weight"))}e.index=i,e.entity=void 0},this),this.links.forEach(function(e){if("string"==typeof e.source&&(e.source=this.shapesById[e.source]),"string"==typeof e.target){var t=this.shapesById[e.target];e.parent=e.target=t}},this),n(this,"controller").getEntitiesFromServer(Object.keys(i),function(t){0!==t.total&&t.data.forEach(function(e){i[e._id].forEach(function(t){t.entity=e})}),e.trigger("redraw")})},redraw:function(){var e=this,t=n(this,"controller.model.width");t||(t=this.$().width());var o=n(this,"controller.model.height");o||(o=9*t/16);var r=n(this,"controller.model.layout"),s=this._layout;s.type=r;var a=s.engine;if(null===s[r]&&(a=s.engine=i.layout[r](),s[r]=this._defaultLayout[r]),a.size([t,o]),this.panel=i.select(this.$("svg .panel")[0]),0===this.panel.size()){var l=function(){if(!e.dragging){console.log(e.translate,i.event.translate);var t=[];[0,1].forEach(function(e){t[e]=i.event.translate[e]}),e.translate=t,e.scale=Math.max(i.event.scale,1.5);var n="translate("+t+")scale("+e.scale+")";e.panel.attr("transform",n)}},c=function(e,t){force.stop()},d=function(e,t){e.px+=i.event.dx,e.py+=i.event.dy,e.x+=i.event.dx,e.y+=i.event.dy,tick()},u=function(e,t){e.fixed=!0,tick(),s.activated&&force.resume()},l=(i.behavior.drag().on("dragstart",c).on("drag",d).on("dragend",u),i.behavior.zoom().scaleExtent([1.5,10]).on("zoom",l));this.panel=i.select(this.$("svg")[0]).attr({width:t,height:o}).append("g").classed({panel:!0}).attr({}).on("click",function(){return e.clickAction(this)}).on("mousemove",function(){return e.moveAction(this)}).on("mouseout",function(){return e.overAction(this)}).on("dblclick",function(){return e.addHandler()}).call(l)}var h="translate("+this.translate+")scale("+this.scale+")";this.panel.attr("transform",h);var p=this.panel.select(".overlay");0===p.size()&&this.panel.append("rect").classed("overlay",!0).attr("width",t).attr("height",o),e.overlay=p,a.nodes(this.nodes).links(this.links);var m=this.panel.selectAll("."+this.linkClass).data(this.links,function(e){return e.id}),f=m.enter();this.addLinks(f);var g=m;this.updateLinks(g);var v=m.exit();this.delLinks(v);var b=this.panel.selectAll("."+this.nodeClass).data(this.nodes,function(e){return e.id}),y=b.enter();this.addNodes(y);var E=b;this.updateNodes(E);var x=b.exit();this.delNodes(x),this.refreshSelectedShapes(),this.refreshLockedShapes(),a.on("tick",function(){s.activated||a.stop(),m.attr({d:function(e){return"M"+e.source.x+" "+e.source.y+"L"+e.target.x+" "+e.target.y}}),b.attr({transform:function(e){return"translate("+e.x+","+e.y+")"}})}),s.activated&&a.start()},weaveLinks:function(e){var t=n(this,"controller").graphModel.recordsById,i=e.id,o=t[i];o.get("sources"),o.get("targets");e._weight=o.get("weight"),e.sources={},e.targets={};var r={sources:{},targets:{}},s=[],a=function(t){var n="sources"===t;o.get(t).forEach(function(o){var s=r[t][o];void 0===s&&(s=0,r[t][o]=s),s++,r[t][o]=s;var a=e[t][o];if(void 0===a&&(a={},e[t][o]=a),Object.keys(a).length<s){link={edge:e,type:"link",isSource:n,source:n?o:i,target:n?i:o,id:""+Math.random(),index:this.links.length},this.links.push(link),this.shapesById[link.id]=link;var l=this.shapesById[link.source];void 0!==l&&(link.source=l);var c=this.shapesById[link.target];void 0!==c&&(link.target=c),a[link.id]=link}},this);var a=function(i){var n=this.shapesById[i];delete e[t][l][i],delete this.shapesById[i],s.push(n.index)};for(var l in e[t]){var c=r[t][l],d=0;void 0!==c&&(d=c);Object.keys(e[t][l]).splice(d).forEach(a,this)}};a.call(this,"sources"),a.call(this,"targets")},refreshSelectedShapes:function(){var e=n(this,"controller").graphModel.selected,t=this.panel.selectAll(".shapegroup").data(e,function(e){return e});t.classed("selected",!0),t.exit().classed("selected",!1)},refreshLockedShapes:function(){this.panel.selectAll(".shapegroup").filter(function(e){return e.fixed}).classed("locked",!0),this.panel.selectAll(".shapegroup").filter(function(e){return!e.fixed}).classed("locked",!1)},coordinates:function(){var e=[1,1];return null!==this.panel&&(e=i.mouse(this.panel[0][0])),e},showToolBox:function(e){if(!i.event.defaultPrevented){var t=e.__data__,n=this.getToolBoxItems(t),o=t?[t.x,t.y]:this.coordinates(),r=this;this.toolbox=this.panel.selectAll(".toolbox").data(n,function(e){return e.name});var s=this.toolbox.enter().append("g").style("opacity",0).attr({id:function(e){return"toolbox_"+e.name},class:function(e){return"toolbox "+e.name},transform:function(e,t){var i=2*t*Math.PI/n.length;return"translate("+(o[0]+Math.cos(i)*r.toolboxGap)+","+(o[1]+Math.sin(i)*r.toolboxGap)+")scale("+1/r.scale+")"+(e.transform?e.transform:"")}});s.append("path").attr({d:function(e,t){return e.symbol.size(20*r._unit)(e,t)}}).append("title").text(function(e){return e.name}),s.append("text").text(function(e){return e.name}),this.toolbox.on("click",function(i){r[i.name+"Handler"](t,e),r.destroyToolBox()}).transition().style("opacity",1).attr({transform:function(e,t){var i=2*t*Math.PI/n.length;return"translate("+(o[0]+Math.cos(i)*r.toolboxGap)+","+(o[1]+Math.sin(i)*r.toolboxGap)+") "+(e.transform?e.transform:"")}}),this.toolbox.exit().transition().duration(this.duration).style("opacity",0).remove()}},destroyToolBox:function(){this.toolbox&&this.toolbox.transition().duration(this.duration).style("opacity",0).remove()},closeHandler:function(e){i.event.stopPropagation()},editHandler:function(e){i.event.stopPropagation(),n(this,"controller").editRecord(e.id)},deleteHandler:function(e){i.event.stopPropagation(),Array.isArray(e)||(e=[e]);var t=[],o=n(this,"controller"),r=o.graphModel.recordsById;e.forEach(function(e){var i=r[e.id];if(void 0!==e.isSource){var n=e.isSource?"source":"target",o=i.get(n+"s"),s=o.indexOf(e[n]);o.splice(s,1),i.set(n+"s",o)}else t.push(i)}),t.length>0&&o.deleteRecords(t)},linkHandler:function(e,t){i.event.stopPropagation(),this.source=e},addHandler:function(e){i.event.stopPropagation();var t=n(this,"controller"),o=function(e){this.getNode(e),t.trigger("refresh")};if(null===this.source){t.newRecord(t.verticeEltType,void 0,!0,o,void 0,this)}else{var r=function(e){this.removeTmpLink(),t.trigger("refresh")},s=function(e){this.removeTmpLink()};this.addLink(this.source,e,!0,r,s,this)}},unselectHandler:function(e){i.event.stopPropagation(),n(this,"controller").unselect(e.id)},selectHandler:function(e){i.event.stopPropagation(),n(this,"controller").select(e.id)},unlockHandler:function(e){i.event.stopPropagation(),this.lock(e)},lockHandler:function(e){i.event.stopPropagation(),this.lock(e,!0)},cancelHandler:function(e){i.event.stopPropagation(),this.removeTmpLink()},eventpoolHandler:function(e){document.location.href="/eventpool/?"+e.elt.get("info").entity},removeTmpLink:function(){this.source=null,this.tmpLink&&this.tmpLink.remove(),this.tmpLink=null},lock:function(e,t){Array.isArray(e)||(e=[e]),e.forEach(function(e){e.fixed=t}),this.refreshLockedShapes()},addNodes:function(e){var t=this,o=n(this,"controller").graphModel.recordsById,r=e.append("g").classed({shapegroup:!0,node:!0,edge:function(e){return"edge"===o[e.id].get("_type")},graph:function(e){return"graph"===o[e.id].get("_type")}}).attr({id:function(e){return e.id}}).on("click",function(){return t.clickAction(this)}).on("dblclick",function(){return t.dblClickAction(this)}).on("mouseover",function(){t.overAction(this)}).on("mouseout",function(){t.outAction(this)}).on("mousemove",function(){t.moveAction(this)});r.append("path").classed({shape:!0});var s=r.filter(function(e){return"edge"!==o[e.id].get("_type")});s.append("title"),s.append("text").classed("entity",!0),s.append("text").classed("operator",!0),r.filter(function(e){return"edge"===o[e.id].get("_type")}).append("text").classed("weight",!0);var a=this._layout.engine.drag.on("dragstart",function(e){i.event.sourceEvent.stopPropagation(),t.dragging=!0,t.panel.select(this).classed("dragging",!0)}).on("dragend",function(e){t.dragging=!1,t.panel.select(this).classed("dragging",!1)});r.call(a)},delNodes:function(e){e.transition().duration(this.duration).style("opacity",0).remove()},updateNodes:function(e){var t=this,o=n(this,"controller").graphModel.recordsById,r=n(this,"controller.model.graph_id");e.select("path").classed({ndok:function(e){var t=o[e.id];return!t.get("info").state||0==t.get("info").state},ndminor:function(e){return 1==o[e.id].get("info").state},ndmajor:function(e){return 2==o[e.id].get("info").state},ndcritical:function(e){return 3==o[e.id].get("info").state}}).attr("d",function(e,n){var s=i.svg.symbol();switch(void 0===e.x&&(e.x=0,e.y=0),o[e.id].get("_type")){case"graph":s=s.type("circle"),s=e.id===r?s.size(30*t._unit):s.size((e._weight>=1?e._weight:1)*t._unit);break;case"edge":s=s.type("diamond").size(e._weight*t._unit);break;case"vertice":s=s.type("square").size((e._weight>=1?e._weight:1)*t._unit);break;default:s=s.type("triangle-down")}return s(e,n)}),e.select("title").text(function(e){var t="",i=o[e.id],n=i.get("info");if(void 0!==n){var r=n.entity;void 0!==r&&(t+=r)}return t}),e.select(".entity").text(function(e){var t="",i=o[e.id],n=i.get("info");if(n&&n.label)t+=n.label;else{var r=e.entity;void 0!==r&&(t+=r.name)}return t}),e.select(".operator").text(function(e){var t="",i=o[e.id],n=i.get("info");if(void 0!==n){var r=n.task;if(r){var s=r.id||r;"canopsis.task.condition.condition"===s&&(r=r.params.condition,s=r.id||r),s=s.substring(s.lastIndexOf(".")+1),t+=s}"change_state"===t&&(t="")}return t}),e.select(".weight").text(function(e){var t="",i=o[e.id],n=i.get("weight");return void 0!==n&&1!==n&&(t+=n),t})},addLinks:function(e){var t=this;e.append("path").classed({shape:!0,link:!0,targetLink:function(e){return!e.isSource}}).attr({id:function(e){return e.id}}).on("click",function(){return t.clickAction(this)}).on("mouseout",function(){t.outAction(this)}).on("mousemove",function(){t.moveAction(this)}).on("mouseover",function(){t.overAction(this)})},delLinks:function(e){e.transition().duration(this.duration).style("opacity",0).remove()},updateLinks:function(e){var t=n(this,"controller").graphModel.recordsById;e.classed({directed:function(e){return t[e.edge.id].get("directed")},lnok:function(e){var i=t[e.edge.id];return!i.get("info").state||0==i.get("info").state},lnminor:function(e){return 1==t[e.edge.id].get("info").state},lnmajor:function(e){return 2==t[e.edge.id].get("info").state},lncritical:function(e){return 3==t[e.edge.id].get("info").state}}).style({"stroke-width":function(e){var i=1,n=t[e.edge.id],o=n.get("weight");return void 0!==o&&(i+=o-1),i},"marker-end":function(e){return t[e.edge.id].get("directed")&&!e.isSource?"url(#markerArrow)":""}})},moveAction:function(e){i.event.defaultPrevented||this.overAction(e)},overAction:function(e){if(!i.event.defaultPrevented){var t=e.__data__;if(void 0!==t&&(d3Shape=i.select(e),d3Shape.classed("over",!0)),null!==this.source){console.log(t);t?(t.x,t.y):this.coordinates()}}},checkTargetLink:function(e){var t=n(this,"controller").graphModel.recordsById,i=void 0===e;if(!i){i="edge"!==t[e.id||e].get("_type")&&e.id!==this.source.id}return i},outAction:function(e){i.event.defaultPrevented||i.select(e).classed("over",!1)},dblClickAction:function(e){i.event.defaultPrevented||(i.event.stopPropagation(),n(this,"controller").editRecord(e.__data__.id),this.destroyToolBox())},clickAction:function(e){i.event.defaultPrevented||(i.event.stopPropagation(),this.showToolBox(e))},getNode:function(e){var t,i=e.get("id"),o=this.shapesById[i],r=n(this,"controller.model.graph_id"),s=e.get("info").view;return void 0!==s&&(t=s[r]),void 0===o&&(void 0===t?(o={fixed:!1,hidden:!1,id:i,index:this.nodes.length,type:e.get("type"),x:0,y:0,px:0,py:0},this.nodes.push(o)):o=t,this.shapesById[i]=o),o},addLink:function(e,t,i,o,r,s){var a=this,l=null,c=n(this,"controller"),d=c.graphModel.recordsById[e.id],u=d.get("_type"),h=n(c,"model.graph_id");if(e.id===h||!this.checkTargetLink(t))throw"Wrong parameters";var p=function(e){console.error(e),void 0!==r&&r.call(s,e)};if(void 0===t){var m=this.coordinates(),f=function(t){var n=this.getNode(t);n.px=n.x=m[0],n.py=n.y=m[1],this.addLink(e,n,i,o,r,s)};if(t=c.newRecord(c.verticeEltType,void 0,i,f,p,this),i)return}if("edge"===u){l=e,record=c.graphModel.recordsById[l.id];var g=record.get("targets");g.push(t.id),record.set("targets",g),record.save().then(function(){a.weaveLinks(l)},function(e){console.error(e)})}else{var v=function(e){var t=this.getNode(e);this.weaveLinks(t),void 0!==o&&o.call(s,e)};c.newRecord(c.edgeEltType,{sources:[e.id],targets:[t.id]},i,v,p,this)}return l},newToolBoxItem:function(e,t,n){return{name:e,symbol:i.svg.symbol().type(t),transform:n,type:"toolbox"}},getToolBoxItems:function(e){var t=[],i=n(this,"controller.model.graph_id");if(null!==this.source)t.push(this.newToolBoxItem("close","triangle-down"),this.newToolBoxItem("cancel","cross","rotate(45)"),this.newToolBoxItem("add","cross"));else if(t.push(this.newToolBoxItem("close","triangle-down")),void 0!==e&&"link"!==e.type){var o=n(this,"controller").graphModel.recordsById[e.id],r=o.get("info");r&&r.entity&&t.push(this.newToolBoxItem("eventpool","triangle-up")),void 0!==n(this,"controller").graphModel.selected[e.id]?t.push(this.newToolBoxItem("unselect","diamond")):t.push(this.newToolBoxItem("select","diamond")),e.fixed?t.push(this.newToolBoxItem("unlock")):t.push(this.newToolBoxItem("lock")),e.id!==i&&t.push(this.newToolBoxItem("link","triangle-up"),this.newToolBoxItem("delete","cross","rotate(45)")),t.push(this.newToolBoxItem("edit","square"))}else t.push(this.newToolBoxItem("add","cross"));return t},actions:{showHideProperties:function(){var e=n(this,"showProperties");o(this,"showProperties",!e)},filter:function(){var e=n(this,"filter");this.filter(e),o(this,"filter",e)}}});t.register("mixin:topology-view",r)}}),Ember.Application.initializer({name:"UimaintabcollectionWidget",after:["WidgetFactory","WidgetController","FormsUtils","RoutesUtils"],initialize:function(e,t){var i=e.lookupFactory("controller:widget"),n=e.lookupFactory("utility:forms"),o=e.lookupFactory("utility:routes"),r=Ember.get,s=Ember.set,a=Ember.String.loc,l=i.extend({needs:["application","login"],currentViewId:Ember.computed.alias("controllers.application.currentViewId"),currentViewModel:Ember.computed.alias("controllers.application.currentViewModel"),tagName:"span",userCanShowEditionMenu:!0,userCanEditView:!0,userCanCreateView:!0,isViewDisplayable:function(e){return!0},computeProperties:function(e,t,i){return t.value===r(e,"currentViewId")?s(t,"isActive",!0):s(t,"isActive",!1),i=i.replace(".","_"),e.isViewDisplayable(i)?s(t,"displayable",!0):s(t,"displayable",!1),t},preparedTabs:function(){var e=this,t=Ember.A();return computeProperties=r(this,"computeProperties"),r(this,"tabs").forEach(function(i,n){var o=!0;if(s(i,"hasDisplayableNestedView",!1),!0===i.hasOwnProperty("nestedViews")){for(var r=0;r<i.nestedViews.length;r++){var a=i.nestedViews[r].value.value||"";computeProperties(e,i.nestedViews[r],a),1==i.nestedViews[r].isActive&&s(i,"isActive",!0),1==i.nestedViews[r].displayable&&(s(i,"hasDisplayableNestedView",!0),s(i,"displayable",!0))}s(i,"nestedViews",i.nestedViews.filterBy("displayable",!0)),0===i.nestedViews.length&&(o=!1)}else{var a=i.value||"";computeProperties(e,i,a)}!0===o&&t.pushObject(i)}),t}.property("tabs","currentViewId"),actions:{do:function(e,t){void 0!==t&&null!==t||(t=[]),this.send(e,t)},showViewOptions:function(){var e=o.getCurrentRouteController(),t=e.get("model"),i=n.showNew("viewtreeform",t,{title:a("Edit userview")});console.log("widgetWizard",i);var s=this;i.submit.done(function(){t.save().then(function(){r(s,"viewController").send("refresh")})})}}});t.register("widgetbase:uimaintabcollection",l)}}),Ember.Application.initializer({name:"ContainerWidget",after:["WidgetFactory","DebugUtils"],initialize:function(e,t){var i=e.lookupFactory("factory:widget"),n=e.lookupFactory("utility:debug"),o=Ember.get,r=Ember.Mixin.create({registerHooks:function(){return o(this,"controller").on("refreshChilds",this,this.refreshChilds),this._super()},unregisterHooks:function(){return o(this,"controller").off("refreshChilds",this,this.refreshChilds),this._super()},refreshChilds:function(){var e=this.$().children().find(".ember-view.widget"),t=this.$().attr("id");console.log("this id",t);for(var i=0,o=e.length;i<o;i++)if($(e[i]).parent().closest(".ember-view.widget").attr("id")===t){var r=n.getViewFromJqueryElement($(e[i])),s=r.get("controller");s.refreshContent()
}}}),s=i("widgetcontainer",{init:function(){this.addMixinView(r),this._super()},refreshContent:function(){return console.log("container startRefresh"),this.trigger("refreshChilds"),this._super()},actions:{callAction:function(e,t){o(e,"controller")&&(e=o(e,"controller")),e.send(t)}}});t.register("widget:widgetcontainer",s)}});
//# sourceMappingURL=dist/brick.map.js