Ember.Application.initializer({name:"component-ack",after:"DatesUtils",initialize:function(e,t){var o=e.lookupFactory("utility:dates"),n=Ember.get,i=Ember.set,r=Ember.isNone,s=Ember.String.loc,a=Ember.Component.extend({crecord:void 0,value:void 0,tickettooltip:void 0,acktooltip:void 0,ackcolor:void 0,acktitle:void 0,init:function(){this._super();var e=n(this,"crecord"),t=n(this,"value");console.log("Ack crecord",e,"Ack value",t);var a=n(e,"record.ticket_declared_author"),c=n(e,"record.ticket_declared_date"),l=n(e,"record.ticket"),u=n(e,"record.ticket_date"),d="";r(l)||r(u)||(d=["<b>"+s("Ticket number")+"</b><br/>",o.timestamp2String(u)+" <br/> ","<i>"+l+"</i><br/> "].join(""));var f="";r(c)||r(a)?r(l)||r(u)||(console.debug("ticket date is ",n(e,"record.ticket_date")),f=["<center>",d,"</center>"].join(""),i(this,"tickettooltip",f)):(f=["<center>","<b>"+s("Ticket declared")+"</b><br/>",o.timestamp2String(c)+" <br/> ",s("By")+" : "+a+" <br/><br/> ",d,"</center>"].join(""),i(this,"tickettooltip",f));var p=t&&t.timestamp?o.timestamp2String(t.timestamp):"",h=t&&t.author?t.author:"",m=t&&t.comment?t.comment:"",g=["<center>","<b>"+s("Ack")+"</b><br/>","<i>"+s("Date")+"</i> : <br/>",p+" <br/> ",s("By")+" : "+h+" <br/><br/> ","<i>"+s("Comment")+" </i> : <br/>"+m,"</center>"].join("");console.log("ack value",t),i(this,"acktooltip",g),t&&t.isCancel?(i(this,"ackcolor",""),i(this,"acktitle",s("Cancelled"))):(i(this,"ackcolor","bg-purple"),i(this,"acktitle",s("Acknowleged")))}});t.register("component:component-ack",a)}}),Ember.Application.initializer({name:"component-cfiltereditor",after:"IndexesRegistry",initialize:function(e,t){var o={},n=e.lookupFactory("registry:indexes"),i=Ember.get,r=Ember.set,s=Ember.isNone,a=Ember.Component.extend({init:function(){var e=i(this,"cfilter_serialized");r(this,"onlyAllowRegisteredIndexes",i(o,"conf.frontendConfig.cfilter_allow_only_optimized_filters")),null!==i(this,"content")&&void 0!==i(this,"content")?r(this,"cfilter_serialized",i(this,"content")):void 0!==e&&null!==e||r(this,"cfilter_serialized","{}"),this._super.apply(this,arguments)},indexesTree:{component:{_metas:{name:"Component"},resource:{_metas:{name:"Resource",final:!0}}},connector:{_metas:{name:"connector"},component:{_metas:{name:"Component"},resource:{_metas:{name:"Resource",final:!0}}}}},currentClauseIndex:-1,cfilter_serialized:Ember.computed.alias("content"),viewTabColumns:[{name:"component",title:"component"},{name:"resource",title:"resource"}],indexes:n,selectedIndexName:"event",selectedIndexChanged:function(){for(var e=i(this,"selectedIndexName"),t=i(this,"indexes"),o=0,n=t.all.length;o<n;o++){var s=t.all[o];s.name===e&&r(this,"indexesTree",s.tree)}}.observes("selectedIndexName"),clauses:function(){var e,t=i(this,"cfilter_serialized"),o=Ember.A();try{e=JSON.parse(t)}catch(t){console.error("unable to parse serialized filter"),e={$or:{}}}if(console.log("deserializeCfilter",t,o.length),console.log("mfilter",e),void 0===e.$or&&0!==Object.keys(e).length)return console.error("This editor cannot display the current filter"),r(this,"filterError","This editor cannot display the current filter"),o;if(void 0===e.$or)return o;for(var n=0,s=e.$or.length;n<s;n++){var a=e.$or[n],c=Ember.Object.create({and:Ember.A()});if(void 0===a.$and&&void 0!==Ember.keys(a)[0]&&(a.$and=[a]),void 0!==a.$and){for(var l,u=0,d=a.$and.length;u<d;u++){var f=a.$and[u],p=Ember.keys(f)[0],h=Ember.keys(f[p])[0];console.log(f[p][h]);var m=f[p][h];"not in"!==h&&"in"!==h||"object"!=typeof m||(m=m.join(","));var g=this.getIndexesForNewAndClause(c),v={isFirst:0===u,keyId:i(this,"cfilterEditId")+"-keys-"+(u+1),options:{available_indexes:g},key:p,value:m,operator:this.getLabelForMongoOperator(h),lastOfList:!0,filling:!1,finalized:!0};l=Ember.Object.create(v),console.log("field:",l),c.and.pushObject(l)}(!(!0===i(this,"onlyAllowRegisteredIndexes"))||i(l,"options.available_indexes.length")>0)&&(console.log("append empty and clause"),this.pushEmptyClause(c)),o.pushObject(c)}!1===i(this,"onlyAllowRegisteredIndexes")&&this.pushEmptyClause(c)}return console.log("clause deserialized",o),o}.property(),classNames:["cfilter"],operators:[{label:"=",value:"$eq"},{label:"!=",value:"$ne"},{label:"<",value:"$lt"},{label:">",value:"$gt"},{label:"in",value:"$in"},{label:"not in",value:"$nin"},{label:"regex",value:"$regex"},{label:"!regex",value:"$not"}],orButtonHidden:!1,onlyAllowRegisteredIndexes:!0,serializeCfilter:function(){for(var e=i(this,"clauses"),t={$or:[]},o=0,n=e.length;o<n;o++){var a=e[o],c={$and:[]};void 0!==a.and[0]&&r(a.and[0],"isFirst",!0);for(var l=0,u=a.and.length;l<u;l++){var d=a.and[l];if(0===l?r(d,"isFirst",!0):r(d,"isFirst",!1),r(d,"finalized",!0),l===a.and.length-1?r(a.and[l],"isLast",!0):r(a.and[l],"isLast",!1),Ember.isArray(a.and[l].value)||"in"!==a.and[l].operator&&"not in"!==a.and[l].operator?"string"==typeof a.and[l].value&&$.isNumeric(a.and[l].value)&&(a.and[l].value=parseFloat(a.and[l].value)):(console.log("Operator in detected"),a.and[l].value=a.and[l].value.split(",")),void 0!==d.key){var f={};console.log("field",d);var p={label:"=",value:"$eq"};void 0!==d.operator&&(p=this.getMongoOperatorForLabel(d.operator)),s(p.format)&&(p.format=function(e){return e}),f[d.key]={},f[d.key][p.value]=p.format(d.value),c.$and.pushObject(f)}}c.$and.length>0&&(1===c.$and.length&&(c=c.$and[0]),t.$or.pushObject(c))}return 0===t.$or.length&&(t={}),t=JSON.stringify(t,null,"")},getMongoOperatorForLabel:function(e){for(var t=0,o=this.operators.length;t<o;t++)if(this.operators[t].label===e)return this.operators[t]},getLabelForMongoOperator:function(e){for(var t=0,o=this.operators.length;t<o;t++)if(this.operators[t].value===e)return this.operators[t].label},checkIfNewAndClauseDisplayed:function(){var e=i(this,"currentClauseIndex");if(e>=0){var t=i(this,"clauses"),o=t.objectAt(e),n=o.and[o.and.length-1],s=function(e){return void 0===e||""===e};return void 0!==n&&s(n.key)&&s(n.value)?void r(this,"newAndClauseDisplayed",!1):void r(this,"newAndClauseDisplayed",!0)}return void r(this,"newAndClauseDisplayed",!1)}.observes("currentClauseIndex"),clausesChanged:function(){var e=i(this,"clauses");if(console.log("clausesChanged",e,e.length),0===e.length)r(this,"orButtonHidden",!1);else{var t=e[e.length-1];console.log("last and length",e),console.log("last and length",t),console.log("last and length",t.and.length);var o=t.and[t.and.length-1];console.log("lastAndQueryPart",o,o.key),t.and.length<=1&&(Ember.isNone(o.key)||Ember.isNone(o.value))?r(this,"orButtonHidden",!0):r(this,"orButtonHidden",!1)}var n=this.serializeCfilter();console.log("generated mfilter",n),r(this,"cfilter_serialized",n)},cfilterId:function(){return i(this,"elementId")+"-cfilter"}.property("elementId"),cfilter:function(){return $("#"+i(this,"cfilterId"))},cfilterEditId:function(){return i(this,"cfilterId")+"-edit"}.property("cfilterId"),cfilterEditTabId:function(){return"#"+i(this,"cfilterEditId")}.property("cfilterEditId"),cfilterEdit:function(){return $(i(this,"cfilterEditTabId"))},cfilterRawId:function(){return i(this,"cfilterId")+"-raw"}.property("cfilterId"),cfilterRawTabId:function(){return"#"+i(this,"cfilterRawId")}.property("cfilterRawId"),cfilterRaw:function(){return $(i(this,"cfilterRawTabId"))},cfilterViewId:function(){return i(this,"cfilterId")+"-view"}.property("cfilterId"),cfilterViewTabId:function(){return"#"+i(this,"cfilterViewId")}.property("cfilterViewId"),cfilterView:function(){return $(i(this,"cfilterViewTabId"))},getIndexesForNewAndClause:function(e){if(console.group("getIndexesForNewAndClause useIndexesOptions : ",i(this,"onlyAllowRegisteredIndexes"),e),!0===i(this,"onlyAllowRegisteredIndexes")){console.group("getIndexesForNewAndClause",e);for(var t=i(this,"indexesTree"),o=0,n=e.and.length;o<n;o++){var r=e.and[o];console.log("currentAnd",r),void 0===t?console.error("bad index management",r.key):t=t[r.key],console.log("indexesTreeCursor",t)}console.info("available indexes",t);var s=[];for(var a in t)console.log("iter",a,t[a]),"_metas"!==a&&s.pushObject({name:t[a]._metas.name,value:a,_metas:t[a]._metas});return console.groupEnd(),s}console.log('no index available because "use indexes" option is disabled'),console.groupEnd()},pushEmptyClause:function(e){console.group("pushEmptyAndClause",i(this,"onlyAllowRegisteredIndexes"));var t=this.getIndexesForNewAndClause(e),o=!0===i(this,"onlyAllowRegisteredIndexes");console.log("available_indexes",t);var n={keyId:i(this,"cfilterEditId")+"-keys-"+(e.and.length+1),options:{available_indexes:t},key:void 0,value:void 0,operator:"=",lastOfList:!0,filling:!1,finalized:!1},s=e.and[e.and.length-2];console.log("and array",e.and),console.log("lastAndClauseOfList",s),void 0!==s&&r(s,"lastOfList",!1),(!o||i(n,"options.available_indexes.length")>0)&&e.and.pushObject(Ember.Object.create(n)),console.groupEnd("pushEmptyClause")},actions:{selectIndexByName:function(e){r(this,"selectedIndexName",e)},unlockIndexes:function(){r(this,"onlyAllowRegisteredIndexes",!1)},lockIndexes:function(){r(this,"onlyAllowRegisteredIndexes",!0)},addAndClause:function(e){console.log("Add AND clause");var t=this.get("clauses"),o=this.get("currentClauseIndex");console.log(o);var n=t.objectAt(o);if(Ember.isNone(n)&&console.error("currentClause seems empty"),o>=0){var s=i(this,"onlyAllowRegisteredIndexes");console.log("test if it's possible to add a and clause",s,!e),!s&&e||(console.log("try to push empty and clause"),this.pushEmptyClause(n))}console.log("clauses addAndClause",t),r(this,"clauses",t),this.clausesChanged()},addOrClause:function(){var e=i(this,"clauses");console.group("Add OR clause",e);var t,o=i(this,"currentClauseIndex");o>=0&&(t=e.objectAt(o),r(t,"current",!1)),t=e.pushObject(Ember.Object.create({current:!0,and:[]})),r(this,"currentClauseIndex",e.length-1),console.log("calling addAndClause"),this.send("addAndClause"),this.send("activate",t),console.groupEnd()},activate:function(e){var t=i(this,"clauses"),o=i(this,"currentClauseIndex"),n=t.indexOf(e);o!==n&&(console.log("Activate clause:",e),o>=0&&t.objectAt(o).set("current",!1),r(e,"current",!0),console.log("changing currentClauseIndex"),r(this,"currentClauseIndex",n))},removeAndClause:function(e,t){console.log("removeAndClause");for(var o=i(this,"clauses"),n=!1,s=0;s<e.and.length;s++){var a=e.and.objectAt(s);if(console.log("currentAnd",a),!0===n&&(e.and.removeAt(s),s--),a===t){e.and.removeAt(s),console.log("processing delete",e.and,e.and.objectAt(s-1));var c=e.and.objectAt(s-1);if(void 0!==c&&r(c,"lastOfList",!0),s--,!0===i(this,"onlyAllowRegisteredIndexes")&&(n=!0,-1===s)){console.log("the clause will be empty, drop it and quit");for(var l=e,u=0,d=o.length;u<d;u++)if(o[u]===l)return o.removeAt(u),i(this,"currentClauseIndex")>=u&&r(this,"currentClauseIndex",i(this,"currentClauseIndex")-1),void this.clausesChanged()}}}void 0!==e&&!0===i(this,"onlyAllowRegisteredIndexes")&&this.pushEmptyClause(e),this.clausesChanged()}}});t.register("component:component-cfiltereditor",a)}}),Ember.Application.initializer({name:"component-eventselector",initialize:function(e,t){var o=Ember.get,n=Ember.set,i=Ember.isNone,r=Ember.String.loc,s=Ember.Component.extend({component:void 0,resource:void 0,componentDataStore:void 0,content:void 0,events:void 0,labelled:void 0,saveLabelsDone:void 0,search_component:void 0,search_resource:void 0,selectedEvents:void 0,selectors:void 0,topologies:void 0,type_label:void 0,init:function(){this._super(),this.set("componentDataStore",DS.Store.create({container:this.get("container")})),console.log("Event selector init"),this.set("selectedEvents",[]),n(this,"search_resource",r("Search for a resource")),n(this,"search_component",r("Search for a component")),n(this,"type_label",r("Associate a label to this event")),void 0!==o(this,"content")&&this.initializeEvents()},initializeEvents:function(){var e=[],t={};if(o(this,"labelled"))for(var i=o(this,"content"),r=i.length,s=0;s<r;s++)e.push(i[s].rk),t[i[s].rk]=i[s].label;else e=o(this,"content");var a=this;o(this,"componentDataStore").findQuery("event",{filter:JSON.stringify({_id:{$in:e}}),limit:0}).then(function(e){if(console.log("Fetched initialization data from events",e.content),o(a,"labelled"))for(var i=e.content.length,r=0;r<i;r++){var s=o(e.content[r],"id");n(e.content[r],"label",t[s])}n(a,"selectedEvents",e.content)})},findEvents:function(){var e={},t=this.getSelectedRks();if(t.length&&(e._id={$nin:t}),this.get("component")&&(e.component={$regex:".*"+this.get("component")+".*",$options:"i"}),this.get("resource")&&(e.resource={$regex:".*"+this.get("resource")+".*",$options:"i"}),e.event_type="check",this.get("selectors")&&(e.event_type={$in:["selector","sla"]}),this.get("topologies")&&(e.source_type={$eq:"topo"}),e.resource||e.component||(this.set("events",[]),this.get("topologies")||this.get("selectors"))){var n=o(this,"componentDataStore").findQuery("event",{filter:JSON.stringify(e),limit:10}),i=this;n.then(function(e){console.log("Fetched data from events",e.content),i.set("events",e.content)})}}.observes("component","resource"),setSelector:function(){this.set("topologies",!1),this.findEvents()}.observes("selectors"),setTopologies:function(){this.set("selectors",!1),this.findEvents()}.observes("topologies"),getSelectedRks:function(){var e=[],t=o(this,"labelled"),n=o(this,"selectedEvents");if(!i(n))for(var r=n.length,s=0;s<r;s++)if(t){var a=o(n[s],"label");a=i(a)?"default_"+s:a.trim(),e.push({rk:o(n[s],"id"),label:a})}else e.push(o(n[s],"id"));return e},actions:{saveLabels:function(){n(this,"content",this.getSelectedRks()),n(this,"saveLabelsDone",!0);var e=this;setTimeout(function(){n(e,"saveLabelsDone",!1)},3e3)},add:function(e){console.log("Adding event",e),o(this,"selectedEvents").pushObject(e),o(this,"events").removeObject(e),n(this,"content",this.getSelectedRks()),0===o(this,"events").length&&this.findEvents()},delete:function(e){console.log("Rk to delete",e.id),o(this,"selectedEvents").removeObject(e),this.findEvents(),n(this,"content",this.getSelectedRks())}}});t.register("component:component-eventselector",s)}}),Ember.Application.initializer({name:"component-stateeditor",initialize:function(e,t){var o=Ember.get,n=Ember.set,i=Ember.isNone,r=Ember.Component.extend({previousContent:void 0,content:void 0,init:function(){this._super(),n(this,"previousContent",o(this,"content")),i(o(this,"hidePrevious"))&&n(this,"hidePrevious",!0)},isInfo:function(){return 0===o(this,"content")}.property("content"),isMinor:function(){return 1===o(this,"content")}.property("content"),isMajor:function(){return 2===o(this,"content")}.property("content"),isCritical:function(){return 3===o(this,"content")}.property("content"),previousIs:function(e){return!o(this,"showAll")&&(o(this,"hidePrevious")&&o(this,"previousContent")===e)},previousIsInfo:function(){return this.previousIs(0)}.property("previousContent"),previousIsMinor:function(){return this.previousIs(1)}.property("previousContent"),previousIsMajor:function(){return this.previousIs(2)}.property("previousContent"),previousIsCritical:function(){return this.previousIs(3)}.property("previousContent"),actions:{setState:function(e){n(this,"content",parseInt(e))}}});t.register("component:component-stateeditor",r)}}),Ember.Application.initializer({name:"component-statemapping",initialize:function(e,t){var o=Ember.get,n=Ember.set,i=Ember.isNone,r=Ember.String.loc,s=Ember.Component.extend({placeholder:r("write template"),didInsertElement:function(){var e=o(this,"content"),t=o(this,"initialized");i(t)&&!i(e)&&Ember.setProperties(this,{info:e.info,minor:e.minor,major:e.major,critical:e.critical,initialized:!0})}.observes("content"),updateContent:function(){var e={info:o(this,"info"),minor:o(this,"minor"),major:o(this,"major"),critical:o(this,"critical")};console.log("statemapping",e),n(this,"content",e)}.observes("critical","major","minor","info")});t.register("component:component-statemapping",s)}}),Ember.Application.initializer({name:"AckForm",after:["FormFactory","ModelForm"],initialize:function(e,t){var o=e.lookupFactory("factory:form"),n=e.lookupFactory("form:modelform"),i={subclass:n},r=o("ackform",{init:function(){this._super(),Ember.set(this,"partials.buttons",["formbutton-cancel","formbutton-ack","formbutton-ackandproblem"])}},i);t.register("form:ackform",r),Ember.TEMPLATES.ackform=Ember.TEMPLATES.modelform}}),Ember.Application.initializer({name:"TicketForm",after:["FormFactory","ModelForm"],initialize:function(e,t){var o=e.lookupFactory("factory:form"),n=e.lookupFactory("form:modelform"),i={subclass:n},r=o("ticketform",{init:function(){this._super(),this.set("partials.buttons",["formbutton-cancel","formbutton-incident"])}},i);t.register("form:ticketform",r),Ember.TEMPLATES.ticketform=Ember.TEMPLATES.modelform}}),Ember.Handlebars.helper("criticity",function(e,t){var o=Ember.String.loc;console.log("keep_state",t);var n="";if(void 0===e&&(e=4),t){var i="";switch(e){case 0:i="bg-green";break;case 1:i="bg-yellow";break;case 2:i="bg-orange";break;case 3:i="bg-red"}n='<span class="badge '+i+'"><i class="fa fa-male"></i></span>'}var r;switch(e){case 0:r='<span class="badge bg-green">'+o("Info")+"</span>";break;case 1:r='<span class="badge bg-yellow">'+o("Minor")+"</span>";break;case 2:r='<span class="badge bg-orange">'+o("Major")+"</span>";break;case 3:r='<span class="badge bg-red">'+o("Critical")+"</span>";break;case 4:r='<span class="badge">'+o("Unknown")+"</span>"}return r+n}),Ember.Handlebars.helper("recordcanbeack",function(e){console.debug("in recordcanbeack. record status is",Ember.get(e,"status"));var t=0!==Ember.get(e,"status")&&2!==Ember.get(e,"status");return Ember.set(e,"recordcanbeack",t),""}),Ember.Handlebars.helper("stateview",function(e){var t=Ember.String.loc,o={0:{color:"green",text:"Info"},1:{color:"yellow",text:"Minor"},2:{color:"orange",text:"Major"},3:{color:"red",text:"Critical"}},n=o[e],i='<span class="badge bg-%@">%@</span>'.fmt(n.color,t(n.text));return new Ember.Handlebars.SafeString(i)}),Ember.Application.initializer({name:"StatusViewHelper",after:"DatesUtils",initialize:function(e,t){var o=e.lookupFactory("utility:dates"),n=Ember.get,i=Ember.set,r=Ember.isNone,s=Ember.String.loc;Ember.Handlebars.helper("statusview",function(e,t){var a={0:"Off",1:"On going",2:"Stealthy",3:"Bagot",4:"Cancelled"};if(r(e)&&(e=n(t,"status")),i(t,"statusvalue",s(a[e]||"")),4===e){var c=n(t,"record.cancel");if(console.log("statusview",e,c),!r(c)){var l=n(c,"timestamp"),u=n(c,"comment"),d=n(c,"author");i(t,"statushtml",["<center>","<i>",s("Date"),"</i> : <br/>",o.timestamp2String(l)," <br/> ",s("By")," : ",d," <br/><br/> ","<i>",s("Comment"),"</i> : <br/>",u,"</center>"].join(""))}}return""})}}),Ember.Application.initializer({name:"DowntimeMixin",after:["MixinFactory","FormsUtils","HashUtils"],initialize:function(e,t){var o=e.lookupFactory("factory:mixin"),n=e.lookupFactory("utility:forms"),i=Ember.get,r=Ember.set,s=Ember.isNone,a=o("Downtime",{partials:{selectionToolbarButtons:[],actionToolbarButtons:[],itemactionbuttons:[],header:[],subHeader:[],footer:[]},mixinsOptionsReady:function(){this._super(),i(this,"mixinOptions.downtime.hideRemove")||(i(this,"partials.selectionToolbarButtons").push("actionbutton-removeselection"),i(this,"partials.itemactionbuttons").push("actionbutton-remove")),i(this,"mixinOptions.downtime.hideEdit")||i(this,"partials.itemactionbuttons").push("actionbutton-edit"),i(this,"mixinOptions.downtime.hideCreate")||i(this,"partials.actionToolbarButtons").push("actionbutton-create"),r(this,"itemsPerPagePropositionSelected",i(this,"itemsPerPage"))},userCanReadRecord:function(){if("root"===i(this,"user"))return!0;var e=i(this,"listed_crecord_type");return i(this,"rights."+e+"_read.checksum")}.property("config.listed_crecord_type"),userCanCreateRecord:function(){if("root"===i(this,"user"))return!0;var e=i(this,"listed_crecord_type");return i(this,"rights."+e+"_create.checksum")}.property("config.listed_crecord_type"),userCanUpdateRecord:function(){if("root"===i(this,"user"))return!0;var e=i(this,"listed_crecord_type");return i(this,"rights."+e+"_update.checksum")}.property("config.listed_crecord_type"),userCanDeleteRecord:function(){if("root"===i(this,"user"))return!0;var e=i(this,"listed_crecord_type");return i(this,"rights."+e+"_delete.checksum")}.property("config.listed_crecord_type"),actions:{edit:function(e){console.log("edit",e);var t=i(this,"mixinOptions.downtime.formoptions"),o=i(this,"mixinOptions.downtime.form"),r={title:"Edit "+i(e,"crecord_type")};s(t)||$.extend(r,t),s(o)&&(o="modelform"),console.log("open form:",o,r);var a=this;n.showNew(o,e,r).submit.then(function(t){console.log("record going to be saved",e,t),e=i(t,"formContext"),e.save(),a.trigger("refresh")})}}});t.register("mixin:downtime",a)}}),Ember.Application.initializer({name:"EditurlfieldMixin",after:["FormsUtils","MixinFactory"],initialize:function(e,t){var o=e.lookupFactory("factory:mixin"),n=e.lookupFactory("utility:forms"),i=Ember.get,r=o("editurlfield",{partials:{actionToolbarButtons:["actionbutton-editurlfield"]},actions:{editUrlField:function(){n.editSchemaRecord("linklistfieldsurl",i(this,"container"))}}});t.register("mixin:editurlfield",r)}}),Ember.Application.initializer({name:"EventConsumer",after:["MixinFactory"],initialize:function(e,t){var o=e.lookupFactory("factory:mixin"),n=Ember.get,i=o("eventconsumer",{fetchEvents:function(e){var t=n(this,"widgetDataStore"),o=[],i={},r=this;return e.forEach(function(e){var t=n(e,"rk"),r=n(e,"label");o.push(t),i[t]=r}),t.findQuery("event",{filter:JSON.stringify({_id:{$in:o}})}).then(function(e){r.onEvents(n(e,"content"),i)})},onEvents:function(e,t){}});t.register("mixin:eventconsumer",i)}}),Ember.Application.initializer({name:"EventhistoryMixin",after:["MixinFactory","FormsUtils","HashUtils"],initialize:function(e,t){var o=e.lookupFactory("factory:mixin"),n=o("eventhistory",{partials:{actionToolbarButtons:["actionbutton-eventnavigation"]}});t.register("mixin:eventhistory",n)}}),Ember.Application.initializer({name:"EventnavigationMixin",after:["MixinFactory","FormsUtils","HashUtils"],initialize:function(e,t){var o=e.lookupFactory("factory:mixin"),n=o("eventnavigation",{partials:{actionToolbarButtons:["actionbutton-history"]}});t.register("mixin:eventnavigation",n)}}),Ember.Application.initializer({name:"HistoryMixin",after:"MixinFactory",initialize:function(e,t){var o=e.lookupFactory("factory:mixin"),n=o("history",{historyMixinFindOptions:function(){console.warn("this should be overriden")}.property(),isHistory:function(){return this.get("historyMixinFindOptions")},actions:{history:function(){this.set("historyMixinFindOptions",!this.get("historyMixinFindOptions")),this.findItems()}}});t.register("mixin:history",n)}}),Ember.Application.initializer({name:"InfobuttonMixin",after:"MixinFactory",initialize:function(e,t){var o=e.lookupFactory("factory:mixin"),n=o("infobutton",{partials:{itemactionbuttons:["actionbutton-info"]}});t.register("mixin:infobutton",n)}}),Ember.Application.initializer({name:"MetricConsumer",after:["MixinFactory","SerieController","PerfdataController"],initialize:function(e,t){var o=e.lookupFactory("factory:mixin"),n=e.lookup("controller:serie"),i=e.lookup("controller:perfdata"),r=Ember.get,s=o("metricconsumer",{aggregateMetrics:function(e,t,o,n,s){var a=this;return new Ember.RSVP.Promise(function(c,l){i.aggregateMany(e,t,o,n,s).then(function(e){!0===r(e,"success")?(a.onMetrics(r(e,"data")),c(e)):(console.error("Metric aggregation failed:",r(e,"data")),l(e))},function(){console.error("Metric aggregation request failed:",arguments),l(arguments)})})},fetchMetrics:function(e,t,o){var n=this;return new Ember.RSVP.Promise(function(s,a){i.fetchMany(e,t,o).then(function(e){!0===r(e,"success")?(n.onMetrics(r(e,"data")),s(e)):(console.error("Metrics fetching failed:",r(e,"data")),a(e))},function(){console.error("Metric fetch request failed:",arguments),a(arguments)})})},onMetrics:function(e){},fetchSeries:function(e,t,o){var i=r(this,"widgetDataStore"),s=this,a={filter:JSON.stringify({crecord_name:{$in:e}})};new Ember.RSVP.Promise(function(c,l){i.findQuery("serie",a).then(function(i){if(!0!==r(i,"meta.success"))console.error("Series fetching failed:",r(i,"content")),l(i);else{var a=[];r(i,"content").forEach(function(e){a.push(n.fetch(e,t,o))}),Ember.RSVP.all(a).then(function(t){var o=[];t.forEach(function(t,n){o.push({label:e[n].replace(/ /g,"_"),points:t})}),s.onSeries(o),c(o)},function(){console.error("Series computation failed:",arguments),l(arguments)})}},function(){console.log("Series request failed:",arguments),l(arguments)})})},onSeries:function(e){}});t.register("mixin:metricconsumer",s)}}),Ember.Application.initializer({name:"MetricFilterable",after:["MixinFactory"],initialize:function(e,t){var o=e.lookupFactory("factory:mixin"),n=Ember.get,i=o("metricfilterable",{getMetricFilter:function(){var e=n(this,"metric_filter"),t=e.split(" "),o={component:[],resource:[],name:[]};$.each(t,function(e,t){var n=t.slice(0,3),i={$regex:t.slice(3)};"co:"===n?o.component.push(i):"re:"===n?o.resource.push(i):"me:"===n?o.name.push(i):(i={$regex:t},o.component.push(i),o.resource.push(i),o.name.push(i))});var i={$and:[]};return $.each(o,function(e,t){if(t.length>0){var o={$or:[]};$.each(t,function(t,n){var i={};i[e]=n,o.$or.push(i)}),1===o.$or.length&&(o=o.$or[0]),i.$and.push(o)}}),0===i.$and.length?i={}:1===i.$and.length&&(i=i.$and[0]),i}});t.register("mixin:metricfilterable",i)}}),Ember.Application.initializer({name:"RecordinfopopupMixin",after:"MixinFactory",initialize:function(e,t){var o=e.lookupFactory("factory:mixin"),n=Ember.get,i=o("recordinfopopup",{actions:{sendDisplayRecord:function(e){console.log("sendDisplayRecord action called with params",e);var t=n(this,"mixinOptions.recordinfopopup.popup_template");Ember.isNone(t)&&(t=""),console.log("Template is ",t),n(this,"controllers.recordinfopopup").send("show",e,t)}},rendererFor:function(e){var t=n(this,"mixinOptions.recordinfopopup.clickable_column");return console.log("recordinfopopup rendererFor",e,t),e.field===t?"renderer-recordinfopopup":this._super(e)}});t.register("mixin:recordinfopopup",i)}}),Ember.Application.initializer({name:"SendeventMixin",after:["MixinFactory","FormsUtils","DatesUtils","NotificationUtils"],initialize:function(e,t){var o=e.lookupFactory("factory:mixin"),n=e.lookupFactory("utility:forms"),i=e.lookupFactory("utility:dates"),r=e.lookupFactory("utility:notification"),s=Ember.get,a=Ember.set,c=Ember.isNone,l=Ember.String.loc,u=o("sendevent",{needs:["application"],init:function(){this._super(),a(this,"login",s(this,"controllers.login.record"))},partials:{itemactionbuttons:["actionbutton-ack","actionbutton-cancel","actionbutton-incident","actionbutton-changestate","actionbutton-ticketnumber"],selectionToolbarButtons:["actionbutton-cancelselection","actionbutton-ackselection"]},setPendingOperation:function(e){if(s(this,"controllers.application.frontendConfig.safe_mode"))for(var t=0,o=e.length;t<o;t++)console.log("Pending operations on crecord",e[t]),e[t].set("pendingOperation",!0)},getDataFromRecord:function(e,t,o){console.group("getDataFromRecord"),console.log("get data from record:",e,o);for(var n={authkey:s(this,"login.authkey"),author:s(this,"login._id"),id:s(t,"id"),connector:s(t,"connector"),connector_name:s(t,"connector_name"),event_type:e,source_type:s(t,"source_type"),component:s(t,"component"),state:s(t,"state"),state_type:s(t,"state_type"),crecord_type:e,timestamp:i.getNow()},r=["domain","perimeter","resource"],l=0,u=r.length;l<u;l++){var d=r[l];c(s(t,d))||a(n,d,s(t,d))}return"resource"===n.source_type&&(n.resource=s(t,"resource")),this.processEvent(e,"extract",[n,t,o]),console.groupEnd(),n},submitEvents:function(e,t,o){var n=this,i=this.get("controllers.application.frontendConfig.safe_mode");return console.log("safe_mode",i),new Ember.RSVP.Promise(function(r,a){for(var c=[],l=0;l<e.length;l++){console.log("Event:",s(t,"author"),s(t,"output"));var u=n.getDataFromRecord(o,e[l],t);u.author=s(t,"author"),u.output=s(t,"output"),s(t,"ticket")&&(u.ticket=s(t,"ticket")),c.push(u),i||n.processEvent(o,"transform",[e[l],u])}$.post("/event",{event:JSON.stringify(c)}).then(function(e){Ember.run(function(){t.rollback(),t.unloadRecord(),console.log("safe_mode",i),i?n.refreshContent():n.trigger("refresh"),window.refreshCurrentActiveViewByPass.trigger("refreshCurrentActiveViewByPass"),r(arguments)})})})},getEventForm:function(e,t,o,i){i=i||"modelform";var a=n.showNew(i,t,{title:l("Add event type: ")+e,override_labels:{output:"comment"},onePageDisplay:!0}),c=this,u=function(){c.startRefresh(),t.rollback(),t.unloadRecord()};a.submit.then(function(n){console.log("saveRecord:",t,n),t=s(n,"formContext"),r.info(l("event sent: ")+e),c.submitEvents(o,t,e),-1!==$.inArray("reportIncident",arguments[1])&&c.submitEvents(o,t,"declareticket"),u()},u)},getRoutingKey:function(e){var t=[e.connector,e.connector_name,e.event_type,e.source_type,e.component].join(".");return"resource"===e.source_type&&(t=[e.id,e.resource].join(".")),t},getDisplayRecord:function(e,t){var o=s(this,"widgetDataStore"),n=this.getDataFromRecord(e,t);return o.createRecord(e,n)},filterUsableCrecords:function(e,t){for(var o=[],n=0,i=t.length;n<i;n++){var r=t[n];this.processEvent(e,"filter",[r])&&o.pushObject(r)}return o},event_processors:{ack:{extract:function(e,t,o){e.ref_rk=s(t,"id"),e.state=0,e.state_type=1,e.id=this.getRoutingKey(e),void 0!==o&&(e.ticket=s(o,"ticket"),e.output=s(o,"output"))},filter:function(e){return s(e,"state")&&!s(e,"ack.isAck")&&!s(e,"ack.isCancel")||0===s(e,"state")&&3===s(e,"status")},handle:function(e){var t=this.getDisplayRecord("ack",e[0]);this.getEventForm("ack",t,e,"ackform")},transform:function(e,t){console.log("transform method for ack -> crecords",e,"record",t),e.set("ack",{comment:t.output,timestamp:i.getNow(),author:t.author,isAck:!0}),c(t.ticket)||(e.set("ticket",t.ticket),e.set("ticket_date",i.getNow())),e.set("ack_remove",void 0)}},fastack:{extract:function(e,t,o){e.ref_rk=s(t,"id"),e.state=0,e.state_type=1,e.id=this.getRoutingKey(e),e.ticket="ticket",e.output=s(e,"output")},filter:function(e){return s(e,"state")&&!s(e,"ack.isAck")&&!s(e,"ack.isCancel")||0===s(e,"state")&&3===s(e,"status")},handle:function(e){var t=this.getDisplayRecord("ack",e[0]),o=s(this,"mixinOptions.sendevent.fastackmsg");t.set("output",o),this.submitEvents(e,t,"ack")},transform:function(e,t){console.log("transform method for ack -> crecords",e,"record",t),e.set("ack",{comment:t.output,timestamp:i.getNow(),author:t.author,isAck:!0}),c(t.ticket)||(e.set("ticket",t.ticket),e.set("ticket_date",i.getNow())),e.set("ack_remove",void 0)}},ackremove:{extract:function(e,t,o){c(o)||(e.output=s(o,"output")),e.ref_rk=s(t,"id"),e.state=0,e.state_type=1,e.id=this.getRoutingKey(e)},filter:function(e){return s(e,"ack.author")&&s(e,"ack.isAck")},handle:function(e){var t=this.getDisplayRecord("ackremove",e[0]);this.getEventForm("ackremove",t,e)},transform:function(e,t){console.log("transform method for ack remove",e,t),e.set("ack",void 0),e.set("declare_ticket_author",void 0),e.set("declare_ticket_date",void 0),e.set("ticket_declared_author",void 0),e.set("ticket_declared_date",void 0),e.set("ticket",void 0),e.set("ticket_date",void 0),e.set("ack_remove",Ember.Object.create({comment:t.output,timestamp:i.getNow(),author:t.author}))}},declareticket:{extract:function(e,t,o){e.ref_rk=s(t,"id"),e.state=0,e.state_type=1,e.id=this.getRoutingKey(e),e.output="declare ticket"},filter:function(e){return s(e,"ack.isAck")},handle:function(e){var t=this.getDisplayRecord("declareticket",e[0]);this.getEventForm("declareticket",t,e,"ticketform")},transform:function(e,t){console.log("transform method for declare ticket",e,t),e.set("ticket_declared_author",t.author),e.set("ticket_declared_date",i.getNow())}},assocticket:{extract:function(e,t,o){e.ref_rk=s(t,"id"),e.state=0,e.state_type=1,e.id=this.getRoutingKey(e),void 0===o?e.output=l("Associated ticket number"):(e.output=s(o,"output"),e.ticket=s(o,"ticket"))},filter:function(e){return s(e,"ack.isAck")},
handle:function(e){var t=this.getDisplayRecord("assocticket",e[0]);this.getEventForm("assocticket",t,e)},transform:function(e,t){console.log("transform method for assoticket",e,t),e.set("ticket",t.ticket),e.set("ticket_date",i.getNow())}},cancel:{extract:function(e,t,o){e.ref_rk=s(t,"id"),e.state=0,e.state_type=1,void 0!==o&&(e.output=s(o,"output")),e.cancel=1},filter:function(e){return s(e,"ack.isAck")},handle:function(e){var t=this.getDisplayRecord("cancel",e[0]);this.getEventForm("cancel",t,e)},transform:function(e,t){console.log("transform method for cancel -> crecords",e,"record",t),e.set("ack.isCancel",!0),e.set("ack.isAck",!1),e.set("status",4),e.set("cancel",{comment:t.output,timestamp:i.getNow(),author:t.author,previous_status:t.state})}},recovery:{extract:function(e,t,o){a(t,"state",0)},filter:function(e){return!1},handle:function(e){var t=e[0];this.submitEvents([t],t,"recovery")},transform:function(e,t){}},uncancel:{extract:function(e,t,o){if(e.ref_rk=s(t,"id"),e.state_type=1,e.state=0,e.cancel=0,void 0!==o){var n=s(o,"output");n||(n=" "),e.output=n}},filter:function(e){return s(e,"ack.isCancel")},handle:function(e){var t=this.getDisplayRecord("uncancel",e[0]);this.getEventForm("uncancel",t,e)},transform:function(e,t){console.log("transform method for uncancel -> crecords",e,"record",t),e.set("ack.isCancel",!1),e.set("ack.isAck",!0),e.set("status",e.get("cancel.previous_status")),c(e.get("ack"))?e.set("ack",{comment:t.output,timestamp:i.getNow(),author:t.author,isAck:!0}):e.set("ack",e.get("ack"))}},changestate:{extract:function(e,t,o){c(o)||(e.state=s(o,"state"),e.output=s(o,"output")),e.event_type="check",e.keep_state=!0,e.state_type=1},filter:function(e){return s(e,"state")},handle:function(e){var t=this.getDisplayRecord("changestate",e[0]);this.getEventForm("changestate",t,e)},transform:function(e,t){console.log("transform method for ack changestate",e,t),e.set("state",t.state),0===t.state?e.set("ack",void 0):e.set("cancel",void 0),a(e,"change_state_output",s(t,"output")),a(e,"keep_state",!0)}},user:{extract:function(e,t,o){e.output=s(t,"output"),e.display_name=s(this,"login.firstname")+" "+s(this,"login.lastname")},filter:function(e){return!1},handle:function(e){var t=this.getDisplayRecord("user",e[0]);r.info(l('event "user" sent')),this.submitEvents(e,t,"user")},transform:function(e,t){console.log("transform method for user",e,t)}},comment:{extract:function(e,t,o){e.referer=s(t,"referer"),e.output=s(t,"output"),e.display_name=s(this,"login.firstname")+" "+s(this,"login.lastname")},filter:function(e){return!1},handle:function(e){var t=this.getDisplayRecord("comment",e[0]);r.info(l('event "comment" sent')),this.submitEvents(e,t,"comment")},transform:function(e,t){console.log("transform method for comment",e,t)}}},hasEventProcessorForType:function(e){return void 0!==this.event_processors[e]},processEvent:function(e,t,o){if(this.hasEventProcessorForType(e)){return this.event_processors[e][t].apply(this,o)}},actions:{sendEvent:function(e,t){console.group("sendEvent:",arguments),this.stopRefresh();var o=[];if(c(t)){var n=s(this,"widgetData.content"),i=n.filterBy("isSelected",!0);if(o=this.filterUsableCrecords(e,i),console.log("events:",e,o),!o.length)return void r.warning("No matching event found for event:",e)}else console.log("event:",e,t),o.pushObject(t);this.processEvent(e,"handle",[o]),this.setPendingOperation(o),console.groupEnd()}}});t.register("mixin:sendevent",u)}}),Ember.Application.initializer({name:"MonitoringApplicationRouteReopen",after:"ApplicationRoute",initialize:function(e,t){var o=e.lookupFactory("route:application"),n=Ember.get,i=(Ember.set,o.reopen({buildBeforeModelPromises:function(){var e=n(this,"store"),t=e.find("ticket","cservice.ticket"),o=this.controllerFor("application");return t.then(function(e){o.ticketConfig=e}),n(this,"promiseArray").pushObject(t),this._super()}}));t.register("route:application",i)}}),Ember.Application.initializer({name:"WeatherWidget",after:"WidgetFactory",initialize:function(e,t){var o=e.lookupFactory("factory:widget"),n=Ember.get,i=Ember.set,r=Ember.isNone,s=window.Handlebars,a=o("weather",{needs:["application"],init:function(){this._super(),i(this,"worst_state",void 0),i(this,"sub_weather",[]),console.log("Setting up weather widget : "+n(this,"config.title"))},actions:{goToInfo:function(e){console.log("goToInfo",e);var t=this.transitionToRoute("/userview/"+n(this,"config.destination_view")),o=n(this,"model.filter_pattern");t.promise.then(function(t){console.log("transition done",t);var r=n(t,"controller.content.containerwidget");r=n(r,"_data.items")[0],r=n(r,"widget"),console.log(r),console.log("filter_pattern",o);var a=o,c=e,l=s.compile(a)(c);console.log("compiledFilterPattern",l),""!==l&&(n(r,"volatile")||i(r,"volatile",{}),i(r,"volatile.forced_filter",l),i(r,"rollbackable",!0),i(r,"title","Info on events :",e.title),i(r,"dirtyMessage",e.title))})}},title:function(){return n(this,"config.title")}.property("config.title"),icon:function(){return this.class_icon(n(this,"worst_state"))}.property("worst_state"),class_icon:function(e){return["ion-ios7-sunny-outline","ion-ios7-cloudy-outline","ion-ios7-rainy-outline","ion-ios7-thunderstorm-outline","ion-checkmark-round"][e]},background:function(){return this.class_background(n(this,"worst_state"))}.property("worst_state"),class_background:function(e){return["eventLikeGreen","eventLikeYellow","eventLikeOrange","eventLikeRed","eventLikePurple"][e]},fetchStates:function(){var e=this,t=n(e,"config.event_selection"),o=[];if(console.log("rk information for weather",o),!t||!t.length)return void console.warn("Widget weather "+n(this,"title")+" No rk found, the widget may not be configured properly");for(var r=t.length,s={},a=0;a<r;a++){var c=t[a];s[c.rk]=c.label,o.push(c.rk)}i(e,"rksLabels",s);var l={limit:0,ids:JSON.stringify(o)};$.ajax({url:"/rest/events",data:l,success:function(t){t.success?e.computeWeather(t.data):console.error("Unable to load event information for weather widget from API"),e.trigger("refresh"),console.log(" + Weather content",n(e,"config.event_selection"))}})},computeWeather:function(e){console.group("computing weathers");for(var t=0,o=[],s=0,a=0,c=n(this,"rksLabels"),l=0,u=e.length;l<u;l++){var d=e[l];console.log("subweather event",d);var f=n(d,"ack.isAck"),p=n(d,"ack"),h=n(d,"resource")||"",m=n(d,"event_type"),g=n(d,"component")||"",v=n(d,"id");f?(console.log("one more ack count"),s++,a=4):(console.log("normal ack count"),a=d.state),d.state>t&&(!p||p&&!f)&&(t=d.state),console.log("computedState",a);var b=g;"selector"===b&&(b="");var y=b+" "+h;n(this,"use_labels")&&(y=c[v]||y);var k={rk:v,event_type:m,isSelector:"selector"===m,component:g,resource:h,title:y,custom_class:this.class_background(a),timestamp:n(d,"timestamp"),previous_state_change_ts:n(d,"previous_state_change_ts")};"selector"===m&&this.generateSelectorFilter(d,k),o.pushObject(k)}if(console.log("The data lenght => ",e.length),1===e.length){i(this,"singleEvent",!0);var E=n(e[0],"output");!r(E)&&E.length>150&&(E=E.substr(0,150)+" ..."),i(this,"singleEventOutput",E)}else i(this,"singleEvent",!1);s===e.length&&(t=4),console.log("worst_state",t),console.log("weather content",{sub_weathers:o,worst_state:t}),i(this,"sub_weather",o),i(this,"worst_state",t),console.groupEnd(),this.trigger("refresh")},generateSelectorFilter:function(e,t){console.log("generateSelectorFilter",arguments);var o={limit:1,ids:JSON.stringify(n(e,"selector_id"))};$.ajax({url:"/rest/object",data:o,success:function(e){if(e.data.length>=1){var o={$or:[]},r=e.data[0],s=n(r,"include_ids"),a=n(r,"exclude_ids"),c=n(r,"mfilter");s&&s.length&&o.$or.pushObject({_id:{$in:s}}),a&&a.length&&o.$or.pushObject({_id:{$nin:a}}),c&&o.$or.pushObject(JSON.parse(c)),i(t,"selector_filter",JSON.stringify(o)),console.log("selector filter",o)}}})},refreshContent:function(){this.fetchStates(),this._super()}});t.register("widget:weather",a)}});
//# sourceMappingURL=dist/brick.map.js