Ember.Application.initializer({name:"component-editor",after:"DebugUtils",initialize:function(e,t){var i=e.lookupFactory("utility:debug"),o=Ember.get,r=Ember.set,n=Ember.isNone,a=Ember.Component.extend({tagName:"span",canopsisConfiguration:canopsisConfiguration,debug:Ember.computed.alias("canopsisConfiguration.DEBUG"),content:void 0,init:function(){console.log("init editor compo"),"standalone"===o(this,"mode")&&(r(this,"attr",{value:void 0}),Ember.addObserver(this,"attr.value",this,this.onValueChange)),this._super()},onValueChange:function(){r(this,"value",o(this,"attr.value"))},actions:{inspect:function(){i.inspectObject(o(this,"content"))}},description:function(){return o(this,"content.model.options.description")}.property(),editorType:function(){console.group("editorType");var e=o(this,"editorOverrides"),t=o(this,"content.model.type"),i=o(this,"content.model.options.role"),r=o(this,"content.field");if(console.log("content:",o(this,"content")),console.log("type:",o(this,"content.field")),console.log("type:",t),console.log("role:",i),"tabs"==r)return"editor-nestedarray";var a;return a=n(e)||n(r)||!o(e,r)?i?!n(e)&&o(e,i)?"editor-"+o(e,i):"editor-"+i:!n(e)&&o(e,t)?"editor-"+o(e,t):"editor-"+t:"editor-"+o(e,r),void 0===Ember.TEMPLATES[a]&&(a="editor-defaultpropertyeditor"),console.groupEnd(),a}.property("content.type","content.role"),attr:Ember.computed.alias("content")});t.register("component:component-editor",a)}}),Ember.Application.initializer({name:"component-renderer",after:"DebugUtils",initialize:function(e,t){var i=e.lookupFactory("utility:debug"),o=Ember.get,r=Ember.set,n=Ember.isNone,a=Ember.Component.extend({init:function(){var e=o(this,"record"),t=o(this,"attrName");if(!n(t)){if(console.group("Fetch attribute from record"),console.log("record:",e),console.log("attrName:",t),!n(e)){var i=o(e,"constructor.attributes."+t),a=o(e,t);console.log("attr:",i),console.log("value:",a);var s;if(n(i)||(s=o(i,"options.role")),!n(s)){var l="renderer-"+s;n(Ember.TEMPLATES[l])||(console.log("rendererType:",l),r(this,"rendererType",l))}r(this,"attr",i),r(this,"value",a)}console.groupEnd()}this._super.apply(this,arguments)},canopsisConfiguration:canopsisConfiguration,debug:Ember.computed.alias("canopsisConfiguration.DEBUG"),actions:{inspect:function(){i.inspectObject(this)},do:function(e){for(var t=[],i=1,r=arguments.length;i<r;i++)t.push(arguments[i]);o(this,"parentView.controller").send(e,t)}},tagName:"span",attr:function(){for(var e=o(this,"shown_columns"),t=0,i=e.length;t<i;t++)if(e[t].field===o(this,"field"))return e[t]}.property("shown_columns")});t.register("component:component-renderer",a)}}),Ember.Application.initializer({name:"ApplicationController",after:["PartialslotAbleController","UserprofilestatusmenuMixin","RequirejsmocksmanagerMixin","ScreentoolstatusmenuMixin","DocumentationMixin","SchemamanagerMixin","ConsolemanagerMixin","LoadingindicatorMixin","PromisemanagerMixin","NotificationsMixin","FormsUtils","DataUtils","DebugUtils","HashUtils","NotificationUtils","LoginController","RecordinfopopupController","CrudMixin"],initialize:function(e,t){var i,o=e.lookupFactory("controller:partialslot-able"),r=e.lookupFactory("mixin:userprofilestatusmenu"),n=e.lookupFactory("mixin:requirejsmocksmanager"),a=e.lookupFactory("mixin:screentoolstatusmenu"),s=e.lookupFactory("mixin:documentation"),l=e.lookupFactory("mixin:schemamanager"),c=e.lookupFactory("mixin:consolemanager"),d=e.lookupFactory("mixin:loadingindicator"),u=e.lookupFactory("mixin:promisemanager"),m=e.lookupFactory("mixin:notifications"),p=e.lookupFactory("utility:forms"),g=e.lookupFactory("utility:data"),f=e.lookupFactory("utility:debug"),h=e.lookupFactory("utility:hash"),b=e.lookupFactory("utility:notification"),y=Ember.get,v=Ember.set,w=Ember.isNone,E=Ember.String.loc,x=Ember.isEmpty,k=Ember.Controller.extend(Ember.Evented,{}),F={needs:["login","recordinfopopup"],partials:{statusbar:[]},currentViewModel:void 0,currentViewId:void 0,editMode:!1,runtimeConfiguration:canopsisConfiguration,debug:Ember.computed.alias("runtimeConfiguration.DEBUG"),defaultView:function(){var e=y(this,"controllers.login.record.defaultview"),t=y(this,"controllers.login.role.defaultview"),i=y(this,"frontendConfig.defaultview");return x(e)?x(t)?i:t:e}.property("frontendConfig.defaultview","controllers.login.defaultview"),enginesviews:[{label:E("Context"),value:"view.context"},{label:E("Selectors"),value:"view.selectors"},{label:E("Event Filter"),value:"view.filters"},{label:E("Performance Data"),value:"view.series"},{label:E("Scheduled Jobs"),value:"view.jobs"},{label:E("Notifications"),value:"view.notifications"},{label:E("Link list"),value:"view.linklist"}],init:function(){console.group("app init"),b.setController(this);var e=y(canopsisConfiguration,"TITLE");w(e)||$("title").html(e),console.groupEnd(),this.refreshPartialsList(),this._super.apply(this,arguments),g.setLoggedUserController(y(this,"controllers.login")),console.groupEnd(),console.tags.remove("init")},editAuthConfig:function(e){console.log("edit "+e);var t=y(this,e);if(w(t))this.send("prompt","Unable to load "+e+" configuration. No edition possible.");else{v(t,"crecord_type",e);p.showNew("modelform",t,{title:E("Edit "+e+" configuration")}).submit.done(function(){t.save()})}},didSaveView:function(e){this.transitionToRoute("/userview/"+y(e,"id"))},actions:{inspect:function(e){f.inspectObject(e)},editConfig:function(){var e=y(this,"frontendConfig");console.log("editConfig",p,e),p.showNew("modelform",e,{title:E("Edit settings"),inspectedItemType:"frontend"}).submit.done(function(){e.save()})},editAuthConfiguration:function(e){console.log("edit "+e),this.editAuthConfig(e)},prompt:function(e){p.showNew("confirmform",{},{title:E(e)})},promptReloadApplication:function(e,t){setTimeout(function(){p.showNew("confirmform",{},{title:E(e)}).submit.then(function(e){w(t)?window.location="/index.html":window.location=t})},1500)},editEventSettings:function(){p.editSchemaRecord("statusmanagement",y(this,"container"))},editDataclean:function(){p.editSchemaRecord("datacleaner",y(this,"container"))},editEnabledPlugins:function(){p.editSchemaRecord("enabledmodules",y(this,"container"))},editTicketJob:function(){console.group("editTicketJob");var e=y(this,"ticketConfig");v(e,"crecord_type","ticket"),console.log("ticketConfig:",e);var t=y(e,"job"),i=y(t,"params");console.log("job:",t,i),i&&console.log("param subject",y(i,"subject")),p.showNew("jobform",t,{scheduled:!1}).submit.done(function(t){var i=y(t,"formContext"),o=y(i,"params");v(e,"job",i),v(e,"job.params",o),e.save()}),console.groupEnd()},addNewView:function(){var e="userview",t=this;console.log("add",e);var i=h.generateId("container"),o=h.generateId("userview");g.getStore().createRecord("widgetcontainer",{xtype:"widgetcontainer",mixins:[{name:"verticallayout"}],id:i});var r=y(this,"controllers.login.record._id"),n=g.getStore().push(e,{id:o,crecord_type:"view",author:r,containerwidget:i,containerwidgetType:"widgetcontainer"});o.replace(".","_");console.log("temp record",n),p.showNew("modelform",n,{title:E("Add ")+e}).submit.done(function(){n.save().then(function(){t.didSaveView(n)})})},importView:function(){var e=this;g.uploadTextFilePopup(function(t,i,o,r){r=JSON.parse(r);var n=e.get("store").pushPayload("userview",{userview:r});console.error("done",n,e.get("store").getById("userview",r.id)),e.get("store").getById("userview",r.id).save()})},openTab:function(e){this.transitionToRoute(e)},logout:function(){y(this,"controllers.login").setProperties({authkey:null,errors:[]}),window.location="/logout"}}};i=canopsisConfiguration.DEBUG?o.extend(r,l,u,c,m,d,n,a,s,F):o.extend(r,m,d,s,F),t.register("controller:application",i),t.register("controller:index",k)}}),Ember.Application.initializer({name:"FormController",after:["FormsUtils","DebugUtils"],initialize:function(e,t){var i=e.lookupFactory("utility:forms"),o=e.lookupFactory("utility:debug"),r=Ember.get,n=Ember.set,a=Ember.Controller.extend(Ember.Evented,{mergedProperties:["partials"],_partials:{},refreshPartialsList:function(){console.log("refreshPartialsList",r(this,"partials"));var e=r(this,"partials"),t=r(this,"content.mixins");if(n(this,"_partials",e),Ember.isArray(t))for(var i=0,o=t.length;i<o;i++)e=this.mergeMixinPartials(t[i],e);console.log("set partials for ",this," --\x3e ",e),n(this,"_partials",e)},mergeMixinPartials:function(e,t){if(console.log("mergeMixinPartials mixin:",e),mixinsRegistry.getByName(e.decamelize())){var i=mixinsRegistry.getByName(e.decamelize()).EmberClass.mixins[0].properties.partials;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o],s="_partials."+o;n(this,s,union_arrays(r(this,s),a))}return t}}}),s=a.extend({needs:["application"],init:function(){var e=r(this,"formParent");n(this,"previousForm",e),this._super.apply(this,arguments)},confirmation:!1,submit:$.Deferred(),actions:{previousForm:function(){var e=r(this,"previousForm");console.log("previousForm",e,this),i.showInstance(e)},show:function(){this.submit=$.Deferred()},submit:function(){if(console.log("onsubmit",this.formParent),void 0!==this.formParent)this.formParent.send("submit",arguments);else if(console.log("resolve modelform submit"),this.confirmation){var e=this.formContext;i.showNew("confirmform",e,{title:" confirmation ",newRecord:arguments[0]})}else this.submit.resolve(this,arguments),r(this,"formwrapper").trigger("hide")},abort:function(){void 0!==this.formParent?this.formParent.send("abort",arguments):(console.log("rejecting submit promise"),this.submit.reject())},inspectForm:function(){console.group("inspectForm"),console.log("form:",this),o.inspectObject(r(this,"categorized_attributes")),console.log("categorized_attributes available in $E"),console.groupEnd()}},partials:{buttons:["formbutton-cancel"],debugButtons:["formbutton-inspectform"]},title:function(){return console.warn('Property "title" must be defined on the concrete class.'),"<Untitled form>"}.property()});t.register("controller:form",s)}}),Ember.Application.initializer({name:"FormwrapperController",initialize:function(e,t){var i=Ember.get,o=Ember.Controller.extend(Ember.Evented),r=o.extend({config:canopsisConfiguration,debug:Ember.computed.alias("config.DEBUG"),actions:{show:function(){console.log("FormwrapperController show",this,i(this,"widgetwrapperView")),i(this,"widgetwrapperView").showPopup()}}});t.register("controller:formwrapper",r)}}),Ember.Application.initializer({name:"LoginController",after:"DataUtils",initialize:function(e,t){var i=e.lookupFactory("utility:data"),o=Ember.set,r=Ember.get,n=(Ember.isNone,Ember.ObjectController.extend({content:{},needs:["application"],init:function(){this._super.apply(this,arguments);var e=DS.Store.create({container:r(this,"container")});o(this,"store",e)},authkey:function(){var e=localStorage.cps_authkey;return"undefined"===e&&(e=void 0),e}.property("authkey"),authkeyChanged:function(){localStorage.cps_authkey=r(this,"authkey")}.observes("authkey"),sessionStart:function(){loggedaccountAdapter=i.getEmberApplicationSingleton().__container__.lookup("adapter:loggedaccount"),window.moment.locale(r(this,"record.ui_language")),username=r(this,"record._id"),loggedaccountAdapter.sessionStart(username),setInterval(function(){loggedaccountAdapter.keepAlive(username)},27e4)}}));t.register("controller:login",n)}}),Ember.Application.initializer({name:"PartialslotAbleController",after:"MixinsRegistry",initialize:function(e,t){function i(e,t){void 0===e&&(e=[]),void 0===t&&(t=[]);for(var i={},o=e.length-1;o>=0;--o)i[e[o]]=e[o];for(var r=t.length-1;r>=0;--r)i[t[r]]=t[r];var n=[];for(var a in i)i.hasOwnProperty(a)&&n.push(i[a]);return n}var o=e.lookupFactory("registry:mixins"),r=Ember.get,n=Ember.set,a=Ember.ObjectController.extend({mergedProperties:["partials"],_partials:{},mixinOptions:{},refreshPartialsList:function(){console.log("refreshPartialsList",r(this,"partials"));var e=r(this,"partials");n(this,"_partials",e);var t=r(this,"content.mixins");if(Ember.isArray(t))for(var i=0,o=t.length;i<o;i++){var a=t[i];"string"==typeof a?Ember.deprecate("Defining mixins as strings is deprecated. The new format is : '{ name: \"mixinName\" }'. This is required by the mixin options system."):a=a.name.camelize(),e=this.mergeMixinPartials(a,e)}console.log("set partials for ",this," --\x3e ",e),n(this,"_partials",e)},mergeMixinPartials:function(e,t){var a=e.decamelize(),s=o.getByName(a);if(console.log("mergeMixinPartials mixin:",e),s){var l=s.EmberClass.mixins[0].properties.partials;for(var c in l)if(l.hasOwnProperty(c)){var d=l[c],u="_partials."+c;n(this,u,i(r(this,u),d))}return t}}});t.register("controller:partialslot-able",a)}}),Ember.Application.initializer({name:"PerfdataController",after:["ApplicationController","PojoAdapter","DataUtils"],initialize:function(e,t){var i=(e.lookupFactory("utility:data"),e.lookup("adapter:pojo")),o=e.lookup("controller:application"),r=(Ember.get,Ember.ObjectController.extend({fetch:function(e,t,r){o.addConcurrentLoading("perfdata");var n={metric_id:e,timewindow:JSON.stringify({start:t/1e3,stop:r/1e3,timezone:(new Date).getTimezoneOffset()}),timeserie:JSON.stringify({aggregation:"NONE"})},a=i.createRecord("perfdata",void 0,n);return a.then(function(){o.removeConcurrentLoading("perfdata")},function(){o.removeConcurrentLoading("perfdata")}),a},fetchMany:function(e,t,i){return this.fetch(JSON.stringify(e),t,i)},aggregate:function(e,t,r,n,a){o.addConcurrentLoading("perfdata");var s={metric_id:e,timewindow:JSON.stringify({start:t/1e3,stop:r/1e3,timezone:(new Date).getTimezoneOffset()}),timeserie:JSON.stringify({aggregation:n,period:{second:a}})},l=i.createRecord("perfdata",void 0,s);return l.then(function(){o.removeConcurrentLoading("perfdata")},function(){o.removeConcurrentLoading("perfdata")}),l},aggregateMany:function(e,t,i,o,r){return this.aggregate(JSON.stringify(e),t,i,o,r)}}));t.register("controller:perfdata",r)}}),Ember.Application.initializer({name:"RecordinfopopupController",initialize:function(e,t){var i=(Ember.get,Ember.set),o=Ember.String.loc,r=Ember.Controller.extend(Ember.Evented),n=r.extend({init:function(){i(this,"title",o("Information")),console.log("initializing recordinfopopup controller")},actions:{show:function(e,t){console.log("Show recordinfopopup",e,t);var o;try{o=Handlebars.compile(t)(e[0].toJson())}catch(e){o="<i>An error occured while compiling the template with the record. please if check the template is correct</i>"}i(this,"content",new Ember.Handlebars.SafeString(o));var r=($(window).width()-$("#recordinfopopup").outerWidth())/2;$("#recordinfopopup").css("left",r),$("#recordinfopopup").fadeIn(500)},hide:function(){console.log("hiding recordinfopopup"),$("#recordinfopopup").fadeOut(500)}}});t.register("controller:recordinfopopup",n)}}),Ember.Application.initializer({name:"SerieController",after:"HashUtils",initialize:function(e,t){var i=e.lookupFactory("utility:hash"),o=window.math,r=Ember.get,n=Ember.set,a=Ember.ObjectController.extend({needs:["perfdata"],perfdata:Ember.computed.alias("controllers.perfdata"),fetch:function(e,t,a){if(r(e,"metrics.length")>1&&"none"===r(e,"aggregate_method")&&(console.group("More than one metric in serie, performing an aggregation"),console.log("serie:",e),console.log("aggregation: average - 60s"),n(e,"aggregate_method","average"),n(e,"aggregate_interval",60),console.groupEnd()),"none"===r(e,"aggregate_method"))var s=r(this,"perfdata").fetchMany(r(e,"metrics"),t,a);else var s=r(this,"perfdata").aggregateMany(r(e,"metrics"),t,a,r(e,"aggregate_method"),r(e,"aggregate_interval"));var l=r(e,"formula");return s.then(function(e){console.group("Computing serie:",l);var t,r=e.total,n=e.data,a={},s=!1;for(t=0;t<r;t++){var c=n[t],d=c.meta.data_id,u="metric_"+i.md5(d),m="/"+d.split("/").slice(4).join("/");l=l.replaceAll(m,u),console.log("metric:",m,u),a[u]=c.points,(!s||c.points.length<s)&&(s=c.points.length)}console.log("formula:",l),console.log("points:",a);var p=Object.keys(a),g=[];for(t=0;t<s;t++){var f,h,b={},y=0;for(f=0,h=p.length;f<h;f++){var u=p[f];b[u]=a[u][t][1],y=a[u][t][0]}o.import(b);var v=o.eval(l);for(f=0,h=p.length;f<h;f++){var u=p[f];delete o[u]}g.push([1e3*y,v])}return console.log("finalserie:",g),console.groupEnd(),g})}});t.register("controller:serie",a)}}),Ember.Application.initializer({name:"UserviewController",after:["FormsUtils","HashUtils","InspectableItemMixin"],initialize:function(e,t){function i(e){for(var t in e){var o=e[t];"id"!==t&&"_id"!==t&&"widgetId"!==t&&"preference_id"!==t||delete e[t],"object"==typeof o&&i(o)}return null!==e&&void 0!==e&&(e.id=r.generateId(e.xtype||e.crecord_type||"item"),e._id=e.id),e}var o=e.lookupFactory("utility:forms"),r=e.lookupFactory("utility:hash"),n=(window.schemasRegistry,e.lookupFactory("mixin:inspectable-item")),a=Ember.get,s=Ember.set,l=Ember.isNone,c=(Ember.String.loc,Ember.ObjectController.extend(n,Ember.Evented,{needs:["application"],actions:{insertWidget:function(e){console.log("insertWidget",e);var t=o.showNew("widgetform",this),i=this;t.submit.done(function(t,o){var r=o[0];console.log("onsubmit, adding widgetwrapper to containerwidget",r,e),console.log("containerwidget items",a(e,"model.items.content")),a(e,"model.items.content").pushObject(r),console.log("saving view"),a(i,"model").save()}),t.submit.fail(function(){console.info("Widget insertion canceled")})},duplicateWidgetAndContent:function(e,t){copyWidget(this,e,t),this.get("model").save()},refreshView:function(){console.log("refresh view"),this.trigger("refreshView")}}}));copyWidget=function(e,t,o){var r=i(t.toJSON());r.widget=null;var n=e.store.createRecord("widgetwrapper",r),c=i(t.get("widget").toJSON()),d=Ember.copy(a(c,"mixins"));s(d,"id",""),s(d,"_id","");var u=e.store.createRecord(c.xtype,c);if(!l(t.get("widget.items")))for(var m=t.get("widget.items.content"),p=0;p<m.length;p++){var g=m[p];copyWidget(e,g,u)}n.set("widget",u),o.get("items.content").pushObject(n)},t.register("controller:userview",c)}}),Ember.Application.initializer({name:"WidgetController",after:["PartialslotAbleController","WidgetsUtils","RoutesUtils","FormsUtils","DebugUtils","DataUtils","HashUtils","WidgetsRegistry"],initialize:function(e,t){var i=e.lookupFactory("controller:partialslot-able"),o=e.lookupFactory("utility:widgets"),r=e.lookupFactory("utility:routes"),n=e.lookupFactory("utility:forms"),a=e.lookupFactory("utility:debug"),s=e.lookupFactory("utility:data"),l=e.lookupFactory("utility:hash"),c=window.schemasRegistry,d=e.lookupFactory("registry:widgets"),u=Ember.get,m=Ember.set,p=Ember.isNone,g=i.extend({needs:["application","login"],partials:{titlebarsbuttons:["titlebarbutton-duplicate","titlebarbutton-moveup","titlebarbutton-movedown","titlebarbutton-widgeterrors"]},abstractType:"widget",canopsisConfiguration:canopsisConfiguration,debug:Ember.computed.alias("canopsisConfiguration.DEBUG"),editMode:Ember.computed.alias("controllers.application.editMode"),config:Ember.computed.alias("content"),init:function(){m(this,"userParams",{}),console.log("widget init");var e=u(o.getParentViewForWidget(this),"content.id"),t=r.getCurrentRouteController().container,i=DS.Store.create({container:t});console.debug("View id for current widget is ",e),this.setProperties({"model.controllerInstance":this,viewId:e,viewController:o.getParentViewForWidget(this),isOnMainView:u(o.getParentViewForWidget(this),"isMainView"),container:t,widgetDataStore:i}),p(this.loadUserConfiguration)||this.loadUserConfiguration(),this._super(),console.debug("user configuration loaded for widget "+u(this,"title")),this.refreshContent()},mixinsOptionsReady:function(){},addMixinView:function(e){var t=u(this,"viewMixins");p(t)&&(t=[],m(this,"viewMixins",t)),t.push(e)},updateInterval:function(e){console.warn("This method should be overriden for current widget",u(this,"id"),e)},stopRefresh:function(){m(this,"isRefreshable",!1)},startRefresh:function(){this.setProperties({isRefreshable:!0,lastRefresh:null})},isRollbackable:function(){return!(!u(this,"isDirty")||"updated"!==u(this,"dirtyType")||!0!==u(this,"rollbackable"))}.property("isDirty","dirtyType","rollbackable"),actions:{inspect:function(e){a.inspectObject(e)},do:function(e){for(var t=[],i=1,o=arguments.length;i<o;i++)t.push(arguments[i]);this.send(e,t)},creationForm:function(e){n.addRecord(e)},rollback:function(e){console.log("rollback changes",arguments),m(e,"volatile",{}),e.rollback(),m(e,"rollbackable",!1)},editWidget:function(e){console.info("edit widget",e);var t=u(e,"title")||"",i=u(e,"xtype")||"",o=n.showNew("modelform",e,{title:__("Edit widget")+" "+i+" "+t});console.log("widgetWizard",o);var r=this;o.submit.done(function(){console.log("record going to be saved",e),u(e,"widgetId")||m(e,"widgetId",u(e,"id"));var t=u(e,"controller.viewController").get("content");t.save().then(function(){u(r,"viewController").send("refresh"),console.log("triggering refresh",t)})})},editMixin:function(e,t){console.info("edit mixin",e,t);var i=u(e,"mixins").findBy("name",t);Ember.isNone(i)||(i.id=l.generateId("mixin"));var o=s.getStore().createRecord(t,i),r=n.showNew("modelform",o,{title:__("Edit mixin"),inspectedItemType:t}),a=u(e,"mixins").findBy("name",t);p(a)&&(a=u(e,"mixins").pushObject({name:t})),console.log("mixinObject",a);var d=this;r.submit.done(function(){var e=c.getByName(t).EmberModel,i=u(e,"attributes");console.log("attributes",i),i.forEach(function(e){console.log("each",arguments);var t=u(o,e.name);console.log("mixinObject",a),m(a,e.name,t);var i=u(d,"viewController").get("content");i.save().then(function(){u(d,"viewController").send("refresh"),console.log("triggering refresh",i)})})})},removeWidget:function(e){var t=this;n.showNew("confirmform",{},{title:__("Delete this widget ?")}).submit.then(function(i){console.group("remove widget",e),console.log("parent container",t);for(var o=u(t,"content.items.content"),r=0,n=o.length;r<n;r++)if(console.log(u(t,"content.items.content")[r]),u(o[r],"widget")===e){o.removeAt(r),console.log("deleteRecord ok");break}u(t,"viewController.content").save(),console.groupEnd()})},movedown:function(e){console.group("movedown",e);try{console.log("context",this);for(var t,i,o=u(this,"content.items.content"),r=0,n=o.length;r<n;r++)void 0!==t&&void 0===i&&(i=r,console.log("next element found")),o[r]===e&&(t=r,console.log("searched element found"));if(void 0!==t&&void 0!==i){var a=o;console.log("swap objects",a);var s=a.objectAt(t);a.insertAt(t,a.objectAt(i)),a.insertAt(i,s),a.replace(t+2,2),console.log("new array",a),m(this,"content.items.content",a);u(this,"viewController.content").save()}}catch(e){console.error(e.stack,e.message)}console.groupEnd()},moveup:function(e){console.group("moveup",e);try{console.log("context",this);for(var t,i,r=u(this,"content.items.content"),n=r.length;n>=0;n--)void 0!==t&&void 0===i&&(i=n,console.log("next element found")),r[n]===e&&(t=n,console.log("searched element found"));if(console.log("indexes to swap",t,i),void 0!==t&&void 0!==i){var a=u(this,"content.items.content");console.log("swap objects",a);var s=a.objectAt(t);a.insertAt(t,a.objectAt(i)),a.insertAt(i,s),a.replace(i+2,2),console.log("new array",a),m(this,"content.items.content",a);u(o.getParentViewForWidget(this),"content").save()}}catch(e){console.error(e.stack,e.message)}console.groupEnd()}},itemController:function(){if(u(this,"itemType"))return u(this,"itemType").capitalize()}.property("itemType"),refreshContent:function(){console.log("refreshContent",u(this,"xtype")),this._super(),this.findItems(),this.setProperties({lastRefresh:(new Date).getTime(),lastRefreshControlDelay:!0})},findItems:function(){console.warn("findItems not implemented",this)},extractItems:function(e){console.log("extractItems",e),this._super(e),m(this,"widgetData",e)},availableTitlebarButtons:function(){var e=u(this,"_partials.titlebarsbuttons");if(void 0===e)return Ember.A();for(var t=Ember.A(),i=0,o=e.length;i<o;i++){var r=e[i];void 0!==Ember.TEMPLATES[r]?t.pushObject(r):console.warn("template not found",r)}return t}.property()});t.reopen({register:function(e,t){if("widget"===e.split(":")[0]){var i=e.split(":")[1],o=i.capitalize()+"Serializer",r=e.split(":")[1];c.getByName(r);var n=c.getByName(r).EmberModel;if(Ember.Application.initializer({name:o,after:"WidgetSerializer",initialize:function(e,t){var i=e.lookupFactory("serializer:widget");t.register("serializer:"+r,i.extend())}}),p(n))notificationUtils.error("No model found for the widget "+i+". There might be no schema concerning this widget on the database");else{var a=(i.camelize().capitalize(),n.proto().metadata),s=Ember.Object.create({name:i,EmberClass:t});if(!p(a)&&(a.icon&&s.set("icon",a.icon),a.classes))for(var l=a.classes,g=0,f=l.length;g<f;g++){var h=l[g];Ember.isArray(u(d.byClass,h))||m(d.byClass,h,Ember.A()),u(d.byClass,h).pushObject(s)}d.all.pushObject(s)}}return this._super.apply(this,arguments)}}),t.register("controller:widget",g)}}),Ember.Application.initializer({name:"ConfirmForm",after:["FormFactory"],initialize:function(e,t){var i=e.lookupFactory("factory:form"),o={},r=i("confirmform",{partials:{buttons:["formbutton-cancel","formbutton-submit"]},confirmation:!1,actions:{submit:function(){console.log("confirmed !"),this._super()}}},o);t.register("form:confirmform",r)}}),Ember.Application.initializer({name:"ModelForm",after:["FormFactory","InspectableItemMixin","ValidationMixin","SlugUtils"],initialize:function(e,t){var i=e.lookupFactory("factory:form"),o=window.schemasRegistry,r=e.lookupFactory("mixin:inspectable-item"),n=e.lookupFactory("mixin:validation"),a=e.lookupFactory("utility:slug"),s=Ember.set,l=Ember.get,c=Ember.isNone,d={mixins:[r,n]},u=i("modelform",{needs:["application"],partials:{debugButtons:["formbutton-inspectform"]},validationFields:Ember.computed(function(){return Ember.A()}),ArrayFields:Ember.A(),init:function(){this._super(),this.set("partials.buttons",["formbutton-submit"])},filterUserPreferenceCategory:function(e,t){var i=l(e,"keys");s(e,"keys",[]);for(var o=0,r=i.length;o<r;o++)console.log("key",i[o]),this.get("userPreferencesOnly")?i[o].model&&i[o].model.options&&i[o].model.options.isUserPreference&&l(e,"keys").push(i[o]):t[i[o].field]&&(console.log("magic keys",i[o]),t[i[o].field].readOnly&&(i[o].model.options.readOnly=!0),l(e,"keys").push(i[o]));return e},categories:function(){var e=l(this,"categorized_attributes"),t=[];if(e instanceof Array){for(var i=0,o=e.length;i<o;i++){var r=e[i];r.slug=a.slug(r.title),console.log("current category",r),l(this,"filterFieldByKey")||l(this,"userPreferencesOnly")?(this.filterUserPreferenceCategory(r,l(this,"filterFieldByKey")),r.keys.length&&t.push(e[i]),console.log("category"),console.log(r)):t.push(e[i])}return t.length&&s(t[0],"isDefault",!0),t}return[]}.property("categorized_attributes"),onePageDisplay:function(){return!1}.property(),inspectedDataItem:function(){return l(this,"formContext")}.property("formContext"),inspectedItemType:function(){return console.log("recompute inspectedItemType",l(this,"formContext")),l(this,"formContext.xtype")?l(this,"formContext.xtype"):"user"===l(this,"formContext.crecord_type")?"account":l(this,"formContext.crecord_type")||l(this,"formContext.connector_type")}.property("formContext"),actions:{submit:function(){if(void 0===this.validation||this.validation()){console.log("submit action",arguments);var e={};if(this.isOnCreate&&this.modelname){var t=this.modelname.charAt(0).toUpperCase()+this.modelname.slice(1),i=o.getByName(t);if(i)for(var r in i)if(i.hasOwnProperty(r)){var n=i[r];if(n&&n._meta&&n._meta.options){var a=n._meta.options;if("setOnCreate"in a){var d=a.setOnCreate;s(this,"formContext."+r,d)}}}}var u=l(this,"options");if(u&&u.override_labels)for(var m in u.override_labels)u.override_labels.hasOwnProperty(m)&&(e[u.override_labels[m]]=m);var p=l(this,"categorized_attributes");console.log("setting fields");for(var g=0,f=p.length;g<f;g++)for(var h=p[g],b=0,y=h.keys.length;b<y;b++){var v=h.keys[b],w=v.field;if(e[v.field]&&(w=e[v.field]),"mixins"===v.field){var E=[];if(!c(v.value))for(var x=0;x<v.value.length;x++){for(var k=Ember.keys(v.value[x]),F={},C=0;C<k.length;C++)F[k[C]]=v.value[x][k[C]];window.$M=F,E.push(F)}Ember.set(v,"value",E)}s(this,"formContext."+w,v.value)}console.log("this is a widget",l(this,"formContext"));var z=[l(this,"formContext")];z.addObjects(arguments),this._super.apply(this,z)}}}},d);t.register("form:modelform",u)}}),Ember.Application.initializer({name:"WidgetForm",after:["FormFactory","WidgetsRegistry","FormsUtils","HashUtils"],initialize:function(e,t){var i=e.lookupFactory("factory:form"),o=e.lookupFactory("registry:widgets"),r=e.lookupFactory("utility:forms"),n=e.lookupFactory("utility:hash"),a=Ember.get,s=(Ember.set,i("widgetform",{needs:["application"],title:"Select a widget",widgets:o,availableWidgets:function(){console.log("availableWidgets");for(var e=[],t=0,i=e.all.length;t<i;t++){var o=e.all[t];e.pushObject(o)}return e}.property("widgets.all","title"),actions:{submit:function(e){var t=e[0];console.log("onWidgetChooserSubmit",arguments),console.group("attach new widget to widgetwrapper"),console.log("newWidget",t),console.log("widgetwrapper",this.newWidgetWrapper),console.groupEnd(),this._super(this.newWidgetWrapper)},selectItem:function(e){console.log("selectItem",arguments);var t=a(this,"formContext.containerwidget");console.group("selectWidget",this,t,e);var i=a(this,"formContext.containerwidget").store;console.log("store to use",a(this,"formContext.containerwidget").store);var o=n.generateId("widget_"+e),s=i.createRecord(e,{xtype:e,listed_crecord_type:"account",meta:{embeddedRecord:!0,parentType:"widgetwrapper"},id:o});this.newWidgetWrapper=i.push("widgetwrapper",{id:n.generateId("widgetwrapper"),xtype:"widgetwrapper",title:"wrapper",widget:s,meta:{embeddedRecord:!0,parentType:a(t,"xtype"),parentId:a(t,"id")}}),console.log("newWidgetWrapper",this.newWidgetWrapper),console.log("newWidget",s),console.log("formwrapper",a(this,"formwrapper")),console.info("show embedded widget wizard"),r.showNew("modelform",s,{formParent:this,title:"Add new "+e}),console.groupEnd()}},partials:{buttons:[]},parentContainerWidget:Ember.required(),parentUserview:Ember.required()}));t.register("form:widgetform",s)}}),Ember.Application.initializer({name:"AbstractClassRegistry",initialize:function(e,t){var i=Ember.get,o=Ember.set,r=Ember.isNone;isArray=Ember.isArray;var n=Ember.Object.extend({name:"unnamed registry",all:[],byClass:{},tableColumns:[{title:"name",name:"name"}],add:function(e,t,n){if(r(t)?t=i(e,"name"):o(e,"name",t),r(n)?n=i(e,"classes"):o(e,"classes",n),console.log("registering item",i(e,"name"),"into registry",t,"with classes",n),this.all.pushObject(e),isArray(n))for(var a=0,s=n.length;a<s;a++)r(this.byClass[n[a]])&&(this.byClass[n[a]]=Ember.A()),this.byClass[n[a]].pushObject(e)},getByName:function(e){for(var t=0,o=this.all.length;t<o;t++)if(i(this.all[t],"name")===e)return this.all[t]},getByClassName:function(e){return i(this.byClass,e)}});t.register("registry:abstractclass",n)}}),Ember.Application.initializer({name:"ActionsRegistry",after:"AbstractClassRegistry",initialize:function(e,t){var i=e.lookupFactory("registry:abstractclass"),o=i.create({name:"actions",all:[{name:"gotoEventView",actionData:["showView","view.event"]},{name:"toggleEditMode",actionData:["toggleEditMode"]},{name:"promptReloadApplication",actionData:["promptReloadApplication"]},{name:"showUserProfile",actionData:["showUserProfile"]},{name:"editConfig",actionData:["editConfig"]},{name:"addNewView",actionData:["addNewView"]},{name:"logout",actionData:["logout"]},{name:"refresh",actionData:["refresh"]},{name:"toggleFullscreen",actionData:["toggleFullscreen"]},{name:"toggleDevTools",actionData:["toggleDevTools"]}],byClass:{},tableColumns:[{title:"name",name:"name"}]});t.register("registry:actions",o)}}),Ember.Application.initializer({name:"ContextRegistry",after:"AbstractClassRegistry",initialize:function(e,t){for(var i=e.lookupFactory("registry:abstractclass"),o=[{name:"component",modelName:"ctxcomponent"},{name:"resource",modelName:"ctxresource"},{name:"selector",
modelName:"ctxselector"},{name:"topology",modelName:"ctxtopology"}],r=i.create({name:"contexts",all:[],byClass:{},tableColumns:[{title:"name",name:"name"},{title:"modelName",name:"modelName"}]}),n=0,a=o.length;n<a;n++)r.all.pushObject({name:o[n].name,modelName:o[n].modelName});t.register("registry:context",r)}}),Ember.Application.initializer({name:"EditorsRegistry",after:"AbstractClassRegistry",initialize:function(e,t){var i=e.lookupFactory("registry:abstractclass"),o=i.create({name:"editors",all:[],byClass:{},tableColumns:[{title:"name",name:"name"}]});t.register("registry:editors",o)}}),Ember.Application.initializer({name:"FormFactory",after:"FormController",initialize:function(e,t){function i(e,t,i){console.tags.add("factory"),console.group("form factory call",arguments);var n=[];if(void 0===i&&(i={}),void 0===i.subclass&&(i.subclass=o),void 0!==i.mixins)for(var a=0,s=i.mixins.length;a<s;a++)n.push(i.mixins[a]);r(t,"formName",e),n.push(t),Ember.assert("formName must be a string","string"==typeof e);var l=e.dasherize();e.dasherize();console.log("extendArguments",n),console.log("subclass",i.subclass);var c=i.subclass.extend.apply(i.subclass,n),d=l.capitalize()+"Controller";return Ember.Application.initializer({name:d,after:"FormsRegistry",initialize:function(t,i){t.lookupFactory("registry:forms").all[e]={EmberClass:c},i.register("controller:"+l,c)}}),console.groupEnd(),console.tags.remove("factory"),c}var o=e.lookupFactory("controller:form"),r=(Ember.get,Ember.set);t.register("factory:form",i)}}),Ember.Application.initializer({name:"MixinFactory",after:"MixinsRegistry",initialize:function(e,t){function i(e,t){console.tags.add("factory"),console.group("mixin factory call",arguments);var i=(e.camelize().capitalize(),Ember.Mixin.create(t)),r=Ember.Object.create({name:e,EmberClass:i});return o.add(r,e),console.groupEnd(),console.tags.remove("factory"),i}var o=(Ember.get,Ember.set,Ember.isNone,e.lookupFactory("registry:mixins"));t.register("factory:mixin",i)}}),Ember.Application.initializer({name:"WidgetFactory",after:["WidgetsRegistry","WidgetController","NotificationUtils","SchemasLoader"],initialize:function(e,t){function i(e,t,i){var r=[];if(void 0===i&&(i={}),void 0===i.subclass&&(i.subclass=o),void 0!==i.mixins)for(var n=0,a=i.mixins.length;n<a;n++)r.push(i.mixins[n]);return r.push(t),o.extend.apply(o,r)}var o=(e.lookupFactory("registry:widgets"),window.schemasRegistry,e.lookupFactory("controller:widget"));e.lookupFactory("utility:notification"),Ember.get,Ember.set,Ember.isNone;t.register("factory:widget",i)}}),Ember.Application.initializer({name:"FormsRegistry",after:"AbstractClassRegistry",initialize:function(e,t){var i=e.lookupFactory("registry:abstractclass"),o=i.create({name:"forms",formwrapper:void 0,tableColumns:[{title:"name",name:"name"}]});t.register("registry:forms",o)}}),function(){Ember.Handlebars.registerHelper("eachIndexed",function(e,t){function i(){var e=arguments[1].data.keywords,t=arguments[1].data.view,i=t.contentIndex,r=t._parentView.get("content")||[],n=r.length;return e.index=i,e.index_1=i+1,e.first=0===i,e.last=i+1===n,e.even=i%2==0,e.odd=!e.even,arguments[1].data.keywords=e,o.apply(this,arguments)}var o,r="item";if(4===arguments.length&&(Ember.assert("If you pass more than one argument to the eachIndexed helper, it must be in the form #eachIndexed foo in bar","in"===arguments[1]),Ember.assert(arguments[0]+" is a reserved word in #eachIndexed",$.inArray(arguments[0],["index","index+1","even","odd"])),r=arguments[0],t=arguments[3],e=arguments[2],t.hash.keyword=r,""===e&&(e="this")),1===arguments.length&&(t=e,e="this"),o=t.fn,t.fn=i,t.hash.dataSourceBinding=e,!t.data.insideGroup||t.hash.groupedRows||t.hash.itemViewClass)return Ember.Handlebars.helpers.collection.call(this,"Ember.Handlebars.EachView",t);new Ember.Handlebars.GroupedEach(this,e,t).render()})}(),Ember.Handlebars.helper("formview",Ember.View),function(){var e=Ember.get;Ember.Handlebars.helper("getfield",function(t,i){var o=e(t,i)||"";return new Ember.Handlebars.SafeString(o)})}(),function(){Ember.Handlebars.helper("tr",function(e){var t;if(e)return t=Ember.String.loc(e),console.log("translating",e,"into",t),t})}(),function(){var e=Ember.get,t=Ember.isNone;Ember.Handlebars.registerBoundHelper("clog",function(i,o){console.tags.add("helper");var r=e(this,"model.type.typeKey");t(r)||console.tags.add(r);var n=e(o,"hash.level");return t(n)&&(n="log"),console[n](i),console.tags.remove("helper"),t(r)||console.tags.remove(r),""})}(),Ember.Handlebars.registerBoundHelper("renderWidget",function(e,t,i){return Ember.Handlebars.helpers.render.call(e,t.get("widget_type"),"widget",i)}),Ember.Application.initializer({name:"IndexesRegistry",after:"AbstractClassRegistry",initialize:function(e,t){var i=e.lookupFactory("registry:abstractclass"),o=i.create({name:"indexes"});o.add(Ember.Object.create({name:"event",tree:{component:{_metas:{name:"Component"},resource:{_metas:{name:"Resource",final:!0}}},connector:{_metas:{name:"connector"},component:{_metas:{name:"Component"},resource:{_metas:{name:"Resource",final:!0}}}}}})),o.add(Ember.Object.create({name:"crecord",tree:{crecord_type:{_metas:{name:"Crecord type"},crecord_name:{_metas:{name:"Crecord name",final:!0}}}}})),t.register("registry:indexes",o)}}),Ember.Application.initializer({name:"InflexionsRegistry",after:"AbstractClassRegistry",initialize:function(e,t){var i=e.lookupFactory("registry:abstractclass"),o=[["nagios","nagios"],["tcp2canopsis","tcp2canopsis"],["curve","curves"],["serie","serie"],["enabledmodules","enabledmodules"],["calendardata","calendardata"],["eventcategories","eventcategories"]],r=i.create({name:"InflectionsRegistry",all:[],byClass:{},tableColumns:[{title:"name",name:"name"},{title:"Singular",name:"singular"},{title:"Plural",name:"plural"}],loadInflections:function(){for(var e=0,t=o.length;e<t;e++)r.all.pushObject({name:o[e][0]+" -> "+o[e][1],singular:o[e][0],plural:o[e][1]}),Ember.Inflector.inflector.irregular(o[e][0],o[e][1])}});t.register("registry:inflexions",r)}}),Ember.Application.initializer({name:"MixinsRegistry",after:"AbstractClassRegistry",initialize:function(e,t){var i=e.lookupFactory("registry:abstractclass"),o=i.extend({add:function(e,t,i){var o=window.schemasRegistry.getByName(t);return o&&o.modelDict&&o.modelDict.metadata&&o.modelDict.metadata.description&&(e.description=o.modelDict.metadata.description),this._super(e,t,i)}}),r=o.create({name:"mixins",all:[],byClass:{},tableColumns:[{title:"name",name:"name"}]});t.register("registry:mixins",r)}}),Ember.Application.initializer({name:"PromisesRegistry",after:"AbstractClassRegistry",initialize:function(e,t){var i=e.lookupFactory("registry:abstractclass"),o=Ember.get,r=Ember.set,n=i.create({name:"promises",all:[],pending:Ember.A(),errors:Ember.A(),pendingCount:0,errorsCount:0,byClass:{},handlePromise:function(e){var t=this;t.all.pushObject(e),t.pending.pushObject(e),r(t,"pendingCount",t.pendingCount+1)},promiseSuccess:function(e){console.info("promise success",e)},promiseFail:function(e){if(void 0!==e._detail&&200===e._detail.status)console.warn("promise failed with error code 200, assuming it's a success"),this.promiseSuccess(e);else{console.error("promise failed",e,(new Error).stack);var t=this;console.error("promise failed",e),o(t,"errors").pushObject(e),r(t,"errorsCount",t.errorsCount+1)}},promiseFinally:function(e){var t=this;Ember.run.schedule("sync",this,function(){console.log("finally"),o(t,"pending").removeObject(e),r(t,"pendingCount",t.pendingCount-1)})}});t.register("registry:promises",n)}}),Ember.Application.initializer({name:"RenderersRegistry",after:"AbstractClassRegistry",initialize:function(e,t){var i=e.lookupFactory("registry:abstractclass"),o=i.create({name:"renderers",all:[],byClass:{},tableColumns:[{title:"name",name:"name"}]});t.register("registry:renderers",o)}}),Ember.Application.initializer({name:"MocksRegistry",after:"FormsUtils",initialize:function(e,t){var i=e.lookupFactory("utility:forms"),o=Ember.set,r=Ember.Object.extend({init:function(){this._super(),this.feedMocks()},feedMocks:function(){var e=localStorage.getItem("files_mocks"),t=Ember.A();try{if(e=JSON.parse(e))for(var i in e)e[i].modulePath=i,t.push(e[i])}catch(e){console.error("Impossible to parse mocks JSON.")}o(this,"mocks",t)},editMock:function(e){var t=this;i.showNew("modelform",e,{title:__("Edit mock")+" "+e.modulePath,inspectedItemType:"requirejsmock"}).submit.then(function(i){var o=localStorage.getItem("files_mocks");try{o=JSON.parse(o);var r=e.modulePath;delete e.modulePath,e.module=e.module,o[r]=e,localStorage.setItem("files_mocks",JSON.stringify(o))}catch(e){console.error("Impossible to parse mocks JSON.")}t.feedMocks()})},addMock:function(){var e=this,t={modulePath:"",module:"",requirements:[]};i.showNew("modelform",t,{title:__("Add mock"),inspectedItemType:"requirejsmock"}).submit.then(function(i){var o=localStorage.getItem("files_mocks");try{o=JSON.parse(o);var r=t.modulePath;delete t.modulePath,t.module=t.module,o[r]=t,localStorage.setItem("files_mocks",JSON.stringify(o))}catch(e){console.error("Impossible to parse mocks JSON.")}e.feedMocks()})},deleteMock:function(e){var t=localStorage.getItem("files_mocks");try{t=JSON.parse(t),delete t[e],localStorage.setItem("files_mocks",JSON.stringify(t))}catch(e){console.error("Impossible to parse mocks JSON.")}this.feedMocks()}}),n=r.create();t.register("registry:mocks",n)}}),Ember.Application.initializer({name:"SearchmethodsRegistry",after:"AbstractClassRegistry",initialize:function(e,t){for(var i=e.lookupFactory("registry:abstractclass"),o=[{name:"simple",filter:function(e,t){var i=(t.propertyToCheck,t.searchCriterion),o=e.filter(function(e,t,o){return e.name.slice(0,i.length)==i});return console.log("##",o),o}}],r=i.create({name:"searchMethods",all:[],byClass:{},tableColumns:[{title:"name",name:"name"}]}),n=0,a=o.length;n<a;n++)r.all.pushObject(o[n]);t.register("registry:searchmethods",r)}}),Ember.Application.initializer({name:"TemplatesRegistry",after:"AbstractClassRegistry",initialize:function(e,t){var i=e.lookupFactory("registry:abstractclass"),o=i.create({name:"templates",all:[],byClass:{},tableColumns:[{title:"name",name:"name"}]});t.register("registry:templates",o)}}),Ember.Application.initializer({name:"UtilityClass",initialize:function(e,t){var i=(Ember.set,Ember.get),o=Ember.Object.extend({init:function(){this._super(),console.log("Registering utility object "+i(this,"name"))}});t.register("class:utility",o)}}),Ember.Application.initializer({name:"ActionsUtils",after:"UtilityClass",initialize:function(e,t){var i,o=e.lookupFactory("class:utility"),r=o.create({name:"actions",setDefaultTarget:function(e){i=e},doAction:function(e,t){console.info("doAction",i,e,t),Ember.assert("The actionsDefaultTarget variable is none",!Ember.isNone(i)),i.send.apply(i,[e,t])}});t.register("utility:actions",r)}}),Ember.Application.initializer({name:"DataUtils",after:["UtilityClass","HashUtils"],initialize:function(e,t){var i,o,r=e.lookupFactory("class:utility"),n=e.lookupFactory("utility:hash"),a=r.create({name:"data",getLoggedUserController:function(){return i},setLoggedUserController:function(e){i=e},getEmberApplicationSingleton:function(){return o},setEmberApplicationSingleton:function(e){o=e},getStore:function(){return console.warn("this should not be used as there is not only one store in Canopsis. This might lead to unexpected behaviour"),this.getEmberApplicationSingleton().__container__.lookup("store:main")},addRecordToRelationship:function(e,t,i,o){console.log("addRecordToRelationship",arguments),"hasMany"===o?(console.log("addRecordToRelationship hasMany",i,arguments,t),t.get(i).pushObject(e)):"belongsTo"===o&&(console.log("addRecordToRelationship belongsTo",i,arguments,t),t.set(i,e))},download:function(e,t,i){i||(i="application/octet-stream");var o=document.createElement("a"),r=new Blob([e],{type:i});o.href=window.URL.createObjectURL(r),o.download=t,o.click()},uploadFilePopup:function(e){if(window.File&&window.FileReader&&window.FileList&&window.Blob){var t=$(document.createElement("input"));t.attr("type","file"),t.trigger("click"),t.change(function(){"function"==typeof e&&e(this)})}else alert("The File APIs are not fully supported by your browser.")},uploadTextFilePopup:function(e){this.uploadFilePopup(function(t){var i=t.files[0];if(i){var o=new FileReader;o.onload=function(t){var o=t.target.result;"function"==typeof e&&e(i.name,i.type,i.size,o)},o.readAsText(i)}else alert("Failed to load file")})},cleanJSONIds:function(e){for(var t in e){var i=e[t];"id"!==t&&"_id"!==t&&"widgetId"!==t&&"preference_id"!==t&&"EmberClass"!==t||delete e[t],"object"==typeof i&&this.cleanJSONIds(i)}return null===e||void 0===e||void 0===e.crecord_type&&void 0===e.xtype||(e.id=n.generateId(e.xtype||e.crecord_type||"item"),e._id=e.id),e}});t.register("utility:data",a)}}),Ember.Application.initializer({name:"DatesUtils",after:["UtilityClass"],initialize:function(e,t){var i=e.lookupFactory("class:utility"),o=Ember.String.loc,r=Ember.isNone,n=i.create({name:"dates",getNow:function(){return parseInt((new Date).getTime()/1e3)},getStringNow:function(e,t){return n.timestamp2String(n.getNow(),e,t)},durationFromNow:function(e){var t=n.getNow()-e;return n.second2Duration(t)},second2Duration:function(e){var t=parseInt(e/86400),i=parseInt(e/3600)%24,o=parseInt(e/60)%60,r=parseInt(e%60),n="";i&&(n=(i<10?"0"+i:i)+"h ");var a="";o&&(a=(o<10?"0"+o:o)+"m ");var s=n+a+(r<10?"0"+r:r)+"s";return isNaN(t)||0===t||(s=t+"d "+s),s},timestamp2String:function(e,t,i){function r(e){return e<10?"0"+e:e.toString()}var n=new Date(1e3*e),a=[o("January"),o("February"),o("March"),o("April"),o("May"),o("June"),o("July"),o("August"),o("September"),o("October"),o("November"),o("December")];!0===i&&(a=[o("Jan"),o("Feb"),o("Mar"),o("Apr"),o("May"),o("June"),o("July"),o("Aug"),o("Sep"),o("Oct"),o("Nov"),o("Dec")]);var s=n.getFullYear(),l=a[n.getMonth()],c=r(n.getDate()),d=r(n.getHours()),u=r(n.getMinutes()),m=r(n.getSeconds()),p="";switch(t){case"f":p=[c,l,s].join(" ")+" "+[d,u,m].join(":");break;case"r":p=[c,r(n.getMonth()),s].join("/")+" <br>"+[d,u,m].join(":");break;case"timeOnly":p=[d,u,m].join(":");break;default:p=[c,l,s].join(" ")+" "+[d,u,m].join(":")}return p},locale:"fr",months:["January","February","March","April","May","June","July","August","September","October","November","December"],days:["Monday","Thuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],setLang:function(e){n.locale=e,"fr"===e&&(n.month=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Octobre","Novembre","Décembre"],n.days=["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"])},startOfTheDay:function(e){r(e)&&(e=n.getNow(),console.log("got date from now as no param given",e)),e*=1e3;var t=new Date(e);return t.setHours(0,0,0,0),parseInt(t.getTime()/1e3)},isToday:function(e){return n.startOfTheDay(n.getNow())===n.startOfTheDay(e)},dateFormat:"YYYY/MM/DD",diffDate:function(e,t,i){switch(div=1,i){case"s":div=1e3;break;case"m":div=6e4;break;case"h":div=36e5;break;case"d":div=864e5}var o=t-e;return Math.ceil(o/div)}});t.register("utility:dates",n)}}),Ember.Application.initializer({name:"DebugUtils",after:["UtilityClass"],initialize:function(e,t){var i=e.lookupFactory("class:utility"),o=Ember.set,r=i.create({name:"debug",inspectObject:function(e){window.$E=e,o(this,"inspectedObject",e),console.info("--- inspect object :",this.inspectedObject)},getViewFromJqueryElement:function(e,t){return t?Ember.View.views[e.closest(".ember-view ."+t).attr("id")]:Ember.View.views[e.closest(".ember-view").attr("id")]}});t.register("utility:debug",r)}}),Ember.Application.initializer({name:"DragUtils",after:["UtilityClass"],initialize:function(e,t){var i=e.lookupFactory("class:utility"),o=(Ember.String.loc,Ember.isNone,i.create({name:"drag",setDraggable:function(e,t){e.on("mousedown",function(){console.log("mousedown",$(this)),t.addClass("draggable").parents().on("mousemove",function(e){$(".draggable").offset({top:e.pageY-50,left:e.pageX-$(".draggable").outerWidth()/2}).on("mouseup",function(){t.removeClass("draggable")})})})}}));t.register("utility:drag",o)}}),Ember.Application.initializer({name:"EventUtils",after:["UtilityClass"],initialize:function(e,t){var i=e.lookupFactory("class:utility"),o=Ember.get,r=Ember.set,n=(Ember.String.loc,Ember.isNone,i.create({name:"event",getFields:function(){return["connector","connector_name","component","resource","perimeter","domain","state","status","timestamp","output"]},applyVolatileFilter:function(e,t,i){e.promise.then(function(e){var n=o(e,"controller.content.containerwidget");n=o(n,"_data.items")[0],n=o(n,"widget"),console.log(n),""!==i&&(o(n,"volatile")||r(n,"volatile",{}),r(n,"volatile.forced_filter",i),r(n,"rollbackable",!0),r(n,"title",t.title))})}}));t.register("utility:event",n)}}),Ember.Application.initializer({name:"FormsUtils",after:["UtilityClass","FormsRegistry","RoutesUtils","DataUtils"],initialize:function(e,t){var i=e.lookupFactory("class:utility"),o=e.lookupFactory("utility:routes"),r=e.lookupFactory("utility:data"),n=e.lookupFactory("registry:forms"),a=Ember.get,s=Ember.set,l=Ember.String.loc,c=i.create({name:"forms",instantiateForm:function(t,i,n){this.formController&&this.formController.destroy(),console.log("try to instantiate form",t,n.formParent);var a=n;n.formName=t,a.target=o.getCurrentRouteController(),a.container=r.getEmberApplicationSingleton().__container__,void 0===e.lookupFactory("form:"+t)&&console.error("the form",t,"was not found");var s=e.lookupFactory("form:"+t).create(a);return s.refreshPartialsList(),this.formController=s,s},showInstance:function(e){e.empty_validationFields(),s(n.formwrapper,"form.validateOnInsert",!1),s(n.formwrapper,"form",e),s(n.formwrapper,"formName",e.formName)},showNew:function(e,t,i){void 0===i&&(i={}),(Ember.isNone(t)||Ember.isNone(a(t,"crecord_type")))&&console.warn("There is no crecord_type in the given record. Form may not display properly."),console.log("Form generation",e);var r=this.instantiateForm(e,t,i);return console.log("formController",r),o.getCurrentRouteController().send("showEditFormWithController",r,t,i),r},editRecord:function(e,t){var i=this.showNew("modelform",e);return console.log("widgetWizard",i),i.submit.then(function(){console.log("record saved");var o=e.save();isNone(t)||o.then(t),i.trigger("hidePopup"),i.destroy()}),i},editSchemaRecord:function(e,t,i){var o=this;DS.Store.create({container:t}).findQuery(e,{}).then(function(t){console.log("queryResults",t);var r=a(t,"content")[0],n=[e," ",l("information not registered in database.")," ",l("Please contact your administrator.")].join("");r?o.editRecord(r,i):o.error(n)})},addRecord:function(e){o.getCurrentRouteController().send("show_add_crecord_form",e)}});t.register("utility:forms",c)}}),Ember.Application.initializer({name:"HashUtils",after:["UtilityClass","HashUtils"],initialize:function(e,t){var i=e.lookupFactory("class:utility"),o=window.Hashes,r=i.create({generate_GUID:function(){var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},generateId:function(e){var t=r.generate_GUID();return Ember.isNone(e)||(t=e+"_"+t),t},md5:function(e){return(new o.MD5).hex(e)},sha1:function(e){return(new o.SHA1).hex(e)}});t.register("utility:hash",r)}}),Ember.Application.initializer({name:"IndexesUtils",after:["UtilityClass"],initialize:function(e,t){var i=e.lookupFactory("class:utility"),o=(window.canopsisConfiguration,i.create({name:"indexes",cache:{},load:function(e){return $.ajax({url:"/rest/indexes/"+e,success:function(t){o.cache[e]=t.indexes},async:!1}),this.cache[e]},parse:function(e){},get:function(e){return console.log(this),Ember.isNone(this.cache[e])&&this.load(e),this.cache[e]},getAsList:function(e){var t=this.get(e);indexesList=[];for(var i in t)indexesList.push(t[i].key);return indexesList},getIndexWithField:function(e,t){for(var i=this.getAsList(e),o=[],r=0,n=i.length;r<n;r++)console.log("searching "+i[r][0][0]+" in",t),-1!==$.inArray(i[r][0][0],t)&&o.push(i[r]);return o}}));t.register("utility:indexes",o)}}),Ember.Application.initializer({name:"ModelsolveUtils",after:["UtilityClass"],initialize:function(e,t){var i=e.lookupFactory("class:utility"),o=i.create({name:"modelsolve",gen_resolve:function(e){return function(t){for(var i=0;i<t.data.length;i++);!1===t.success&&t.data.msg&&(console.error("Server Error",t.data.msg,t.data.type),console.error(t.data.traceback)),Ember.run(null,e,t)}},gen_reject:function(e){return function(t){t.then=null,Ember.run(null,e,t)}}});t.register("utility:modelsolve",o)}}),Ember.Application.initializer({name:"NotificationUtils",after:["UtilityClass"],initialize:function(e,t){var i=e.lookupFactory("class:utility");targetcontroller={temp_buffer:[],createNotification:function(e,t){this.temp_buffer.push({notificationType:e,notificationMessage:t})}};var o=i.create({name:"notification",setController:function(e){},info:function(e){},warning:function(e){},error:function(e){},help:function(){console.log("usage is: utils.notification.notificate('info'|'warning'|'error', 'my message');")}});t.register("utility:notification",o)}}),Ember.Application.initializer({name:"RoutesUtils",after:["UtilityClass","DataUtils"],initialize:function(e,t){var i=e.lookupFactory("class:utility"),o=e.lookupFactory("utility:data"),r=i.create({name:"routes",getCurrentRouteController:function(){var e=o.getEmberApplicationSingleton().__container__.lookup("router:main").router.currentHandlerInfos,t=e[e.length-1].handler.controller;return console.log("currentHandlers",e),console.log("currentRouteController",t),t},getCurrentViewId:function(){return o.getEmberApplicationSingleton().__container__.lookup("router:main").router.currentHandlerInfos[1].params.userview_id}});t.register("utility:routes",r)}}),Ember.Application.initializer({name:"SlugUtils",after:["UtilityClass"],initialize:function(e,t){var i=e.lookupFactory("class:utility"),o=i.create({name:"slug",slug:function(e){for(var t=[{re:/[\xC0-\xC6]/g,ch:"A"},{re:/[\xE0-\xE6]/g,ch:"a"},{re:/[\xC8-\xCB]/g,ch:"E"},{re:/[\xE8-\xEB]/g,ch:"e"},{re:/[\xCC-\xCF]/g,ch:"I"},{re:/[\xEC-\xEF]/g,ch:"i"},{re:/[\xD2-\xD6]/g,ch:"O"},{re:/[\xF2-\xF6]/g,ch:"o"},{re:/[\xD9-\xDC]/g,ch:"U"},{re:/[\xF9-\xFC]/g,ch:"u"},{re:/[\xC7-\xE7]/g,ch:"c"},{re:/[\xD1]/g,ch:"N"},{re:/[\xF1]/g,ch:"n"}],i=0,o=t.length;i<o;i++)e=e.replace(t[i].re,t[i].ch);return e=e.toLowerCase(),e=e.replace(/\s+/g,"-"),e=e.replace(/[^a-z0-9-]/g,""),e=e.replace(/\-{2,}/g,"-")}});t.register("utility:slug",o)}}),Ember.Application.initializer({name:"TimeWindowUtils",after:["UtilityClass"],initialize:function(e,t){var i=e.lookupFactory("class:utility"),o=Ember.get,r=Ember.isNone,n=i.create({default_timewindow:86400,default_timewindow_offset:0,getFromTo:function(e,t){var i=(new Date).getTime();return r(e)&&(e=o(this,"default_timewindow")),r(t)&&(t=o(this,"default_timewindow_offset")),e*=1e3,t*=1e3,[i-t-e,i-t]}});t.register("utility:timewindow",n)}}),Ember.Application.initializer({name:"ValuesUtils",after:["UtilityClass","DatesUtils"],initialize:function(e,t){var i=e.lookupFactory("class:utility"),o=e.lookupFactory("utility:dates"),r=[" "," k"," M"," G"," T"],n=i.create({name:"values",humanize:function(e,t){if("s"===t.toLowerCase())return o.second2Duration(e);var i=1e3,n=e<0;n&&(e=-e),"o"!==t&&"o/s"!==t||(i=1024);for(var a=0,s=parseInt(e/i);s>0;)e=s,s=parseInt(e/i),a++;return n?"-"+e+r[a]+t:e+r[a]+t},castValue:function(e,t){t=t.toLowerCase();var i=["string","boolean","number","array"];if(-1===i.indexOf(t))return console.warn("type",t,"not recognized. Expected one of",i.join(",")),e;if("string"===t)return e+"";if("number"===t){try{e=parseFloat(e)}catch(t){console.warn("unable to case to number value",e)}return isNaN(e)?0:e}if("boolean"===t){try{if("true"===e)return!0;if("false"===e)return!1;e=!!e}catch(t){console.warn("unable to case to boolean value",e)}return e}if("array"===t){try{e=e.split(",")}catch(t){console.warn("unable to case to array value",e)}return e}}});t.register("utility:values",n)}}),Ember.Application.initializer({name:"WidgetSelectorsUtils",after:["UtilityClass"],initialize:function(e,t){var i=e.lookupFactory("class:utility"),o=Ember.get,r=(Ember.set,Ember.isNone),n=i.create({name:"widgetSelector",toTree:function(e){if(r(e))return console.warn("Widget is undefined in widget selector toTree"),{};var t={};console.log("enter tree for widget",e.get("id"));for(var i=n.directChildren(e),o=[],a=i.length,s=0,l=a;s<l;s++)console.log("iterating over widget ",i[s].get("id")),o.push(n.toTree(i[s]));return t[e.get("id")]={children:o,widget:e},console.log("will return sub tree",t),t},directChildren:function(e){if(Ember.isNone(e))return console.warn("Widget is undefined in widget selector direct children"),[];console.log("in direct children");var t=o(e,"items.content"),i=[];if(!Ember.isNone(t))for(var r=t.length,n=0;n<r;n++)i.push(o(t[n],"widget"));return i},children:function(e){if(Ember.isNone(e))return console.warn("Widget is undefined in widget selector in children"),[];for(var t=[],i=n.directChildren(e),o=i.length,r=0;r<o;r++){console.log("iterating over widget ",r);for(var a=n.children(i[r]),s=a.length,l=0,c=s;l<c;l++)console.log("iterating over sub children",l),t.push(a[l]);t.push(i[r])}return t},filter:function(e,t){if(Ember.isNone(e))return console.warn("Widget is undefined in widget selector in filter"),[];if(Ember.isNone(t))return console.warn("Filter is undefined in widget selector in filter"),[];var i=[];t.directChilrenOnly?(i=n.directChildren(e),console.log("directChilrenOnly",i)):(i=n.children(e),console.log("not directChilrenOnly",i));var r={},a=[];if(t.keyEquals)for(var s in t.keyEquals){console.log("checking if key",s,"is in widget");for(var l=0,c=i.length;l<c;l++)i[l].get(s)===t.keyEquals[s]&&Ember.isNone(r[o(i[l],"id")])&&(a.push(i[l]),r[o(i[l],"id")]=!0)}return a}});t.register("utility:widget-selectors",n)}}),Ember.Application.initializer({name:"WidgetsUtils",after:["UtilityClass"],initialize:function(e,t){var i=e.lookupFactory("class:utility"),o=Ember.get,r=i.create({name:"widgetsUtils",getParentViewForWidget:function(e){for(var t=e;"view"!==o(t,"crecord_type");)t=o(t,"target");return t}});t.register("utility:widgets",r)}}),Ember.Application.initializer({name:"WidgetsRegistry",after:"AbstractClassRegistry",initialize:function(e,t){var i=e.lookupFactory("registry:abstractclass"),o=i.create({name:"widgets",all:[],byClass:{},tableColumns:[{title:"icon",name:"icon"},{title:"name",name:"name"}]});t.register("registry:widgets",o)}});var deps=[];isIE||"test"===window.environment||deps.push("canopsis/core/externals/console.js/console"),define(deps,function(){if(conf=canopsisConfiguration,delete console.init,isIE){if(conf.DEBUG){var e=console;console={log:function(){try{for(var t=[],i=0;i<arguments.length;i++)t.push(arguments[i]);var o=JSON.stringify(t);e.log.apply(e,["",o])}catch(e){Array.prototype.unshift.call(arguments,[" > unable to serialize next message"]),Array.prototype.unshift.call(arguments,"")}},tags:{add:function(){},remove:function(){}},group:function(){},groupEnd:function(){},warn:function(){},debug:function(){},info:function(){},error:function(){}}}}else console.group("init"),console.tags.add("init");return console.debug=console.log,console}),Ember.Application.initializer({name:"ConsolemanagerMixin",after:["MixinFactory","FormsUtils","DataUtils"],initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),o=e.lookupFactory("utility:forms"),r=e.lookupFactory("utility:data"),n=(Ember.get,Ember.set,Ember.String.loc),a=i("consolemanager",{init:function(){this.partials.statusbar.pushObject("consolemanagerstatusmenu"),this._super()},actions:{showConsoleSettings:function(){var e=r.getStore().createRecord("jsruntimeconfiguration",{id:0,selected_tags:window.console.tags._selectedTags,colors:window.console.style._colors}),t=o.showNew("modelform",e,{title:n("Edit JS runtime configuration"),inspectedItemType:"jsruntimeconfiguration"});console.log("editForm deferred",t.submit),t.submit.done(function(){console.log("jsruntimeconfigrecord saved",e)}),t.submit.always(function(){console.log("jsruntimeconfigrecord always",e),window.console.tags._selectedTags=e.get("selected_tags"),window.console.style._colors=e.get("colors"),window.console.settings.save(),e.unloadRecord()})}},verbosity_mode:function(){return n("custom")}.property()});t.register("mixin:consolemanager",a)}}),Ember.Application.initializer({name:"CriticitylevelsMixin",after:"MixinFactory",initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),o=Ember.get,r=Ember.set,n=Ember.isNone,a=i("criticitylevels",{init:function(){if(o(this,"content.mixins")){var e=o(this,"content.mixins").findBy("name","criticitylevels");this.mixinOptions.criticitylevels=e}this._super(),r(this,"warn_value",o(this,"mixinOptions.criticitylevels.warn_value")),r(this,"crit_value",o(this,"mixinOptions.criticitylevels.crit_value")),r(this,"unit_or_percent",o(this,"mixinOptions.criticitylevels.unit_or_percent")),r(this,"standard_color",o(this,"mixinOptions.criticitylevels.standard_color")),r(this,"warn_color",o(this,"mixinOptions.criticitylevels.warn_color")),r(this,"critic_color",o(this,"mixinOptions.criticitylevels.critic_color")),n(o(this,"background_color"))&&r(this,"background_color","#3c8dbc"),n(o(this,"warn_color"))&&r(this,"warn_color","#f39c12"),n(o(this,"critic_color"))&&r(this,"critic_color","#f56954")}});t.register("mixin:criticitylevels",a)}}),Ember.Application.initializer({name:"DocumentationMixin",after:"MixinFactory",initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),o=i("Documentation",{showDocumentationButton:!0,init:function(){this.partials.statusbar.pushObject("documentation"),this._super()}});t.register("mixin:documentation",o)}}),Ember.Application.initializer({name:"EmbeddedRecordSerializerMixin",after:["MixinFactory","DataUtils","HashUtils"],initialize:function(e,t){function i(e){return e=e.decamelize()}var o=e.lookupFactory("factory:mixin"),r=window.schemasRegistry,n=e.lookupFactory("utility:hash"),a=e.lookupFactory("utility:data"),s=Ember.isNone,l=(Ember.get,o("embeddedRecordSerializer",{sideloadItem:function(e,t,i,o){try{if(console.log("sideLoad",t,i.xtype),console.log("payload before sideLoad",e),void 0===r.getByName(i.xtype).EmberModel)return void console.error(e,"bad xtype for widget :"+i.xtype);var a=i.xtype.pluralize(),l=Ember.get(this,"primaryKey"),c=i[l],d=e[a]||[];return console.log("sideloadKey",a),(s(c)&&(console.log("generateId",i.xtype,i.id),c=n.generateId("item"),i[l]=c),s(i.meta)&&(i.meta={}),console.log("filling item",i,"meta with parent",o.xtype),i.meta.embeddedRecord=!0,i.meta.parentId=o.id,s(o.xtype)?s(o.crecord_type)||(i.meta.parentType=o.crecord_type):i.meta.parentType=o.xtype,s(d.findBy("id",c)))?(console.log("pushing item",d,"into",a),d.push(i),e[a]=d,e):e}catch(e){console.error(e.message,e.stack)}},extractRelationships:function(e,t,i,o){console.group("extractRelationships",t,i);try{if(console.log("payload before extractRelationships",e),console.log("primaryType",i,t.xtype),i===r.getByName("widget").EmberModel){var n=r.getByName(t.xtype).EmberModel;i=n}return s(i.store)&&(i.store=o.store),i.eachRelationship(function(o,r){console.log("eachRelationship",o,t,t[o]),console.log("relationship",r);var n=t[o],a=r.type;if(console.log("related",n),n)if("belongsTo"===r.kind){console.group("belongsTo relationship"),console.log("related",n),console.log("relationship",r),console.log("recordJSON",t),console.groupEnd();var l=this.sideloadItem(e,a,n,t);s(l)||(t[o]=n.id,t[o+"Type"]=n.xtype,this.extractRelationships(e,n,a,i))}else"hasMany"===r.kind&&(console.group("hasMany relationship"),console.log("related",n),console.log("relationship",r),console.log("recordJSON",t),console.groupEnd(),n.forEach(function(o,r){console.log("sideLoad items in",t);var l=this.sideloadItem(e,a,o,t);s(l)||(n[r]=o.id,this.extractRelationships(e,o,a,i))},this))},this),console.groupEnd(),e
}catch(e){console.groupEnd(),console.error(e.message,e.stack)}},isRecordEmbedded:function(e){var t;return t=!s(e._data.meta)&&!0===e._data.meta.embeddedRecord,console.log("isRecordEmbedded",e,t),t},getTopmostNotEmbeddedRecordFor:function(e,t){console.log("getTopmostNotEmbeddedRecordFor",e,e.data,e._data);for(var i=e;this.isRecordEmbedded(i);){var o=i._data.meta.parentType,r=i._data.meta.parentId;"view"===o&&(o="userview"),i=i.store.getById(o,r)}return i},serialize:function(e,t){console.log("serialize",e);var i=!0;if(s(t)||!1!==t.lookForDocumentRoot||(i=!1),i&&this.isRecordEmbedded(e))return void this.getTopmostNotEmbeddedRecordFor(e).save(t);var o=this._super(e,t);return o.id=e.get("id"),console.log(" - serialized record",e,o),o},serializeBelongsTo:function(e,t,o){console.log("serializeBelongsTo",arguments);var r=o.key;console.log("serializeBelongsTo",o,e);var n=i(r);console.log("key",n);var a=e.get(n);if(console.log("content",a),s(a))console.error("Content is empty",a);else{var l=a.serialize({lookForDocumentRoot:!1});console.log("serializedSubDocument",l),t[n]=l}},serializeHasMany:function(e,t,o){var r=o.key;console.log("serializeHasMany",o,e,t,r);var n=i(r);console.log("keyForRelationship",n);var a=e.get(n).get("content");console.log("subDocuments",a),t[n]=[];var l=a.length;(s(o)||s(o.type)||s(o.type.typeKey))&&console.error("Error while retrieving typeKey from model is it is none.");for(var c=0,d=l;c<d;c++)if(s(a[c]))console.error("subdocument is none for index",c,a);else{var u=a[c].serialize({lookForDocumentRoot:!1});u.xtype=o.type.typeKey,t[n].push(u)}console.log("serializedSubDocuments",t[n])},normalize:function(e,t,i){return e.eachRelationship(function(e,i){t[e]&&(t[e].type=t[e].xtype)}),this._super.apply(this,arguments)},pushPayload:function(e,t){for(var t=a.cleanJSONIds(t),i=Ember.keys(t),o=0,s=i.length;o<s;o++){var l=i[o],c=r.getByName(l).EmberModel;this.extractRelationships(t,t[l],c)}return t[l].id=n.generateId(t[l].xtype||t[l].crecord_type||"item"),this._super(e,t)}}));t.register("mixin:embedded-record-serializer",l)}}),Ember.Application.initializer({name:"HashSerializerMixin",after:"MixinFactory",initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),o=i("hashSerializer",{serializeIntoHash:function(e,t,i,o,r){return console.log("serializeIntoHash",arguments),e=this.serialize(i,r),"PUT"===o?e:"POST"===o?[e]:void 0}});t.register("mixin:hash-serializer",o)}}),Ember.Application.initializer({name:"InspectableArrayMixin",after:"MixinFactory",initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),o=i("InspectableArray",{attributesKeys:function(){var e=[],t=this.get("inspectedDataArray.type.attributes.values");console.log("attributesDict",t);for(var i in t){var o=t[i];!1!==o.options.hiddenInLists&&void 0!==o.options.hiddenInLists||(e.pushObject({field:o.name,type:o.type,options:o.options}),console.log("pushed attr",{field:o.name,type:o.type,options:o.options}))}return e}.property("inspectedProperty","inspectedDataArray"),inspectedDataArray:function(){console.error("This must be defined on the base class")}.property()});t.register("mixin:inspectable-array",o)}}),Ember.Application.initializer({name:"InspectableItemMixin",after:["MixinFactory","NotificationUtils"],initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),o=window.schemasRegistry,r=e.lookupFactory("utility:notification"),n=Ember.get,a=Ember.set,s=i("inspectableItem",{attributesKey:"attributes",inspectedDataItem:function(){return console.error("This must be defined on the base class. Assuming inspected data is content"),"content"}.property(),inspectedItemType:function(){return console.error("This must be defined on the base class. Assuming inspected data is content.xtype"),"content.xtype"}.property(),inspectedItemInstance:function(){return console.error("Not mandatory, but attr.value field will not be set"),"content"}.property(),getInspectedItemType:function(){var e=n(this,"inspectedItemType");return"view"===e&&(e="userview"),e},insertValueIntoAttribute:function(e,t,i,o,r){var a=this.isOnCreate?o.options.defaultValue:n(t,i);if("array"===o.type){a=Ember.copy(a,!0)}return e.keys[r].value=a,e},generateEditorNameForAttribute:function(e){var t;return t=void 0!==e.options&&void 0!==e.options.role?"editor-"+e.options.role:"editor-"+e.type,void 0===Ember.TEMPLATES[t]&&(t="editor-defaultpropertyeditor"),t},generateRoleAttribute:function(e){return{type:"string",model:{options:{role:e}},options:{}}},getAttributes:function(){var e=this.getInspectedItemType(),t=o.getByName(e).EmberModel;return void 0!==t&&void 0!==t.proto()||r.error("There does not seems to be a registered schema for",e.capitalize()),void 0===t.proto().categories&&r.error("No categories in the schema of"+e),n(t,n(this,"attributesKey"))},categorized_attributes:function(){var e=n(this,"inspectedDataItem");if(console.log("recompute categorized_attributes",e),void 0===e);else{console.log("inspectedDataItem attributes",this.getAttributes());var t=this.getInspectedItemType(),i=o.getByName(t).EmberModel;if(void 0!==t){var s=n(this,"options"),l=[];s&&s.filters&&(l=s.filters),console.log(" + filters ",l);var c={};s&&s.override_labels&&(c=s.override_labels),a(this,"categories",[]);for(var d=this.getAttributes(),u=i.proto().categories,m=0,p=u.length;u&&m<p;m++){for(var g=u[m],f={title:g.title,keys:[]},h=0,b=g.keys.length;h<b;h++){var y=g.keys[h],v=d.get(y);if("separator"===y)f.keys[h]=this.generateRoleAttribute("separator");else{if(void 0!==y&&void 0===v){r.error("An attribute that does not exists seems to be referenced in schema categories"+y),console.error(i,v,d),f.keys[h]=this.generateRoleAttribute("error"),f.keys[h].field=y,f.keys[h].error="Attribute referenced in schema categories not found";continue}void 0===v.options&&(v.options={}),0===l.length||-1!==$.inArray(y,l)?a(v,"options.hiddenInForm",!1):a(v,"options.hiddenInForm",!0);var w=y;c[y]&&(w=c[y]),f.keys[h]={field:w,model:v,editor:this.generateEditorNameForAttribute(v)},f=this.insertValueIntoAttribute(f,e,y,v,h)}}this.categories.push(f)}return console.log("categories",this.categories),this.categories}}}.property("inspectedDataItem","inspectedItemType")});t.register("mixin:inspectable-item",s)}}),Ember.Application.initializer({name:"LoadingindicatorMixin",after:"MixinFactory",initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),o=Ember.get,r=Ember.set;isNone=Ember.isNone;var n=i("loadingindicator",{init:function(){isNone(o(this,"partials.indicators"))&&r(this,"partials.indicators",[]),this.partials.indicators.pushObject("loadingindicator"),this._super()},isLoading:0,addConcurrentLoading:function(e){isNone(o(concurrentLoadingsPending,e))?r(concurrentLoadingsPending,e,{count:1}):concurrentLoadingsPending.incrementProperty(e+".count"),recomputeIsLoading(this)},removeConcurrentLoading:function(e){concurrentLoadingsPending.decrementProperty(e+".count"),o(concurrentLoadingsPending,e+".count")<=0&&delete concurrentLoadingsPending[e],recomputeIsLoading(this)}});recomputeIsLoading=function(e){for(var t=0,i=Ember.keys(concurrentLoadingsPending),n=0;n<i.length;n++){var a=concurrentLoadingsPending[i[n]];t+=o(a,"count")||0}r(e,"isLoading",t>0)},concurrentLoadingsPending=Ember.Object.create({userview:{count:0},perfdata:{count:0}}),t.register("mixin:loadingindicator",n)}}),Ember.Application.initializer({name:"MetaSerializerMixin",after:"MixinFactory",initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),o=Ember.isNone,r=i("metaSerializer",{extractMeta:function(e,t,i){console.log("extractMeta",e,t,i),i&&void 0===i.meta&&(i.meta={}),i&&void 0!==i.total&&(i.meta.total=i.total),i&&i.messages&&(i.meta.totalmessages=i.messages),i&&void 0!==i.success&&(i.meta.success=i.success),delete i.total,delete i.messages,delete i.success,console.log("normalizePayload",arguments),(o(t)||o(t.typeKey))&&console.error("Error while retrieving typeKey from model is it is none.");var r=t.typeKey,n=r.pluralize();return i[n]=i.data,delete i.data,console.log("payload",n,i),i&&i[n]&&void 0!==i[n]?i[n].forEach(function(e){this.extractRelationships(i,e,t)},this):void 0!==i[r]&&this.extractRelationships(i,i[r],t),this._super(e,t,i)},extractRelationships:function(e,t,i){this._super.apply(this,arguments)}});t.register("mixin:meta-serializer",r)}}),Ember.Application.initializer({name:"NotificationsMixin",after:"MixinFactory",initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),o=Ember.get;Ember.set;assert=Ember.assert;var r=i("notifications",{init:function(){this.partials.statusbar.pushObject("notificationsstatusmenu"),this._super()},notifications:function(){return assert("The notification store should be an instance of DS.Store",DS.Store.detectInstance(this.store)),this.store.find("notification")}.property(),createNotification:function(e,t){assert("The notification store should be an instance of DS.Store",DS.Store.detectInstance(this.store));var i=e;void 0!==t&&void 0!==e||(t="missing information for notification",i="warning",e="warning"),"error"===e&&(i="warning",e="danger"),this.store.createRecord("notification",{level:e,message:t,timestamp:(new Date).getTime(),falevel:"fa-"+i}).save()},notificationCount:function(){return o(this,"notifications.length")}.property("notifications.length")});t.register("mixin:notifications",r)}}),Ember.Application.initializer({name:"PromisemanagerMixin",after:["PromisesRegistry","MixinFactory"],initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),o=e.lookupFactory("registry:promises"),r=i("promisemanager",{promises:o,init:function(){this.partials.statusbar.pushObject("promisemanagerstatusmenu"),this._super()}});t.register("mixin:promisemanager",r)}}),Ember.Application.initializer({name:"RequirejsmocksmanagerMixin",after:["MocksRegistry","MixinFactory"],initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),o=e.lookupFactory("registry:mocks"),r=i("Requirejsmocksmanager",{requirejsmocksmanager:o,init:function(){this.partials.statusbar.pushObject("requirejsmockingstatusmenu"),this._super()},actions:{deleteMock:function(e){o.deleteMock(e)},editMock:function(e){o.editMock(e)},addMock:function(){o.addMock()}}});t.register("mixin:requirejsmocksmanager",r)}}),Ember.Application.initializer({name:"SchemamanagerMixin",after:["MixinFactory","FormsUtils","DataUtils","SearchmethodsRegistry","SchemasLoader"],initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),o=e.lookupFactory("utility:forms"),r=e.lookupFactory("utility:data"),n=e.lookupFactory("deprecated:schemasLoader"),a=window.canopsisConfiguration,s=e.lookupFactory("registry:searchmethods"),l=Ember.get,c=(Ember.set,Ember.isNone),d=i("schemamanager",{configuration:a,available_types:n.generatedModels,init:function(){this.partials.statusbar.pushObject("schemamanagerstatusmenu"),this._super()},displayedTypes:function(){var e=l(this,"schemaManagerSearchCriterion");return console.log("recompute displayedTypes"),c(e)?l(this,"available_types"):(console.log("searchCriterion",e),s.getByName("simple").filter(l(this,"available_types"),{propertyToCheck:"name",searchCriterion:l(this,"schemaManagerSearchCriterion")}))}.property("available_types","schemaManagerSearchCriterion"),actions:{addModelInstance:function(e){console.log("add",e);var t=r.getStore().createRecord(e,{crecord_type:e.underscore()});console.log("temp record",t),o.showNew("modelform",t,{title:__("Add ")+e}).submit.done(function(){t.save()})}}});t.register("mixin:schemamanager",d)}}),Ember.Application.initializer({name:"ScreentoolstatusmenuMixin",after:"MixinFactory",initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),o=i("Screentoolstatusmenu",{init:function(){this.partials.statusbar.pushObject("screentoolstatusmenu"),this._super()},actions:{changeScreenSize:function(e){var t={small:"480px",medium:"940px",large:"100%"}[e];$("body").animate({width:t})}}});t.register("mixin:screentoolstatusmenu",o)}}),Ember.Application.initializer({name:"UserprofilestatusmenuMixin",after:["MixinFactory","FormsUtils","DataUtils","NotificationUtils"],initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),o=e.lookupFactory("utility:forms"),r=e.lookupFactory("utility:data"),n=e.lookupFactory("utility:notification"),a=Ember.get,s=Ember.set,l=Ember.isNone,c=i("Userprofilestatusmenu",{init:function(){l(this.partials.statusbar)||this.partials.statusbar.pushObject("userstatusmenu"),this._super()},actions:{showUserProfile:function(){var e=this,t=a(this,"controllers.login.record");o.showNew("modelform",t,{title:a(t,"_id")+" "+__("profile"),filterFieldByKey:{firstname:{readOnly:!0},lastname:{readOnly:!0},authkey:{readOnly:!0},ui_language:!0,mail:!0,userpreferences:!0}}).submit.then(function(i){ouilang=t._data.ui_language,console.group("submit form:",i);var o=i.get("formContext");console.log("save record:",o),s(o,"crecord_type","user"),o.id=o._id,user=o.serialize(),delete user.rights,r.getStore().createRecord("user",user).save(),n.info(__("profile")+" "+__("updated")),uilang=a(o,"ui_language"),console.log("Lang:",uilang,ouilang),uilang!==ouilang&&(console.log("Language changed, will prompt for application reload"),e.send("promptReloadApplication","Interface language has changed, reload canopsis to apply changes ?")),console.groupEnd()})}}});t.register("mixin:userprofilestatusmenu",c)}}),Ember.Application.initializer({name:"ValidationMixin",after:["MixinFactory","FormsUtils"],initialize:function(e,t){var i,o=e.lookupFactory("factory:mixin"),i=e.lookupFactory("utility:forms"),r=Ember.get,n=Ember.set,a=o("validation",{validationFields:function(){return console.warn('Property "validationFields" must be defined on the concrete class.'),"<validationFields is null>"},changeTAB:function(e,t){var i="#"+e+"_tab";t?$(i).addClass("active"):$(i).removeClass("active");var o="#"+e;t?$(o).addClass("active"):$(o).removeClass("active")},set_tab:function(e){var t,i,o=this.categories;for(t=0;t<o.length;t++)i=o[t],this.changeTAB(i.slug,!1),Ember.set(i,"isDefault",!1);e:for(t=0;t<o.length;t++){i=o[t];for(var r=0;r<i.keys.length;r++){var n=i.keys[r],a=n.field;if(a===e){this.changeTAB(i.slug,!0),Ember.set(i,"isDefault",!0);break e}}}},empty_validationFields:function(){n(this,"validationFields",Ember.A())},validation:function(){console.group("Form validation");var e=r(this,"validationFields"),t=!0,o=[],n="",a=this;if(e)for(var s=0,l=e.length;s<l;s++){console.log("check if field is valid",r(e[s],"attr.field"));var c=e[s].validate();if(!0!==c.valid&&(o.push(c),console.log("Attribute not valid",e[s]),n=e[s].attr.field||e[s].attr.parent.attr.field,t=!1,e[s].removedFromDOM)){a.validateOnInsert=!0,i.showInstance(a);break}}return t||(console.log("form not valid"),this.set_tab(n)),console.groupEnd(),t}});t.register("mixin:validation",a)}}),Ember.Application.initializer({name:"ValidationFieldMixin",after:["MixinFactory","FormsRegistry"],initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),o=e.lookupFactory("registry:forms"),r=Ember.get,n=Ember.set,a=Ember.isNone,s=i("validationField",{attr:"",init:function(){var e=o.formwrapper.form;n(this,"form",e);var t=this.attr||this.content;if(n(this,"attr",t),a(t)||a(t.model))console.warn("No attributes found on this component");else{var i=t.model;a(r(this,"value"))&&!a(r(this,"attr.model.options.default"))&&this.set("value",r(this,"attr.model.options.default"));var s=r(i,"options.input_type")||r(i,"type");s="string"===s?"text":s}this._super()},didInsertElement:function(){var e=o.formwrapper.form;if(e){var t=r(e,"validationFields");t&&t.pushObject(this)}e.validateOnInsert&&this.validate()},focusOut:function(){this.validate()},validate:function(){var t=o.formwrapper.form;if(void 0!==r(t,"validation")){var i=r(this,"attr"),n=e.lookupFactory("validator:main"),a=n(i);if(console.log("valideStruct",a),!this.removedFromDOM){var s=this.$();s.closest("div").next(".help-block").remove(),a.valid?s.closest("div").removeClass("has-error"):s.closest("div").addClass("has-error").after('<span class="help-block">'+a.error+"</span>")}return a}}});t.register("mixin:validation-field",s)}}),Ember.Application.initializer({name:"ApplicationRoute",after:["AuthenticatedRoute","FormsRegistry","RoutesUtils","ActionsUtils"],initialize:function(e,t){function i(e,t){Mousetrap.bind([e],function(e){return console.log("binding",arguments),n.doAction(t),!1})}var o,r,n,a=e.lookupFactory("route:authenticated");o=e.lookupFactory("registry:forms"),r=e.lookupFactory("utility:routes"),n=e.lookupFactory("utility:actions");var s=Ember.get,l=Ember.set,c=Ember.isNone,d=a.extend({actions:{showView:function(e){console.log("ShowView action",arguments);r.getCurrentViewId();this.transitionTo("userview",e)},showEditFormWithController:function(e,t,i){if(e.ArrayFields)for(;e.ArrayFields.length>0;)e.ArrayFields.pop();var r=s(e,"formName");console.log("showEditFormWithController",e,r,t,i);var n=this.controllerFor("formwrapper");return l(o,"formwrapper",n),e.setProperties({formwrapper:n,formContext:t}),n.setProperties({form:e,formName:r}),n.send("show"),e}},beforeModel:function(e){var t=this,o=DS.Store.create({container:s(this,"container")}),r=o.find("frontend","cservice.frontend"),n=t.controllerFor("application");r.then(function(e){console.log("frontend config found"),n.frontendConfig=e;var t=s(e,"keybindings");console.log("load keybindings",t);for(var o=0,r=t.length;o<r;o++){var a=t[o];console.log("Mousetrap define",a),i(a.label,a.value)}});var a=this._super(e);l(this,"promiseArray",[a,r]),this.buildBeforeModelPromises(),l(this,"store",o);var d=this.authConfig("authconfiguration",function(e){var i=s(e,"services");if(console.log("authconfigurationRecord",e,i),!c(i))for(var o=0,r=i.length;o<r;o++)if(i[o]){var n=t.authConfig(i[o]);s(t,"promiseArray").pushObject(n)}});return s(this,"promiseArray").pushObject(d),Ember.RSVP.Promise.all(s(this,"promiseArray"))},buildBeforeModelPromises:function(){},authConfig:function(e,t){var i="cservice."+e,o=this.controllerFor("application"),r=s(this,"store"),n=function(e,t,i,o){e[t]=i,e.authTypes||(e.authTypes=[]),e.authTypes.pushObject(t),c(o)||o(i)},a=r.find(e,i);return a.then(function(i){console.log(e,"config found",i),n(o,e,i,t)},function(){console.log("create base "+e+" config");var a=r.createRecord(e,{crecord_name:e});a.id=i,n(o,e,a,t)}),a},model:function(){return{title:"Canopsis"}},renderTemplate:function(){console.info("render application template"),this.render();var e=this.controllerFor("formwrapper");this.render("formwrapper",{outlet:"formwrapper",into:"application",controller:e});var t=this.controllerFor("recordinfopopup");this.render("recordinfopopup",{outlet:"recordinfopopup",into:"application",controller:t})}});t.register("route:application",d)}}),Ember.Application.initializer({name:"AuthenticatedRoute",after:["DataUtils","ActionsUtils"],initialize:function(e,t){var i=(e.lookupFactory("utility:data"),e.lookupFactory("utility:actions")),o=(Ember.get,Ember.set,Ember.Route.extend({setupController:function(e){return this.controllerFor("application").onIndexRoute=!0,i.setDefaultTarget(e),this._super.apply(this,arguments)},actions:{editAndSaveModel:function(e,t,i){console.log("editAndSaveModel",t),e.setProperties(t);var o=e.save();void 0!==i&&o.then(i)},addRecord:function(e,t,i){if(t[e]=e,void 0!==i&&void 0!==i.customFormAction)i.customFormAction(e,t);else{var o=this.store.createRecord(e,t),r=o.save();void 0!==i&&void 0!==i.callback&&r.then(i.callback)}},error:function(e,t){403!==e.status&&401!==e.status||this.loginRequired(t)}}}));t.register("route:authenticated",o)}}),Ember.Application.initializer({name:"IndexRoute",after:"AuthenticatedRoute",initialize:function(e,t){var i=e.lookupFactory("route:authenticated"),o=(Ember.set,Ember.get,i.extend({}));t.register("route:index",o)}}),Ember.Application.initializer({name:"UserviewRoute",after:["AuthenticatedRoute","DataUtils","NotificationUtils","FormsUtils","WidgetSelectorsUtils"],initialize:function(e,t){var i=e.lookupFactory("route:authenticated"),o=e.lookupFactory("utility:data"),r=e.lookupFactory("utility:notification"),n=e.lookupFactory("utility:forms"),a=e.lookupFactory("utility:widget-selectors"),s=Ember.set,l=Ember.get,c=(Ember.isNone,!1),d=i.extend({beforeModel:function(e){return this.controllerFor("application").addConcurrentLoading("userview"),this._super(e)},afterModel:function(e,t){return this.controllerFor("application").removeConcurrentLoading("userview"),this._super(e,t)},actions:{error:function(e,t){0===e.status?console.debug("no error detected in access status"):403===e.status?console.debug("go to some default route"):401===e.status?console.debug("handle 401"):404===e.status?this.transitionTo("/userview/view.404"):(console.error(e),r.error(__("Impossible to load view.")))},toggleEditMode:function(){var e=this.controllerFor("application");if(!0===l(e,"editMode"))console.info("Leaving edit mode"),s(e,"editMode",!1);else{for(var t=a.children(l(this.controllerFor("userview"),"containerwidget")),i=0,o=t.length;i<o;i++){var r=t[i];l(r,"rollbackable")&&r.send("rollback")}console.info("Entering edit mode"),s(e,"editMode",!0)}},exportCurrentView:function(){var e=this.controllerFor("userview").get("model"),t=e.serialize();t=o.cleanJSONIds(t),o.download(JSON.stringify(t),l(e,"crecord_name")+".json","application/json")},toggleDevTools:function(){$(".debugmenu").slideToggle(200)},toggleFullscreen:function(){var e=this.controllerFor("application"),t=!l(e,"fullscreenMode");s(e,"fullscreenMode",t)},stopLiveReporting:function(){this.setReportingInterval(void 0)},displayLiveReporting:function(){var e=this,t=o.getStore().createRecord("livereporting",{crecord_type:"livereporting"});n.showNew("modelform",t,{title:__("Edit live reporting")}).submit.then(function(i){t=l(i,"formContext");var o=l(t,"dateinterval");s(e.controllerFor("application"),"interval",o),e.setReportingInterval(o),console.debug("setting interval to value",o)})},refresh:function(){var e=this.controllerFor("userview");console.log("refresh",this),this.refresh(),e.send("refreshView")}},setReportingInterval:function(e){s(this.controllerFor("application"),"interval",e);var t=this.controllerFor("userview"),i=l(t,"content.containerwidget"),o=a.children(i);Ember.isNone(e)&&(e={});for(var r=0,n=o.length;r<n;r++){console.debug("Child widget",l(o[r],"id"),o[r]);var c=l(o[r],"controllerInstance");Ember.isNone(c)?console.error("Unable to find controller instance for widget",l(o[r],"id")):c.updateInterval(e)}},setupController:function(e,t){console.log("UserviewRoute setupController",arguments),this._super.apply(this,arguments),e.setProperties({isMainView:!0}),!1===c&&(c=!0),s(this.controllerFor("application"),"currentViewId",l(t,"id")),s(this.controllerFor("application"),"currentViewModel",t);this.controllerFor("application");e.trigger&&e.trigger("refreshView")}});t.register("route:userview",d)}}),Ember.Application.initializer({name:"ApplicationSerializer",after:["MetaSerializerMixin","HashSerializerMixin","EmbeddedRecordSerializerMixin","NotificationUtils","HashUtils"],initialize:function(e,t){var i=e.lookupFactory("mixin:meta-serializer"),o=e.lookupFactory("mixin:hash-serializer"),r=e.lookupFactory("mixin:embedded-record-serializer"),n=(e.lookupFactory("utility:notification"),e.lookupFactory("utility:hash")),a=(Ember.get,Ember.set,Ember.isNone),s=DS.RESTSerializer.extend(i,o,r,{normalizeId:function(e){a(e.id)&&(e.id=e._id)},normalize:function(e,t){return console.log("normalize",arguments),a(t.id)&&(t.id=n.generateId("generatedId")),this._super(e,t)}});t.register("serializer:application",s)}}),Ember.Application.initializer({name:"LoggedaccountSerializer",after:["ApplicationSerializer"],initialize:function(e,t){var i=e.lookupFactory("serializer:application"),o=i.extend();t.register("serializer:loggedaccount",o)}}),Ember.Application.initializer({name:"UserviewSerializer",after:["ApplicationSerializer","EmbeddedRecordSerializerMixin"],initialize:function(e,t){var i=e.lookupFactory("serializer:application"),o=e.lookupFactory("mixin:embedded-record-serializer"),r=i.extend(o,{});t.register("serializer:userview",r)}}),Ember.Application.initializer({name:"WidgetSerializer",after:["ApplicationSerializer","EmbeddedRecordSerializerMixin"],initialize:function(e,t){var i=e.lookupFactory("serializer:application"),o=e.lookupFactory("mixin:embedded-record-serializer"),r=i.extend(o,{});t.register("serializer:widget",r)}}),Ember.Application.initializer({name:"WidgetwrapperSerializer",after:["ApplicationSerializer","EmbeddedRecordSerializerMixin"],initialize:function(e,t){var i=e.lookupFactory("serializer:application"),o=e.lookupFactory("mixin:embedded-record-serializer"),r=i.extend(o,{});t.register("serializer:widgetwrapper",r)}}),Ember.Application.initializer({name:"MailValidator",initialize:function(e,t){function i(e,t){var i=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return Ember.isBlank(e.value)?e.model.options.required?(t.valid=!1,t.error="Mail is required"):t.valid=!0:i.test(e.value)?t.valid=!0:(t.valid=!1,t.error="Mail's format should be: X@Y.Z"),t}t.register("validator:mail",i)}}),Ember.Application.initializer({name:"MaxItemsValidator",initialize:function(e,t){function i(e,t){var i=e.model.options.maxItems;return e.value.length<=i?t.valid=!0:(t.valid=!1,t.error="There can be at most "+i+" item(s)."),t}t.register("validator:max-items",i)}}),Ember.Application.initializer({name:"MinItemsValidator",initialize:function(e,t){function i(e,t){var i=e.model.options.minItems;return e.value.length>=i?t.valid=!0:(t.valid=!1,t.error="Must have at least "+i+" item(s)."),t}t.register("validator:min-items",i)}}),Ember.Application.initializer({name:"NumberValidator",initialize:function(e,t){function i(e,t){return Ember.isEmpty(e.value)||!isNaN(e.value)?t.valid=!0:(t.valid=!1,t.error="value should be a number"),t}t.register("validator:number",i)}}),Ember.Application.initializer({name:"RequiredValidator",initialize:function(e,t){function i(e,t){return console.log("requiredValidator :attr = ",e),void 0===e.model.options.required||!0!==e.model.options.required||void 0!==e.value&&""!==e.value&&null!==e.value?(t.valid=!0,t.error=""):(t.valid=!1,t.error=" Field can't be empty"),t}t.register("validator:required",i)}}),Ember.Application.initializer({name:"RightsValidator",initialize:function(e,t){function i(e,t){return t.valid=!0,t}t.register("validator:rights",i)}}),Ember.Application.initializer({name:"Validator",initialize:function(e,t){function i(t){console.log("attr = ",t);var i=n(t,"model.options"),o=[],r=n(t,"model.type"),a=e.lookupFactory("validator:"+r);if(void 0!==a&&o.push(a),void 0!==i){for(var s in i)if(i.hasOwnProperty(s)&&("role"===s||"type"===s)){var l=e.lookupFactory("validator:"+i[s]);void 0!==l&&o.push(l)}n(i,"required")&&(a=e.lookupFactory("validator:required"),o.push(a))}return o}function o(e){function t(){for(var e=0;e<o;e++)this[i[e]]=arguments[e]}var i=e.split(" "),o=i.length;return t}function r(e){for(var t=o("valid error"),r=new t(!0,""),n=i(e),a=0;a<n.length;a++)if(validator=n[a],r=validator(e,r),!1===r.valid)return r;return r}var n=Ember.get;t.register("validator:main",r)}}),Ember.Application.initializer({name:"ApplicationView",initialize:function(e,t){var i=Ember.get,o=(Ember.set,Ember.View.extend({rightSideCssClasses:function(){return i(this,"controller.fullscreenMode")?"right-side strech fullscreen":"right-side strech"}.property("controller.fullscreenMode")}));t.register("view:application",o)}}),Ember.Application.initializer({name:"EditorView",initialize:function(e,t){var i=Ember.View.extend({attrBinding:"templateData.keywords.attr.value",init:function(){var e=utils.hash.generateId(this.templateName);this.elementId=e}});t.register("view:editor",i)}}),Ember.Application.initializer({name:"FormwrapperView",after:"DragUtils",initialize:function(e,t){var i=e.lookupFactory("utility:drag"),o=Ember.get,r=Ember.set,n=Ember.isNone,a=Ember.View.extend({init:function(){this._super(),console.log("formwrapper view init",this,o(this,"controller")),r(this,"controller.widgetwrapperView",this)},didInsertElement:function(){i.setDraggable(this.$("#formwrapper .modal-title"),this.$("#formwrapper"))},willDestroyElement:function(){this.$("#formwrapper").modal("hide"),this._super()},registerHooks:function(){this.hooksRegistered=!0,console.log("registerHooks",this),this.get("controller").on("validate",this,this.hidePopup),this.get("controller").on("hide",this,this.hidePopup),this.get("controller").on("rerender",this,this.rerender);var e=this;this.$("#formwrapper").on("hidden.bs.modal",function(){e.onPopupHidden.apply(e,arguments)})},unregisterHooks:function(){this.get("controller").off("validate",this,this.hidePopup),this.get("controller").off("hide",this,this.hidePopup),this.get("controller").off("rerender",this,this.rerender)},showPopup:function(){console.log("view showPopup"),this.hooksRegistered||this.registerHooks(),this.$("#formwrapper").modal("show").css("top",0).css("left",0),o(this,"controller.form")&&o(this,"controller.form").send("show")},hidePopup:function(){console.log("view hidePopup"),this.$("#formwrapper").modal("hide")},onPopupHidden:function(){console.log("onPopupHidden",arguments);var e=o(this,"controller.form.submit");n(e)||"pending"!==e.state()||(console.info("rejecting form submission"),o(this,"controller.form").send("abort"))}});t.register("view:formwrapper",a)}}),Ember.Application.initializer({name:"ListlineView",initialize:function(e,t){var i=(Ember.set,Ember.get,Ember.View.extend({tagName:"tr",templateName:"listline",classNames:["listline"],checkChanged:function(){var e=this.$(".toggle");void 0!==e&&e.iCheck("check")}.observes("controller.isAllSelected")}));t.register("view:listline",i)}}),Ember.Application.initializer({name:"MixineditdropdownView",initialize:function(e,t){var i=window.schemasRegistry,o=(Ember.set,Ember.get),r=(Ember.isNone,Ember.View.extend({tagName:"span",templateName:"mixineditdropdown",hasEditableMixins:function(){return o(this,"editableEnabledMixins.length")||o(this,"wrapperMixins.length")}.property("editableEnabledMixins","wrapperMixins"),wrapperMixins:function(){var e=Ember.A();return o(this,"isGridLayout")&&e.pushObject({name:"gridlayout"}),e}.property("isGridLayout"),editableEnabledMixins:function(){var e=o(this,"mixins"),t=Ember.A();if(e)for(var r=0;r<e.length;r++)i.getByName(e[r].name.camelize())&&t.pushObject(e[r]);return t}.property("mixins")}));t.register("view:mixineditdropdown",r)}}),Ember.Application.initializer({name:"PartialslotView",initialize:function(e,t){var i=Ember.View.extend({canopsisConfiguration:canopsisConfiguration,showPartialslots:Ember.computed.alias("canopsisConfiguration.showPartialslots"),templateName:"partialslot",tagName:"span",slot:Ember.required()});t.register("view:partialslot",i),Ember.Handlebars.helper("partialslot",i)}}),Ember.Application.initializer({name:"RecordinfopopupView",after:"DragUtils",initialize:function(e,t){var i=e.lookupFactory("utility:drag"),o=(Ember.get,Ember.set,Ember.View.extend({didInsertElement:function(){console.log("Recordinfopopup dom element"),$(window).on("resize",function(){var e=($(window).width()-$("#recordinfopopup").outerWidth())/2;$("#recordinfopopup").css("left",e)}),i.setDraggable($("#recordinfopopup .hand"),$("#recordinfopopup"))}}));t.register("view:recordinfopopup",o)}}),Ember.Application.initializer({name:"TabledraggablethView",initialize:function(e,t){var i=Ember.get,o=Ember.set,r=Ember.View.extend({templateName:"tabledraggableth",tagName:"th",attributeBindings:["draggable","droppable"],draggable:"true",droppable:"true",click:function(){this.get("controller").send("sort",i(this,"attr"))},drag:function(e){var t=this.$().parent().children("th"),i=e.originalEvent.clientX;$(t).css({"border-right":"0"}),this.closestTh=void 0;for(var o=1/0,r=0,n=t.length;r<n;r++){var a=Math.abs($(t[r]).position().left+$(t[r]).width()-i);a<o&&(this.closestTh=t[r],o=a)}$(this.closestTh).css({"border-right":"10px solid blue"})},dragEnd:function(e){
var t=this.$().parent().children("th");$(t).css({"border-right":"0"}),console.log("permute",this.getPosition(this.$()),this.getPosition($(this.closestTh))),this.permuteColumns(this.getPosition(this.$()),this.getPosition($(this.closestTh)))},swapColumnsInDom:function(e,t){console.log("swapColumnsInDom",arguments),table=this.$().parent();var i=this.$().parent().parent().parent().find("tr");console.log("rows",i);var o;i.each(function(){o=$(this).children("th, td"),console.log("cols",o),o.eq(e+1).detach().insertAfter(o.eq(t+1))})},permuteColumns:function(e,t){var r=i(this,"controller"),n=this.getColumns();0!==e&&0!==t||(console.log("unable to perform drag and drop operation"),r.send("refreshView")),console.debug("columns before drag",n);var a=n.splice(e-1,1)[0],s=this;Ember.isNone(a)?(console.log("unable to perform drag and drop operation"),r.send("refreshView")):(console.debug("permutation is",a),console.debug("permutation is replaced between",n[t-1],"and",n[t]),e>t?n.splice(t,0,a):n.splice(t-1,0,a),console.debug("columns after drag",n),o(r,"model.user_displayed_columns",n),o(r,"displayed_columns",n),s.swapColumnsInDom(e-1,t-1),r.saveUserConfiguration())},getPosition:function(e){var t,i=this.$().parent().children("th");return i.each(function(o){if(e[0]===i.eq(o)[0])return t=o,console.log("element position is",o),!1}),t},getColumns:function(){var e=i(this,"controller.displayed_columns");if(Ember.isNone(e)){var t=i(this,"controller.shown_columns");console.debug("using shown_columns property",t),e=Ember.A();for(var o=0,r=t.length;o<r;o++)e.pushObject(i(t[o],"field"))}else console.debug("using displayed_columns property");return e}});t.register("view:tabledraggableth",r)}}),Ember.Application.initializer({name:"UserviewView",initialize:function(e,t){var i=Ember.get,o=(Ember.set,Ember.isNone,Ember.View.extend({actions:{refreshView:function(){this.rerender()}},hookRegistered:!1,registerHooks:function(){i(this,"hookRegistered")||(i(this,"controller").on("refreshView",this,this.rerender),this.set("hookRegistered",!0))},unregisterHooks:function(){i(this,"controller").off("refreshView",this,this.rerender),this.set("hookRegistered",!1)},rerender:function(){if(console.info("refreshing view",this),"destroying"===i(this,"state"))return void console.warn("view is being destroying, cancel refresh");this._super.apply(this,arguments),this.registerHooks()},didInsertElement:function(){return console.log("inserted view",this),this.registerHooks(),$("#loading").remove(),$("#loadingInfo").remove(),$("#moduleList").remove(),this._super.apply(this,arguments)},willClearRender:function(){return this.unregisterHooks(),this._super.apply(this,arguments)}}));t.register("view:userview",o)}}),Ember.Application.initializer({name:"component-validationtextarea",after:"ValidationFieldMixin",initialize:function(e,t){var i=e.lookupFactory("mixin:validation-field"),o=Ember.TextArea.extend(i,{});t.register("component:component-validationtextarea",o),Ember.Handlebars.helper("component-validationtextarea",o)}}),Ember.Application.initializer({name:"component-validationtextfield",after:"ValidationFieldMixin",initialize:function(e,t){var i=e.lookupFactory("mixin:validation-field"),o=Ember.TextField.extend(i,{});t.register("component:component-validationtextfield",o)}}),Ember.Application.initializer({name:"WidgetView",after:["WidgetsRegistry","MixinFactory","WidgetController","MixinsRegistry"],initialize:function(e,t){function i(e,t){var i=s(t,"mixins"),o=[];console.log("computeMixinsArray",i,t);var r={};if(i){for(var l=0,c=i.length;l<c;l++){var d=i[l];"string"==typeof d?Ember.deprecate("Defining mixins as strings is deprecated. The new format is : '{ name: \"mixinName\" }'. This is required by the mixin options system."):d=d.name.camelize(),r[d]=i[l];var u=n.getByName(d);console.log("find mixin",d,u);var m=a.getByName(d);if(void 0!==m){m=m.EmberModel;var p=m.proto().userPreferencesModel;console.log("mixinModel",p);var g=s(p,"attributes");console.log("mixinModelAttributes",g),g.forEach(function(e){t.userPreferencesModel[e.name]=p[e.name],t.userPreferencesModel.attributes.add(e)})}u?o.pushObject(u.EmberClass):(s(e,"displayedErrors").pushObject("mixin not found : "+d),console.error("mixin not found",d))}var f=e.get("controller");f.onMixinsApplied&&f.onMixinsApplied()}return o.pushObject(Ember.Evented),{array:o,mixinOptions:r}}var o,o=e.lookupFactory("registry:widgets"),r=(e.lookupFactory("factory:mixin"),e.lookupFactory("controller:widget")),n=e.lookupFactory("registry:mixins"),a=window.schemasRegistry,s=Ember.get,l=Ember.set,c=(Ember.isNone,Ember.View.extend({templateName:"widget",classNames:["widget"],errorMessages:Ember.A(),widgetController:void 0,init:function(){console.group("widget initialisation :",s(this,"widget.xtype"),this.widget,s(this,"widget.tagName")),l(this,"target",s(this,"controller")),this._super(),l(this,"displayedErrors",Ember.A()),s(this,"widget")?(this.intializeController(this.widget),this.applyAllViewMixins()):(console.error("No correct widget found for view",this),this.errorMessages.pushObject("No correct widget found")),s(this,"widget.tagName")&&(console.log("custom tagName",s(this,"widget.tagName")),l(this,"tagName",s(this,"widget.tagName")));var e=s(this,"widget.cssClass");e&&(console.log("custom tagName",s(this,"widget.tagName")),l(this,"classNames",e.split(","))),console.groupEnd()},applyAllViewMixins:function(){var e=s(this,"controller");if(console.group("apply widget view mixins",e.viewMixins),void 0!==e.viewMixins)for(var t=0,i=e.viewMixins.length;t<i;t++){var o=e.viewMixins[t];console.log("mixinToApply",o),void 0!==o.mixins[0].properties.init&&console.warn("The mixin",o,"have a init method. This practice is not encouraged for view mixin as they are applied at runtime and the init method will not be triggerred"),o.apply(this)}console.groupEnd()},intializeController:function(e){console.group("set controller for widget",e);var t=this.instantiateCorrectController(e),i=s(e,"xtype");"text"===i&&(i="textwidget"),this.setProperties({controller:t,templateName:i}),e.set("controller",t),this.registerHooks(),console.groupEnd()},instantiateCorrectController:function(e){console.log("instantiateCorrectController",arguments);var t=s(e,"xtype");void 0!==t&&null!==t||console.error("no xtype for widget",e,this);var a=i(this,e);a.array.pushObject({model:e,target:s(this,"target")});var l,c=o.getByName(s(e,"xtype"));c=void 0!==c?c.EmberClass:r,l=c.createWithMixins.apply(c,a.array),l.refreshPartialsList(),Ember.setProperties(l,{"model.displayedErrors":s(this,"displayedErrors"),mixinOptions:a.mixinOptions}),l.mixinsOptionsReady();var d=s(e,"mixins");if(d)for(var u=0,m=d.length;u<m;u++){var p=d[u],g=n.all[p];g&&g.apply(l)}return l},didInsertElement:function(){return console.log("inserted widget, view:",this),this.registerHooks(),this._super.apply(this,arguments)},willDestroyElement:function(){return clearInterval(s(this,"widgetRefreshInterval")),this.unregisterHooks(),this._super.apply(this,arguments)},onWidgetRefresh:function(){},registerHooks:function(){return console.log("registerHooks",s(this,"controller"),s(this,"controller").on),s(this,"controller").on("refresh",this,this.rerender),this._super()},unregisterHooks:function(){return s(this,"controller").off("refresh",this,this.rerender),this._super()}}));o=e.lookupFactory("registry:widgets"),Ember.Handlebars.helper("widgethelper",c),t.register("view:widget",c)}}),Ember.Application.initializer({name:"WidgetslotView",initialize:function(e,t){var i=Ember.get,o=Ember.set,r=Ember.View.extend({init:function(){console.log("widgetslot init",i(this,"controller.content.widgetslotTemplate"));var e=i(this,"controller.content.widgetslotTemplate");void 0!==e&&null!==e&&void 0!==Ember.TEMPLATES[e]&&o(this,"templateName",e),this._super.apply(this,arguments)},templateName:"widgetslot-default",classNames:["widgetslot"]});Ember.Handlebars.helper("widgetslot",r),t.register("view:widgetslot",r)}});
//# sourceMappingURL=dist/brick.map.js