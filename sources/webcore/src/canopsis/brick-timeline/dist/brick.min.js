Ember.Application.initializer({name:"TimelineAdapter",after:["ApplicationAdapter"],initialize:function(t,e){var a=t.lookupFactory("adapter:application"),o=a.extend({findQuery:function(t,e,a,o){var n="/alerts/get-alarms?";return n+=$.param(o),this.ajax(n,"GET")}});e.register("adapter:timeline",o)}}),Ember.Application.initializer({name:"component-timeline",after:["DataUtils","HashUtils"],initialize:function(t,e){var a=t.lookupFactory("utility:data"),o=Ember.get,n=Ember.set,r=window.moment;__=Ember.String.loc;var c=__("unknown"),i=Ember.Component.extend({timelineData:void 0,statusToName:{ack:__("Acknowledged by "),ackremove:__("Ack removed by "),assocticket:__("Ticket association by "),declareticket:__("Ticket declared by "),cancel:__("Canceled by "),comment:__("Comment by "),uncancel:__("Restored by "),statusinc:__("Status increased"),statusdec:__("Status decreased"),stateinc:__("State increased"),statedec:__("State decreased"),changestate:__("State changed"),snooze:__("Snoozed by "),statecounter:__("Cropped states (since last change of status)"),done:__("Mark as done by "),hardlimit:__("Hard limit reached !")},authoredName:["ack","ackremove","assocticket","declareticket","cancel","comment","uncancel","snooze","done"],stateArray:["Ok","Minor","Major","Critical"],statusArray:["off","ongoing","stealthy","bagot","canceled"],colorArray:["bg-green","bg-yellow","bg-orange","bg-red"],iconsAndColors:{ack:{icon:"fa-check",color:"bg-purple"},ackremove:{icon:"glyphicon glyphicon-ban-circle",color:"bg-purple"},assocticket:{icon:"fa-ticket",color:"bg-blue"},declareticket:{icon:"fa-ticket",color:"bg-blue"},cancel:{icon:"glyphicon glyphicon-trash",color:"bg-gray"},comment:{icon:"fa-comment-o",color:"bg-teal"},uncancel:{icon:"glyphicon glyphicon-share",color:"bg-gray"},statusinc:{icon:"fa-chevron-up",color:"bg-gray"},statusdec:{icon:"fa-chevron-down",color:"bg-gray"},stateinc:{icon:"fa-flag",color:void 0},statedec:{icon:"fa-flag",color:void 0},changestate:{icon:"fa-flag",color:void 0},snooze:{icon:"fa-clock-o",color:"bg-fuchsia"},statecounter:{icon:"fa-scissors",color:"bg-black"},done:{icon:"fa-check-square",color:"bg-olive"},hardlimit:{icon:"fa-warning",color:"bg-red"},long_output:{icon:"fa-warning",color:"bg-red"}},addAuthor:["stateinc","statedec","changestate","statusinc","statusdec"],didInsertElement:function(){var t=this,e=o(t,"timelineData"),i=a.getEmberApplicationSingleton().__container__.lookup("adapter:timeline"),s=JSON.stringify({d:e.entity_id,"v.creation_date":e["v.creation_date"]}),l={filter:s,opened:!0,resolved:!0,sort_key:"t",sort_dir:"DESC",limit:1,with_steps:!0};i.findQuery("alarm","get-current-alarm",void 0,l).then(function(e){var a=void 0,i=[];if(e.data.length>0&&e.data[0].alarms.length>0){for(var s=e.data[0].alarms[0].v.steps.length-1;s>=0;s--){var l=e.data[0].alarms[0].v.steps[s],d="",m=new Date(1e3*l.t);if(l.date=r(m).format("LL"),l.date!=a?l.showDate=!0:l.showDate=!1,l.time=r(m).format("HH:mm:ss"),l._t in o(t,"iconsAndColors")){if(l.color=o(t,"iconsAndColors")[l._t].color,l.icon=o(t,"iconsAndColors")[l._t].icon,l.color||(l.color=o(t,"colorArray")[l.val]),l._t.indexOf("state")>=0&&(l.state=o(t,"stateArray")[l.val]),l._t.indexOf("status")>=0&&(l.status=o(t,"statusArray")[l.val]),"snooze"===l._t){var _=new Date(1e3*l.val);l.until=r(_).format("HH:mm:ss")}if("statecounter"===l._t){l.m='<table class="table table-hover"><tbody>',l.m+="<tr><th>State increases</th><th>"+l.val.stateinc+"</th></tr>",l.m+="<tr><th>State decreases</th><th>"+l.val.statedec+"</th></tr>";for(v in l.val)if(v.startsWith("state:")){var g=parseInt(v.replace("state:",""),10),u=o(t,"stateArray")[g];l.m+="<tr><th>State "+u+"</th><th>"+l.val[v]+"</th></tr>"}l.m+="</tbody></table>"}d=o(t,"statusToName")[l._t],t.get("addAuthor").includes(l._t)?l.a.indexOf(".")>-1?l.name=d+" "+__("by ")+c:l.name=d+" "+__("by ")+l.a:(l.name=d,-1!=o(t,"authoredName").indexOf(l._t)&&(l.name+=l.a)),"assocticket"===l._t&&(l.m+=" "+l.val),void 0===l.state&&void 0===l.status&&(author=l.a,console.error("*** Author",author),l.name=__("update_output")+__("by"),l.icon="fa-pencil",l.color="bg-grey"),i.push(l),a=l.date}else console.warn('Unknown step "'+l._t+'" : skipping')}n(t,"steps",i)}},function(t){console.error("ERROR in the adapter: ",t)})}});e.register("component:component-timeline",i)}});
//# sourceMappingURL=dist/brick.map.js