<template lang="pug">
  div
    h2.text-xs-center.my-3.display-1.font-weight-medium Webhooks
    v-data-table(
    :items="webhooks",
    item-key="_id"
    :headers="headers",
    :loading="webhooksPending",
    expand
    )
      template(slot="items", slot-scope="props")
        tr(@click="props.expanded = !props.expanded")
          td {{ props.item._id }}
          td {{ props.item.request.method }}
          td {{ props.item.request.url }}
          td
            v-layout
              v-btn(@click.stop="showEditWebhookModal(props.item)", icon, small)
                v-icon edit
              v-btn(@click.stop="showDuplicateWebhookModal(props.item)", icon, small)
                v-icon file_copy
              v-btn(@click.stop="showRemoveWebhookModal(props.item._id)", icon, small)
                v-icon.error--text delete
      template(slot="expand", slot-scope="props")
        v-tabs(centered)
          v-tab Hook
          v-tab Request
          v-tab Declare ticket
          v-tab-item
            v-card
              v-card-text
                v-layout
                  v-flex(xs6)
                    v-data-iterator(:items="props.item.hook.triggers")
                  v-flex(xs6)
                    v-data-iterator(:items="props.item.hook.triggers")
          v-tab-item
            v-card
              v-card-text
                v-list
                  v-list-tile
                    v-list-tile-content Method:
                    v-list-tile-content.allign-end {{ props.item.request.method }}
                  v-list-tile
                    v-list-tile-content URL:
                    v-list-tile-content.allign-end {{ props.item.request.url }}
            h2 Request
          v-tab-item
            h2 Declare ticket
    .fab
      v-layout(column)
        refresh-btn(@click="refreshWebhooksList")
        v-tooltip(left)
          v-btn(slot="activator", @click="showCreateWebhookModal", color="primary", dark, fab, icon)
            v-icon add
          span Create modal
</template>

<script>
import { MODALS } from '@/constants';

import modalMixin from '@/mixins/modal';
import entitiesWebhookMixin from '@/mixins/entities/webhook';

import RefreshBtn from '@/components/other/view/refresh-btn.vue';

export default {
  components: { RefreshBtn },
  mixins: [modalMixin, entitiesWebhookMixin],
  data() {
    return {
      headers: [
        {
          text: 'ID',
          value: '_id',
        },
        {
          text: 'Request method',
          value: 'request.method',
        },
        {
          text: 'Request URL',
          value: 'request.url',
        },
        {
          text: this.$t('common.actions'),
          sortable: false,
        },
      ],
    };
  },
  mounted() {
    this.fetchWebhooksList();
  },
  methods: {
    showCreateWebhookModal() {
      this.showModal({
        name: MODALS.createWebhook,
      });
    },
    showEditWebhookModal() {

    },
    showDuplicateWebhookModal() {

    },
    showRemoveWebhookModal() {

    },
  },
};
</script>

