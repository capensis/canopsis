<template lang="pug">
  div
    actions-list(
    :showDeleteActionModal="showDeleteActionModal",
    :showEditActionModal="showEditActionModal",
    :showDeleteSelectedActionsModal="showDeleteSelectedActionsModal",
    :showDuplicateActionModal="showDuplicateActionModal",
    )
    .fab
      v-layout(column)
        refresh-btn(@click="refreshActionsList")
        v-tooltip(left)
          v-btn(
          slot="activator",
          color="primary",
          fab,
          dark,
          @click.stop="showCreateActionModal"
          )
            v-icon add
          span {{ $t('actions.addAction') }}
</template>

<script>
import { MODALS } from '@/constants';

import ActionsList from '@/components/other/action/actions-list.vue';
import RefreshBtn from '@/components/other/view/refresh-btn.vue';

import entitiesActionMixin from '@/mixins/entities/action';
import popupMixin from '@/mixins/popup';
import modalMixin from '@/mixins/modal';

export default {
  components: {
    ActionsList,
    RefreshBtn,
  },
  mixins: [entitiesActionMixin, popupMixin, modalMixin],
  mounted() {
    this.fetchActionsList();
  },
  methods: {
    showCreateActionModal() {
      this.showModal({
        name: MODALS.createAction,
        config: {
          action: async (data) => {
            await this.createAction({ data });
            this.addSuccessPopup({ text: this.$t('modals.createAction.create.success') });
            this.refreshActionsList();
          },
        },
      });
    },

    showEditActionModal(item) {
      this.showModal({
        name: MODALS.createAction,
        config: {
          item,
          action: async (data) => {
            await this.updateAction({ data, id: item._id });
            this.addSuccessPopup({ text: this.$t('modals.createAction.edit.success') });
            this.refreshActionsList();
          },
        },
      });
    },

    showDuplicateActionModal(item) {
      this.showModal({
        name: MODALS.createAction,
        config: {
          item,
          isDuplicating: true,
          action: async (data) => {
            await this.createAction({ data, id: item._id });
            this.addSuccessPopup({ text: this.$t('modals.createAction.duplicate.success') });
            this.refreshActionsList();
          },
        },
      });
    },

    showDeleteActionModal(id) {
      this.showModal({
        name: MODALS.confirmation,
        config: {
          action: async () => {
            await this.removeAction({ id });
            this.addSuccessPopup({ text: this.$t('modals.createAction.remove.success') });
            this.refreshActionsList();
          },
        },
      });
    },

    showDeleteSelectedActionsModal(selected) {
      this.showModal({
        name: MODALS.confirmation,
        config: {
          action: async () => {
            await Promise.all(selected.map(action => this.removeAction({ id: action._id })));

            this.refreshActionsList();
            this.selected = [];
          },
        },
      });
    },
  },
};
</script>

