<template lang="pug">
  div
    h2.text-xs-center.my-3.display-1.font-weight-medium {{ $t('snmpRules.title') }}
    div.white
      v-layout(v-if="hasDeleteAnySnmpRuleAccess", row, wrap)
        v-flex(v-show="selected.length", xs4)
          v-btn(icon, @click="showDeleteSelectedSnmpRulesModal(selected)")
            v-icon(color="error") delete
      v-data-table.v-table-small(
        v-model="selected",
        :items="items",
        :loading="pending",
        :headers="headers",
        item-key="_id",
        hide-actions,
        select-all
      )
        template(slot="items", slot-scope="props")
          tr
            td
              v-checkbox(v-model="props.selected", primary, hide-details)
            td
              snmp-rules-list-item-cell(
                :fields="['mibName', 'moduleName']",
                :source="props.item.oid"
              )
            td
              snmp-rules-list-item-cell(
                :fields="['value', 'regex']",
                :source="props.item.output"
              )
            td
              snmp-rules-list-item-cell(
                :fields="['value', 'regex']",
                :source="props.item.resource"
              )
            td
              snmp-rules-list-item-cell(
                :fields="['value', 'regex']",
                :source="props.item.component"
              )
            td
              template(v-if="props.item.state.type === $constants.SNMP_STATE_TYPES.template")
                snmp-rules-list-item-cell(
                  :fields="[...Object.keys($constants.ENTITIES_STATES), 'type']",
                  :source="props.item.state"
                )
                snmp-rules-list-item-cell(
                  :fields="['stateoid']",
                )
                div.pl-3
                  snmp-rules-list-item-cell(
                    :fields="['value', 'regex', 'formatter']",
                    :source="props.item.state.stateoid"
                  )
              template(v-else)
                snmp-rules-list-item-cell(
                  :fields="['state', 'type']",
                  :source="props.item.state"
                )
            td
              v-layout
                v-flex
                  v-btn(
                    v-if="hasUpdateAnySnmpRuleAccess",
                    icon,
                    small,
                    @click="showEditSnmpRuleModal(props.item)"
                  )
                    v-icon edit
                  v-btn.error--text(
                    v-if="hasDeleteAnySnmpRuleAccess",
                    icon,
                    small,
                    @click="showDeleteSnmpRuleModal(props.item._id)"
                  )
                    v-icon(color="error") delete
    v-layout.white(align-center)
      v-flex(xs10)
        pagination(
          :page="query.page",
          :limit="query.limit",
          :total="meta.total",
          @input="updateQueryPage"
        )
      v-spacer
      v-flex(xs2)
        records-per-page(v-model="query.limit")
</template>

<script>
import rightsTechnicalExploitationSnmpRuleMixin from '@/mixins/rights/technical/exploitation/snmp-rule';

import Pagination from '@/components/tables/pagination.vue';
import RecordsPerPage from '@/components/tables/records-per-page.vue';

import SnmpRulesListItemCell from './snmp-rules-list-item-cell.vue';

export default {
  components: {
    Pagination,
    RecordsPerPage,
    SnmpRulesListItemCell,
  },
  mixins: [rightsTechnicalExploitationSnmpRuleMixin],
  props: {
    query: {
      type: Object,
      required: true,
    },
    items: {
      type: Array,
      default: () => [],
    },
    meta: {
      type: Object,
      default: () => ({}),
    },
    pending: {
      type: Boolean,
      default: true,
    },
    showEditSnmpRuleModal: {
      type: Function,
      default: () => () => {
      },
    },
    showDeleteSnmpRuleModal: {
      type: Function,
      default: () => () => {
      },
    },
    showDeleteSelectedSnmpRulesModal: {
      type: Function,
      default: () => () => {
      },
    },
  },
  data() {
    return {
      selected: [],
    };
  },
  computed: {
    headers() {
      return [
        { text: this.$t('modals.createSnmpRule.fields.oid.title'), sortable: false },
        { text: this.$t('modals.createSnmpRule.fields.output.title'), sortable: false },
        { text: this.$t('modals.createSnmpRule.fields.resource.title'), sortable: false },
        { text: this.$t('modals.createSnmpRule.fields.component.title'), sortable: false },
        { text: this.$t('modals.createSnmpRule.fields.state.title'), sortable: false },
        { text: this.$t('common.actionsLabel'), sortable: false },
      ];
    },
  },
  watch: {
    query() {
      this.selected = [];
    },

    items() {
      this.selected = [];
    },
  },
  methods: {
    updateQueryPage(page) {
      this.$emit('update:query', { ...this.query, page });
    },
  },
};
</script>

<style lang="scss">
  .v-table-small table.v-table {
    tbody td:first-child,
    tbody td:not(:first-child),
    tbody th:first-child,
    tbody th:not(:first-child),
    thead td:first-child,
    thead td:not(:first-child),
    thead th:first-child,
    thead th:not(:first-child) {
      padding: 0 10px;
    }
  }
</style>
