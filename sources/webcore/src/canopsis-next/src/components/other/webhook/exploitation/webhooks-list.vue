<template lang="pug">
  div
    h2.text-xs-center.my-3.display-1.font-weight-medium {{ $t('webhook.title') }}
    .white
      v-layout(row, wrap)
        v-flex(v-show="selected.length", xs4)
          v-btn(icon, @click="showDeleteSelectedWebhooksModal(selected)")
            v-icon(color="error") delete
      v-data-table(
      v-model="selected",
      :items="webhooks",
      :headers="headers",
      :loading="pending",
      item-key="_id",
      select-all,
      expand
      )
        template(slot="items", slot-scope="props")
          tr(@click="props.expanded = !props.expanded")
            td(@click.stop="")
              v-checkbox-functional(v-model="props.selected", primary, hide-details)
            td {{ props.item._id }}
            td {{ props.item.request.method }}
            td {{ props.item.request.url }}
            td
              v-layout
                v-btn(
                v-if="hasUpdateAnyWebhookAccess",
                icon,
                small,
                @click.stop="showEditWebhookModal(props.item)"
                )
                  v-icon edit
                v-btn(
                v-if="hasDeleteAnyWebhookAccess",
                icon,
                small,
                @click.stop="showRemoveWebhookModal(props.item._id)"
                )
                  v-icon.error--text delete
        template(slot="expand", slot-scope="{ item }")
          webhook-form(:form="item | webhookToForm", dark, disabled)
</template>

<script>
import webhookFormFiltersMixin from '@/mixins/webhook/form-filters';
import rightsTechnicalExploitationWebhookMixin from '@/mixins/rights/technical/exploitation/webhook';

import WebhookForm from '@/components/other/webhook/form/webhook-form.vue';

export default {
  components: {
    WebhookForm,
  },
  mixins: [
    webhookFormFiltersMixin,
    rightsTechnicalExploitationWebhookMixin,
  ],
  props: {
    webhooks: {
      type: Array,
      default: () => [],
    },
    pending: {
      type: Boolean,
      default: true,
    },
    showEditWebhookModal: {
      type: Function,
      default: () => () => {},
    },
    showDeleteWebhookModal: {
      type: Function,
      default: () => () => {},
    },
    showDeleteSelectedWebhooksModal: {
      type: Function,
      default: () => () => {},
    },
  },
  data() {
    return {
      selected: [],
    };
  },
  computed: {
    headers() {
      return [
        {
          text: this.$t('webhook.table.headers.id'),
          value: '_id',
        },
        {
          text: this.$t('webhook.table.headers.requestMethod'),
          value: 'request.method',
        },
        {
          text: this.$t('webhook.table.headers.requestUrl'),
          value: 'request.url',
        },
        {
          text: this.$t('common.actionsLabel'),
          sortable: false,
        },
      ];
    },
  },
  watch: {
    webhooks() {
      this.selected = [];
    },
  },
};
</script>

