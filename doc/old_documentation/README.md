Documenting Canopsis with sphinx
================================

The current documentation handling has been setup to improve maintenability and
cohenrency. Everything is stored in its related repository. This modular doc 
can either be built independently or be configured to be built via a script :
doc_builder.py.

1. Structure
------------
1.1. Where can I find sources ?
-------------------------------
The documentation available on http://canopsis.org/learn is composed of three 
main parts : Ficus, Sakura and Connectors. Ficus and Sakura's sources are 
versioned on canopsis' github repository. The doc about connectors is composed 
of a generic part about connectors and one/two pages about each connector. 
Each version of canopsis and each connector has a doc folder at the root of 
its repository.
Some files (ie the root index and the generic doc about connectors) have no 
place in this modular documentation handling. Those files are versioned in the 
canopsis-doc repository, in sphinx_index folder.

1.2. Static vs autogenerated
----------------------------
The main part of the documentation is static : written in .rst files by 
Canopsis' team. Sakura's developer-guide have an 'API' folder that will be 
filled with auto-generated documentation by doc_builder.py [1].
Auto-generated doc is read from sources' docstrings as it were in a rst file.
In short, all you need to do is write docstrings in rst.
Exemple and template can be found in canopsis-doc:sphinx_index/howto-rst.html.

[1] Only Sakura is concerned. Ficus had not such a documentation in docstrings 
and it would take too much time to write it.

2. Tree view
------------
Below a description of files/directories in doc folders for canopsis and 
connectors :

2.1 Canopsis versions
---------------------
  - conf.py : Sphinx configuration. This is close to the default conf.
  - Makefile : Allows you to just type "make html" to compile .rst files.
  - \_themes : HTML themes.
  - index.rst : Main index. Users hit this page first.
  - user-guide, administrator-guide, developer-guide : Main sub-folders.
  - includes : Ignored when compiling rst files. Mostly used to record internal
    links.
  - glossary.rst
  - \_static : This folder is defined in conf.py to be static, meaning it will 
    be ignored during the compilation process, and copied as is at the end. 
    This is useful for images path, custom css, .htaccess, etc.

2.2 Connectors
--------------
Documentations about connectors can _not_ be built independently. Only 
fetch_doc.py can build it for you. That's why you must follow this 
convention :
  - <files>.rst : Documentation about this connector. You can have as many 
    as you want.
  - img : This is where you store images.
  - Do not store images nor rst files in a subfolder or fetch_doc will just 
    ignore it.

3. How to build documentation ?
-------------------------------
You can build a standalone documentation (ie just Ficus or just Sakura), by 
typing "make html" (or 'pdf' or whatever sphinx allows) in the appropriate doc 
directory. Be sure to have python package Sphinx installed.
If you want a global documentation, you must be in a canopsis environnement, in 
~canopsis. Configure doc_builder.json to include what you want. Calling 
doc_builder.py does the job.
Outputs can be dropped in a web folder.

3.a doc_builder.json
--------------------
  - sphinx_index : core documentation to link subparts.
  - html_index_titles : HTML tags in the root index for main parts.
  - versions : ficus/sakura and their doc folder.
  - auto_libs : sources to autodocument. `packages` refers to the pattern where 
    packages are located (can be written with bash regexps). `versions` refers 
    to the version if multiple versions need to be autodocumented (but only 
    sakura is concerned at the moment).
  - autodoc_directory : where to drop autodocumented rst files
  - connectors : same as versions, but for connectors
  - log_file : the whole process is verbose, so everything is logged in this 
    file for potential analysis.

4. Best practices
-----------------
You'll find bellow a non exhaustive list of best practices to help you keeping 
clean/clear .rst files and doc tree.
  - Do not multiply subfolders, especially if they contain only one file.
  - Store images in the static folder.
  - Use the /includes folder if you need inclusions.
  - Feel free to add links in the include/links and entries to the glossary.
  - _Build after modifications and check sphinx error log._

# TODO: Traductions
5. Traductions
--------------
5.1 Initialization
------------------
Sphinx can handle multiple languages through sphinx-intl package.
  pip install sphinx-intl

Add a new language, say uzbek :
  make gettext
  sphinx-intl update -p \_build/locale -l uzb
  ls locale/uzb/LC\_MESSAGES/

  sphinx-intl build
  make -e SPHINXOPTS="-D language='uzb'" html
Building allows to compile strings in a 'binary catalog' for effiency reasons 
while make makes the job done.

5.2 How to update ?
-------------------

source : http://sphinx-doc.org/intl.html
