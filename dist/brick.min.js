Ember.Application.initializer({name:"AlertExpressionAdapter",after:["ApplicationAdapter"],initialize:function(e,t){var i=e.lookupFactory("adapter:application"),r=i.extend({findQuery:function(e,t){return this.ajax("/alerts/search/validate","GET",{data:t})}});t.register("adapter:alertexpression",r)}}),Ember.Application.initializer({name:"AlertsAdapter",after:["ApplicationAdapter"],initialize:function(e,t){var i=e.lookupFactory("adapter:application"),r=i.extend({findQuery:function(e,t,i){return"get-current-alarm"==t?this.ajax("/alerts/get-current-alarm","GET",{data:i}):this.ajax("/alerts/get-alarms","GET",{data:t})}});t.register("adapter:alerts",r)}}),Ember.Application.initializer({name:"component-alarmactions",initialize:function(e,t){var i=(Ember.get,Ember.set,Ember.isNone,Ember.Component.extend({tagName:"td",classNames:["action-cell"],actionsMap:Ember.A([{class:"glyphicon glyphicon-saved",internal_states:["unacked"],name:"ack",mixin_name:"ack"},{class:"glyphicon glyphicon-ok",internal_states:["unacked"],name:"fastack",mixin_name:"fastack"},{class:"glyphicon glyphicon-ban-circle",internal_states:["acked"],name:"cancelack",mixin_name:"ackremove"},{class:"fa fa-ticket",internal_states:["acked","cancelled"],name:"declareanincident",mixin_name:"declareticket"},{class:"fa fa-thumb-tack",internal_states:["acked","cancelled"],name:"assignticketnumber",mixin_name:"assocticket"},{class:"fa fa-calendar-o",internal_states:["immutable","unacked","acked","cancelled"],name:"pbehavior",mixin_name:"pbehavior"},{class:"glyphicon glyphicon-trash",internal_states:["acked"],name:"removealarm",mixin_name:"cancelack"},{class:"fa fa-exclamation-triangle",internal_states:["acked"],name:"changecriticity",mixin_name:"changestate"},{class:"glyphicon glyphicon-share-alt",internal_states:["cancelled"],name:"restorealarm",mixin_name:"recovery"},{class:"fa fa-clock-o",internal_states:["unacked","acked","cancelled"],name:"snoozealarm",mixin_name:"snooze"}]),init:function(){this._super()},availableActions:function(){var e=this.get("internalState"),t=this.get("actionsMap").filter(function(t,i,r){return t.internal_states.includes(e)});return this.get("isSnoozed")&&t.removeObject(t.findBy("mixin_name","snooze")),this.get("isChangedByUser")&&t.removeObject(t.findBy("mixin_name","cancelack")),t}.property("internalState","isSnoozed","isChangedByUser"),internalState:function(){return 0==this.get("alarm.state.val")?"immutable":this.get("isCanceled")?"cancelled":this.get("isAcked")?"acked":"unacked"}.property("alarm.state.val","isCanceled","isAcked"),isAcked:function(){return void 0!=this.get("alarm.extra_details.ack")}.property("alarm.changed","alarm.extra_details"),isCanceled:function(){return void 0!=this.get("alarm.canceled")}.property("alarm.canceled"),isSnoozed:function(){return void 0!=this.get("alarm.extra_details.snooze")}.property("alarm.extra_details.snooze"),hasLinks:function(){return this.get("alarm.linklist.event_links.length")>0}.property("alarm.linklist.event_links"),isChangedByUser:function(){return"changestate"==this.get("alarm.state._t")}.property("alarm.state._t"),actions:{sendAction:function(e){this.sendAction("action",e,this.get("alarm"))}}}));t.register("component:component-alarmactions",i)}}),Ember.Application.initializer({name:"component-alarmraw",initialize:function(e,t){var i=Ember.get,r=Ember.set,n=(Ember.isNone,Ember.Component.extend({tagName:"tr",init:function(){this._super(),r(this,"alarm",i(this,"alarm")),r(this,"fields",i(this,"fields"))},expandClass:function(){return"glyphicon "+(this.get("alarm.isExpanded")?"glyphicon-minus":"glyphicon-plus")}.property("alarm.isExpanded"),actions:{tdClick:function(e,t){this.sendAction("action",e,t)},sendAction:function(e,t){this.sendAction("saction",e,t)},expand:function(){this.toggleProperty("alarm.isExpanded")}}}));t.register("component:component-alarmraw",n)}}),Ember.Application.initializer({name:"component-alarmstate",initialize:function(e,t){var i=Ember.get,r=Ember.set,n=Ember.isNone,o=Ember.Component.extend({state:void 0,isSelected:0,init:function(){this._super(),n(this.get("content"))||r(this,"state",i(this,"content.state"))},onUpdate:function(){this.set("content",{state:i(this,"state")})}.observes("state")});t.register("component:component-alarmstate",o)}}),Ember.Application.initializer({name:"component-alarmtable",initialize:function(e,t){var i=Ember.get,r=(Ember.set,Ember.isNone,Ember.Component.extend({init:function(){this._super(),this.set("isAllChecked",!1)},allSelectionObserver:function(){var e=this.get("isAllChecked");this.get("alarms").setEach("isSelected",e)}.observes("isAllChecked"),currentSortColumn:function(){return i(this,"defaultSortColumn")}.property("defaultSortColumn"),columnsAmount:function(){return this.get("fields.length")+3}.property("fields.length"),actions:{click:function(e){e==this.get("currentSortColumn")?this.set("currentSortColumn.isASC",!this.get("currentSortColumn.isASC")):(this.set("currentSortColumn.isSortable",!1),this.set("currentSortColumn",e),this.set("currentSortColumn.isSortable",!0),this.set("currentSortColumn.isASC",!0)),this.sendAction("action",this.get("currentSortColumn"))},tdClick:function(e,t){Ember.columnTemplates.findBy("columnName",t.humanName)&&(this.set("clickedAlarm",e),this.set("clickedField",t),this.set("updater",(new Date).getTime()))},sendAction:function(e,t){this.sendAction("saction",e,t)}}}));t.register("component:component-alarmtable",r)}}),Ember.Application.initializer({name:"component-alarmtd",initialize:function(e,t){var i=Ember.get,r=(Ember.set,Ember.isNone,Ember.Component.extend({tagName:"td",renderers:["v_state","v_state_t","v_status","v_extra_details"],init:function(){this._super()},click:function(){this.sendAction("action",this.get("alarm"),this.get("field"))},value:function(){return i(this,"alarm")[i(this,"field").humanName]}.property("alarm.changed","field"),hasRenderer:function(){return this.get("renderers").includes(this.get("field.name").replace(/\./g,"_"))}.property("alarm"),renderer:function(){return this.get("field.name").replace(/\./g,"_")}.property("alarm.name")}));t.register("component:component-alarmtd",r)}}),Ember.Application.initializer({name:"component-columntemplate",initialize:function(e,t){var i=Ember.get,r=Ember.set,n=Ember.isNone,o=Ember.Component.extend({template:void 0,column:void 0,init:function(){this._super(),n(this.get("content"))||(r(this,"column",i(this,"content.column")),r(this,"template",i(this,"content.template")))},onUpdate:function(){this.set("content",{column:i(this,"column"),template:i(this,"template")})}.observes("template","column")});t.register("component:component-columntemplate",o)}}),Ember.Application.initializer({name:"component-customtimeline",after:["DataUtils","HashUtils"],initialize:function(e,t){var i=e.lookupFactory("utility:data"),r=Ember.get,n=Ember.set,o=(Ember.isNone,Ember.Component.extend({tagName:"tr",classNameBindings:["isHidden:invisible"],isHidden:function(){return!this.get("alarm.isExpanded")}.property("alarm.isExpanded"),timelineData:void 0,statusToName:{ack:"Acknowledged by ",ackremove:"Ack removed by ",assocticket:"Ticket association by ",declareticket:"Ticket declared by ",cancel:"Canceled by ",uncancel:"Restored by ",statusinc:"Status increased",statusdec:"Status decreased",stateinc:"State increased",statedec:"State decreased",changestate:"State changed",snooze:"Snoozed by "},stateArray:["Ok","Minor","Major","Critical"],statusArray:["off","ongoing","stealthy","bagot","canceled"],colorArray:["bg-green","bg-yellow","bg-orange","bg-red"],iconsAndColors:{ack:{icon:"fa-check",color:"bg-purple"},ackremove:{icon:"glyphicon glyphicon-ban-circle",color:"bg-purple"},assocticket:{icon:"fa-ticket",color:"bg-blue"},declareticket:{icon:"fa-ticket",color:"bg-blue"},cancel:{icon:"glyphicon glyphicon-trash",color:"bg-gray"},uncancel:{icon:"glyphicon glyphicon-share",color:"bg-gray"},statusinc:{icon:"fa-chevron-up",color:"bg-gray"},statusdec:{icon:"fa-chevron-down",color:"bg-gray"},stateinc:{icon:"fa-flag",color:void 0},statedec:{icon:"fa-flag",color:void 0},changestate:{icon:"fa-flag",color:void 0},snooze:{icon:"fa-clock-o",color:"bg-fuchsia"}},init:function(){this._super()},stepsLoader:function(){if(!this.get("isHidden")){var e=this,t=i.getEmberApplicationSingleton().__container__.lookup("adapter:alarm"),o={entity_id:this.get("alarm.entity_id")};t.findQuery("alarm","get-current-alarm",o).then(function(t){var i=((new Date).getTime(),(new Date).getTime(),(new Date).getTime(),[]);if(t.data)for(var o=t.data[0].value.steps.length-1;o>=0;o--){var a=t.data[0].value.steps[o],s=new Date(1e3*a.t);if(a.date=moment(s).format("LL"),a.time=moment(s).format("h:mm:ss a"),a.color=r(e,"iconsAndColors")[a._t].color,a.icon=r(e,"iconsAndColors")[a._t].icon,a.color||(a.color=r(e,"colorArray")[a.val]),a._t.indexOf("state")>-1&&(a.state=r(e,"stateArray")[a.val]),a._t.indexOf("status")>-1&&(a.status=r(e,"statusArray")[a.val]),"snooze"===a._t){var c=new Date(1e3*a.val);a.until=moment(c).format("h:mm:ss a")}a.name=r(e,"statusToName")[a._t],i.push(a)}n(e,"steps",i)},function(e){console.error("ERROR in the adapter: ",e)})}}.observes("isHidden","alarm.id")}));t.register("component:component-customtimeline",o)}}),Ember.Application.initializer({name:"component-popupinfo",initialize:function(e,t){var i=(Ember.get,Ember.set,Ember.isNone,Ember.Component.extend({init:function(){this._super(),this.set("columnTemplate",Ember.columnTemplates.findBy("columnName",this.get("columnName")).columnTemplate)},upd:function(){this.get("columnName")==this.get("clickedField.humanName")&&($(".popupinfo").hide(),this.$(".popupinfo").fadeIn(500))}.observes("updater"),actions:{hide:function(){this.$(".popupinfo").fadeOut(500)}}}));t.register("component:component-popupinfo",i)}}),Ember.Application.initializer({name:"component-radio",initialize:function(e,t){var i=(Ember.get,Ember.set,Ember.isNone,Ember.Component.extend({tagName:"input",type:"radio",attributeBindings:["name","type","value","checked:checked:"],init:function(){this._super()},click:function(){this.set("selection",this.$().val())},checked:function(){return this.get("value")==this.get("selection")}.property()}));t.register("component:component-radio",i)}}),Ember.Application.initializer({name:"component-rendererack",initialize:function(e,t){var i=Ember.get,r=(Ember.set,Ember.isNone,Ember.Component.extend({propertyMap:{t:"date",a:"user"},properties:["t","a"],propertiesMap:function(){var e=this.get("propertyMap"),t=this.get("value");return this.get("properties").map(function(r){return{key:e[r]||r,value:i(t,r)}})}.property("properties","propertyMap","value"),init:function(){this._super()}}));t.register("component:component-rendererack",r)}}),Ember.Application.initializer({name:"component-rendererextradetails",initialize:function(e,t){Ember.get,Ember.set,Ember.isNone;__=Ember.String.loc;var i=Ember.Component.extend({init:function(){this._super()},acktooltip:function(){return this.get("hasAck")?["<center>","<b>"+__("Ack")+"</b><br/>","<i>"+__("Date")+"</i> : <br/>",this.dateFormat(this.get("value.ack.t"))+" <br/> ",__("By")+" : "+this.get("value.ack.a")+" <br/><br/> ","<i>"+__("Comment")+" </i> : <br/>"+this.get("value.ack.m"),"</center>"].join(""):""}.property("value.ack.t","hasAck"),snoozetooltip:function(){return this.get("hasSnooze")?["<center>","<b>"+__("Snooze")+"</b><br/>","<i>"+__("Since")+"</i> : <br/>",this.dateFormat(this.get("value.snooze.t"))+" <br/> ",__("By")+" : "+this.get("value.snooze.a")+" <br/><br/> ","</center>"].join(""):""}.property("value.snooze.a","hasSnooze"),tickettooltip:function(){return this.get("hasTicket")?["<center>","<b>"+__("Ticket declared")+"</b><br/>",this.dateFormat(this.get("value.ticket.t"))+" <br/> ",__("By")+" : "+this.get("value.ticket.a")+" <br/><br/> ","</center>"].join(""):""}.property("value.ticket.a","hasTicket"),pbehaviortooltip:function(){if(this.get("hasPBehavior")){var e=this;return["<center>","<b>"+__("Periodic behavior")+"</b><br/>",this.get("value.pbehaviors").map(function(t){return t.name+" <br/>"+e.dateFormat(t.dtstart)+" - "+e.dateFormat(t.dtstop)+" <br/>"+t.rrule+" <br/>"}).join("")+" <br/><br/> ","</center>"].join("")}return""}.property("value.pbehaviors.@each.behavior","hasPBehavior"),hasSnooze:function(){return null!=this.get("value.snooze")}.property("value.snooze"),hasTicket:function(){return null!=this.get("value.ticket")}.property("value.ticket"),hasAck:function(){return null!=this.get("value.ack")}.property("value.ack"),hasPBehavior:function(){return null!=this.get("value.pbehaviors")&&0!=this.get("value.pbehaviors").length}.property("value.pbihaviors"),dateFormat:function(e){var t=parseInt(e);t<1e10&&(t*=1e3);var i=new Date(t);return moment(i).format("MM/DD/YY hh:mm:ss")}});t.register("component:component-rendererextradetails",i)}}),Ember.Application.initializer({name:"component-rendererpbehaviors",initialize:function(e,t){Ember.get,Ember.set,Ember.isNone;rRule=window.RRule;var i=Ember.Component.extend({propertyMap:{tstop:"stop date",enabled:"enabled",name:"name",tstart:"start date",rrule:"rule"},properties:["tstop","enabled","name","tstart","rrule"],pbehMap:function(){var e=(this.get("propertyMap"),this.get("value")),t=this;return e.map(function(e){return e.name+" - start: "+t.dateFormat(e.tstart)+" - stop: "+t.dateFormat(e.tstop)+" - freq: "+t.rruleParse(e.rrule)})}.property("properties","propertyMap","value"),dateFormat:function(e){var t=new Date(e);return moment(t).format("MM/DD/YY hh:mm:ss")},rruleParse:function(e){var t=rRule.parseString(e);return new rRule(t||{}).toText()},init:function(){this._super()}});t.register("component:component-rendererpbehaviors",i)}}),Ember.Application.initializer({name:"component-rendererstate",initialize:function(e,t){var i=(Ember.get,Ember.set,Ember.isNone,Ember.Component.extend({list:{0:{color:"bg-green",name:"Info"},1:{color:"bg-yellow",name:"Minor"},2:{color:"bg-orange",name:"Major"},3:{color:"bg-red",name:"Critical"}},init:function(){this._super()},spanClass:function(){return[this.get("list")[this.get("value.val")].color,"badge"].join(" ")}.property("value.val"),caption:function(){return this.get("list")[this.get("value.val")].name}.property("value.val"),isChangedByUser:function(){return"changestate"==this.get("value._t")}.property("value._t"),isCancelled:function(){return void 0!=this.get("value.canceled")}.property("value.canceled")}));t.register("component:component-rendererstate",i)}}),Ember.Application.initializer({name:"component-rendererstatetimestamp",initialize:function(e,t){var i=(Ember.get,Ember.set,Ember.isNone,Ember.Component.extend({init:function(){this._super()},timestamp:function(){return this.get("value")}.property("value"),dateFormat:function(e){var t=new Date(e);return moment(t).format("MM/DD/YY hh:mm:ss")}}));t.register("component:component-rendererstatetimestamp",i)}}),Ember.Application.initializer({name:"component-rendererstatus",initialize:function(e,t){var i=(Ember.get,Ember.set,Ember.isNone,Ember.Component.extend({list:{0:"Off",1:"On going",2:"Stealthy",3:"Bagot",4:"Canceled"},init:function(){this._super()},status:function(){return this.get("list")[this.get("value.val")]}.property("value.val"),isCanceled:function(){return 4==this.get("value.val")}.property("value.val")}));t.register("component:component-rendererstatus",i)}}),Ember.Application.initializer({name:"component-rendererstatusval",initialize:function(e,t){var i=(Ember.get,Ember.set,Ember.isNone,Ember.Component.extend({list:{0:"Off",1:"On going",2:"Stealthy",3:"Bagot",4:"Cancel"},init:function(){this._super()},status:function(){return this.get("list")[this.get("value")]}.property("value")}));t.register("component:component-rendererstatusval",i)}}),Ember.Application.initializer({name:"component-search",initialize:function(e,t){var i=(Ember.get,Ember.set,Ember.isNone,Ember.Component.extend({classNames:["col-xs-3","search"],init:function(){this._super()},removeInvalidSearchTextNotification:function(){this.set("isValid",!0)}.observes("value"),actions:{search:function(){this.get("value").length>0&&this.sendAction("action",this.get("value"))},resetValue:function(){this.set("value",""),this.sendAction("action","")}}}));t.register("component:component-search",i)}}),Ember.Application.initializer({name:"component-selectionactions",initialize:function(e,t){var i=(Ember.get,Ember.set,Ember.isNone,Ember.Component.extend({tagName:"td",classNames:["action-cell"],actionsMap:Ember.A([{class:"glyphicon glyphicon-ok",mixin_name:"fastack",caption:"Fast Ack"},{class:"glyphicon glyphicon-saved",mixin_name:"ack",caption:"Ack"},{class:"glyphicon glyphicon-ban-circle",mixin_name:"ackremove",caption:"Cancel ack"},{class:"glyphicon glyphicon-share-alt",mixin_name:"recovery",caption:"Restore alarm"}]),init:function(){this._super()},actions:{sendAction:function(e){this.sendAction("action",e)}}}));t.register("component:component-selectionactions",i)}}),Ember.Application.initializer({name:"component-selectioncheckbox",initialize:function(e,t){var i=(Ember.get,Ember.set,Ember.isNone,Ember.Component.extend({init:function(){this._super()}}));t.register("component:component-selectioncheckbox",i)}}),Ember.Application.initializer({name:"PbehaviorForm",after:["FormFactory","InspectableItemMixin","ValidationMixin","SlugUtils"],initialize:function(e,t){var i=e.lookupFactory("factory:form"),r=window.schemasRegistry,n=e.lookupFactory("mixin:inspectable-item"),o=e.lookupFactory("mixin:validation"),a=e.lookupFactory("utility:slug"),s=Ember.set,c=Ember.get,l=Ember.isNone,m={mixins:[n,o]},u=i("pbehaviorform",{needs:["application"],partials:{debugButtons:["formbutton-inspectform"]},validationFields:Ember.computed(function(){return Ember.A()}),ArrayFields:Ember.A(),init:function(){this._super(),this.set("partials.buttons",["formbutton-submit"])},filterUserPreferenceCategory:function(e,t){var i=c(e,"keys");s(e,"keys",[]);for(var r=0,n=i.length;r<n;r++)console.log("key",i[r]),this.get("userPreferencesOnly")?i[r].model&&i[r].model.options&&i[r].model.options.isUserPreference&&c(e,"keys").push(i[r]):t[i[r].field]&&(console.log("magic keys",i[r]),t[i[r].field].readOnly&&(i[r].model.options.readOnly=!0),c(e,"keys").push(i[r]));return e},categories:function(){var e=c(this,"categorized_attributes"),t=[];if(e instanceof Array){for(var i=0,r=e.length;i<r;i++){var n=e[i];n.slug=a.slug(n.title),console.log("current category",n),c(this,"filterFieldByKey")||c(this,"userPreferencesOnly")?(this.filterUserPreferenceCategory(n,c(this,"filterFieldByKey")),n.keys.length&&t.push(e[i]),console.log("category"),console.log(n)):t.push(e[i])}return t.length&&s(t[0],"isDefault",!0),t}return[]}.property("categorized_attributes"),onePageDisplay:function(){return!1}.property(),inspectedDataItem:function(){return c(this,"formContext")}.property("formContext"),inspectedItemType:function(){return console.log("recompute inspectedItemType",c(this,"formContext")),c(this,"formContext.xtype")?c(this,"formContext.xtype"):"user"===c(this,"formContext.crecord_type")?"account":c(this,"formContext.crecord_type")||c(this,"formContext.connector_type")}.property("formContext"),categorized_attributes:function(){var e=c(this,"inspectedDataItem");if(console.log("recompute categorized_attributes",e),void 0===e);else{console.log("inspectedDataItem attributes",this.getAttributes());var t=this.getInspectedItemType();console.error("itemType",t),console.error("schemas",window.schemasRegistry);var i=window.schemasRegistry.getByName(t).EmberModel;if(void 0!==t){var r=c(this,"options"),n=[];r&&r.filters&&(n=r.filters),console.log(" + filters ",n);var o={};r&&r.override_labels&&(o=r.override_labels),s(this,"categories",[]);var a=this.getAttributes();console.error("YOYOOO:",i.proto());var l=[{keys:["start","end","rrule","name"],title:"General"}];a.get("start").type="timestamp",a.get("start").options.type="timestamp",a.get("end").type="timestamp",a.get("end").options.type="timestamp";for(var m=0,u=l.length;l&&m<u;m++){for(var p=l[m],d={title:p.title,keys:[]},h=0,f=p.keys.length;h<f;h++){var g=p.keys[h],v=a.get(g);if("separator"===g)d.keys[h]=this.generateRoleAttribute("separator");else{if("name"===g&&(v={isAttribute:!0,name:"name",options:{default:"",description:"Name",required:!0,role:"string",type:"string"},type:"stting"}),void 0!==g&&void 0===v){notificationUtils.error("An attribute that does not exists seems to be referenced in schema categories"+g),console.error(i,v,a),d.keys[h]=this.generateRoleAttribute("error"),d.keys[h].field=g,d.keys[h].error="Attribute referenced in schema categories not found";continue}void 0===v.options&&(v.options={}),0===n.length||-1!==$.inArray(g,n)?s(v,"options.hiddenInForm",!1):s(v,"options.hiddenInForm",!0);var b=g;o[g]&&(b=o[g]),d.keys[h]={field:b,model:v,editor:this.generateEditorNameForAttribute(v)},d=this.insertValueIntoAttribute(d,e,g,v,h)}}this.categories.push(d)}return console.log("categories",this.categories),this.categories}}}.property("inspectedDataItem","inspectedItemType"),actions:{submit:function(){if(void 0===this.validation||this.validation()){console.log("submit action",arguments);var e={};if(this.isOnCreate&&this.modelname){var t=this.modelname.charAt(0).toUpperCase()+this.modelname.slice(1),i=r.getByName(t);if(i)for(var n in i)if(i.hasOwnProperty(n)){var o=i[n];if(o&&o._meta&&o._meta.options){var a=o._meta.options;if("setOnCreate"in a){var m=a.setOnCreate;s(this,"formContext."+n,m)}}}}var u=c(this,"options");if(u&&u.override_labels)for(var p in u.override_labels)u.override_labels.hasOwnProperty(p)&&(e[u.override_labels[p]]=p);var d=c(this,"categorized_attributes");console.log("setting fields");for(var h=0,f=d.length;h<f;h++)for(var g=d[h],v=0,b=g.keys.length;v<b;v++){var y=g.keys[v],k=y.field;if(e[y.field]&&(k=e[y.field]),"mixins"===y.field){var _=[];if(!l(y.value))for(var E=0;E<y.value.length;E++){for(var x=Ember.keys(y.value[E]),A={},C=0;C<x.length;C++)A[x[C]]=y.value[E][x[C]];window.$M=A,_.push(A)}Ember.set(y,"value",_)}s(this,"formContext."+k,y.value)}console.log("this is a widget",c(this,"formContext"));var S=[c(this,"formContext")];S.addObjects(arguments),this._super.apply(this,S)}}}},m);t.register("form:pbehaviorform",u)}}),Ember.Application.initializer({name:"SnoozeForm",after:["FormFactory","InspectableItemMixin","ValidationMixin","SlugUtils"],initialize:function(e,t){var i=e.lookupFactory("factory:form"),r=window.schemasRegistry,n=e.lookupFactory("mixin:inspectable-item"),o=e.lookupFactory("mixin:validation"),a=e.lookupFactory("utility:slug"),s=Ember.set,c=Ember.get,l=Ember.isNone,m={mixins:[n,o]},u=i("snoozeform",{needs:["application"],partials:{debugButtons:["formbutton-inspectform"]},validationFields:Ember.computed(function(){return Ember.A()}),ArrayFields:Ember.A(),init:function(){this._super(),this.set("partials.buttons",["formbutton-submit"])},filterUserPreferenceCategory:function(e,t){var i=c(e,"keys");s(e,"keys",[]);for(var r=0,n=i.length;r<n;r++)console.log("key",i[r]),this.get("userPreferencesOnly")?i[r].model&&i[r].model.options&&i[r].model.options.isUserPreference&&c(e,"keys").push(i[r]):t[i[r].field]&&(console.log("magic keys",i[r]),t[i[r].field].readOnly&&(i[r].model.options.readOnly=!0),c(e,"keys").push(i[r]));return e},categories:function(){var e=c(this,"categorized_attributes"),t=[];if(e instanceof Array){for(var i=0,r=e.length;i<r;i++){var n=e[i];n.slug=a.slug(n.title),console.log("current category",n),c(this,"filterFieldByKey")||c(this,"userPreferencesOnly")?(this.filterUserPreferenceCategory(n,c(this,"filterFieldByKey")),n.keys.length&&t.push(e[i]),console.log("category"),console.log(n)):t.push(e[i])}return t.length&&s(t[0],"isDefault",!0),t}return[]}.property("categorized_attributes"),onePageDisplay:function(){return!1}.property(),inspectedDataItem:function(){return c(this,"formContext")}.property("formContext"),inspectedItemType:function(){return console.log("recompute inspectedItemType",c(this,"formContext")),c(this,"formContext.xtype")?c(this,"formContext.xtype"):"user"===c(this,"formContext.crecord_type")?"account":c(this,"formContext.crecord_type")||c(this,"formContext.connector_type")}.property("formContext"),categorized_attributes:function(){var e=c(this,"inspectedDataItem");if(console.log("recompute categorized_attributes",e),void 0===e);else{console.log("inspectedDataItem attributes",this.getAttributes());var t=this.getInspectedItemType(),i=window.schemasRegistry.getByName(t).EmberModel;if(void 0!==t){var r=c(this,"options"),n=[];r&&r.filters&&(n=r.filters),console.log(" + filters ",n);var o={};r&&r.override_labels&&(o=r.override_labels),s(this,"categories",[]);var a=this.getAttributes(),l=i.proto().categories;l[0].keys[5]="duration";for(var m=0,u=l.length;l&&m<u;m++){for(var p=l[m],d={title:p.title,keys:[]},h=0,f=p.keys.length;h<f;h++){var g=p.keys[h],v=a.get(g);if("separator"===g)d.keys[h]=this.generateRoleAttribute("separator");else{if("duration"===g&&void 0===(v=c(window.schemasRegistry.getByName("pbehavior").EmberModel,c(this,"attributesKey")).get("duration"))&&(v={default:0,name:"duration",type:"integer",options:{default:0,description:"Duration in seconds (warning: 1 month = 365 days / 12).",hiddenInForm:!1,required:!1,role:"duration",type:"integer"}}),void 0!==g&&void 0===v){notificationUtils.error("An attribute that does not exists seems to be referenced in schema categories"+g),console.error(i,v,a),d.keys[h]=this.generateRoleAttribute("error"),d.keys[h].field=g,d.keys[h].error="Attribute referenced in schema categories not found";continue}void 0===v.options&&(v.options={}),0===n.length||-1!==$.inArray(g,n)?s(v,"options.hiddenInForm",!1):s(v,"options.hiddenInForm",!0);var b=g;o[g]&&(b=o[g]),d.keys[h]={field:b,model:v,editor:this.generateEditorNameForAttribute(v)},d=this.insertValueIntoAttribute(d,e,g,v,h)}}this.categories.push(d)}return console.log("categories",this.categories),this.categories}}}.property("inspectedDataItem","inspectedItemType"),actions:{submit:function(){if(void 0===this.validation||this.validation()){console.log("submit action",arguments);var e={};if(this.isOnCreate&&this.modelname){var t=this.modelname.charAt(0).toUpperCase()+this.modelname.slice(1),i=r.getByName(t);if(i)for(var n in i)if(i.hasOwnProperty(n)){var o=i[n];if(o&&o._meta&&o._meta.options){var a=o._meta.options;if("setOnCreate"in a){var m=a.setOnCreate;s(this,"formContext."+n,m)}}}}var u=c(this,"options");if(u&&u.override_labels)for(var p in u.override_labels)u.override_labels.hasOwnProperty(p)&&(e[u.override_labels[p]]=p);var d=c(this,"categorized_attributes");console.log("setting fields");for(var h=0,f=d.length;h<f;h++)for(var g=d[h],v=0,b=g.keys.length;v<b;v++){var y=g.keys[v],k=y.field;if(e[y.field]&&(k=e[y.field]),"mixins"===y.field){var _=[];if(!l(y.value))for(var E=0;E<y.value.length;E++){for(var x=Ember.keys(y.value[E]),A={},C=0;C<x.length;C++)A[x[C]]=y.value[E][x[C]];window.$M=A,_.push(A)}Ember.set(y,"value",_)}s(this,"formContext."+k,y.value)}console.log("this is a widget",c(this,"formContext"));var S=[c(this,"formContext")];S.addObjects(arguments),this._super.apply(this,S)}}}},m);t.register("form:snoozeform",u)}}),Ember.Application.initializer({name:"AbsoluteTimesinceHelper",after:"DatesUtils",initialize:function(e,t){var i=e.lookupFactory("utility:dates");Ember.String.loc;Ember.Handlebars.helper("absoluteTimeSince",function(e,t){if(e||t.timeStampState){e=t.timeStampState||e;return i.durationFromNow(e)}return""})}}),Ember.Application.initializer({name:"CustomSendeventMixin",after:["MixinFactory","FormsUtils","DatesUtils","NotificationUtils"],initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),r=e.lookupFactory("utility:forms"),n=e.lookupFactory("utility:dates"),o=e.lookupFactory("utility:notification"),a=Ember.get,s=Ember.set,c=Ember.isNone,l=Ember.String.loc,m=i("customsendevent",{needs:["application"],init:function(){this._super(),s(this,"login",a(this,"controllers.login.record"))},partials:{itemactionbuttons:["actionbutton-ack","actionbutton-cancel","actionbutton-incident","actionbutton-changestate","actionbutton-ticketnumber"],selectionToolbarButtons:["actionbutton-cancelselection","actionbutton-ackselection"]},setPendingOperation:function(e){if(a(this,"controllers.application.frontendConfig.safe_mode"))for(var t=0,i=e.length;t<i;t++)console.log("Pending operations on crecord",e[t]),e[t].pendingOperation=!0},getDataFromRecord:function(e,t,i){console.group("getDataFromRecord"),console.log("get data from record:",e,i);for(var r={author:a(this,"login._id"),id:a(t,"id"),connector:a(t,"connector"),connector_name:a(t,"connector_name"),event_type:e,source_type:a(t,"source_type"),component:a(t,"component"),state:a(t,"state"),state_type:a(t,"state_type"),crecord_type:e,timestamp:n.getNow()},o=["domain","perimeter","resource"],l=0,m=o.length;l<m;l++){var u=o[l];c(a(t,u))||s(r,u,a(t,u))}return"resource"===r.source_type&&(r.resource=a(t,"resource")),this.processEvent(e,"extract",[r,t,i]),console.groupEnd(),r},submitEvents:function(e,t,i){var r=this,n=a(this,"widgetDataStore")||Ember.widgetDataStore,o=this.get("controllers.application.frontendConfig.safe_mode");return console.log("safe_mode",o),new Ember.RSVP.Promise(function(s,c){for(var l=[],m=0;m<e.length;m++){console.log("Event:",a(t,"author"),a(t,"output"));var u=r.getDataFromRecord(i,e[m],t);u.author=a(t,"author"),u.output=a(t,"output"),a(t,"ticket")&&(u.ticket=a(t,"ticket")),l.push(u),o||r.processEvent(i,"transform",[e[m],u]),n.deleteRecord(t)}$.post("/event",{event:JSON.stringify(l)}).then(function(e){e.success?r.updateAlarm(e.data[0].id):console.error("error while send event",e.data.msg)})})},getEventForm:function(e,t,i,n){n=n||"modelform";var s=r.showNew(n,t,{title:l("Add event type: ")+e,override_labels:{output:"comment"},onePageDisplay:!0}),c=this,m=function(){c.startRefresh(),t.rollback(),t.unloadRecord()};s.submit.then(function(r){console.log("saveRecord:",t,r),t=a(r,"formContext"),o.info(l("event sent: ")+e),c.submitEvents(i,t,e),-1!==$.inArray("reportIncident",arguments[1])&&c.submitEvents(i,t,"declareticket"),m()},m)},getRoutingKey:function(e){var t=[e.connector,e.connector_name,e.event_type,e.source_type,e.component].join(".");return"resource"===e.source_type&&(t=[e.id,e.resource].join(".")),t},getDisplayRecord:function(e,t){var i=a(this,"widgetDataStore")||Ember.widgetDataStore,r=this.getDataFromRecord(e,t);return i.createRecord(e,r)},filterUsableCrecords:function(e,t){for(var i=[],r=0,n=t.length;r<n;r++){var o=t[r];this.processEvent(e,"filter",[o])&&i.pushObject(o)}return i},event_processors:{ack:{extract:function(e,t,i){e.ref_rk=a(t,"entity_id"),e.state=0,e.state_type=1,void 0!==i&&(e.ticket=a(i,"ticket"),e.output=a(i,"output"))},filter:function(e){return a(e,"state")&&!a(e,"ack.isAck")&&!a(e,"ack.isCancel")||0===a(e,"state")&&3===a(e,"status")},handle:function(e){var t=this.getDisplayRecord("ack",e[0]);this.getEventForm("ack",t,e,"ackform")},transform:function(e,t){console.log("transform method for ack -> crecords",e,"record",t),e.set("ack",{comment:t.output,timestamp:n.getNow(),author:t.author,isAck:!0}),c(t.ticket)||(e.set("ticket",t.ticket),e.set("ticket_date",n.getNow())),e.set("ack_remove",void 0)}},fastack:{extract:function(e,t,i){e.ref_rk=a(t,"entity_id"),e.state=0,e.state_type=1,e.ticket="ticket",e.output="auto ack by "+a(e,"author")},filter:function(e){return a(e,"state")&&!a(e,"ack.isAck")&&!a(e,"ack.isCancel")||0===a(e,"state")&&3===a(e,"status")},handle:function(e){var t=this.getDisplayRecord("ack",e[0]);a(this,"mixinOptions.sendevent.fastackmsg");t.set("output","auto ack by "+a(t,"author")),this.submitEvents(e,t,"ack")},transform:function(e,t){console.log("transform method for ack -> crecords",e,"record",t),e.set("ack",{comment:t.output,timestamp:n.getNow(),author:t.author,isAck:!0}),c(t.ticket)||(e.set("ticket",t.ticket),e.set("ticket_date",n.getNow())),e.set("ack_remove",void 0)}},ackremove:{extract:function(e,t,i){c(i)||(e.output=a(i,"output")),e.ref_rk=a(t,"entity_id"),e.state=0,e.state_type=1},filter:function(e){
var t=void 0!=a(e,"canceled"),i=void 0!=a(e,"extra_details.ack");return!t&&i},handle:function(e){var t=this.getDisplayRecord("ackremove",e[0]);this.getEventForm("ackremove",t,e)},transform:function(e,t){console.log("transform method for ack remove",e,t),e.set("ack",void 0),e.set("declare_ticket_author",void 0),e.set("declare_ticket_date",void 0),e.set("ticket",void 0),e.set("ticket_date",void 0),e.set("ack_remove",Ember.Object.create({comment:t.output,timestamp:n.getNow(),author:t.author}))}},pbehavior:{extract:function(e,t,i){c(i)||(e.output=a(i,"output"),e.start=a(i,"dtstart"),e.end=a(i,"dtend"),e.rrule=a(i,"rrule"),e.pbehavior_name="downtime",e.action="create",e.name=a(i,"name"))},filter:function(e){return a(e,"ack.author")&&a(e,"ack.isAck")},handle:function(e){var t=this.getDisplayRecord("pbehavior",e[0]);this.getEventForm("pbehavior",t,e,"pbehaviorform")},transform:function(e,t){console.log("transform method for ack remove",e,t,"pbehavior")}},declareticket:{extract:function(e,t,i){e.ref_rk=a(t,"entity_id"),e.state=0,e.state_type=1,e.output="declare ticket"},filter:function(e){return a(e,"ack.isAck")},handle:function(e){var t=this.getDisplayRecord("declareticket",e[0]);this.getEventForm("declareticket",t,e,"ticketform")},transform:function(e,t){console.log("transform method for declare ticket",e,t),e.set("ticket_declared_author",t.author),e.set("ticket_declared_date",n.getNow())}},assocticket:{extract:function(e,t,i){e.ref_rk=a(t,"entity_id"),e.state=0,e.state_type=1,void 0===i?e.output=l("Associated ticket number"):(e.output=a(i,"output"),e.ticket=a(i,"ticket"))},filter:function(e){return a(e,"ack.isAck")},handle:function(e){var t=this.getDisplayRecord("assocticket",e[0]);this.getEventForm("assocticket",t,e)},transform:function(e,t){console.log("transform method for assoticket",e,t),e.set("ticket",t.ticket),e.set("ticket_date",n.getNow())}},cancel:{extract:function(e,t,i){e.ref_rk=a(t,"entity_id"),e.state=0,e.state_type=1,void 0!==i&&(e.output=a(i,"output")),e.cancel=1},filter:function(e){return a(e,"ack.isAck")},handle:function(e){var t=this.getDisplayRecord("cancel",e[0]);this.getEventForm("cancel",t,e)},transform:function(e,t){console.log("transform method for cancel -> crecords",e,"record",t),e.set("ack.isCancel",!0),e.set("ack.isAck",!1),e.set("status",4),e.set("cancel",{comment:t.output,timestamp:n.getNow(),author:t.author,previous_status:t.state})}},cancelack:{extract:function(e,t,i){e.ref_rk=a(t,"entity_id"),e.state=0,e.state_type=1,void 0!==i&&(e.output=a(i,"output")),e.cancel=1},filter:function(e){return a(e,"ack.isAck")},handle:function(e){var t=this.getDisplayRecord("cancel",e[0]);this.getEventForm("cancel",t,e)},transform:function(e,t){console.log("transform method for cancel -> crecords",e,"record",t),e.set("ack.isCancel",!0),e.set("ack.isAck",!1),e.set("status",4),e.set("cancel",{comment:t.output,timestamp:n.getNow(),author:t.author,previous_status:t.state})}},recovery:{extract:function(e,t,i){s(t,"state",0)},filter:function(e){return void 0!=a(e,"canceled")},handle:function(e){var t=e[0];this.submitEvents([t],t,"recovery")},transform:function(e,t){}},uncancel:{extract:function(e,t,i){if(e.ref_rk=a(t,"entity_id"),e.state_type=1,e.state=0,e.cancel=0,void 0!==i){var r=a(i,"output");r||(r=" "),e.output=r}},filter:function(e){return a(e,"ack.isCancel")},handle:function(e){var t=this.getDisplayRecord("uncancel",e[0]);this.getEventForm("uncancel",t,e)},transform:function(e,t){console.log("transform method for uncancel -> crecords",e,"record",t),e.set("ack.isCancel",!1),e.set("ack.isAck",!0),e.set("status",e.get("cancel.previous_status")),c(e.get("ack"))?e.set("ack",{comment:t.output,timestamp:n.getNow(),author:t.author,isAck:!0}):e.set("ack",e.get("ack"))}},changestate:{extract:function(e,t,i){c(i)||(e.state=a(i,"state"),e.output=a(i,"output")),e.event_type="changestate",e.keep_state=!0,e.state_type=1},filter:function(e){return a(e,"state")},handle:function(e){var t=this.getDisplayRecord("changestate",e[0]);this.getEventForm("changestate",t,e)},transform:function(e,t){console.log("transform method for ack changestate",e,t),e.set("state",t.state),0===t.state?e.set("ack",void 0):e.set("cancel",void 0),s(e,"change_state_output",a(t,"output")),s(e,"keep_state",!0)}},snooze:{extract:function(e,t,i){c(i)||(e.state=a(i,"state"),e.output=a(i,"output"),e.duration=a(i,"duration"))},filter:function(e){return a(e,"state")},handle:function(e){var t=this.getDisplayRecord("snooze",e[0]);this.getEventForm("snooze",t,e,"snoozeform")},transform:function(e,t){console.log("transform method for ack snooze",e,t)}},comment:{extract:function(e,t,i){e.referer=a(t,"referer"),e.output=a(t,"output"),e.display_name=a(this,"login.firstname")+" "+a(this,"login.lastname")},filter:function(e){return!1},handle:function(e){var t=this.getDisplayRecord("comment",e[0]);o.info(l('event "comment" sent')),this.submitEvents(e,t,"comment")},transform:function(e,t){console.log("transform method for comment",e,t)}}},hasEventProcessorForType:function(e){return void 0!==this.event_processors[e]},processEvent:function(e,t,i){if(this.hasEventProcessorForType(e)){return this.event_processors[e][t].apply(this,i)}},actions:{sendEvent:function(e,t){console.group("sendEvent:",arguments),this.stopRefresh();var i=[];if(c(t)){var r=a(this,"widgetData.content"),n=r.filterBy("isSelected",!0);if(i=this.filterUsableCrecords(e,n),console.log("events:",e,i),!i.length)return void o.warning("No matching event found for event:",e)}else console.log("event:",e,t),i.pushObject(t);this.processEvent(e,"handle",[i]),this.setPendingOperation(i),console.groupEnd()}}});t.register("mixin:customsendevent",m)}}),Ember.Application.initializer({name:"RinfopopMixin",after:"MixinFactory",initialize:function(e,t){var i=e.lookupFactory("factory:mixin"),r=Ember.get,n=i("rinfopop",{actions:{sendDisplayRecord:function(e){console.log("sendDisplayRecord action called with params",e);var t=r(this,"mixinOptions.rinfopop.popup_template");Ember.isNone(t)&&(t=""),console.log("Template is ",t),r(this,"controllers.rinfopop").send("show",e,t)}},rendererFor:function(e){var t=r(this,"mixinOptions.rinfopop.clickable_column");return console.log("recordinfopopup rendererFor",e,t),e.field===t?"renderer-recordinfopopup":this._super(e)}});t.register("mixin:rinfopop",n)}}),Ember.Application.initializer({name:"AlertExpressionSerializer",after:["ApplicationSerializer"],initialize:function(e,t){var i=e.lookupFactory("serializer:application"),r=i.extend({});t.register("serializer:alertexpression",r)}}),Ember.Application.initializer({name:"AlertsSerializer",after:["ApplicationSerializer"],initialize:function(e,t){var i=e.lookupFactory("serializer:application"),r=i.extend({});t.register("serializer:alerts",r)}}),Ember.Application.initializer({name:"ListAlarmWidget",after:["NotificationUtils","TimeWindowUtils","DataUtils","WidgetFactory","UserconfigurationMixin","RinfopopMixin","SchemasLoader","CustomfilterlistMixin","CustomSendeventMixin"],initialize:function(e,t){var i=(e.lookupFactory("utility:timewindow"),e.lookupFactory("utility:data")),r=e.lookupFactory("factory:widget"),n=e.lookupFactory("mixin:userconfiguration");SendeventMixin=e.lookupFactory("mixin:customsendevent"),notificationUtils=e.lookupFactory("utility:notification"),mx=e.lookupFactory("mixin:customfilterlist");var o=Ember.get,a=Ember.set,s=Ember.isNone,c={mixins:[n,mx,SendeventMixin]},l=r("listalarm",{needs:["login","application"],viewMixins:[mx],searchText:"",isValidSearchText:!0,humanReadableColumnNames:{uid:"_id",connector:"v.connector",connector_name:"v.connector_name",component:"v.component",resource:"v.resource",entity_id:"d",state:"v.state",status:"v.status",snooze:"v.snooze",ack:"v.ack",cancel:"v.cancel","ticket.val":"v.ticket.val",output:"output",opened:"t",resolved:"v.resolved",domain:"v.extra.domain",perimeter:"v.extra.perimeter",last_state_change:"v.state.t",output:"v.state.m",pbehaviors:"pbehaviors",extra_details:"v.extra_details"},mandatoryFields:[{getValue:"v.connector",name:"connector",humanName:"connector"},{getValue:"v.connector_name",name:"connector_name",humanName:"connector_name"},{getValue:"v.component",name:"component",humanName:"component"},{getValue:"v.resource",name:"resource",humanName:"resource"},{getValue:"v.state",name:"state",humanName:"state"}],extraDeatialsEntities:[{name:"snooze",value:"v.snooze"},{name:"ticket",value:"v.ticket"},{name:"ack",value:"v.ack"},{name:"pbehaviors",value:"pbehaviors"}],manualUpdateAlarms:0,alarmsTimestamp:0,init:function(){this._super.apply(this,arguments),a(this,"loaded",!1),a(this,"rights",{list_filters:{checksum:!0}}),a(this,"store",DS.Store.extend({container:o(this,"container")})),this.showParams(),this.loadTemplates(this.get("model.popup"));try{var e=this.get("user_filters").findBy("isActive",!0),t=e?e.filter:void 0}catch(e){var t=void 0}var i=this.get("model.alarms_state_filter.state")||"resolved";this.defultTimestamps(i);this.set("alarmSearchOptions",{opened:"opened"==i,resolved:"resolved"==i,lookups:JSON.stringify(["pbehaviors","linklist"]),filter:t,sort_key:this.get("model.default_sort_column.property"),sort_dir:this.get("model.default_sort_column.direction")})},defultTimestamps:function(e){var t=0,i=0;if("opened"==e)t=0,i=(new Date).getTime();else{var r=new Date;t=r.setMonth(r.getMonth()-1),i=(new Date).getTime()}return{tstart:t,tstop:i}},filtersObserver:function(){this.set("alarmSearchOptions.filter",this.get("selected_filter.filter")||{})}.observes("selected_filter"),totalPagess:function(){if(0===o(this,"itemsTotal"))this.set("totalPages",0);else{var e=o(this,"itemsPerPage");this.set("totalPages",Math.ceil(o(this,"itemsTotal")/e))}}.observes("itemsPerPagePropositionSelected","itemsTotal","itemsPerPage"),sendEventCustom:function(e,t){console.group("sendEvent:",arguments),this.stopRefresh();var i=[];if(s(t)){if(this.get("loaded"))var r=o(this,"alarms");else var r=Ember.A();var n=r.filterBy("isSelected",!0);if(i=this.filterUsableCrecords(e,n),console.log("events:",e,i),!i.length)return void console.error("there are no suitable alarms")}else console.log("event:",e,t),i.pushObject(t);this.processEvent(e,"handle",[i]),this.setPendingOperation(i),console.groupEnd()},timelineListener:function(){if(this.get("controllers.application.interval.timestamp.$gte"))this.set("alarmSearchOptions.tstart",this.get("controllers.application.interval.timestamp.$gte")||0),this.set("alarmSearchOptions.tstop",this.get("controllers.application.interval.timestamp.$lte")||0);else{var e=this.defultTimestamps(this.get("model.alarms_state_filter.state")||"resolved");this.set("alarmSearchOptions.tstart",e.tstart),this.set("alarmSearchOptions.tstop",e.tstop)}}.observes("controllers.application.interval.timestamp"),originalAlarms:function(){this.set("loaded",!1);var e=this.get("alarmSearchOptions");console.error("reload original alarms with params",e);var t=i.getEmberApplicationSingleton().__container__.lookup("adapter:alerts");return DS.PromiseArray.create({promise:t.findQuery("alerts",e).then(function(e){if(e.success)return console.error("loaded alarms: ",o(e,"data.firstObject.alarms")),Ember.totalAlarms=o(e,"data.firstObject.total"),o(e,"data.firstObject.alarms");throw new Error(o(e,"data.msg"))},function(e){return console.error("ERROR in the adapter: ",e),[]}).catch(function(e){return console.error("unexpected error ",e),[]})})}.property("alarmSearchOptions.search","alarmSearchOptions.resolved","alarmSearchOptions.sort_key","alarmSearchOptions.sort_dir","alarmSearchOptions.filter","alarmSearchOptions.skip","alarmSearchOptions.limit","alarmSearchOptions.tstart","alarmSearchOptions.tstop","manualUpdateAlarms"),fields:function(){return this.parseFields(o(this,"model.columns"))}.property("model.columns"),widgetDataMetas:function(){return{total:this.get("defTotal")||0}}.property("defTotal"),alarms:function(){var e=this,t=o(this,"fields"),i=o(this,"originalAlarms").map(function(i){i.v.extra_details={},e.get("extraDeatialsEntities").forEach(function(e){i.v.extra_details[e.name]=Ember.Object.create(i).get(e.value)});var r=Ember.Object.create();return e.get("mandatoryFields").forEach(function(e){var t=o(Ember.Object.create(i),e.getValue);r[e.name]=t,r[e.humanName]=t}),t.forEach(function(e){var t=o(Ember.Object.create(i),e.getValue);r[e.name]=t,r[e.humanName]=t}),r.isSelected=!1,r.isExpanded=!1,r.id=i._id,r.entity_id=i.d,r.set("state.canceled",i.v.canceled),r.changed=(new Date).getTime(),r.linklist=i.linklist,i.v.resource?r.source_type="resource":r.source_type="component",r});return this.set("defTotal",Ember.totalAlarms),this.set("loaded",!0),i}.property("originalAlarms.@each","fields.[]"),currPage:function(){this.set("alarmSearchOptions.limit",this.get("itemsPerPage")),this.set("alarmSearchOptions.skip",this.get("itemsPerPage")*(this.get("currentPage")-1))}.observes("currentPage","itemsPerPage"),paginationLastItemIndexx:function(){var e=o(this,"itemsPerPage"),t=e*(this.currentPage-1);return Math.min(t+e,o(this,"itemsTotal"))}.property("widgetData","itemsTotal","itemsPerPage","currentPage"),loadTemplates:function(e){try{Ember.columnTemplates=e.map(function(e){return{columnName:e.column,columnTemplate:Ember.View.extend({template:Ember.HTMLBars.compile(e.template)})}})}catch(e){}},showParams:function(){var e=this,t=["popup","title"];console.error("brick's parameters"),t.forEach(function(t){console.error(t+": "+e.get("model."+t))}),console.error("default_sort_column: "+e.get("model.default_sort_column.property")+"-"+e.get("model.default_sort_column.direction")),console.error("columnts: "+e.get("model.columns").join(" ")),console.error("alarms_state_filter: "+e.get("model.alarms_state_filter.state"))},refreshContent:function(){},fetchAlarms:function(e){var t=this,r=e||{},n=this.get("model.alarms_state_filter.state")||"opened",a={tstart:r.tstart||0,tstop:r.tstop||0,sort_key:r.sort_key||this.get("model.default_sort_column.property"),sort_dir:r.sort_dir||this.get("model.default_sort_column.direction"),search:r.search||"",opened:"opened"==n,resolved:"resolved"==n};i.getEmberApplicationSingleton().__container__.lookup("adapter:alerts").findQuery("alerts",a).then(function(e){var i=o(e,"data");t.setAlarmsForShow(i[0].alarms)},function(e){console.error("ERROR in the adapter: ",e)})},isValidExpression:function(e){var t={expression:e},r=i.getEmberApplicationSingleton().__container__.lookup("adapter:alertexpression");return DS.PromiseObject.create({promise:r.findQuery("alertexpression",t).then(function(e){if(e.success)return e.data[0];throw new Error(e.data.msg)},function(e){return console.error("ERROR in the adapter: ",e),!1}).catch(function(e){return console.error("unexpected error ",e),!1})})},parseFields:function(e){var t=this,i=this.get("model.default_sort_column.property"),r=this.get("model.default_sort_column.direction");return e.map(function(e){var n={};return n.name=t.get("humanReadableColumnNames")[e]||"v."+e,n.humanName=e,n.isSortable=e==i,n.isASC="ASC"==r,n.getValue=t.get("humanReadableColumnNames")[e]||"v."+e,n})},sortColumn:function(){var e=o(this,"fields").findBy("humanName",o(this,"controller.default_sort_column.property"));if(!e){e=o(this,"fields.firstObject");try{e.isSortable=!0,e.isASC=o(this,"controller.default_sort_column.property")}catch(e){}return console.error('the column "'+o(this,"controller.default_sort_column.property")+'" was not found.'),e}return e}.property("controller.default_sort_column.property","fields.[]"),updateAlarm:function(e){var t=this,r=this.get("alarms").findBy("id",e);if(r){var n=this,a=(this.get("model.alarms_state_filter.state"),i.getEmberApplicationSingleton().__container__.lookup("adapter:alerts"));r.get("entity_id");a.findQuery("alarm",{lookups:JSON.stringify(["pbehaviors","linklist"]),filter:'{"$or":[{"_id":"'+r.get("id")+'"}]}'}).then(function(e){if(e.success){var i=n.get("fields"),a=e.data[0].alarms[0];r.entity_id=a._id,r.d=a._id,r.set("extra_details",Ember.Object.create()),t.get("extraDeatialsEntities").forEach(function(e){r.set("extra_details."+e.name,Ember.Object.create(a).get(e.value))});Ember.Object.create();i.forEach(function(e){if("extra_details"!=e.humanName){var t=o(Ember.Object.create(a),e.getValue);r.set(e.humanName,t)}}),r.set("isSelected",!1),r.set("isExpanded",!1),r.set("canceled",o(Ember.Object.create(a),"v.canceled")),Ember.set(r,"changed",(new Date).getTime())}else console.error("unsuccessful request")})}else console.error("alarm not found")},actions:{massAction:function(e){this.sendEventCustom(e.mixin_name)},sendCustomAction:function(e,t){this.sendEventCustom(e.mixin_name,t)},updateSortField:function(e){this.set("alarmSearchOptions.sort_key",e.name),this.set("alarmSearchOptions.sort_dir",e.isASC?"ASC":"DESC")},search:function(e){var t=this;this.isValidExpression(e).then(function(i){t.set("isValidSearchText",i),i&&(t.set("alarmSearchOptions.search",e),t.set("manualUpdateAlarms",(new Date).getTime()))})}}},c);t.register("widget:listalarm",l)}});
//# sourceMappingURL=dist/brick.map.js