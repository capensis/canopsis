Ember.Application.initializer({name:"TimelineAdapter",after:["ApplicationAdapter"],initialize:function(t,e){var a=t.lookupFactory("adapter:application"),o=a.extend({findQuery:function(t,e,a,o){var n="/alerts/get-alarms?";return n+=$.param(o),this.ajax(n,"GET")}});e.register("adapter:timeline",o)}}),Ember.Application.initializer({name:"component-timeline",after:["DataUtils","HashUtils"],initialize:function(t,e){var a=t.lookupFactory("utility:data"),o=Ember.get,n=Ember.set,r=window.moment;__=Ember.String.loc;var c=Ember.Component.extend({timelineData:void 0,statusToName:{ack:__("Acknowledged by "),ackremove:__("Ack removed by "),assocticket:__("Ticket association by "),declareticket:__("Ticket declared by "),cancel:__("Canceled by "),comment:__("Comment by "),uncancel:__("Restored by "),statusinc:__("Status increased"),statusdec:__("Status decreased"),stateinc:__("State increased"),statedec:__("State decreased"),changestate:__("State changed"),snooze:__("Snoozed by "),statecounter:__("Cropped states (since last change of status)"),hardlimit:__("Hard limit reached !")},authoredName:["ack","ackremove","assocticket","declareticket","cancel","comment","uncancel","snooze"],stateArray:["Ok","Minor","Major","Critical"],statusArray:["off","ongoing","stealthy","bagot","canceled"],colorArray:["bg-green","bg-yellow","bg-orange","bg-red"],iconsAndColors:{ack:{icon:"fa-check",color:"bg-purple"},ackremove:{icon:"glyphicon glyphicon-ban-circle",color:"bg-purple"},assocticket:{icon:"fa-ticket",color:"bg-blue"},declareticket:{icon:"fa-ticket",color:"bg-blue"},cancel:{icon:"glyphicon glyphicon-trash",color:"bg-gray"},comment:{icon:"fa-comment-o",color:"bg-teal"},uncancel:{icon:"glyphicon glyphicon-share",color:"bg-gray"},statusinc:{icon:"fa-chevron-up",color:"bg-gray"},statusdec:{icon:"fa-chevron-down",color:"bg-gray"},stateinc:{icon:"fa-flag",color:void 0},statedec:{icon:"fa-flag",color:void 0},changestate:{icon:"fa-flag",color:void 0},snooze:{icon:"fa-clock-o",color:"bg-fuchsia"},statecounter:{icon:"fa-scissors",color:"bg-black"},hardlimit:{icon:"fa-warning",color:"bg-red"}},addAuthor:["stateinc","statedec","changestate","statusinc"],didInsertElement:function(){var t=this,e=o(t,"timelineData"),c=a.getEmberApplicationSingleton().__container__.lookup("adapter:timeline"),i=JSON.stringify({d:e.entity_id,"v.creation_date":e["v.creation_date"]}),s={filter:i,opened:!0,resolved:!0,sort_key:"t",sort_dir:"DESC",limit:1,with_steps:!0};c.findQuery("alarm","get-current-alarm",void 0,s).then(function(e){var a=void 0,c=[];if(e.data.length>0&&e.data[0].alarms.length>0){for(var i=e.data[0].alarms[0].v.steps.length-1;i>=0;i--){var s=e.data[0].alarms[0].v.steps[i],l="",d=new Date(1e3*s.t);if(s.date=r(d).format("LL"),s.date!=a?s.showDate=!0:s.showDate=!1,s.time=r(d).format("HH:mm:ss"),s._t in o(t,"iconsAndColors")){if(s.color=o(t,"iconsAndColors")[s._t].color,s.icon=o(t,"iconsAndColors")[s._t].icon,s.color||(s.color=o(t,"colorArray")[s.val]),s._t.indexOf("state")>=0&&(s.state=o(t,"stateArray")[s.val]),s._t.indexOf("status")>=0&&(s.status=o(t,"statusArray")[s.val]),"snooze"===s._t){var m=new Date(1e3*s.val);s.until=r(m).format("HH:mm:ss")}if("statecounter"===s._t){s.m='<table class="table table-hover"><tbody>',s.m+="<tr><th>State increases</th><th>"+s.val.stateinc+"</th></tr>",s.m+="<tr><th>State decreases</th><th>"+s.val.statedec+"</th></tr>";for(v in s.val)if(v.startsWith("state:")){var g=parseInt(v.replace("state:",""),10),_=o(t,"stateArray")[g];s.m+="<tr><th>State "+_+"</th><th>"+s.val[v]+"</th></tr>"}s.m+="</tbody></table>"}l=o(t,"statusToName")[s._t],t.get("addAuthor").includes(s._t)?s.name=l+" by "+s.a:s.name=l,-1!=o(t,"authoredName").indexOf(s._t)&&(s.name+=s.a),c.push(s),a=s.date}else console.warning('Unknown step "'+s._t+'" : skipping')}n(t,"steps",c)}},function(t){console.error("ERROR in the adapter: ",t)})}});e.register("component:component-timeline",c)}});
//# sourceMappingURL=dist/brick.map.js