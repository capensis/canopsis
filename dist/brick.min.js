Ember.Application.initializer({name:"AlertExpressionAdapter",after:["ApplicationAdapter"],initialize:function(t,e){var n=t.lookupFactory("adapter:application"),i=n.extend({findQuery:function(t,e){var n="/alerts/search/validate";return this.ajax(n,"GET",{data:e})}});e.register("adapter:alertexpression",i)}}),Ember.Application.initializer({name:"AlertsAdapter",after:["ApplicationAdapter"],initialize:function(t,e){var n=t.lookupFactory("adapter:application"),i=n.extend({findQuery:function(t,e,n){var i="/alerts/get-alarms";return"get-current-alarm"==e?this.ajax("/alerts/get-current-alarm","GET",{data:n}):this.ajax(i,"GET",{data:e})}});e.register("adapter:alerts",i)}}),Ember.Application.initializer({name:"component-alarmactions",initialize:function(t,e){var n=(Ember.get,Ember.set,Ember.isNone,Ember.Component.extend({tagName:"td",classNames:["action-cell"],actionsMap:Ember.A([{class:"glyphicon glyphicon-saved",internal_states:["unacked"],name:"ack",mixin_name:"ack"},{class:"glyphicon glyphicon-ok",internal_states:["unacked"],name:"fastack",mixin_name:"fastack"},{class:"glyphicon glyphicon-ban-circle",internal_states:["acked"],name:"unack",mixin_name:"ackremove"},{class:"fa fa-ticket",internal_states:["acked"],name:"declareticket",mixin_name:"declareticket"},{class:"fa fa-thumb-tack",internal_states:["acked","removed"],name:"assocticket",mixin_name:"assocticket"},{class:"glyphicon glyphicon-trash",internal_states:["acked"],name:"cancelalarm",mixin_name:"cancel"},{class:"fa fa-exclamation-triangle",internal_states:["acked"],name:"changecriticity",mixin_name:"changestate"},{class:"glyphicon glyphicon-share-alt",internal_states:["removed"],name:"restorealarm",mixin_name:"recovery"},{class:"fa fa-clock-o",internal_states:["unacked"],name:"snoozealarm",mixin_name:"snooze"}]),init:function(){this._super()},availableActions:function(){var t=this.get("internalState");return this.get("actionsMap").filter(function(e,n,i){return e.internal_states.includes(t)})}.property("internalState"),internalState:function(){return 0!=this.get("state")||this.get("isAcked")?this.get("state")>0&&!this.get("isAcked")?"unacked":this.get("isAcked")?"acked":"removed":"immutable"}.property("alarm.state","alarm.status"),isAcked:function(){return void 0!=this.get("alarm.ack._t")}.property("alarm.ack._t"),hasLinks:function(){return this.get("alarm.linklist.event_links.length")>0}.property("alarm.linklist.event_links"),actions:{sendAction:function(t){this.sendAction("action",t,this.get("alarm"))}}}));e.register("component:component-alarmactions",n)}}),Ember.Application.initializer({name:"component-alarmraw",initialize:function(t,e){var n=Ember.get,i=Ember.set,r=(Ember.isNone,Ember.Component.extend({tagName:"tr",init:function(){this._super(),i(this,"alarm",n(this,"alarm")),i(this,"fields",n(this,"fields"))},expandClass:function(){var t="";return t=this.get("alarm.isExpanded")?"glyphicon-minus":"glyphicon-plus","glyphicon "+t}.property("alarm.isExpanded"),actions:{tdClick:function(t,e){this.sendAction("action",t,e)},sendAction:function(t,e){this.sendAction("saction",t,e)},expand:function(){this.toggleProperty("alarm.isExpanded")}}}));e.register("component:component-alarmraw",r)}}),Ember.Application.initializer({name:"component-alarmstate",initialize:function(t,e){var n=Ember.get,i=Ember.set,r=Ember.isNone,o=Ember.Component.extend({state:void 0,isSelected:0,init:function(){this._super(),r(this.get("content"))||i(this,"state",n(this,"content.state"))},onUpdate:function(){this.set("content",{state:n(this,"state")})}.observes("state")});e.register("component:component-alarmstate",o)}}),Ember.Application.initializer({name:"component-alarmtable",initialize:function(t,e){var n=Ember.get,i=(Ember.set,Ember.isNone,Ember.Component.extend({init:function(){this._super(),this.set("isAllChecked",!1)},allSelectionObserver:function(){var t=this.get("isAllChecked");this.get("alarms").setEach("isSelected",t)}.observes("isAllChecked"),currentSortColumn:function(){return n(this,"defaultSortColumn")}.property("defaultSortColumn"),actions:{click:function(t){t==this.get("currentSortColumn")?this.set("currentSortColumn.isASC",!this.get("currentSortColumn.isASC")):(this.set("currentSortColumn.isSortable",!1),this.set("currentSortColumn",t),this.set("currentSortColumn.isSortable",!0),this.set("currentSortColumn.isASC",!0)),this.sendAction("action",this.get("currentSortColumn"))},tdClick:function(t,e){Ember.columnTemplates.findBy("columnName",e.humanName)&&(this.set("clickedAlarm",t),this.set("clickedField",e),this.set("updater",(new Date).getTime()))},sendAction:function(t,e){this.sendAction("saction",t,e)}}}));e.register("component:component-alarmtable",i)}}),Ember.Application.initializer({name:"component-alarmtd",initialize:function(t,e){var n=Ember.get,i=(Ember.set,Ember.isNone,Ember.Component.extend({tagName:"td",renderers:["v_state_val","v_state_t","v_status_val","v_extra_details"],init:function(){this._super()},click:function(){this.sendAction("action",this.get("alarm"),this.get("field"))},value:function(){var t=n(this,"alarm"),e=n(this,"field");return t[e.humanName]}.property("alarm.changed","field"),hasRenderer:function(){return this.get("renderers").includes(this.get("field.name").replace(/\./g,"_"))}.property("alarm"),renderer:function(){return this.get("field.name").replace(/\./g,"_")}.property("alarm.name"),vv:function(){return Ember.View.extend({template:Ember.HTMLBars.compile("renderer")})}.property("field")}));e.register("component:component-alarmtd",i)}}),Ember.Application.initializer({name:"component-columntemplate",initialize:function(t,e){var n=Ember.get,i=Ember.set,r=Ember.isNone,o=Ember.Component.extend({template:void 0,column:void 0,init:function(){this._super(),r(this.get("content"))||(i(this,"column",n(this,"content.column")),i(this,"template",n(this,"content.template")))},onUpdate:function(){this.set("content",{column:n(this,"column"),template:n(this,"template")})}.observes("template","column")});e.register("component:component-columntemplate",o)}}),Ember.Application.initializer({name:"component-customtimeline",after:["DataUtils","HashUtils"],initialize:function(t,e){var n=t.lookupFactory("utility:data"),i=Ember.get,r=Ember.set,o=(Ember.isNone,Ember.Component.extend({tagName:"tr",classNameBindings:["isHidden:invisible"],isHidden:function(){return!this.get("alarm.isExpanded")}.property("alarm.isExpanded"),timelineData:void 0,statusToName:{ack:"Acknowledged by ",ackremove:"Ack removed by ",assocticket:"Ticket association by ",declareticket:"Ticket declared by ",cancel:"Canceled by ",uncancel:"Restored by ",statusinc:"Status increased",statusdec:"Status decreased",stateinc:"State increased",statedec:"State decreased",changestate:"State changed",snooze:"Snoozed by "},stateArray:["Ok","Minor","Major","Critical"],statusArray:["off","ongoing","stealthy","bagot","canceled"],colorArray:["bg-green","bg-yellow","bg-orange","bg-red"],iconsAndColors:{ack:{icon:"fa-check",color:"bg-purple"},ackremove:{icon:"glyphicon glyphicon-ban-circle",color:"bg-purple"},assocticket:{icon:"fa-ticket",color:"bg-blue"},declareticket:{icon:"fa-ticket",color:"bg-blue"},cancel:{icon:"glyphicon glyphicon-trash",color:"bg-gray"},uncancel:{icon:"glyphicon glyphicon-share",color:"bg-gray"},statusinc:{icon:"fa-chevron-up",color:"bg-gray"},statusdec:{icon:"fa-chevron-down",color:"bg-gray"},stateinc:{icon:"fa-flag",color:void 0},statedec:{icon:"fa-flag",color:void 0},changestate:{icon:"fa-flag",color:void 0},snooze:{icon:"fa-clock-o",color:"bg-fuchsia"}},init:function(){this._super()},stepsLoader:function(){if(!this.get("isHidden")){var t=this,e=n.getEmberApplicationSingleton().__container__.lookup("adapter:alarm"),o={entity_id:this.get("alarm.entity_id")};e.findQuery("alarm","get-current-alarm",o).then(function(e){var n=([{t:(new Date).getTime(),_t:"ackremove",val:1},{t:(new Date).getTime(),_t:"statusdec",val:2},{t:(new Date).getTime(),_t:"snooze",val:3}],[]);if(e.data)for(var o=e.data[0].value.steps.length-1;o>=0;o--){var a=e.data[0].value.steps[o],s=new Date(1e3*a.t);if(a.date=moment(s).format("LL"),a.time=moment(s).format("h:mm:ss a"),a.color=i(t,"iconsAndColors")[a._t].color,a.icon=i(t,"iconsAndColors")[a._t].icon,a.color||(a.color=i(t,"colorArray")[a.val]),a._t.indexOf("state")>-1&&(a.state=i(t,"stateArray")[a.val]),a._t.indexOf("status")>-1&&(a.status=i(t,"statusArray")[a.val]),"snooze"===a._t){var c=new Date(1e3*a.val);a.until=moment(c).format("h:mm:ss a")}a.name=i(t,"statusToName")[a._t],n.push(a)}r(t,"steps",n)},function(t){console.error("ERROR in the adapter: ",t)})}}.observes("isHidden","alarm.id")}));e.register("component:component-customtimeline",o)}}),Ember.Application.initializer({name:"component-popupinfo",initialize:function(t,e){var n=(Ember.get,Ember.set,Ember.isNone,Ember.Component.extend({init:function(){this._super(),this.set("columnTemplate",Ember.columnTemplates.findBy("columnName",this.get("columnName")).columnTemplate)},upd:function(){this.get("columnName")==this.get("clickedField.humanName")&&($(".popupinfo").hide(),this.$(".popupinfo").fadeIn(500))}.observes("updater"),actions:{hide:function(){this.$(".popupinfo").fadeOut(500)}}}));e.register("component:component-popupinfo",n)}}),Ember.Application.initializer({name:"component-radio",initialize:function(t,e){var n=(Ember.get,Ember.set,Ember.isNone,Ember.Component.extend({tagName:"input",type:"radio",attributeBindings:["name","type","value","checked:checked:"],init:function(){this._super()},click:function(){this.set("selection",this.$().val())},checked:function(){return this.get("value")==this.get("selection")}.property()}));e.register("component:component-radio",n)}}),Ember.Application.initializer({name:"component-rendererack",initialize:function(t,e){var n=Ember.get,i=(Ember.set,Ember.isNone,Ember.Component.extend({propertyMap:{t:"date",a:"user"},properties:["t","a"],propertiesMap:function(){var t=this.get("propertyMap"),e=this.get("value");return this.get("properties").map(function(i){return{key:t[i]||i,value:n(e,i)}})}.property("properties","propertyMap","value"),init:function(){this._super()}}));e.register("component:component-rendererack",i)}}),Ember.Application.initializer({name:"component-rendererextradetails",initialize:function(t,e){Ember.get,Ember.set,Ember.isNone;__=Ember.String.loc;var n=Ember.Component.extend({init:function(){this._super()},acktooltip:function(){return this.get("hasAck")?["<center>","<b>"+__("Ack")+"</b><br/>","<i>"+__("Date")+"</i> : <br/>",this.dateFormat(this.get("value.ack.t"))+" <br/> ",__("By")+" : "+this.get("value.ack.a")+" <br/><br/> ","<i>"+__("Comment")+" </i> : <br/>"+this.get("value.ack.m"),"</center>"].join(""):""}.property("value.ack.t","hasAck"),snoozetooltip:function(){return this.get("hasSnooze")?["<center>","<b>"+__("Snooze")+"</b><br/>","<i>"+__("Since")+"</i> : <br/>",this.dateFormat(this.get("value.snooze.t"))+" <br/> ",__("By")+" : "+this.get("value.snooze.a")+" <br/><br/> ","</center>"].join(""):""}.property("value.snooze.a","hasSnooze"),tickettooltip:function(){return this.get("hasTicket")?["<center>","<b>"+__("Ticket declared")+"</b><br/>",this.dateFormat(this.get("value.ticket.t"))+" <br/> ",__("By")+" : "+this.get("value.ticket.a")+" <br/><br/> ","</center>"].join(""):""}.property("value.ticket.a","hasTicket"),pbehaviortooltip:function(){if(this.get("hasPBehavior")){var t=this;return["<center>","<b>"+__("Periodic behavior")+"</b><br/>",this.get("value.pbehaviors").map(function(e){return e.behavior+" <br/>"+t.dateFormat(e.dtstart)+" - "+t.dateFormat(e.dtstop)+" <br/>"+e.rrule+" <br/>"}).join("")+" <br/><br/> ","</center>"].join("")}return""}.property("value.pbehaviors.@each.behavior","hasPBehavior"),hasSnooze:function(){return null!=this.get("value.snooze")}.property("value.snooze"),hasTicket:function(){return null!=this.get("value.ticket")}.property("value.ticket"),hasAck:function(){return null!=this.get("value.ack")}.property("value.ack"),hasPBehavior:function(){return null!=this.get("value.pbehaviors")}.property("value.pbihaviors"),dateFormat:function(t){var e=new Date(t);return moment(e).format("MM/DD/YY hh:mm:ss")}});e.register("component:component-rendererextradetails",n)}}),Ember.Application.initializer({name:"component-rendererpbehaviors",initialize:function(t,e){Ember.get,Ember.set,Ember.isNone;rRule=window.RRule;var n=Ember.Component.extend({propertyMap:{tstop:"stop date",enabled:"enabled",name:"name",tstart:"start date",rrule:"rule"},properties:["tstop","enabled","name","tstart","rrule"],pbehMap:function(){var t=(this.get("propertyMap"),this.get("value")),e=this;return t.map(function(t){return t.name+" - start: "+e.dateFormat(t.tstart)+" - stop: "+e.dateFormat(t.tstop)+" - freq: "+e.rruleParse(t.rrule)})}.property("properties","propertyMap","value"),dateFormat:function(t){var e=new Date(t);return moment(e).format("MM/DD/YY hh:mm:ss")},rruleParse:function(t){var e=rRule.parseString(t),n=new rRule(e||{});return n.toText()},init:function(){this._super()}});e.register("component:component-rendererpbehaviors",n)}}),Ember.Application.initializer({name:"component-rendererstate",initialize:function(t,e){var n=(Ember.get,Ember.set,Ember.isNone,Ember.Component.extend({list:{0:{color:"bg-green",name:"Info"},1:{color:"bg-yellow",name:"Minor"},2:{color:"bg-orange",name:"Major"},3:{color:"bg-red",name:"Critical"}},init:function(){this._super()},spanClass:function(){return[this.get("list")[this.get("value")].color,"badge"].join(" ")}.property("value"),caption:function(){return this.get("list")[this.get("value")].name}.property("value")}));e.register("component:component-rendererstate",n)}}),Ember.Application.initializer({name:"component-rendererstatetimestamp",initialize:function(t,e){var n=(Ember.get,Ember.set,Ember.isNone,Ember.Component.extend({init:function(){this._super()},timestamp:function(){return this.get("value")}.property("value"),dateFormat:function(t){var e=new Date(t);return moment(e).format("MM/DD/YY hh:mm:ss")}}));e.register("component:component-rendererstatetimestamp",n)}}),Ember.Application.initializer({name:"component-rendererstatusval",initialize:function(t,e){var n=(Ember.get,Ember.set,Ember.isNone,Ember.Component.extend({list:{0:"Off",1:"On going",2:"Stealthy",3:"Bagot",4:"Cancel"},init:function(){this._super()},status:function(){return this.get("list")[this.get("value")]}.property("value")}));e.register("component:component-rendererstatusval",n)}}),Ember.Application.initializer({name:"component-search",initialize:function(t,e){var n=(Ember.get,Ember.set,Ember.isNone,Ember.Component.extend({classNames:["pull-left","input-group","input-group-sm","col-xs-3","search","search-padding"],init:function(){this._super()},removeInvalidSearchTextNotification:function(){this.set("isValid",!0)}.observes("value"),actions:{search:function(){this.get("value").length>0&&this.sendAction("action",this.get("value"))},resetValue:function(){this.set("value",""),this.sendAction("action","")}}}));e.register("component:component-search",n)}}),Ember.Application.initializer({name:"component-selectionactions",initialize:function(t,e){var n=(Ember.get,Ember.set,Ember.isNone,Ember.Component.extend({tagName:"td",classNames:["action-cell"],actionsMap:Ember.A([{class:"glyphicon glyphicon-ok",mixin_name:"fastack",caption:"Fast Ack"},{class:"glyphicon glyphicon-saved",mixin_name:"ack",caption:"Ack"},{class:"glyphicon glyphicon-ban-circle",mixin_name:"ackremove",caption:"Cancel ack"},{class:"glyphicon glyphicon-share-alt",mixin_name:"recovery",caption:"Restore alarm"}]),init:function(){this._super()},actions:{sendAction:function(t){this.sendAction("action",t)}}}));e.register("component:component-selectionactions",n)}}),Ember.Application.initializer({name:"component-selectioncheckbox",initialize:function(t,e){var n=(Ember.get,Ember.set,Ember.isNone,Ember.Component.extend({init:function(){this._super()}}));e.register("component:component-selectioncheckbox",n)}}),Ember.Application.initializer({name:"CustomSendeventMixin",after:["MixinFactory","FormsUtils","DatesUtils","NotificationUtils"],initialize:function(t,e){var n=t.lookupFactory("factory:mixin"),i=t.lookupFactory("utility:forms"),r=t.lookupFactory("utility:dates"),o=t.lookupFactory("utility:notification"),a=Ember.get,s=Ember.set,c=Ember.isNone,l=Ember.String.loc,m=n("customsendevent",{needs:["application"],init:function(){this._super(),s(this,"login",a(this,"controllers.login.record"))},partials:{itemactionbuttons:["actionbutton-ack","actionbutton-cancel","actionbutton-incident","actionbutton-changestate","actionbutton-ticketnumber"],selectionToolbarButtons:["actionbutton-cancelselection","actionbutton-ackselection"]},setPendingOperation:function(t){var e=a(this,"controllers.application.frontendConfig.safe_mode");if(e)for(var n=0,i=t.length;n<i;n++)console.log("Pending operations on crecord",t[n]),t[n].pendingOperation=!0},getDataFromRecord:function(t,e,n){console.group("getDataFromRecord"),console.log("get data from record:",t,n);for(var i={authkey:a(this,"login.authkey"),author:a(this,"login._id"),id:a(e,"id"),connector:a(e,"connector"),connector_name:a(e,"connector_name"),event_type:t,source_type:a(e,"source_type"),component:a(e,"component"),state:a(e,"state"),state_type:a(e,"state_type"),crecord_type:t,timestamp:r.getNow()},o=["domain","perimeter","resource"],l=0,m=o.length;l<m;l++){var u=o[l];c(a(e,u))||s(i,u,a(e,u))}return"resource"===i.source_type&&(i.resource=a(e,"resource")),this.processEvent(t,"extract",[i,e,n]),console.groupEnd(),i},submitEvents:function(t,e,n){var i=this,r=this.get("controllers.application.frontendConfig.safe_mode");return console.log("safe_mode",r),new Ember.RSVP.Promise(function(o,s){for(var c=[],l=0;l<t.length;l++){console.log("Event:",a(e,"author"),a(e,"output"));var m=i.getDataFromRecord(n,t[l],e);m.author=a(e,"author"),m.output=a(e,"output"),a(e,"ticket")&&(m.ticket=a(e,"ticket")),c.push(m),r||i.processEvent(n,"transform",[t[l],m])}$.post("/event",{event:JSON.stringify(c)}).then(function(t){t.success?i.updateAlarm(t.data[0].ref_rk):console.error("error while send event",t.data.msg)})})},getEventForm:function(t,e,n,r){r=r||"modelform";var s=i.showNew(r,e,{title:l("Add event type: ")+t,override_labels:{output:"comment"},onePageDisplay:!0}),c=this,m=function(){c.startRefresh(),e.rollback(),e.unloadRecord()};s.submit.then(function(i){console.log("saveRecord:",e,i),e=a(i,"formContext"),o.info(l("event sent: ")+t),c.submitEvents(n,e,t),$.inArray("reportIncident",arguments[1])!==-1&&c.submitEvents(n,e,"declareticket"),m()},m)},getRoutingKey:function(t){var e=[t.connector,t.connector_name,t.event_type,t.source_type,t.component].join(".");return"resource"===t.source_type&&(e=[t.id,t.resource].join(".")),e},getDisplayRecord:function(t,e){var n=a(this,"widgetDataStore"),i=this.getDataFromRecord(t,e),r=n.createRecord(t,i);return r},filterUsableCrecords:function(t,e){for(var n=[],i=0,r=e.length;i<r;i++){var o=e[i],a=this.processEvent(t,"filter",[o]);a&&n.pushObject(o)}return n},event_processors:{ack:{extract:function(t,e,n){t.ref_rk=a(e,"id"),t.state=0,t.state_type=1,t.id=this.getRoutingKey(t),void 0!==n&&(t.ticket=a(n,"ticket"),t.output=a(n,"output"))},filter:function(t){var e=3,n=0;return a(t,"state")&&!a(t,"ack.isAck")&&!a(t,"ack.isCancel")||a(t,"state")===n&&a(t,"status")===e},handle:function(t){var e=this.getDisplayRecord("ack",t[0]);this.getEventForm("ack",e,t,"ackform")},transform:function(t,e){console.log("transform method for ack -> crecords",t,"record",e),t.set("ack",{comment:e.output,timestamp:r.getNow(),author:e.author,isAck:!0}),c(e.ticket)||(t.set("ticket",e.ticket),t.set("ticket_date",r.getNow())),t.set("ack_remove",void 0)}},fastack:{extract:function(t,e,n){t.ref_rk=a(e,"id"),t.state=0,t.state_type=1,t.id=this.getRoutingKey(t),t.ticket="ticket",t.output=a(t,"output")},filter:function(t){var e=3,n=0;return a(t,"state")&&!a(t,"ack.isAck")&&!a(t,"ack.isCancel")||a(t,"state")===n&&a(t,"status")===e},handle:function(t){var e=this.getDisplayRecord("ack",t[0]),n=a(this,"mixinOptions.sendevent.fastackmsg");e.set("output",n),this.submitEvents(t,e,"ack")},transform:function(t,e){console.log("transform method for ack -> crecords",t,"record",e),t.set("ack",{comment:e.output,timestamp:r.getNow(),author:e.author,isAck:!0}),c(e.ticket)||(t.set("ticket",e.ticket),t.set("ticket_date",r.getNow())),t.set("ack_remove",void 0)}},ackremove:{extract:function(t,e,n){c(n)||(t.output=a(n,"output")),t.ref_rk=a(e,"id"),t.state=0,t.state_type=1,t.id=this.getRoutingKey(t)},filter:function(t){return a(t,"ack.author")&&a(t,"ack.isAck")},handle:function(t){var e=this.getDisplayRecord("ackremove",t[0]);this.getEventForm("ackremove",e,t)},transform:function(t,e){console.log("transform method for ack remove",t,e),t.set("ack",void 0),t.set("declare_ticket_author",void 0),t.set("declare_ticket_date",void 0),t.set("ticket",void 0),t.set("ticket_date",void 0),t.set("ack_remove",Ember.Object.create({comment:e.output,timestamp:r.getNow(),author:e.author}))}},declareticket:{extract:function(t,e,n){t.ref_rk=a(e,"id"),t.state=0,t.state_type=1,t.id=this.getRoutingKey(t),t.output="declare ticket"},filter:function(t){return a(t,"ack.isAck")},handle:function(t){var e=this.getDisplayRecord("declareticket",t[0]);this.getEventForm("declareticket",e,t,"ticketform")},transform:function(t,e){console.log("transform method for declare ticket",t,e),t.set("ticket_declared_author",e.author),t.set("ticket_declared_date",r.getNow())}},assocticket:{extract:function(t,e,n){t.ref_rk=a(e,"id"),t.state=0,t.state_type=1,t.id=this.getRoutingKey(t),void 0===n?t.output=l("Associated ticket number"):(t.output=a(n,"output"),t.ticket=a(n,"ticket"))},filter:function(t){return a(t,"ack.isAck")},handle:function(t){var e=this.getDisplayRecord("assocticket",t[0]);this.getEventForm("assocticket",e,t)},transform:function(t,e){console.log("transform method for assoticket",t,e),t.set("ticket",e.ticket),t.set("ticket_date",r.getNow())}},cancel:{extract:function(t,e,n){t.ref_rk=a(e,"id"),t.state=0,t.state_type=1,void 0!==n&&(t.output=a(n,"output")),t.cancel=1},filter:function(t){return a(t,"ack.isAck")},handle:function(t){var e=this.getDisplayRecord("cancel",t[0]);this.getEventForm("cancel",e,t)},transform:function(t,e){console.log("transform method for cancel -> crecords",t,"record",e),t.set("ack.isCancel",!0),t.set("ack.isAck",!1),t.set("status",4),t.set("cancel",{comment:e.output,timestamp:r.getNow(),author:e.author,previous_status:e.state})}},recovery:{extract:function(t,e,n){s(e,"state",0)},filter:function(t){return!1},handle:function(t){var e=t[0];this.submitEvents([e],e,"recovery")},transform:function(t,e){}},uncancel:{extract:function(t,e,n){if(t.ref_rk=a(e,"id"),t.state_type=1,t.state=0,t.cancel=0,void 0!==n){var i=a(n,"output");i||(i=" "),t.output=i}},filter:function(t){return a(t,"ack.isCancel")},handle:function(t){var e=this.getDisplayRecord("uncancel",t[0]);this.getEventForm("uncancel",e,t)},transform:function(t,e){console.log("transform method for uncancel -> crecords",t,"record",e),t.set("ack.isCancel",!1),t.set("ack.isAck",!0),t.set("status",t.get("cancel.previous_status")),c(t.get("ack"))?t.set("ack",{comment:e.output,timestamp:r.getNow(),author:e.author,isAck:!0}):t.set("ack",t.get("ack"))}},changestate:{extract:function(t,e,n){c(n)||(t.state=a(n,"state"),t.output=a(n,"output")),t.event_type="check",t.keep_state=!0,t.state_type=1},filter:function(t){return a(t,"state")},handle:function(t){var e=this.getDisplayRecord("changestate",t[0]);this.getEventForm("changestate",e,t)},transform:function(t,e){console.log("transform method for ack changestate",t,e),t.set("state",e.state),0===e.state?t.set("ack",void 0):t.set("cancel",void 0),s(t,"change_state_output",a(e,"output")),s(t,"keep_state",!0)}},snooze:{extract:function(t,e,n){c(n)||(t.state=a(n,"state"),t.output=a(n,"output")),t.event_type="check",t.keep_state=!0,t.state_type=1},filter:function(t){return a(t,"state")},handle:function(t){var e=this.getDisplayRecord("changestate",t[0]);this.getEventForm("changestate",e,t)},transform:function(t,e){console.log("transform method for ack changestate",t,e),t.set("state",e.state),0===e.state?t.set("ack",void 0):t.set("cancel",void 0),s(t,"change_state_output",a(e,"output")),s(t,"keep_state",!0)}},user:{extract:function(t,e,n){t.output=a(e,"output"),t.display_name=a(this,"login.firstname")+" "+a(this,"login.lastname")},filter:function(t){return!1},handle:function(t){var e=this.getDisplayRecord("user",t[0]);o.info(l('event "user" sent')),this.submitEvents(t,e,"user")},transform:function(t,e){console.log("transform method for user",t,e)}},comment:{extract:function(t,e,n){t.referer=a(e,"referer"),t.output=a(e,"output"),t.display_name=a(this,"login.firstname")+" "+a(this,"login.lastname")},filter:function(t){return!1},handle:function(t){var e=this.getDisplayRecord("comment",t[0]);o.info(l('event "comment" sent')),this.submitEvents(t,e,"comment")},transform:function(t,e){console.log("transform method for comment",t,e)}}},hasEventProcessorForType:function(t){return void 0!==this.event_processors[t]},processEvent:function(t,e,n){if(this.hasEventProcessorForType(t)){var i=this.event_processors[t][e];return i.apply(this,n)}},actions:{sendEvent:function(t,e){console.group("sendEvent:",arguments),this.stopRefresh();var n=[];if(c(e)){var i=a(this,"widgetData.content"),r=i.filterBy("isSelected",!0);if(n=this.filterUsableCrecords(t,r),console.log("events:",t,n),!n.length)return void o.warning("No matching event found for event:",t)}else console.log("event:",t,e),n.pushObject(e);this.processEvent(t,"handle",[n]),this.setPendingOperation(n),console.groupEnd()}}});e.register("mixin:customsendevent",m)}}),Ember.Application.initializer({name:"RinfopopMixin",after:"MixinFactory",initialize:function(t,e){var n=t.lookupFactory("factory:mixin"),i=Ember.get,r=n("rinfopop",{actions:{sendDisplayRecord:function(t){console.log("sendDisplayRecord action called with params",t);var e=i(this,"mixinOptions.rinfopop.popup_template");Ember.isNone(e)&&(e=""),console.log("Template is ",e);var n=i(this,"controllers.rinfopop");n.send("show",t,e)}},rendererFor:function(t){var e=i(this,"mixinOptions.rinfopop.clickable_column");return console.log("recordinfopopup rendererFor",t,e),t.field===e?"renderer-recordinfopopup":this._super(t)}});e.register("mixin:rinfopop",r)}}),Ember.Application.initializer({name:"AlertExpressionSerializer",after:["ApplicationSerializer"],initialize:function(t,e){var n=t.lookupFactory("serializer:application"),i=n.extend({});e.register("serializer:alertexpression",i)}}),Ember.Application.initializer({name:"AlertsSerializer",after:["ApplicationSerializer"],initialize:function(t,e){var n=t.lookupFactory("serializer:application"),i=n.extend({});e.register("serializer:alerts",i)}}),Ember.Application.initializer({name:"ListAlarmWidget",after:["NotificationUtils","TimeWindowUtils","DataUtils","WidgetFactory","UserconfigurationMixin","RinfopopMixin","SchemasLoader","CustomfilterlistMixin","CustomSendeventMixin"],initialize:function(e,n){var i=(e.lookupFactory("utility:timewindow"),e.lookupFactory("utility:data")),r=e.lookupFactory("factory:widget"),o=e.lookupFactory("mixin:userconfiguration");SendeventMixin=e.lookupFactory("mixin:customsendevent"),notificationUtils=e.lookupFactory("utility:notification"),mx=e.lookupFactory("mixin:customfilterlist");var a=Ember.get,s=Ember.set,c=Ember.isNone,l={mixins:[o,mx,SendeventMixin]},m=r("listalarm",{needs:["login","application"],viewMixins:[],searchText:"",isValidSearchText:!0,humanReadableColumnNames:{uid:"_id",connector:"v.connector",connector_name:"v.connector_name",component:"v.component",resource:"v.resource",entity_id:"d",state:"v.state.val",status:"v.status.val",snooze:"v.snooze",ack:"v.ack",cancel:"v.cancel","ticket.val":"v.ticket.val",output:"output",opened:"t",resolved:"v.resolved",domain:"v.extra.domain",perimeter:"v.extra.perimeter",last_state_change:"v.state.t",output:"v.state.m",pbehaviors:"v.pbehaviors",extra_details:"v.extra_details"},extraDeatialsEntities:[{name:"snooze",value:"v.snooze"},{name:"ticket",value:"v.ticket"},{name:"ack",value:"v.ack"},{name:"pbehaviors",value:"v.pbehaviors"}],init:function(){this._super.apply(this,arguments),s(this,"loaded",!1),s(this,"rights",{list_filters:{checksum:!0}}),s(this,"store",DS.Store.extend({container:a(this,"container")})),this.loadRadioButtonView(),this.loadTemplates(this.get("model.popup"));try{var t=this.get("user_filters").findBy("isActive",!0),e=t?t.filter:void 0}catch(t){var e=void 0}var n=this.get("model.alarms_state_filter.state")||"resolved";this.set("alarmSearchOptions",{tstart:0,tstop:0,opened:"opened"==n,resolved:"resolved"==n,filter:e,search:"",sort_key:this.get("model.default_sort_column.property"),sort_dir:this.get("model.default_sort_column.direction"),skip:0,limit:this.get("model.itemsPerPage")||50})},totalPagess:function(){if(0===a(this,"itemsTotal"))this.set("totalPages",0);else{var t=a(this,"itemsPerPage");this.set("totalPages",Math.ceil(a(this,"itemsTotal")/t))}}.observes("itemsPerPagePropositionSelected","itemsTotal","itemsPerPage"),sendEventt:function(t,e){console.group("sendEvent:",arguments),this.stopRefresh();var n=[];if(c(e)){if(this.get("loaded"))var i=a(this,"alarms");else var i=Ember.A();var r=i.filterBy("isSelected",!0);if(n=this.filterUsableCrecords(t,r),console.log("events:",t,n),!n.length)return void console.error("there is no suitable alarms")}else console.log("event:",t,e),n.pushObject(e);this.processEvent(t,"handle",[n]),this.setPendingOperation(n),console.groupEnd()},alarmsTimestamp:0,timelineListener:function(){this.set("alarmSearchOptions.tstart",this.get("controllers.application.interval.timestamp.$gte")||0),this.set("alarmSearchOptions.tstop",this.get("controllers.application.interval.timestamp.$lte")||0)}.observes("controllers.application.interval.timestamp"),alarmss:function(){this.set("loaded",!1);var t=this.get("alarmSearchOptions"),e=i.getEmberApplicationSingleton().__container__.lookup("adapter:alerts");return DS.PromiseArray.create({promise:e.findQuery("alerts",t).then(function(t){if(t.success)return console.error("loaded alarms: ",a(t,"data.firstObject.alarms")),Ember.totalAlarms=a(t,"data.firstObject.total"),a(t,"data.firstObject.alarms");throw new Error(a(t,"data.msg"))},function(t){return console.error("ERROR in the adapter: ",t),[]}).catch(function(t){return console.error("unexpected error ",t),[]})})}.property("alarmSearchOptions.search","alarmSearchOptions.resolved","alarmSearchOptions.sort_key","alarmSearchOptions.sort_dir","alarmSearchOptions.filter","alarmSearchOptions.skip","alarmSearchOptions.limit","alarmSearchOptions.tstart","alarmSearchOptions.tstop"),fields:function(){return this.parseFields(a(this,"model.columns"))}.property("model.columns"),widgetDataMetas:function(){return{total:this.get("defTotal")||0}}.property("defTotal"),alarms:function(){var t=this,e=a(this,"fields"),n=a(this,"alarmss").map(function(n){n.v.extra_details={},t.get("extraDeatialsEntities").forEach(function(t){n.v.extra_details[t.name]=Ember.Object.create(n).get(t.value)});var i=Ember.Object.create();return e.forEach(function(t){var e=a(Ember.Object.create(n),t.getValue);i[t.name]=e,i[t.humanName]=e}),i.isSelected=!1,i.isExpanded=!1,i.id=n._id,i.entity_id=n.d,i.changed=(new Date).getTime(),i.linklist={event_links:[{url:"http://tasks.info/?co=Demo",label:"test"}]},0==n.d.search("/resource/")&&(i.source_type="resource"),0==n.d.search("/component/")&&(i.source_type="component"),i});return this.set("defTotal",Ember.totalAlarms),this.set("loaded",!0),n}.property("alarmss.@each","fields.[]"),currPage:function(){this.set("alarmSearchOptions.limit",this.get("itemsPerPage")),this.set("alarmSearchOptions.skip",this.get("itemsPerPage")*(this.get("currentPage")-1))}.observes("currentPage","itemsPerPage"),paginationLastItemIndexx:function(){var t=a(this,"itemsPerPage"),e=t*(this.currentPage-1);return Math.min(e+t,a(this,"itemsTotal"))}.property("widgetData","itemsTotal","itemsPerPage","currentPage"),filtersObserver:function(){try{var t=this.get("user_filters");
if(t){var e=t.findBy("isActive",!0);if(e){var n=e.filter||e.get("filter");this.set("alarmSearchOptions.filter",n)}else this.set("alarmSearchOptions.filter",void 0)}else this.set("alarmSearchOptions.filter",void 0)}catch(t){this.set("alarmSearchOptions.filter",void 0)}}.observes("user_filters.@each.isActive"),loadRadioButtonView:function(){view=Ember.View.extend({tagName:"input",type:"radio",attributeBindings:["name","type","value","checked:checked:"],click:function(){this.set("selection",this.$().val())},checked:function(){return this.get("value")==this.get("selection")}.property()});try{Ember.RadioButton||s("Ember.RadioButton",view)}catch(t){}},loadTemplates:function(t){try{Ember.columnTemplates=t.map(function(t){return{columnName:t.column,columnTemplate:Ember.View.extend({template:Ember.HTMLBars.compile(t.template)})}})}catch(t){}},showParams:function(){var t=this,e=["popup","title"];console.error("brick's parameters"),e.forEach(function(e){console.error(e+": "+t.get("model."+e))}),console.error("default_sort_column: "+t.get("model.default_sort_column.property")+"-"+t.get("model.default_sort_column.direction")),console.error("columnts: "+t.get("model.columns").join(" ")),console.error("alarms_state_filter: "+t.get("model.alarms_state_filter.state"))},refreshContent:function(){},fetchAlarms:function(t){var e=this,n=t||{},r=this.get("model.alarms_state_filter.state")||"opened",o={tstart:n.tstart||0,tstop:n.tstop||0,sort_key:n.sort_key||this.get("model.default_sort_column.property"),sort_dir:n.sort_dir||this.get("model.default_sort_column.direction"),search:n.search||"",opened:"opened"==r,resolved:"resolved"==r},s=i.getEmberApplicationSingleton().__container__.lookup("adapter:alerts");s.findQuery("alerts",o).then(function(t){var n=a(t,"data");e.setAlarmsForShow(n[0].alarms)},function(t){})},isValidExpression:function(t){var e={expression:t},n=i.getEmberApplicationSingleton().__container__.lookup("adapter:alertexpression");return DS.PromiseObject.create({promise:n.findQuery("alertexpression",e).then(function(t){if(t.success)return t.data[0];throw new Error(t.data.msg)},function(t){return console.error("ERROR in the adapter: ",t),!1}).catch(function(t){return console.error("unexpected error ",t),!1})})},parseFields:function(t){var e=this,n=[],i=this.get("model.default_sort_column.property"),r=this.get("model.default_sort_column.direction");return n=t.map(function(t){var n={};return n.name=e.get("humanReadableColumnNames")[t]||"v."+t,n.humanName=t,n.isSortable=t==i,n.isASC="ASC"==r,n.getValue=e.get("humanReadableColumnNames")[t]||"v."+t,n})},sortColumn:function(){var t=a(this,"fields").findBy("humanName",a(this,"controller.default_sort_column.property"));if(!t){t=a(this,"fields.firstObject");try{t.isSortable=!0,t.isASC=a(this,"controller.default_sort_column.property")}catch(t){}return console.error('the column "'+a(this,"controller.default_sort_column.property")+'" was not found.'),t}return t}.property("controller.default_sort_column.property","fields.[]"),updateAlarm:function(e){var n=this.get("alarms").findBy("id",e);if(n){var r=this,o=i.getEmberApplicationSingleton().__container__.lookup("adapter:alerts");o.findQuery("alarm","get-current-alarm",{entity_id:n.get("entity_id")}).then(function(e){var i=r.get("fields"),o=e.data[0];o.v=o.value,o._id="aa",o.entity_id=o.data_id,o.d=o.data_id,o.v.pbehaviors=[{tstop:1483311600,enabled:!1,name:"downtime",tstart:1483225200,rrule:"FREQ=WEEKLY"}];var s=Ember.Object.create();i.forEach(function(t){var e=a(Ember.Object.create(o),t.getValue);n.set(t.humanName,e)}),s.isSelected=!1,s.isExpanded=!1,s.id=o._id,s.entity_id=o.d,s.linklist={event_links:[{url:"http://tasks.info/?co=Demo",label:"test"}]},0==o.d.search("/resource/")&&(s.source_type="resource"),0==o.d.search("/component/")&&(s.source_type="component"),Ember.set(n,"changed",(new Date).getTime()),t=2})}else console.error("alarm not found")},actions:{massAction:function(t){this.sendEventt(t.mixin_name)},sendCustomAction:function(t,e){this.sendEventt(t.mixin_name,e)},updateSortField:function(t){this.set("alarmSearchOptions.sort_key",t.name),this.set("alarmSearchOptions.sort_dir",t.isASC?"ASC":"DESC")},search:function(t){var e=this;this.isValidExpression(t).then(function(n){e.set("isValidSearchText",n),n&&e.set("alarmSearchOptions.search",t)})}}},l);n.register("widget:listalarm",m)}});
//# sourceMappingURL=dist/brick.map.js