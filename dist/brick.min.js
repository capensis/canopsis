Ember.Application.initializer({name:"component-querybuilder",initialize:function(e,r){var t=e.lookupFactory("utility:i18n"),o=Ember.set,n=Ember.get,i=Ember.String.loc,l=function(e){var r,t=e.split(" "),o={component:[],resource:[],name:[]};for(r=0;r<t.length;r++){var n=t[r];if(""!==n){var i=n.slice(3)||null;0===n.indexOf("co:")?o.component.push(i):0===n.indexOf("re:")?o.resource.push(i):0===n.indexOf("me:")?o.name.push(i):o.name.push(n)}}var l={$and:[]},a={component:{$or:[]},resource:{$or:[]},name:{$or:[]}};for(var c in a){for(r=0;r<o[c].length;r++){var u={},s=o[c][r];u[c]=null!==s?{$regex:s}:null,a[c].$or.push(u)}var d=a[c].$or.length;1===d&&(a[c]=a[c].$or[0]),d>0&&l.$and.push(a[c])}return 1===l.$and.length&&(l=l.$and[0]),l},a=function(e){for(var r=[],t=Ember.keys(e),o=0;o<t.length;o++){var n=t[o];if(Ember.isArray(e[n]))for(var i=0;i<e[n].length;i++)r=$.unique(r.concat(a(e[n][i])));else"object"===e[n]?(r.push(n),r=$.unique(r.concat(a(e[n])))):r.push(n)}return r=$(r).not(["$eq","$regex","$ne","$gt","$gte","$lt","$lte","$in","$ne","$nin","$exists","$type","$mod","$where","$text"]).get()},c=function(e){var r=Ember.keys(e);if(void 0!==e.$eq)return e.$eq;for(var t=0;t<r.length;t++){var o=r[t];if(Ember.isArray(e[o])){for(var n=[],i=0;i<e[o].length;i++)n.pushObject(c(e[o][i]));e[o]=n}else"object"==typeof e[o]&&(e[o]=c(e[o]))}return e},u=Ember.Component.extend({viewTabColumns:[{name:"connector",title:"connector"},{name:"connector_name",title:"connector_name"},{name:"component",title:"component"},{name:"resource",title:"resource"}],selectionTabColumns:[{name:"connector",title:"connector"},{name:"connector_name",title:"connector_name"},{name:"component",title:"component"},{name:"resource",title:"resource"},{action:"select",actionAll:!0===n(this,"multiselect")?"selectAll":void 0,title:new Ember.Handlebars.SafeString('<span class="glyphicon glyphicon-plus-sign"></span>'),style:"text-align: center;"}],helpModal:{title:i("Syntax"),content:["<ul>","<li><code>co:regex</code> : ",i("look for a component"),"</li>","<li><code>re:regex</code> : ",i("look for a resource"),"</li>","<li><code>me:regex</code> : ",i("look for a metric"),"(<code>me:</code>",i(" isn't needed for this one"),")</li>","<li>",i("combine all of them to improve your search")," : <code>co:regex re:regex me:regex</code></li>","<li><code>co:</code>, <code>re:</code>, <code>me:</code> : ",i("look for non-existant field"),"</li>","</ul>"].join("")},classNames:["query-builder"],selectionTabSearch:null,filterValue:"",actions:{search:function(e){if(e){var r=l(e);o(this,"selectionTabSearch",JSON.stringify(r))}else o(this,"selectionTabSearch",null)},select:function(e){var r=n(this,"filterValue")||"{}";r=JSON.parse(r),r||(r={}),r.$or||(r.$or=[]),r.$and&&(r.$or.pushObject({$and:r.$and}),r={$or:r.$or});var t=n(e,"id");r.$or.findBy("_id",t)||r.$or.pushObject({_id:n(e,"id")}),this.$(".builder").queryBuilder("setRulesFromMongo",r),o(this,"filterValue",JSON.stringify(r,null,2))}},didInsertElement:function(){for(var e=[],r=window.schemasRegistry.getByName("event").schema,o=0;o<r.categories.length;o++)for(var n=r.categories[o].title,i=0;i<r.categories[o].keys.length;i++){var l=r.categories[o].keys[i],u=l.split("."),s=r;$.each(u,function(e,r){s=void 0!==s&&void 0!==s.properties?s.properties[r]:void 0}),void 0===s&&(s={type:"string"});var d=l,p={id:d,label:d,type:s.type,optgroup:n};"boolean"===s.type&&(p.input="radio",p.values={true:"True",false:"False"}),"number"===s.type&&(p.type="integer"),"object"!==s.type&&"array"!==s.type&&e.pushObject(p)}e.pushObject({id:"_id",label:"_id",type:"string",optgroup:"system"});var f=[];for(o=0;o<e.length;o++)f.push(e[o].id);var m=this.get("filterValue")||void 0;if(m&&"{}"!==m){m=JSON.parse(m),m=c(m);var g=a(m);for(g=$(g).not(f).get(),o=0;o<g.length;o++)e.pushObject({id:g[o],label:g[o],type:"string",optgroup:"custom"})}this.$().find(".builder").queryBuilder({filters:e,lang_code:t.lang,plugins:["key-editable-select"]}),m&&"{}"!==m&&this.$().find(".builder").queryBuilder("setRulesFromMongo",m);var h=this;this.$().find(".builder").on("afterUpdateRuleFilter.queryBuilder afterDeleteGroup.queryBuilder afterAddRule.queryBuilder afterDeleteRule.queryBuilder afterUpdateRuleValue.queryBuilder afterUpdateRuleOperator.queryBuilder afterUpdateGroupCondition.queryBuilder",function(){var e=h.$().find(".builder").queryBuilder("getMongo");$.isEmptyObject(e)||h.set("filterValue",JSON.stringify(e,null,2))}),this.$(".btn-reset").on("click",function(){h.$().find(".builder").queryBuilder("reset"),h.set("filterValue","{}")})}});r.register("component:component-querybuilder",u)}});
//# sourceMappingURL=dist/brick.map.js