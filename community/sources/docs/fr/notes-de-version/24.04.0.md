# Notes de version Canopsis 24.04.0

Canopsis 24.04.0 a été publié le 30 avril 2024.

## Procédure d'installation

Suivre la [procédure d'installation de Canopsis](../guide-administration/installation/index.md).

## Procédure de mise à jour

Canopsis 24.04.0 apporte des changements importants tant au niveau technique que fonctionnel.  
À ce titre, le [Guide de migration vers Canopsis 24.04.0](migration/migration-24.04.0.md) doit obligatoirement être suivi pour les installations déjà en place.

## Changements entre Canopsis 23.10 et 24.04

### Refonte de "Timeline" des alarmes

https://git.canopsis.net/canopsis/canopsis-pro/-/issues/5074

### Méthodes de calculs des sévérités

La version originale de calcul de sévévité (d’état) de météo des services se base sur un algorithme pire état.  
Canopsis 24.04 inclut de nouveaux algorithmes de calculs qui s'appuient sur les dépendances d'un service.  

Vous pouvez par exemple exprimer le fait que le service sera en état :

* Critique si plus de 50% de ses dépendances sont en état critique ou
* Majeur si 3 de ses dépendances sont en état mineur ou
* Mineur si 20% des entités sont en état majeur ou
* OK si au moins 1 dépendance est en état OK

Pour cela, des conditions peuvent être définies pour chaque état final du service, comme dans l'illustration ci-dessous :

![services-calcul-etat2.png](./img/services-calcul-etat2.png)

### Recherche avancée dans le bac à alarmes

La recherche avancée du bac à alarme est maintenant dotée d'une aide en ligne qui propose des complétions automatiques concernant les mots clés du langage.  


https://git.canopsis.net/canopsis/canopsis-pro/-/issues/5147


### Montées de version 

Les outils suivants bénéficient de mises à jour :

| Outil       | Version d'origine | Version après 24.04 |
| ----------- | ----------------- | ------------------- |
| MongoDB     | 5                 | 7                   |

Les instructions pour leur mise à jour sont précisées dans le [guide de migration](migration/migration-24.04.0.md).

### Liste des modifications

*  **Général :**
    * Les appels au shell de mongoDB via la commande `mongo` ont été remplacés par des appels via la commande `mongosh` (#5267)
    * Ajout des fonctions suivantes dans les templates GO : `substrLeft`, `substrRight`, `substr`, `strlen`, `strpos`, `add`, `sub`, `mult`, `div` (#5286)
*  **UI :**
    * Amélioration de la fonction de vérification des patterns (#4641)
    * **Bac à alarmes**
        * Lorsque l'on souhaite ajouter une alarme dans une méta alarme manuellement, l'option "Résolution automatique" n'est plus visible (#5345)
    * **Consignes**
        * Ajout de le colonne "Priorité" dans la liste des consignes (#5288)
        * Lorsqu'une consigne n'a pas été approuvée, elle n'est désormais plus supprimée et peut être éditée (#5107)
*  **API :**
    * Correction d'un bug qui empêchait la création d'un service avec le même nom qu'un service précédemment supprimé (#5218)
    * L'API `PUT /api/v4/contextgraph/import` a été supprimée et remplacée par `PUT /api/v4/contextgraph-import` (#5254)
    * Ajout de l'API `PATCH /api/v4/users/{id}` (#5299)
*  **Moteurs :**
    * **Remediation**
        * La collection mongoDB `instruction_week_stats` est maintenant gérée dans TimescaleDB (#5152)
*  **Connecteurs :**
    * **Adapteur Centreon**
        * L'adapteur Centreon capable de gérer les comportements périodiques du connecteur Centreon Legacy (à présent obsolète) a été supprimé (#5347)
*  **Documentation :**
    * [Paramètres de calcul d'état/sévérité](../../guide-utilisation/menu-administration/parametres-de-calculd-etat-sévérité/)
    * [Les Services](../../guide-utilisation/services/)
    * [Templates GO](../../guide-utilisation/templates-go/)
