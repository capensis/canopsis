# Notes de version Canopsis 4.3.0

Canopsis 4.3.0 a été publié le xx août 2021.

## Procédure d'installation

Suivre la [procédure d'installation de Canopsis](../guide-administration/installation/index.md).


## Procédure de mise à jour

Canopsis 4.3.0 propose des changements importants tant au niveau technique que fonctionnel. A ce titre un [Guide de migration vers Canopsis 4.3.0](migration/migration-4.3.0.md) doit **obligatoirement** être suivi pour les installations déjà en place.  

!!! Note
    Ce guide sera publié prochainement. En attendant, vous pouvez utiliser cette version en démarrant de 0.

## Changements entre Canopsis 4.2.0 et 4.3.0

## Che external datasource

Il faut préciser que le plugin che de datasource externe est cassé pour le moment
https://git.canopsis.net/canopsis/canopsis-pro/-/issues/3748

### Watchers / Services

La notion de `Watcher` a été supprimée de Canopsis; 
Remplacement par arbre de dépendances/services

### Migration API v2 v4

La quasi totalité des API bénéficient d'une montée de version.  
Le préfixe qui été auparavant `/api/v2` devient `/api/v4`.  

Si vous utilisez actuellement ces API dans des scripts, des applications tierces, vous devez les adapter pour être compatibles avec ces nouvelles API.  
!!!warning "Avertissement"
    Il ne s'agit pas forcément que de remplacer le préfixe.  Certaines structures ont également évolué. 
    Vous pouvez consulter les définitions et structures des API sur [la page de documentation dédiée](https://doc.canopsis.net/guide-developpement/swagger/).

### Idle-rules

La fonctionnalité `idle-rules` a été revue dans cette version.  
Il s'agit de la possibilité de réagir (exécuter des actions) lorsqu'aucun événement ou changement n'a lieu sur une alarme ou une entité durant une période.  
Quelques cas d'usage :  

* Une alarme n'a pas reçu d'acquittement alors qu'elle a été créée il y a 30 minute; Une augmentation de la sévérité est exécutée
* Certaines sources de données ne sont pas en mesure de générer des contre alarmes; Si aucune mise à jour d'alarme dans ce cas n'est reçu pendant 10 minutes alors Canopsis clôture l'alarme

La documentation de cette fonctionnalité arrive prochainement.

### Junit

Dans Canopsis 4.3.0 nous introduisons un module capable de recevoir des résultats d'exécution de scénarios au format [XML Junit](https://fr.wikipedia.org/wiki/JUnit).  
Le module comprend : 

* Un récepteur (via API) de fichierx XML au format Junit
* Un moteur capable de parser, générer des alarmes à partir des résultats reçus
* Un widget pour l'interface graphique capable de présenter les résultats sous diverses formes

La documentation complète sera publiée prochainement.  

Voici quelques copies d'écran pour vous donner un aperçu.  

!!!warning "Avertissement"
    Nous n'assurons pas de support sur ce module pour le moment qui est publié en version Beta


![junit-screenshot1](./img/4.3.0-junit-screenshot1.png){: .link width=80%"}
![junit-screenshot2](./img/4.3.0-junit-screenshot2.png){: .link width=80%"}

![junit-screenshot3](./img/4.3.0-junit-screenshot3.png){: .link width=80%"}

![junit-screenshot4](./img/4.3.0-junit-screenshot4.png){: .link width=80%"}

![junit-screenshot5](./img/4.3.0-junit-screenshot5.png){: .link width=80%"}


### Liste des modifications


*  **UI :**
    * Les menus **Exploitation** et **Administration** ont été réorganisés ([#423](https://git.canopsis.net/canopsis/canopsis-pro/-/issues/423))
    * **Weather widget**
        * Résolution d'un bug qui empêchait l'affichage correct d'un comportement périodique ([#142](https://git.canopsis.net/canopsis/canopsis-pro/-/issues/142))
    * **Eventfilter**
        * Homogénéisation des colonnes affichées dans la liste des règles d'eventfilter ([#490](https://git.canopsis.net/canopsis/canopsis-pro/-/issues/490))
    * **Scenarios**
        * Ajout de l'auteur dans les colonnes de la liste des scénarios ([#50](https://git.canopsis.net/canopsis/canopsis-pro/-/issues/50))
    * **Comportements périodiques**
        * Ajout du support de la syntaxe `LIKE` dans la fonction de recherche ([#217](https://git.canopsis.net/canopsis/canopsis-pro/-/issues/217))
    * **Explorateur de contexte**
        * Correction d'un bug qui empêchait l'utilisation de l'opérateur "NOT" dans la recherche ([#3747](https://git.canopsis.net/canopsis/canopsis-pro/-/issues/3747))
    * **Bac à alarmes**
        * Correction d'un bug qui rendait le tri des durées d'alarmes inopérant ([#402](https://git.canopsis.net/canopsis/canopsis-pro/-/issues/402))
    * **Remediation**
        * Ajout d'un tooltip de réussite d'exécution d'un job ([#145](https://git.canopsis.net/canopsis/canopsis-pro/-/issues/145))
        * L'auteur d'une consigne ou d'une configuration de consigne est maintenant présenté correctement (au lieu de son _id) ([#213](https://git.canopsis.net/canopsis/canopsis-pro/-/issues/213))


*  **API :**
    * Ajout d'un mécanisme de validation d'ID ([#222](https://git.canopsis.net/canopsis/canopsis-pro/-/issues/222))
    * Correction d'un bug qui empêchait de supprimer des objets dont l'id contenait des caractères spéciaux ([#58](https://git.canopsis.net/canopsis/canopsis-pro/-/issues/58),[#151](https://git.canopsis.net/canopsis/canopsis-pro/-/issues/151))
    * **Event**
        * Ajout du support `url-encoded` ([#263](https://git.canopsis.net/canopsis/canopsis-pro/-/issues/263))
    * **Pbehavior**
        * Ajout d'un mécanisme d'avertissement du nombre d'entités impactées par un filtre de pbehavior ([#139](https://git.canopsis.net/canopsis/canopsis-pro/-/issues/139))
    * **Scenarios**
        * Support de l'action `changestate`i vers criticité "Info"  ([#53](https://git.canopsis.net/canopsis/canopsis-pro/-/issues/53))
        * Il est maintenant possible de spécifier un identifiant (_id) dans un payload de règles ([#3750](https://git.canopsis.net/canopsis/canopsis-pro/-/issues/3750))


*  **Moteurs :**
    * **CHE**
        * Mise à disposition de deux nouvelles actions d'enrichissement ([#212](https://git.canopsis.net/canopsis/canopsis-pro/-/issues/212))
    * **Fifo**
        * Début de support des statistiques de traitement d'événements ([#127](https://git.canopsis.net/canopsis/canopsis-pro/-/issues/127))
    * **Correlation**
        * La politique des dates `last_update_date` et `last_event_date` des méta alarmes a été revue ([#352](https://git.canopsis.net/canopsis/canopsis-pro/-/issues/352))

*  **Général :**
    * Il est maintenant possible de connaitre l'origine d'une action; un attribut **initiator** fait son apparition ([#136](https://git.canopsis.net/canopsis/canopsis-pro/-/issues/136))
    * Les fonctions des [templates GO], notamment `uppercase` et `lowercase`(https://doc.canopsis.net/guide-administration/architecture-interne/templates-golang/) sont maintenant disponibles de manière homogène dans Canopsis ([#3717](https://git.canopsis.net/canopsis/canopsis-pro/-/issues/3717)

