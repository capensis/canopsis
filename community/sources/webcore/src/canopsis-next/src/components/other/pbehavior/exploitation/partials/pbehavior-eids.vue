<template lang="pug">
  v-card
    v-layout(row)
      v-flex(xs4)
        search-field(v-model="pagination.search", @submit="submitSearch", @clear="clearSearch")
    v-card-text
      v-data-iterator.data-iterator(
        :items="eids",
        :loading="pending",
        :pagination.sync="pagination",
        :total-items="meta.total_count",
        item-key="id"
      )
        v-flex(slot="header")
          v-fade-transition
            v-progress-linear.ma-0(
              v-show="pending",
              :height="3",
              color="primary",
              indeterminate
            )
        v-flex(slot="item", slot-scope="{ item }")
          v-card
            v-card-title {{ item.id }}
          v-divider
        v-flex(slot="no-data")
          v-card
            v-card-title {{ $t('tables.noData') }}
</template>

<script>
import entitiesPbehaviorEidsMixin from '@/mixins/entities/pbehavior/eids';
import localQueryMixin from '@/mixins/query-local/query';

import SearchField from '@/components/forms/fields/search-field.vue';

export default {
  components: { SearchField },
  mixins: [localQueryMixin, entitiesPbehaviorEidsMixin],
  props: {
    pbehavior: {
      type: Object,
      default: () => ({}),
    },
  },
  data() {
    return {
      pending: false,
      meta: {},
      eids: [],
    };
  },
  mounted() {
    this.fetchList();
  },
  methods: {
    async fetchList() {
      this.pending = true;

      const { data: eids, ...meta } = await this.fetchPbehaviorEidsListWithoutStore({
        id: this.pbehavior._id,
        params: this.getQuery(),
      });

      this.meta = meta;
      this.eids = eids;

      this.pending = false;
    },

    submitSearch(search = '') {
      this.query = {
        ...this.query,
        search,
      };
    },

    clearSearch() {
      this.submitSearch();
    },
  },
};
</script>
