<template lang="pug">
  div
    categories-list(v-if="asList", :categories="filteredCategories", :limit="limit")
    v-menu(v-else, :disabled="isDisabled", @click.native.stop)
      v-btn(slot="activator", :disabled="isDisabled", depressed, small) {{ $t('common.links') }}
      v-list(dark, dense)
        categories-list(:categories="filteredCategories")
</template>

<script>
import { BUSINESS_USER_PERMISSIONS_ACTIONS_MAP, WIDGETS_ACTIONS_TYPES } from '@/constants';

import { harmonizeCategories } from '@/helpers/links';

import { authMixin } from '@/mixins/auth';

import CategoriesList from './category-links/categories-list.vue';

export default {
  components: { CategoriesList },
  mixins: [authMixin],
  props: {
    links: {
      type: Object,
      default: () => ({}),
    },
    asList: {
      type: Boolean,
      default: false,
    },
    limit: {
      type: Number,
      required: false,
    },
  },
  computed: {
    filteredCategories() {
      return harmonizeCategories(this.links, this.checkAccessForSpecialCategory);
    },

    /**
     * If there are no links, in every category
     */
    isDisabled() {
      return Object.values(this.links).every(element => !element.length);
    },

    /**
     * Check if user has access to all links/categories
     */
    hasAccessToLinks() {
      return this.checkAccess(BUSINESS_USER_PERMISSIONS_ACTIONS_MAP.alarmsList[WIDGETS_ACTIONS_TYPES.alarmsList.links]);
    },
  },
  methods: {
    checkAccessForSpecialCategory(category) {
      const permissionPrefix = BUSINESS_USER_PERMISSIONS_ACTIONS_MAP.alarmsList[WIDGETS_ACTIONS_TYPES.alarmsList.links];
      const permission = `${permissionPrefix}_${category}`;

      return this.hasAccessToLinks || this.checkAccess(permission);
    },
  },
};
</script>
