<template lang="pug">
  div
    slot(name="prepend")
    movable-card-iterator-item.my-2(
      v-for="(item, index) in items",
      :key="item[itemKey]",
      :disabled-up="index === 0",
      :disabled-down="index === items.length - 1",
      @up="up(index)",
      @down="down(index)",
      @remove="removeItemFromArray(index)"
    )
      template
        slot(name="item", :item="item", :index="index")
    slot(name="append")
    v-layout(row, wrap)
      v-btn.mr-2.mx-0(
        v-if="addable",
        color="primary",
        outline,
        @click.prevent="$emit('add')"
      ) {{ $t('common.add') }}
      slot(name="actions")
</template>

<script>
import { formArrayMixin } from '@/mixins/form';

import MovableCardIteratorItem from './movable-card-iterator-item.vue';

export default {
  components: { MovableCardIteratorItem },
  mixins: [formArrayMixin],
  model: {
    prop: 'items',
    event: 'input',
  },
  props: {
    items: {
      type: Array,
      default: () => [],
    },
    itemKey: {
      type: String,
      default: 'key',
    },
    addable: {
      type: Boolean,
      default: false,
    },
  },
  methods: {
    moveItemByOffset(index, offset) {
      const items = [...this.items];
      const temp = items[index];

      items[index] = items[index + offset];
      items[index + offset] = temp;

      this.updateModel(items);
    },

    up(index) {
      if (index > 0) {
        this.moveItemByOffset(index, -1);
      }
    },

    down(index) {
      if (index < this.items.length - 1) {
        this.moveItemByOffset(index, 1);
      }
    },
  },
};
</script>
