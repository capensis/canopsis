<template lang="pug">
  div
    c-page-header
    pbehaviors-list(
      :pagination.sync="pagination",
      :pbehaviors="pbehaviors",
      :total-items="pbehaviorsMeta.total_count",
      :pending="pbehaviorsPending",
      @edit="showEditPbehaviorModal",
      @duplicate="showDuplicatePbehaviorModal",
      @remove="showDeletePbehaviorModal",
      @remove-selected="showDeleteSelectedPbehaviorsModal"
    )
    c-fab-expand-btn(:has-access="hasCreateAnyPbehaviorAccess", @refresh="fetchList")
      c-action-fab-btn(
        :tooltip="$t('common.addPbehavior')",
        color="primary",
        icon="pause",
        @click="showCreatePbehaviorModal"
      )
      c-action-fab-btn(
        :tooltip="$t('modals.pbehaviorsCalendar.title')",
        color="secondary",
        icon="calendar_today",
        @click="showPbehaviorsCalendarModal"
      )
</template>

<script>
import { MODALS } from '@/constants';

import { entitiesPbehaviorMixin } from '@/mixins/entities/pbehavior';
import { permissionsTechnicalExploitationPbehaviorMixin } from '@/mixins/permissions/technical/exploitation/pbehavior';
import { localQueryMixin } from '@/mixins/query-local/query';

import PbehaviorsList from '@/components/other/pbehavior/exploitation/pbehaviors-list.vue';

export default {
  components: {
    PbehaviorsList,
  },
  mixins: [
    localQueryMixin,
    entitiesPbehaviorMixin,
    permissionsTechnicalExploitationPbehaviorMixin,
  ],
  mounted() {
    this.fetchList();
  },
  methods: {
    showCreatePbehaviorModal() {
      this.$modals.show({
        name: MODALS.pbehaviorPlanning,
        config: {
          afterSubmit: this.fetchList,
        },
      });
    },

    showPbehaviorsCalendarModal() {
      this.$modals.show({
        name: MODALS.pbehaviorsCalendar,
        config: {
          afterSubmit: this.fetchList,
        },
      });
    },

    showEditPbehaviorModal(pbehavior) {
      this.$modals.show({
        name: MODALS.pbehaviorPlanning,
        config: {
          pbehaviors: [pbehavior],
          afterSubmit: this.fetchList,
        },
      });
    },

    showDuplicatePbehaviorModal(pbehavior) {
      this.$modals.show({
        name: MODALS.pbehaviorPlanning,
        config: {
          pbehaviorsToAdd: [pbehavior],
          afterSubmit: this.fetchList,
        },
      });
    },

    showDeletePbehaviorModal(id) {
      this.$modals.show({
        name: MODALS.confirmation,
        config: {
          action: async () => {
            await this.removePbehavior({ id });
            await this.fetchList();
          },
        },
      });
    },

    showDeleteSelectedPbehaviorsModal(selected) {
      this.$modals.show({
        name: MODALS.confirmation,
        config: {
          action: async () => {
            await this.removePbehaviors(selected);
            await this.fetchList();
          },
        },
      });
    },

    fetchList() {
      this.fetchPbehaviorsList({ params: this.getQuery() });
    },
  },
};
</script>
