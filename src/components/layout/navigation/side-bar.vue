<template lang="pug">
  v-navigation-drawer.side-bar.grey.darken-4(
  v-model="isOpen",
  :clipped="$mq | mq({ m: false, l: true })",
  :width="width",
  absolute,
  app,
  )
    v-expansion-panel.panel(
    expand,
    focusable,
    dark
    )
      v-expansion-panel-content(v-for="group in groups", :key="group._id").grey.darken-4.white--text
        div(slot="header")
          span {{ group.name }}
          v-btn(
          v-show="editing",
          depressed,
          small,
          icon,
          color="grey darken-3",
          @click.stop="showEditGroupModal(group)"
          )
            v-icon(small) edit
        v-card.grey.darken-3.white--text(v-for="view in group.views", :key="view._id")
          v-card-text
            router-link(:to="{ name: 'view', params: { id: view._id } }")
              span {{ view.title }}
              v-btn(
              v-show="editing",
              depressed,
              small,
              icon,
              color="grey darken-2",
              @click.prevent="showEditViewModal(view)"
              )
                v-icon(small) edit
    v-divider
    div
      v-speed-dial(
      v-model="fab"
      bottom,
      right,
      direction="top"
      transition="slide-y-reverse-transition"
      )
        v-btn(
        slot="activator",
        v-model="fab"
        color="blue darken-2",
        dark,
        fab
        )
          v-icon settings
          v-icon close
        v-btn(
        v-model="editing"
        small,
        fab,
        dark,
        color="blue darken-4",
        @click.stop="editModeToggle"
        )
          v-icon(dark) edit
          v-icon(dark) done
        v-btn(
        small,
        fab,
        dark,
        color="green darken-4",
        @click="showCreateViewModal"
        )
          v-icon(dark) add
</template>

<script>
import { SIDE_BAR_WIDTH } from '@/config';
import { MODALS } from '@/constants';

import modalMixin from '@/mixins/modal/modal';
import entitiesViewGroupMixin from '@/mixins/entities/view/group';

/**
 * Component for the side-bar, on the left of the application
 *
 * @prop {bool} [value=false] - visibility control
 *
 * @event input#update
 */
export default {
  mixins: [
    modalMixin,
    entitiesViewGroupMixin,
  ],
  props: {
    value: {
      type: Boolean,
      default: false,
    },
  },
  data() {
    return {
      fab: false,
      editing: false,
      width: SIDE_BAR_WIDTH,
    };
  },
  computed: {
    isOpen: {
      get() {
        return this.value;
      },
      set(value) {
        if (value !== this.value) {
          this.$emit('input', value);
        }
      },
    },
  },
  mounted() {
    this.fetchGroupsList();
  },
  methods: {
    editModeToggle() {
      this.editing = !this.editing;
    },

    showEditGroupModal(group) {
      this.showModal({
        name: MODALS.createGroup,
        config: { group },
      });
    },

    showEditViewModal(view) {
      this.showModal({
        name: MODALS.createView,
        config: { view },
      });
    },

    showCreateViewModal() {
      this.showModal({
        name: MODALS.createView,
      });
    },
  },
};
</script>

<style scoped>
  .v-speed-dial {
    position: fixed;
  }

  a {
    color: inherit;
    text-decoration: none;
  }
  .panel {
    box-shadow: none;
  }

  .side-bar {
    position: fixed;
    height: 100vh;
    overflow-y: auto;
  }
</style>
