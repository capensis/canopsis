<template lang="pug">
  div
    v-layout(justify-end)
      v-btn(@click="showCreateRuleModal", fab, icon)
        v-icon add
    v-data-table(
    :items="items",
    :headers="headers",
    :loading="getEventFilterRulePending"
    )
      template(slot="items", slot-scope="props")
        td {{ props.item.type }}
        td {{ props.item.pattern }}
        td {{ props.item.priority }}
        td {{ props.item.enabled }}
        td
          v-layout
            v-btn(@click="showEditRuleModal(props.item)", icon, small)
              v-icon edit
            v-btn(@click="showDuplicateRuleModal(props.item)", icon, small)
              v-icon file_copy
            v-btn(@click="showRemoveRuleModal(props.item._id)", icon, small)
              v-icon.error--text delete
</template>

<script>
import { MODALS } from '@/constants';

import modalMixin from '@/mixins/modal/modal';
import entityEventFilterMixin from '@/mixins/entities/event-filter';

export default {
  mixins: [modalMixin, entityEventFilterMixin],
  data() {
    return {
      headers: [
        {
          text: 'Type',
          value: 'type',
        },
        {
          text: 'Pattern',
          value: 'pattern',
        },
        {
          text: 'Priority',
          value: 'priority',
        },
        {
          text: 'Enabled',
          value: 'enabled',
        },
        {
          text: 'Actions',
          sortable: false,
        },
      ],
    };
  },
  mounted() {
    this.fetchEventFilterRulesList();
  },
  methods: {
    showCreateRuleModal() {
      this.showModal({
        name: MODALS.createEventFilterRule,
        config: {
          title: this.$t('modals.eventFilterRule.create.title'),
          action: rule => this.createEventFilterRuleWithPopup(rule),
        },
      });
    },

    showDuplicateRuleModal(rule) {
      this.showModal({
        name: MODALS.createEventFilterRule,
        config: {
          title: this.$t('modals.eventFilterRule.duplicate.title'),
          rule,
          action: newRule => this.duplicateEventFilterRuleWithPopup(newRule),
        },
      });
    },

    showRemoveRuleModal(ruleId) {
      this.showModal({
        name: MODALS.confirmation,
        config: {
          action: () => this.removeEventFilterRule({ id: ruleId }),
        },
      });
    },

    showEditRuleModal(rule) {
      this.showModal({
        name: MODALS.createEventFilterRule,
        config: {
          title: this.$t('modals.eventFilterRule.edit.title'),
          rule,
          action: editedRule => this.editEventFilterRuleWithPopup(rule._id, editedRule),
        },
      });
    },
  },
};
</script>

